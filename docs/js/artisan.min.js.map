{"version":3,"sources":["docs/js/artisan.js"],"names":["angular","module","service","$http","$promise","$timeout","environment","$httpPromise","method","url","data","promise","api","then","response","resolve","e","status","error","reject","$get","$post","$put","$patch","$delete","$fake","deferred","$q","defer","this","get","post","put","patch","delete","fake","app","factory","Rect","x","y","w","h","mult","rect","value","prototype","offset","reduce","size","reduceRect","offsetRect","expandRect","expand","intersect","top","right","bottom","left","center","topLeft","topRight","bottomRight","bottomLeft","setX","setY","setW","setH","setPos","setSize","copy","clone","toString","Color","r","g","b","a","arguments","length","uint","parseInt","componentToHex","c","hex","luma","color","dot","contrast","darker","pow","min","Math","max","floor","lighter","toUint","toHex","toRgba","toFixed","alpha","makeSet","foreground","border","light","Shape","shapeCircle","p","cx","cy","sa","ea","PI","ctx","arc","shapeStar","or","ir","steps","angle","step","moveTo","i","cos","sin","lineTo","shapeRoundRect","undefined","tl","tr","br","bl","defaultRadius","key","quadraticCurveTo","circle","params","Array","slice","call","beginPath","apply","closePath","star","roundRect","constant","black","white","blue","red","lightBlue","lightYellow","greyLighter","greyLight","greyMedium","grey","map","Painter","Palette","painter","buffer","pool","rows","getRect","row","canvas","width","height","setCanvas","document","createElement","drawImage","add","path","palette","isString","img","Image","onload","addShape","onerror","src","callback","save","clip","translate","restore","draw","target","pre","drawRect","tint","setFill","fillRect","globalCompositeOperation","console","log","pattern","drawPattern","fillStyle","createPattern","toDataURL","PainterColors","drawingRect","setColors","colors","forEach","offsetWidth","offsetHeight","getContext","lineCap","clear","resize","setText","font","align","verticalAlign","textAlign","textBaseline","setStroke","strokeStyle","lineWidth","fillText","text","point","maxLength","substr","trim","strokeRect","fill","stroke","begin","close","rotate","xy","image","t","s","flip","scale","Api","$location","$routeParams","Doc","item","extend","statics","current","menu","items","doc","Event","element","documentNode","documentElement","body","parentNode","scroll","window","pageXOffset","scrollLeft","pageYOffset","scrollTop","type","view","getWidth","getHeight","node","getNode","offsetLeft","offsetTop","getBoundingClientRect","page","getPage","relative","absolute","originalEvent","self","innerWidth","clientWidth","innerHeight","clientHeight","standardEvents","touchEvents","indexOf","event","touches","changedTouches","pageX","pageY","Events","onClick","events","listeners","click","onMouseDown","down","removeTouchEvents","onMouseMove","move","onMouseUp","up","onResize","onTouchStart","removeStandardEvents","onTouchMove","onTouchEnd","getElement","scope","standard","touch","windowElement","listener","remove","on","$on","off","filter","$filter","array","filters","directive","restrict","templateUrl","transclude","message","link","attributes","model","$parse","formatLabel","string","prepend","expression","splitted","split","formatted","shift","index","join","uniqueId","template","control","ngModel","required","form","title","placeholder","source","label","require","controller","optionLabel","getOptions","number","field","replace","format","precision","validate","minLength","Number","POSITIVE_INFINITY","options","focus","visible","onChange","$parent","onFilter","getType","getClasses","control-focus","control-success","$valid","control-error","$invalid","$submitted","$touched","control-empty","$viewValue","getMessages","$error","toggleVisibility","$templateCache","$compile","compile","onRemove","getter","numberPicker","setter","assign","onAdd","removeListeners","nodeRemove","nodeAdd","querySelectorAll","onFocus","$modelValue","$setViewValue","doBlur","onBlur","$formatters","push","$parsers","unshift","valid","String","$setValidity","Hash","Object","defineProperties","enumerable","writable","has","id","getId","hash","set","newItem","keys","oldItem","splice","addMany","removeMany","removeAll","each","forward","reverse","sort","d","backward","differs","updatePool","pools","tap","onDown","removeClass","style","setTimeout","addClass","ngBind","href","ngHref","ngClick","appendChild","priority","$templateRequest","$controller","Utils","compileController","html","contents","$scope","$new","controllerAs","children","modal","modalView","provider","when","routes","modals","popModal","m","active","closeModal","addModal","back","Nav","$watch","isArray","onLink","onNav","nav","setItems","itemOpen","immediate","state","$nav","closed","closing","opening","opened","itemClose","o","itemToggle","parent","onTap","trigger","output","resolved","rejected","navItem","prevent","preventDefault","querySelector","$silent","defaults","setNav","setNavs","level","addItems","getLink","itemOrItems","addItem","silent","all","promises","redirect","msecs","doRedirect","$$lastRequestedPath","doRetry","$rootScope","unlink","$$listeners","$locationChangeSuccess","name","relink","$path","location","State","errors","isReady","idle","isBusy","isError","isErroring","isSuccess","isSuccessing","button","busy","ready","success","enabled","errorMessage","submitClass","successing","errorring","labels","addons","classes","$window","Cookie","TIMEOUT","_set","days","expires","date","Date","setTime","getTime","toGMTString","cookie","exists","cookieName","ca","charAt","substring","JSON","parse","decodeURIComponent","atob","cache","json","stringify","btoa","encodeURIComponent","checkCookie","elapsed","timeout","interval","LocalStorage","isSupported","supported","localStorage","setItem","removeItem","storageEvent","clearTimeout","newValue","SessionStorage","sessionStorage","Vector","make","sqrt","normalize","l","incidence","atan2","distance","cross","difference","power","abs","towards","friction","getTouch","previous","getRelativeTouch","getClosest","el","selector","matchesFn","some","fn","parentElement","getClosestElement","throttle","func","wait","context","args","result","later","leading","getNow","now","remaining","trailing","where","query","found","reverseSortOn","reducer","reducerSetter","reducerAdder","downloadFile","content","download","createEvent","anchor","base64","downloadName","lastIndexOf","initEvent","dispatchEvent","open","blob","Blob","reader","FileReader","readAsDataURL","onloadend","serverDownload","uri","extension","input","action","enctype","submit","removeChild","lastTime","vendors","requestAnimationFrame","cancelAnimationFrame","currTime","timeToCall","defineProperty","TypeError","len","k","ua","navigator","userAgent","toLowerCase","safari","msie","chrome","mobile","toMd5","Md5","encode","getElementsByTagName"],"mappings":"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","file":"artisan.min.js","sourcesContent":["/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan', ['ng', 'ngRoute', 'ngMessages']);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.service('WebApi', ['$http', '$promise', '$timeout', 'environment',\r\n        function($http, $promise, $timeout, environment) {\r\n\r\n            function $httpPromise(method, url, data) {\r\n                return $promise(function(promise) {\r\n\r\n                    $http[method](environment.api + url, data).then(function(response) {\r\n                        promise.resolve(response.data);\r\n\r\n                    }, function(e, status) {\r\n                        var error = (e && e.data) ? e.data : {};\r\n                        error.status = e.status;\r\n                        promise.reject(error);\r\n\r\n                    });\r\n                });\r\n            }\r\n\r\n            function $get(url) {\r\n                return $httpPromise('get', url);\r\n            }\r\n\r\n            function $post(url, data) {\r\n                return $httpPromise('post', url, data);\r\n            }\r\n\r\n            function $put(url, data) {\r\n                return $httpPromise('put', url, data);\r\n            }\r\n\r\n            function $patch(url, data) {\r\n                return $httpPromise('patch', url, data);\r\n            }\r\n\r\n            function $delete(url) {\r\n                return $httpPromise('delete', url);\r\n            }\r\n\r\n            function $fake(data) {\r\n                var deferred = $q.defer();\r\n                $timeout(function() {\r\n                    deferred.resolve({ data: data });\r\n                }, 1000);\r\n                return deferred.promise;\r\n            }\r\n\r\n            this.get = $get;\r\n            this.post = $post;\r\n            this.put = $put;\r\n            this.patch = $patch;\r\n            this.delete = $delete;\r\n            this.fake = $fake;\r\n\r\n        }\r\n    ]);\r\n\r\n}());\n/* global angular, firebase */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('Rect', [function() {\n        function Rect(x, y, w, h) {\n            this.x = x || 0;\n            this.y = y || 0;\n            this.w = w || 0;\n            this.h = h || 0;\n        }\n        Rect.mult = function(rect, value) {\n            rect.x *= value;\n            rect.y *= value;\n            rect.w *= value;\n            rect.h *= value;\n            return rect;\n        };\n        Rect.prototype = {\n            mult: function(value) {\n                return Rect.mult(this, value);\n            },\n            offset: function(x, y) {\n                this.x += x;\n                this.y += y;\n                return this;\n            },\n            reduce: function(size) {\n                return this.offset(-size);\n            },\n            reduceRect: function(rect) {\n                return this.offsetRect(Rect.mult(rect, -1));\n            },\n            expandRect: function(rect) {\n                this.x -= rect.x || 0;\n                this.y -= rect.y || 0;\n                this.w += rect.w || 0;\n                this.h += rect.h || 0;\n                return this;\n            },\n            expand: function(size) {\n                return this.expandRect({ x: size, y: size, w: size * 2, h: size * 2 });\n            },\n            intersect: function(rect) {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return !(rect.x > x + w || rect.x + rect.w < x || rect.y > y + h || rect.y + rect.h < y);\n            },\n            top: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x + w / 2, y: y };\n            },\n            right: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x + w, y: y + h / 2 };\n            },\n            bottom: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x + w / 2, y: y + h };\n            },\n            left: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x, y: y + h / 2 };\n            },\n            center: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x + w / 2, y: y + h / 2 };\n            },\n            topLeft: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x, y: y };\n            },\n            topRight: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x + w, y: y };\n            },\n            bottomRight: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x + w, y: y + h };\n            },\n            bottomLeft: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x, y: y + h };\n            },\n            setX: function(x) {\n                this.x = x;\n                return this;\n            },\n            setY: function(y) {\n                this.y = y;\n                return this;\n            },\n            setW: function(w) {\n                this.w = w;\n                return this;\n            },\n            setH: function(h) {\n                this.h = h;\n                return this;\n            },\n            setPos: function(x, y) {\n                this.x = x;\n                this.y = y;\n                return this;\n            },\n            setSize: function(w, h) {\n                this.w = w;\n                this.h = h;\n                return this;\n            },\n            copy: function(rect) {\n                this.x = rect.x;\n                this.y = rect.y;\n                this.w = rect.w;\n                this.h = rect.h;\n                return this;\n            },\n            clone: function() {\n                return new Rect(this.x, this.y, this.w, this.h);\n            },\n            toString: function() {\n                return '{' + this.x + ',' + this.y + ',' + this.w + ',' + this.h + '}';\n            },\n        };\n        return Rect;\n    }]);\n\n    app.factory('Color', [function() {\n        function Color(r, g, b, a) {\n            if (arguments.length > 1) {\n                this.r = (r || r === 0) ? r : 0;\n                this.g = (g || g === 0) ? g : 0;\n                this.b = (b || b === 0) ? b : 0;\n                this.a = (a || a === 0) ? a : 255;\n            } else {\n                var uint = r || '0xffffff';\n                uint = parseInt(uint);\n                if (r.length > 8) {\n                    this.r = uint >> 24 & 0xff;\n                    this.g = uint >> 16 & 0xff;\n                    this.b = uint >> 8 & 0xff;\n                    this.a = uint >> 0 & 0xff;\n                } else {\n                    this.r = uint >> 16 & 0xff;\n                    this.g = uint >> 8 & 0xff;\n                    this.b = uint >> 0 & 0xff;\n                    this.a = 255;\n                }\n            }\n        }\n        Color.componentToHex = function(c) {\n            var hex = c.toString(16);\n            return hex.length == 1 ? '0' + hex : hex;\n        };\n        Color.luma = function(color) {\n            // var luma = color.dot({ r: 54.213, g: 182.376, b: 18.411 });\n            var luma = color.dot({ r: 95, g: 100, b: 60 });\n            return luma;\n        };\n        Color.contrast = function(color) {\n            var luma = Color.luma(color);\n            if (luma > 0.6) {\n                return new Color('0x000000');\n            } else {\n                return new Color('0xffffff');\n            }\n        };\n        Color.darker = function(color, pow, min) {\n            min = min || 0;\n            var r = Math.max(Math.floor(color.r * min), Math.floor(color.r - 255 * pow));\n            var g = Math.max(Math.floor(color.g * min), Math.floor(color.g - 255 * pow));\n            var b = Math.max(Math.floor(color.b * min), Math.floor(color.b - 255 * pow));\n            return new Color(r, g, b, color.a);\n        };\n        Color.lighter = function(color, pow, max) {\n            max = max || 1;\n            var r = Math.min(color.r + Math.floor((255 - color.r) * max), Math.floor(color.r + 255 * pow));\n            var g = Math.min(color.g + Math.floor((255 - color.g) * max), Math.floor(color.g + 255 * pow));\n            var b = Math.min(color.b + Math.floor((255 - color.b) * max), Math.floor(color.b + 255 * pow));\n            return new Color(r, g, b, color.a);\n        };\n        /*\n        Color.rgbaToHex = function (rgba) {        \n            rgba = rgba.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\n            return (rgba && rgba.length === 4) ? \"#\" +\n                (\"0\" + parseInt(rgba[1], 10).toString(16)).slice(-2) +\n                (\"0\" + parseInt(rgba[2], 10).toString(16)).slice(-2) +\n                (\"0\" + parseInt(rgba[3], 10).toString(16)).slice(-2) : '';        \n        }\n        */\n        Color.prototype = {\n            toUint: function() {\n                return (this.r << 24) + (this.g << 16) + (this.b << 8) + (this.a);\n            },\n            toHex: function() {\n                return '#' + Color.componentToHex(this.r) + Color.componentToHex(this.g) + Color.componentToHex(this.b) + Color.componentToHex(this.a);\n            },\n            toRgba: function() {\n                return 'rgba(' + this.r + ',' + this.g + ',' + this.b + ',' + (this.a / 255).toFixed(3) + ')';\n            },\n            dot: function(color) {\n                return ((this.r / 255) * (color.r / 255) + (this.g / 255) * (color.g / 255) + (this.b / 255) * (color.b / 255));\n            },\n            alpha: function(pow, min, max) {\n                min = min || 0;\n                max = max || 1;\n                this.a = Math.floor((min + (pow * (max - min))) * 255);\n                return this;\n            },\n            makeSet: function() {\n                this.foreground = Color.contrast(this);\n                this.border = Color.darker(this, 0.3);\n                this.light = Color.lighter(this, 0.3);\n                return this;\n            },\n        };\n        return Color;\n    }]);\n\n    app.factory('Shape', [function() {\n        function Shape() {}\n        Shape.shapeCircle = function(p, cx, cy, r, sa, ea) {\n            sa = sa || 0;\n            ea = ea || 2 * Math.PI;\n            p.ctx.arc(cx, cy, r, sa, ea, false);\n        };\n        Shape.shapeStar = function(p, cx, cy, or, ir, steps) {\n            var x, y;\n            var angle = Math.PI / 2 * 3;\n            var step = Math.PI / steps;\n            var ctx = p.ctx;\n            ctx.moveTo(cx, cy - or);\n            for (i = 0; i < steps; i++) {\n                x = cx + Math.cos(angle) * or;\n                y = cy + Math.sin(angle) * or;\n                ctx.lineTo(x, y);\n                angle += step;\n                x = cx + Math.cos(angle) * ir;\n                y = cy + Math.sin(angle) * ir;\n                ctx.lineTo(x, y);\n                angle += step;\n            }\n            ctx.lineTo(cx, cy - or);\n        };\n        Shape.shapeRoundRect = function(p, rect, r) {\n            var ctx = p.ctx,\n                x = rect.x,\n                y = rect.y,\n                w = rect.w,\n                h = rect.h;\n            if (typeof r === undefined) {\n                r = 4;\n            }\n            if (typeof r === 'number') {\n                r = { tl: r, tr: r, br: r, bl: r };\n            } else {\n                var defaultRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\n                for (var key in defaultRadius) {\n                    r[key] = r[key] || defaultRadius[key];\n                }\n            }\n            ctx.moveTo(x + r.tl, y);\n            ctx.lineTo(x + w - r.tr, y);\n            ctx.quadraticCurveTo(x + w, y, x + w, y + r.tr);\n            ctx.lineTo(x + w, y + h - r.br);\n            ctx.quadraticCurveTo(x + w, y + h, x + w - r.br, y + h);\n            ctx.lineTo(x + r.bl, y + h);\n            ctx.quadraticCurveTo(x, y + h, x, y + h - r.bl);\n            ctx.lineTo(x, y + r.tl);\n            ctx.quadraticCurveTo(x, y, x + r.tl, y);\n        };\n        Shape.circle = function() {\n            var params = Array.prototype.slice.call(arguments);\n            var ctx = params[0].ctx;\n            ctx.beginPath();\n            Shape.shapeCircle.apply(this, params);\n            ctx.closePath();\n        };\n        Shape.star = function() {\n            var params = Array.prototype.slice.call(arguments);\n            var ctx = params[0].ctx;\n            ctx.beginPath();\n            Shape.shapeStar.apply(this, params);\n            ctx.closePath();\n        };\n        Shape.roundRect = function() {\n            var params = Array.prototype.slice.call(arguments);\n            var ctx = params[0].ctx;\n            ctx.beginPath();\n            Shape.shapeRoundRect.apply(this, params);\n            ctx.closePath();\n        };\n        return Shape;\n    }]);\n\n    app.constant('PainterColors', {\n        /*\n        black: new Color('0x111111'),\n        white: new Color('0xffffff'),\n        red: new Color('0xff0000'),\n        green: new Color('0x00ff00'),\n        blue: new Color('0x0000ff'),\n        yellow: new Color('0xffff00'),\n        cyan: new Color('0x00ffff'),\n        purple: new Color('0xff00ff'),\n        */\n        black: '0x14191e',\n        white: '0xffffff',\n        blue: '0x0023FF',\n        red: '0xF21500',\n        lightBlue: '0x79ccf2',\n        lightYellow: '0xfff79a',\n        greyLighter: '0xf8f8f8',\n        greyLight: '0xeeeeee',\n        greyMedium: '0xcccccc',\n        grey: '0x90939b',\n        map: '0x24292e',\n    });\n\n    app.factory('Palette', ['$q', 'Painter', 'Rect', function($q, Painter, Rect) {\n        function Palette() {\n            this.painter = new Painter().setSize(0, 0);\n            this.buffer = new Painter().setSize(0, 0);\n            this.size = { w: 0, h: 0 };\n            this.pool = {};\n            this.rows = {};\n        }\n        Palette.prototype = {\n            getRect: function(w, h) {\n                var p = this.painter,\n                    size = this.size,\n                    rows = this.rows,\n                    r = new Rect(0, 0, w, h),\n                    row = rows[h] || { x: 0, y: size.h };\n                size.w = Math.max(size.w, row.x + w);\n                size.h = Math.max(size.h, row.y + h);\n                if (!p.canvas.width && !p.canvas.height) {\n                    p.setSize(size.w, size.h);\n                } else if (size.w > p.canvas.width || size.h > p.canvas.height) {\n                    // var img = new Image();\n                    // img.src = p.toDataURL();\n                    // document.body.appendChild(canvas);\n                    // console.log(p.canvas.width, p.canvas.height);\n                    // var data = p.ctx.getImageData(0, 0, p.canvas.width, p.canvas.height);\n                    var canvas = p.canvas;\n                    p.setCanvas(document.createElement('canvas'));\n                    p.setSize(size.w, size.h);\n                    p.ctx.drawImage(canvas, 0, 0);\n                    // p.ctx.putImageData(data, 0, 0);\n                    // p.ctx.drawImage(img, 0, 0);\n                    // document.body.removeChild(canvas);\n                }\n                r.x = row.x;\n                r.y = row.y;\n                row.x += w;\n                rows[h] = row;\n                return r;\n            },\n            add: function(key, path) {\n                var palette = this;\n                if (angular.isString(path)) {\n                    var deferred = $q.defer();\n                    var img = new Image();\n                    img.onload = function() {\n                        palette.addShape(key, img.width, img.height, function(p, rect) {\n                            p.ctx.drawImage(img, 0, 0);\n                        });\n                        deferred.resolve(img);\n                    };\n                    img.onerror = function() {\n                        deferred.reject('connot load ' + path);\n                    };\n                    img.src = path;\n                    return deferred.promise;\n                } else {\n                    var params = Array.prototype.slice.call(arguments);\n                    return palette.addShape.apply(palette, params);\n                }\n            },\n            addShape: function(key, w, h, callback) {\n                var p = this.painter,\n                    r = this.getRect(w, h);\n                p.ctx.save();\n                p.ctx.rect(r.x, r.y, r.w, r.h);\n                // p.ctx.stroke();\n                p.ctx.clip();\n                p.ctx.translate(r.x, r.y);\n                callback.call(p, p, r.clone().setPos(0, 0));\n                p.ctx.restore();\n                this.pool[key] = r;\n                // console.log('Painter.add', r);\n            },\n            draw: function(target, key, x, y, pre) {\n                var r = this.pool[key];\n                if (r) {\n                    // var ctx = target.ctx;\n                    // ctx.save();\n                    target.drawRect(this.painter.canvas, r, { x: x, y: y, w: r.w, h: r.h }, pre);\n                    // target.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, x - r.w / 2, y - r.h / 2, r.w, r.h);\n                    // ctx.restore();\n                }\n            },\n            tint: function(target, key, x, y, color, pre) {\n                var r = this.pool[key];\n                if (r) {\n                    var p = this.painter,\n                        b = this.buffer.setSize(r.w, r.h);\n                    b.save();\n                    b.setFill(color);\n                    b.fillRect();\n                    b.ctx.globalCompositeOperation = \"destination-atop\";\n                    b.ctx.drawImage(p.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n                    b.restore();\n                    console.log(x, y, b.canvas, target.canvas);\n                    target.draw(b.canvas, { x: x, y: y }, pre);\n                }\n            },\n            pattern: function(target, key, x, y, w, h, color) {\n                function drawPattern(pattern) {\n                    var ctx = target.ctx;\n                    ctx.save();\n                    ctx.translate(x, y);\n                    // draw\n                    // ctx.beginPath();\n                    // ctx.rect(-x, -y, w, h);\n                    ctx.fillStyle = pattern;\n                    ctx.fillRect(-x, -y, w, h);\n                    ctx.translate(-x, -y);\n                    // ctx.fill();\n                    ctx.restore();\n                }\n                var r = this.pool[key];\n                if (r) {\n                    var img = r.img,\n                        pattern;\n                    if (!img || r.color != color) {\n                        var b = this.buffer.setSize(r.w, r.h);\n                        if (color) {\n                            r.color = color;\n                            b.save();\n                            b.setFill(color);\n                            b.fillRect();\n                            b.ctx.globalCompositeOperation = \"destination-atop\";\n                            b.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n                            b.restore();\n                        } else {\n                            b.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n                        }\n                        img = new Image();\n                        img.onload = function() {\n                            r.img = img;\n                            pattern = target.ctx.createPattern(img, \"repeat\");\n                            drawPattern(pattern);\n                        };\n                        img.src = b.toDataURL();\n                    } else {\n                        pattern = target.ctx.createPattern(img, \"repeat\");\n                        drawPattern(pattern);\n                    }\n                }\n            },\n        };\n        return Palette;\n    }]);\n\n    app.factory('Painter', ['Shape', 'Rect', 'Color', 'PainterColors', function(Shape, Rect, Color, PainterColors) {\n        function Painter(canvas) {\n            canvas = canvas || document.createElement('canvas');\n            this.rect = new Rect();\n            this.drawingRect = new Rect();\n            this.setColors();\n            this.setCanvas(canvas);\n        }\n        Painter.colors = {};\n        angular.forEach(PainterColors, function(value, key) {\n            Painter.colors[key] = new Color(value).makeSet();\n        });\n        var colors = Painter.colors;\n        Painter.prototype = {\n            colors: Painter.colors,\n            setColors: function() {\n                var colors = this.colors;\n                angular.forEach(PainterColors, function(value, key) {\n                    colors[key] = new Color(value).makeSet();\n                });\n            },\n            setCanvas: function(canvas) {\n                this.canvas = canvas;\n                this.setSize(canvas.offsetWidth, canvas.offsetHeight);\n                var ctx = canvas.getContext('2d');\n                ctx.lineCap = 'square';\n                this.ctx = ctx;\n                return this;\n            },\n            setSize: function(w, h) {\n                this.canvas.width = w;\n                this.canvas.height = h;\n                this.rect.w = w;\n                this.rect.h = h;\n                return this;\n            },\n            copy: function(canvas) {\n                this.ctx.drawImage(canvas, 0, 0);\n                return this;\n            },\n            clear: function() {\n                this.resize();\n                // this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n                return this;\n            },\n            resize: function() {\n                this.setSize(this.canvas.offsetWidth, this.canvas.offsetHeight);\n                return this;\n            },\n            setText: function(font, align, verticalAlign, color) {\n                font = font || '11px monospace';\n                align = align || 'center';\n                verticalAlign = verticalAlign || 'middle';\n                color = color || this.colors.black;\n                var ctx = this.ctx;\n                ctx.font = font;\n                ctx.textAlign = align;\n                ctx.textBaseline = verticalAlign;\n                ctx.fillStyle = color.toRgba();\n                return this;\n            },\n            setFill: function(color) {\n                color = color || this.colors.black;\n                var ctx = this.ctx;\n                /*\n                var my_gradient = ctx.createLinearGradient(0, 0, 0, 170);\n                my_gradient.addColorStop(0, \"black\");\n                my_gradient.addColorStop(1, \"white\");\n                ctx.fillStyle = my_gradient;\n                */\n                ctx.fillStyle = color.toRgba();\n                return this;\n            },\n            setStroke: function(color, size) {\n                color = color || this.colors.black;\n                var ctx = this.ctx;\n                size = size || 1;\n                /*            \n                var gradient=ctx.createLinearGradient(0,0,170,0);\n                gradient.addColorStop(\"0\",\"magenta\");\n                gradient.addColorStop(\"0.5\",\"blue\");\n                gradient.addColorStop(\"1.0\",\"red\");\n                ctx.strokeStyle = gradient;\n                */\n                // Fill with gradient\n                ctx.strokeStyle = color.toRgba();\n                ctx.lineWidth = size;\n                return this;\n            },\n            /*\n            drawRoundRect: function (rect, r) {\n                rect = rect || this.rect;\n                Shape.roundRect(this, rect, r);\n                return this;\n            },\n            */\n            fillText: function(text, point, width, post, maxLength) {\n                if (width) {\n                    post = post || '';\n                    maxLength = maxLength || Math.floor(width / 8);\n                    if (text.length > maxLength) {\n                        text = text.substr(0, Math.min(text.length, maxLength)).trim() + post;\n                    }\n                }\n                this.ctx.fillText(text, point.x, point.y);\n                return this;\n            },\n            fillRect: function(rect) {\n                rect = rect || this.rect;\n                var ctx = this.ctx,\n                    x = rect.x,\n                    y = rect.y,\n                    w = rect.w,\n                    h = rect.h;\n                ctx.fillRect(x, y, w, h);\n                return this;\n            },\n            strokeRect: function(rect) {\n                rect = rect || this.rect;\n                var ctx = this.ctx,\n                    x = rect.x,\n                    y = rect.y,\n                    w = rect.w,\n                    h = rect.h;\n                ctx.strokeRect(x, y, w, h);\n                return this;\n            },\n            fill: function() {\n                this.ctx.fill();\n                return this;\n            },\n            stroke: function() {\n                this.ctx.stroke();\n                return this;\n            },\n            begin: function() {\n                this.ctx.beginPath();\n                return this;\n            },\n            close: function() {\n                this.ctx.closePath();\n                return this;\n            },\n            save: function() {\n                this.ctx.save();\n                return this;\n            },\n            restore: function() {\n                this.ctx.restore();\n                return this;\n            },\n            rotate: function(angle) {\n                this.ctx.rotate(angle * Math.PI / 180);\n            },\n            translate: function(xy) {\n                this.ctx.translate(xy.x, xy.y);\n            },\n            toDataURL: function() {\n                return this.canvas.toDataURL();\n            },\n            draw: function(image, t, pre) {\n                if (image) {\n                    t.w = t.w || image.width;\n                    t.h = t.h || image.height;\n                    var ctx = this.ctx,\n                        rect = this.drawingRect,\n                        x = rect.x = t.x - t.w / 2,\n                        y = rect.y = t.y - t.h / 2,\n                        w = rect.w = t.w,\n                        h = rect.h = t.h;\n                    ctx.save();\n                    ctx.translate(x, y);\n                    if (pre) {\n                        pre.call(this);\n                    }\n                    ctx.drawImage(image, 0, 0);\n                    ctx.restore();\n                    // console.log('painter.draw', x, y, w, h);\n                }\n                return this;\n            },\n            drawRect: function(image, s, t, pre) {\n                if (image) {\n                    s.w = s.w || image.width;\n                    s.h = s.h || image.height;\n                    t.w = t.w || image.width;\n                    t.h = t.h || image.height;\n                    var ctx = this.ctx,\n                        rect = this.drawingRect,\n                        x = rect.x = t.x - s.w / 2,\n                        y = rect.y = t.y - s.h / 2,\n                        w = rect.w = t.w,\n                        h = rect.h = t.h;\n                    ctx.save();\n                    ctx.translate(x, y);\n                    if (pre) {\n                        pre.call(this);\n                    }\n                    ctx.drawImage(image, s.x, s.y, s.w, s.h, 0, 0, t.w, t.h);\n                    ctx.restore();\n                    // console.log('painter.drawRect', x, y, w, h);\n                }\n                return this;\n            },\n            flip: function(scale) {\n                scale = scale || { x: 1, y: -1 };\n                var ctx = this.ctx,\n                    rect = this.drawingRect;\n                ctx.translate(scale.x === -1 ? rect.w : 0, scale.y === -1 ? rect.h : 0);\n                ctx.scale(scale.x, scale.y);\n            },\n        };\n        return Painter;\n    }]);\n\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.factory('Doc', ['Api', '$promise', '$location', '$routeParams', 'environment',\r\n        function(Api, $promise, $location, $routeParams, environment) {\r\n\r\n            function Doc(item) {\r\n                angular.extend(this, {\r\n                    url: $location.path(),\r\n                    params: $routeParams,\r\n                });\r\n                angular.extend(this, environment);\r\n                if (item) {\r\n                    angular.extend(this, item);\r\n                }\r\n            }\r\n\r\n            Doc.prototype = {\r\n\r\n            };\r\n\r\n            var statics = {\r\n                current: function() {\r\n                    return $promise(function(promise) {\r\n                        Api.menu().then(function(items) {\r\n                            var doc = null,\r\n                                url = $location.path();\r\n                            angular.forEach(items, function(item) {\r\n                                if (item.url === url) {\r\n                                    doc = new Doc(item);\r\n                                }\r\n                                console.log(item, item.url, url);\r\n                            });\r\n                            promise.resolve(doc);\r\n                        }, function(error) {\r\n                            promise.reject(error);\r\n                        });\r\n                    });\r\n                }\r\n            };\r\n\r\n            angular.extend(Doc, statics);\r\n\r\n            return Doc;\r\n        }\r\n    ]);\r\n\r\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Events', [function () {\n\n\t\tfunction Event(e, element) {\n\t\t\tvar documentNode = (document.documentElement || document.body.parentNode || document.body);\n\t\t\tvar scroll = {\n\t\t\t\tx: window.pageXOffset || documentNode.scrollLeft,\n\t\t\t\ty: window.pageYOffset || documentNode.scrollTop\n\t\t\t};\n\t\t\tif (e.type === 'resize') {\n\t\t\t\tvar view = {\n\t\t\t\t\tw: this.getWidth(),\n\t\t\t\t\th: this.getHeight(),\n\t\t\t\t};\n\t\t\t\tthis.view = view;\n\t\t\t}\n\t\t\tvar node = getNode(element);\n\t\t\tvar offset = {\n\t\t\t\tx: node.offsetLeft,\n\t\t\t\ty: node.offsetTop,\n\t\t\t};\n\t\t\tvar rect = node.getBoundingClientRect();\n\t\t\tvar page = this.getPage(e);\n\t\t\tif (page) {\n\t\t\t\tvar relative = {\n\t\t\t\t\tx: page.x - scroll.x - rect.left,\n\t\t\t\t\ty: page.y - scroll.y - rect.top,\n\t\t\t\t};\n\t\t\t\tvar absolute = {\n\t\t\t\t\tx: page.x - scroll.x,\n\t\t\t\t\ty: page.y - scroll.y,\n\t\t\t\t};\n\t\t\t\tthis.relative = relative;\n\t\t\t\tthis.absolute = absolute;\n\t\t\t}\n\t\t\tif (this.type === 'resize') {\n\t\t\t\tconsole.log(this.type);\n\t\t\t}\n\t\t\tthis.originalEvent = e;\n\t\t\tthis.element = element;\n\t\t\tthis.node = node;\n\t\t\tthis.offset = offset;\n\t\t\tthis.rect = rect;\n\t\t\t// console.log('Event', 'page', page, 'scroll', scroll, 'offset', offset, 'rect', rect, 'relative', relative, 'absolute', absolute);\n\t\t\t// console.log('scroll.y', scroll.y, 'page.y', page.y, 'offset.y', offset.y, 'rect.top', rect.top);\n\t\t}\n\t\tEvent.prototype = {\n\t\t\tgetPage: getPage,\n\t\t\tgetWidth: getWidth,\n\t\t\tgetHeight: getHeight,\n\t\t};\n\n\t\tfunction getWidth() {\n\t\t\tif (self.innerWidth) {\n\t\t\t\treturn self.innerWidth;\n\t\t\t}\n\t\t\tif (document.documentElement && document.documentElement.clientWidth) {\n\t\t\t\treturn document.documentElement.clientWidth;\n\t\t\t}\n\t\t\tif (document.body) {\n\t\t\t\treturn document.body.clientWidth;\n\t\t\t}\n\t\t}\n\n\t\tfunction getHeight() {\n\t\t\tif (self.innerHeight) {\n\t\t\t\treturn self.innerHeight;\n\t\t\t}\n\t\t\tif (document.documentElement && document.documentElement.clientHeight) {\n\t\t\t\treturn document.documentElement.clientHeight;\n\t\t\t}\n\t\t\tif (document.body) {\n\t\t\t\treturn document.body.clientHeight;\n\t\t\t}\n\t\t}\n\n\t\tfunction getPage(e) {\n\t\t\tvar standardEvents = ['click', 'mousedown', 'mouseup', 'mousemove', 'mouseover', 'mouseout', 'mouseenter', 'mouseleave', 'contextmenu'];\n\t\t\tvar touchEvents = ['touchstart', 'touchmove', 'touchend', 'touchcancel'];\n\t\t\tvar page = null;\n\t\t\tif (touchEvents.indexOf(e.type) !== -1) {\n\t\t\t\tvar t = null;\n\t\t\t\tvar event = e.originalEvent ? e.originalEvent : e;\n\t\t\t\tvar touches = event.touches.length ? event.touches : event.changedTouches;\n\t\t\t\tif (touches && touches.length) {\n\t\t\t\t\tt = touches[0];\n\t\t\t\t}\n\t\t\t\tif (t) {\n\t\t\t\t\tpage = {\n\t\t\t\t\t\tx: t.pageX,\n\t\t\t\t\t\ty: t.pageY,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t} else if (standardEvents.indexOf(e.type) !== -1) {\n\t\t\t\tpage = {\n\t\t\t\t\tx: e.pageX,\n\t\t\t\t\ty: e.pageY,\n\t\t\t\t};\n\t\t\t}\n\t\t\tthis.type = e.type;\n\t\t\treturn page;\n\t\t}\n\n\t\tfunction Events(element) {\n\t\t\tthis.element = element;\n\t\t\tthis.listeners = {};\n\t\t\tthis.standardEvents = {\n\t\t\t\tclick: {\n\t\t\t\t\tkey: 'click',\n\t\t\t\t\tcallback: onClick\n\t\t\t\t},\n\t\t\t\tdown: {\n\t\t\t\t\tkey: 'mousedown',\n\t\t\t\t\tcallback: onMouseDown\n\t\t\t\t},\n\t\t\t\tmove: {\n\t\t\t\t\tkey: 'mousemove',\n\t\t\t\t\tcallback: onMouseMove\n\t\t\t\t},\n\t\t\t\tup: {\n\t\t\t\t\tkey: 'mouseup',\n\t\t\t\t\tcallback: onMouseUp\n\t\t\t\t},\n\t\t\t\tresize: {\n\t\t\t\t\tkey: 'resize',\n\t\t\t\t\tcallback: onResize\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.touchEvents = {\n\t\t\t\tdown: {\n\t\t\t\t\tkey: 'touchstart',\n\t\t\t\t\tcallback: onTouchStart\n\t\t\t\t},\n\t\t\t\tmove: {\n\t\t\t\t\tkey: 'touchmove',\n\t\t\t\t\tcallback: onTouchMove\n\t\t\t\t},\n\t\t\t\tup: {\n\t\t\t\t\tkey: 'touchend',\n\t\t\t\t\tcallback: onTouchEnd\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tvar events = this;\n\n\t\t\tfunction onClick(e) {\n\t\t\t\t// console.log('onClick', e, events);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.listeners.click.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onMouseDown(e) {\n\t\t\t\t// console.log('onMouseDown', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.listeners.down.apply(this, [event]);\n\t\t\t\tevents.removeTouchEvents();\n\t\t\t}\n\n\t\t\tfunction onMouseMove(e) {\n\t\t\t\t// console.log('onMouseMove', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.listeners.move.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onMouseUp(e) {\n\t\t\t\t// console.log('onMouseUp', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.listeners.up.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onResize(e) {\n\t\t\t\tconsole.log('onResize', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.listeners.resize.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onTouchStart(e) {\n\t\t\t\t// console.log('onTouchStart', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.listeners.down.apply(this, [event]);\n\t\t\t\tevents.removeStandardEvents();\n\t\t\t}\n\n\t\t\tfunction onTouchMove(e) {\n\t\t\t\t// console.log('onTouchMove', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.listeners.move.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onTouchEnd(e) {\n\t\t\t\t// console.log('onTouchEnd', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.listeners.up.apply(this, [event]);\n\t\t\t}\n\t\t}\n\t\tEvents.prototype = {\n\t\t\tadd: add,\n\t\t\tremove: remove,\n\t\t\tremoveStandardEvents: removeStandardEvents,\n\t\t\tremoveTouchEvents: removeTouchEvents,\n\t\t};\n\t\treturn Events;\n\n\t\tfunction getNode(element) {\n\t\t\treturn element.length ? element[0] : element; // (element.length && (element[0] instanceOf Node || element[0] instanceOf HTMLElement)) ? element[0] : element;\n\t\t}\n\n\t\tfunction getElement(element) {\n\t\t\treturn element.length ? element : angular.element(element); // (element.length && (element[0] instanceOf Node || element[0] instanceOf HTMLElement)) ? element : angular.element(element);\n\t\t}\n\n\t\tfunction add(listeners, scope) {\n\t\t\tvar events = this,\n\t\t\t\tstandard = this.standardEvents,\n\t\t\t\ttouch = this.touchEvents;\n\t\t\tvar element = getElement(this.element),\n\t\t\t\twindowElement = angular.element(window);\n\n\t\t\tangular.forEach(listeners, function (callback, key) {\n\t\t\t\tif (events.listeners[key]) {\n\t\t\t\t\tvar listener = {};\n\t\t\t\t\tlistener[key] = events.listeners[key];\n\t\t\t\t\tremove(listener);\n\t\t\t\t}\n\t\t\t\tevents.listeners[key] = callback;\n\t\t\t\tif (standard[key]) {\n\t\t\t\t\tif (key === 'resize') {\n\t\t\t\t\t\twindowElement.on(standard[key].key, standard[key].callback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.on(standard[key].key, standard[key].callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (touch[key]) {\n\t\t\t\t\telement.on(touch[key].key, touch[key].callback);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (scope) {\n\t\t\t\tscope.$on('$destroy', function () {\n\t\t\t\t\tevents.remove(listeners);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn events;\n\t\t}\n\n\t\tfunction remove(listeners) {\n\t\t\tvar events = this,\n\t\t\t\tstandard = this.standardEvents,\n\t\t\t\ttouch = this.touchEvents;\n\t\t\tvar element = getElement(this.element),\n\t\t\t\twindowElement = angular.element(window);\n\t\t\tangular.forEach(listeners, function (callback, key) {\n\t\t\t\tif (standard[key]) {\n\t\t\t\t\tif (key === 'resize') {\n\t\t\t\t\t\twindowElement.off(standard[key].key, standard[key].callback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.off(standard[key].key, standard[key].callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (touch[key]) {\n\t\t\t\t\telement.off(touch[key].key, touch[key].callback);\n\t\t\t\t}\n\t\t\t\tevents.listeners[key] = null;\n\t\t\t});\n\t\t\treturn events;\n\t\t}\n\n\t\tfunction removeStandardEvents() {\n\t\t\tvar events = this,\n\t\t\t\tstandard = events.standardEvents,\n\t\t\t\ttouch = events.touchEvents;\n\t\t\tvar element = getElement(events.element);\n\t\t\telement.off('mousedown', standard.down.callback);\n\t\t\telement.off('mousemove', standard.move.callback);\n\t\t\telement.off('mouseup', standard.up.callback);\n\t\t}\n\n\t\tfunction removeTouchEvents() {\n\t\t\tvar events = this,\n\t\t\t\tstandard = events.standardEvents,\n\t\t\t\ttouch = events.touchEvents;\n\t\t\tvar element = getElement(events.element);\n\t\t\telement.off('touchstart', touch.down.callback);\n\t\t\telement.off('touchmove', touch.move.callback);\n\t\t\telement.off('touchend', touch.up.callback);\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular, app, Autolinker */\r\n(function () {\r\n\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.filter('notIn', ['$filter', function ($filter) {\r\n\t\treturn function (array, filters, element) {\r\n\t\t\tif (filters) {\r\n\t\t\t\treturn $filter(\"filter\")(array, function (item) {\r\n\t\t\t\t\tfor (var i = 0; i < filters.length; i++) {\r\n\t\t\t\t\t\tif (filters[i][element] === item[element]) return false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.directive('controlMessages', [function() {\n        return {\n            restrict: 'E',\n            templateUrl: 'artisan/forms/messages',\n            transclude: {\n                'message': '?messageItems',\n            },\n            link: function(scope, element, attributes, model) {}\n        };\n    }]);\n\n    app.directive('control', ['$parse', function($parse) {\n        function formatLabel(string, prepend, expression) {\n            string = string || '';\n            prepend = prepend || '';\n            var splitted = string.split(',');\n            if (splitted.length > 1) {\n                var formatted = splitted.shift();\n                angular.forEach(splitted, function(value, index) {\n                    if (expression) {\n                        formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n                    } else {\n                        formatted = formatted.split('{' + index + '}').join(prepend + value);\n                    }\n                });\n                if (expression) {\n                    return '\\'' + formatted + '\\'';\n                } else {\n                    return formatted;\n                }\n            } else {\n                return prepend + string;\n            }\n        }\n        var uniqueId = 0;\n        return {\n            restrict: 'A',\n            templateUrl: function(element, attributes) {\n                var template = 'artisan/forms/text';\n                switch (attributes.control) {\n                    case 'select':\n                        template = 'artisan/forms/select';\n                        break;\n                }\n                return template;\n            },\n            scope: {\n                ngModel: '=',\n                required: '=',\n                form: '@',\n                title: '@',\n                placeholder: '@',\n                source: '=?',\n                key: '@?',\n                label: '@?',\n            },\n            require: 'ngModel',\n            transclude: true,\n            link: {\n                pre: function preLink(scope, element, attributes, controller, transclude) {\n                    var label = scope.label = (scope.label ? scope.label : 'name');\n                    var key = scope.key = (scope.key ? scope.key : 'id');\n                    if (attributes.control === 'select') {\n                        var filter = (attributes.filter ? '| ' + attributes.filter : '');\n                        var optionLabel = formatLabel(label, 'item.', true);\n                        scope.getOptions = function() {\n                            return attributes.number ?\n                                'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in source ' + filter :\n                                optionLabel + ' disable when item.disabled for item in source ' + filter + ' track by item.' + key;\n                        };\n                    }\n                    var type = scope.type = attributes.control;\n                    var form = scope.form = scope.form || 'form';\n                    var title = scope.title = scope.title || 'untitled';\n                    var placeholder = scope.placeholder = scope.placeholder || title;\n                    var field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\n                    scope.format = attributes.format || null;\n                    scope.precision = attributes.precision || null;\n                    scope.validate = attributes.validate || attributes.control;\n                    scope.minLength = attributes.minLength || 0;\n                    scope.maxLength = attributes.maxLength || Number.POSITIVE_INFINITY;\n                    scope.min = attributes.min || null;\n                    scope.max = attributes.max || null;\n                    scope.options = $parse(attributes.options)(scope) || {};\n                    scope.focus = false;\n                    scope.visible = false;\n                    scope.onChange = function(model) {\n                        $parse(attributes.onChange)(scope.$parent);\n                    };\n                    scope.onFilter = function(model) {\n                        $parse(attributes.onFilter)(scope.$parent);\n                    };\n                    scope.getType = function() {\n                        var type = 'text';\n                        switch (attributes.control) {\n                            case 'password':\n                                type = scope.visible ? 'text' : 'password';\n                                break;\n                            default:\n                                type = attributes.control;\n                        }\n                        return type;\n                    };\n                    scope.getClasses = function() {\n                        var form = $parse(scope.form)(scope.$parent);\n                        var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n                        return {\n                            'control-focus': scope.focus,\n                            'control-success': field.$valid,\n                            'control-error': field.$invalid && (form.$submitted || field.$touched),\n                            'control-empty': !field.$viewValue\n                        };\n                    };\n                    scope.getMessages = function() {\n                        var form = $parse(scope.form)(scope.$parent);\n                        var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n                        return (form.$submitted || field.$touched) && field.$error;\n                    };\n                    scope.toggleVisibility = function() {\n                        scope.visible = !scope.visible;\n                    };\n                },\n            },\n        };\n    }]);\n\n    app.directive('_control', ['$http', '$templateCache', '$compile', '$parse', function($http, $templateCache, $compile, $parse) {\n        function formatLabel(string, prepend, expression) {\n            string = string || '';\n            prepend = prepend || '';\n            var splitted = string.split(',');\n            if (splitted.length > 1) {\n                var formatted = splitted.shift();\n                angular.forEach(splitted, function(value, index) {\n                    if (expression) {\n                        formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n                    } else {\n                        formatted = formatted.split('{' + index + '}').join(prepend + value);\n                    }\n                });\n                if (expression) {\n                    return '\\'' + formatted + '\\'';\n                } else {\n                    return formatted;\n                }\n            } else {\n                return prepend + string;\n            }\n        }\n        var uniqueId = 0;\n        return {\n            restrict: 'A',\n            templateUrl: function(element, attributes) {\n                var template = 'artisan/forms/text';\n                switch (attributes.control) {\n                    case 'select':\n                        template = 'artisan/forms/select';\n                        break;\n                }\n                return template;\n            },\n            scope: {\n                ngModel: '=',\n                required: '=',\n                form: '@',\n                title: '@',\n                placeholder: '@',\n            },\n            require: 'ngModel',\n            /*\n            link: function(scope, element, attributes, model) {\n            },\n            */\n            compile: function(element, attributes) {\n                    return {\n                        pre: function(scope, element, attributes) {\n                            if (attributes.control === 'select') {\n                                var label = (attributes.label ? attributes.label : 'name');\n                                var key = (attributes.key ? attributes.key : 'id');\n                                var filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\n                                var optionLabel = formatLabel(label, 'item.', true);\n                                scope.options = attributes.number ?\n                                    'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter :\n                                    optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter + ' track by item.' + key;\n                                console.log('control.compile.pre', scope.options);\n                            }\n                            var type = scope.type = attributes.control;\n                            var form = scope.form = scope.form || 'form';\n                            var title = scope.title = scope.title || 'untitled';\n                            var placeholder = scope.placeholder = scope.placeholder || title;\n                            var field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\n                            scope.validate = attributes.validate || attributes.control;\n                            scope.format = attributes.format || null;\n                            scope.precision = attributes.precision || null;\n                            scope.validate = attributes.validate || attributes.control;\n                            scope.minLength = attributes.min || 0;\n                            scope.maxLength = attributes.max || Number.POSITIVE_INFINITY;\n                            scope.options = $parse(attributes.options)(scope) || {};\n                            scope.focus = false;\n                            scope.visible = false;\n                            scope.getType = function() {\n                                var type = 'text';\n                                switch (attributes.control) {\n                                    case 'password':\n                                        // var form = $parse(scope.form)(scope.$parent);\n                                        // var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n                                        type = scope.visible ? 'text' : 'password';\n                                        break;\n                                    default:\n                                        type = attributes.control;\n                                }\n                                // console.log('control.getType', type);\n                                return type;\n                            };\n                            scope.getClasses = function() {\n                                var form = $parse(scope.form)(scope.$parent);\n                                var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n                                return {\n                                    'control-focus': scope.focus,\n                                    'control-success': field.$valid,\n                                    'control-error': field.$invalid && (form.$submitted || field.$touched),\n                                    'control-empty': !field.$viewValue\n                                };\n                            };\n                            scope.getMessages = function() {\n                                var form = $parse(scope.form)(scope.$parent);\n                                var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n                                return (form.$submitted || field.$touched) && field.$error;\n                            };\n                        },\n                        // post: function (scope, element, attributes) { }\n                    };\n                }\n                /*\n                compile: function(element, attributes) {\n                    element.removeAttr('my-dir'); \n                    element.attr('ng-hide', 'true');\n                    return function(scope) {\n                        $compile(element)(scope);\n                    };\n                },\n                */\n        };\n    }]);\n\n    app.directive('numberPicker', ['$parse', '$timeout', function($parse, $timeout) {\n        return {\n            restrict: 'A',\n            template: '<div class=\"input-group\">' +\n                '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">-</button></span>' +\n                '   <div ng-transclude></div>' +\n                '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">+</button></span>' +\n                '</div>',\n            replace: true,\n            transclude: true,\n            link: function(scope, element, attributes, model) {\n                var node = element[0];\n                var nodeRemove = node.querySelectorAll('.input-group-btn > .btn')[0];\n                var nodeAdd = node.querySelectorAll('.input-group-btn > .btn')[1];\n\n                function onRemove(e) {\n                    var min = $parse(attributes.min)(scope);\n                    var getter = $parse(attributes.numberPicker);\n                    var setter = getter.assign;\n                    $timeout(function() {\n                        setter(scope, Math.max(min, getter(scope) - 1));\n                    });\n                    // console.log('numberPicker.onRemove', min);\n                }\n\n                function onAdd(e) {\n                    var max = $parse(attributes.max)(scope);\n                    var getter = $parse(attributes.numberPicker);\n                    var setter = getter.assign;\n                    $timeout(function() {\n                        setter(scope, Math.min(max, getter(scope) + 1));\n                    });\n                    // console.log('numberPicker.onAdd', max);\n                }\n\n                function addListeners() {\n                    angular.element(nodeRemove).on('touchstart mousedown', onRemove);\n                    angular.element(nodeAdd).on('touchstart mousedown', onAdd);\n                }\n\n                function removeListeners() {\n                    angular.element(nodeRemove).off('touchstart mousedown', onRemove);\n                    angular.element(nodeAdd).off('touchstart mousedown', onAdd);\n                }\n                scope.$on('$destroy', function() {\n                    removeListeners();\n                });\n                addListeners();\n            }\n        };\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.directive('validate', ['$filter', function($filter) {\n        return {\n            require: 'ngModel',\n            link: function(scope, element, attributes, model) {\n                var type = attributes.validate;\n                var format = attributes.format || '';\n                var precision = attributes.precision || 2;\n                var focus = false;\n                // console.log('validate', type);\n                switch (type) {\n                    case 'date':\n                    case 'datetime':\n                    case 'datetime-local':\n                        model.$formatters.push(function(value) {\n                            if (value) {\n                                return $filter('date')(value, format);\n                            } else {\n                                return null;\n                            }\n                        });\n                        break;\n                    case 'number':\n                        model.$parsers.unshift(function(value) {\n                            var valid = false;\n                            if (value !== undefined && value !== \"\") {\n                                valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \n                                value = Number(value);\n                                model.$setValidity('number', valid);\n                                if (valid) {\n                                    model.$setValidity('positive', value >= 0.01);\n                                    if (attributes.min !== undefined) {\n                                        model.$setValidity('range', value >= Number(attributes.min));\n                                    }\n                                    if (attributes.max !== undefined) {\n                                        model.$setValidity('range', value <= Number(attributes.max));\n                                    }\n                                }\n                            } else {\n                                valid = true;\n                                value = Number(value);\n                                model.$setValidity('number', true);\n                                model.$setValidity('positive', true);\n                                if (attributes.min !== undefined) {\n                                    model.$setValidity('range', true);\n                                }\n                                if (attributes.max !== undefined) {\n                                    model.$setValidity('range', true);\n                                }\n                            }\n                            return value;\n                        });\n                        model.$formatters.push(function(value) {\n                            if (value) {\n                                return $filter('number')(value, precision) + ' ' + format;\n                            } else {\n                                return null;\n                            }\n                        });\n                        break;\n                    case 'anynumber':\n                        model.$parsers.unshift(function(value) {\n                            var valid = false;\n                            if (value !== undefined && value !== \"\") {\n                                valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \n                                value = Number(value);\n                                model.$setValidity('number', valid);\n                                if (valid) {\n                                    if (attributes.min !== undefined) {\n                                        model.$setValidity('range', value >= Number(attributes.min));\n                                    }\n                                    if (attributes.max !== undefined) {\n                                        model.$setValidity('range', value <= Number(attributes.max));\n                                    }\n                                }\n                            } else {\n                                valid = true;\n                                value = Number(value);\n                                model.$setValidity('number', true);\n                                if (attributes.min !== undefined) {\n                                    model.$setValidity('range', true);\n                                }\n                                if (attributes.max !== undefined) {\n                                    model.$setValidity('range', true);\n                                }\n                            }\n                            return value;\n                        });\n                        model.$formatters.push(function(value) {\n                            if (value || value === 0) {\n                                return $filter('number')(value, precision) + ' ' + format;\n                            } else {\n                                return null;\n                            }\n                        });\n                        break;\n                }\n\n                function onFocus() {\n                    focus = true;\n                    if (format) {\n                        element[0].value = model.$modelValue || null;\n                        if (!model.$modelValue) {\n                            model.$setViewValue(null);\n                        }\n                    }\n                }\n\n                function doBlur() {\n                    if (format && !model.$invalid) {\n                        switch (type) {\n                            case 'date':\n                            case 'datetime':\n                            case 'datetime-local':\n                                element[0].value = model.$modelValue ? $filter('date')(model.$modelValue, format) : ' ';\n                                break;\n                            default:\n                                element[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\n                                break;\n                        }\n                    }\n                }\n\n                function onBlur() {\n                    focus = false;\n                    doBlur();\n                }\n\n                function addListeners() {\n                    element.on('focus', onFocus);\n                    element.on('blur', onBlur);\n                }\n\n                function removeListeners() {\n                    element.off('focus', onFocus);\n                    element.off('blur', onBlur);\n                }\n                scope.$on('$destroy', function() {\n                    removeListeners();\n                });\n                addListeners();\n            }\n        };\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('Hash', [function() {\n        var pools = {};\n\n        function Hash(key, pool) {\n            key = key || 'id';\n            pool = pool ? Hash.get(pool) : {};\n            Object.defineProperties(this, {\n                key: {\n                    value: key,\n                    enumerable: false,\n                    writable: false\n                },\n                pool: {\n                    value: pool,\n                    enumerable: false,\n                    writable: false\n                },\n                length: {\n                    value: 0,\n                    enumerable: false,\n                    writable: true\n                }\n            });\n        }\n        Hash.get = function(pool) {\n            return (pools[pool] = pools[pool] || {});\n        };\n        Hash.prototype = new Array;\n        Hash.prototype.has = has;\n        Hash.prototype.getId = getId;\n        Hash.prototype.get = get;\n        Hash.prototype.set = set;\n        Hash.prototype.add = add;\n        Hash.prototype.remove = remove;\n        Hash.prototype.each = each;\n        Hash.prototype.addMany = addMany;\n        Hash.prototype.removeMany = removeMany;\n        Hash.prototype.removeAll = removeAll;\n        Hash.prototype.forward = forward;\n        Hash.prototype.backward = backward;\n        Hash.prototype.differs = differs;\n        Hash.prototype.updatePool = updatePool;\n        return Hash;\n\n        function has(id) {\n            return this.pool[id] !== undefined;\n        }\n\n        function getId(id) {\n            return this.pool[id];\n        }\n\n        function get(item) {\n            var hash = this,\n                key = this.key;\n            return item ? hash.getId(item[key]) : null;\n        }\n\n        function set(item) {\n            var hash = this,\n                pool = this.pool,\n                key = this.key;\n            pool[item[key]] = item;\n            hash.push(item);\n            return item;\n        }\n\n        function add(newItem) {\n            var hash = this;\n            var item = hash.get(newItem);\n            if (item) {\n                for (var i = 0, keys = Object.keys(newItem), p; i < keys.length; i++) {\n                    p = keys[i];\n                    item[p] = newItem[p];\n                }\n            } else {\n                item = hash.set(newItem);\n            }\n            return item;\n        }\n\n        function remove(oldItem) {\n            var hash = this,\n                pool = this.pool,\n                key = this.key;\n            var item = hash.get(oldItem);\n            if (item) {\n                var index = hash.indexOf(item);\n                if (index !== -1) {\n                    hash.splice(index, 1);\n                }\n                delete pool[item[key]];\n            }\n            return hash;\n        }\n\n        function addMany(items) {\n            var hash = this;\n            if (!items) {\n                return hash;\n            }\n            var i = 0;\n            while (i < items.length) {\n                hash.add(items[i]);\n                i++;\n            }\n            return hash;\n        }\n\n        function removeMany(items) {\n            var hash = this;\n            if (!items) {\n                return hash;\n            }\n            var i = 0;\n            while (i < items.length) {\n                hash.remove(items[i]);\n                i++;\n            }\n            return hash;\n        }\n\n        function removeAll() {\n            var hash = this,\n                key = hash.key,\n                pool = hash.pool;\n            var i = 0,\n                t = hash.length,\n                item;\n            while (hash.length) {\n                item = hash.shift();\n                delete pool[item[key]];\n                i++;\n            }\n            return hash;\n        }\n\n        function each(callback) {\n            var hash = this;\n            if (callback) {\n                var i = 0;\n                while (i < hash.length) {\n                    callback(hash[i], i);\n                    i++;\n                }\n            }\n            return hash;\n        }\n\n        function forward(key, reverse) {\n            var hash = this;\n            key = (key || this.key);\n            hash.sort(function(c, d) {\n                var a = reverse ? d : c;\n                var b = reverse ? c : d;\n                return a[key] - b[key];\n            });\n            return hash;\n        }\n\n        function backward(key) {\n            return this.forward(key, true);\n        }\n\n        function differs(hash) {\n            if (hash.key !== this.key || hash.length !== this.length) {\n                return true;\n            } else {\n                var differs = false,\n                    i = 0,\n                    t = this.length,\n                    key = this.key;\n                while (differs && i < t) {\n                    differs = this[i][key] !== hash[i][key];\n                    i++;\n                }\n            }\n        }\n\n        function updatePool() {\n            var hash = this,\n                pool = this.pool,\n                key = this.key;\n            Object.keys(pool).forEach(function(key) {\n                delete pool[key];\n            });\n            angular.forEach(hash, function(item) {\n                pool[item[key]] = item;\n            });\n        }\n\n    }]);\n\n}());\n/* global angular */\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    // micro interactions\n\n    function tap(Events) {\n        return {\n            restrict: 'A',\n            priority: 0,\n            link: link\n        };\n\n        function link(scope, element, attributes, model) {\n            if (attributes.ngBind) {\n                return;\n            }\n            if (attributes.href === '#' && !attributes.ngHref && !attributes.ngClick) {\n                return;\n            }\n\n            element.addClass('interaction-tap');\n            var node = document.createElement('interaction');\n            element[0].appendChild(node);\n\n            function onDown(e) {\n                element.removeClass('interaction-animate');\n                void element.offsetWidth;\n                // node.style.animationPlayState = \"paused\";\n                node.style.left = e.relative.x + 'px';\n                node.style.top = e.relative.y + 'px';\n                setTimeout(function() {\n                    element.addClass('interaction-animate');\n                    setTimeout(function() {\n                        element.removeClass('interaction-animate');\n                    }, 1000);\n                }, 10);\n\n                // console.log('tap.onDown', node, node.parentElement);\n            }\n            var listeners = { // down, move, up, click\n                down: onDown,\n            };\n            var events = new Events(element).add(listeners, scope); // passing scope to add remove listeners automatically on $destroy\n        }\n    }\n    app.directive('href', ['Events', tap]);\n    app.directive('ngClick', ['Events', tap]);\n\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.directive('modalView', ['$parse', '$templateRequest', '$compile', '$controller', 'Utils', function($parse, $templateRequest, $compile, $controller, Utils) {\r\n\r\n        function compileController(scope, element, html, data) {\r\n            // console.log('modalView.compileController', element);\r\n            element.html(html);\r\n            var link = $compile(element.contents());\r\n            if (data.controller) {\r\n                var $scope = scope.$new();\r\n                angular.extend($scope, data);\r\n                var controller = $controller(data.controller, { $scope: $scope });\r\n                if (data.controllerAs) {\r\n                    scope[data.controllerAs] = controller;\r\n                }\r\n                element.data('$ngControllerController', controller);\r\n                element.children().data('$ngControllerController', controller);\r\n                scope = $scope;\r\n            }\r\n            link(scope);\r\n        }\r\n\r\n        return {\r\n            restrict: 'A',\r\n            priority: -400,\r\n            link: function(scope, element, attributes, model) {\r\n                var modal = $parse(attributes.modalView);\r\n                modal = modal(scope);\r\n                modal.templateUrl = modal.templateUrl || 'artisan/modals/modal';\r\n                $templateRequest(modal.templateUrl).then(function(html) {\r\n                    compileController(scope, element, html, modal);\r\n                });\r\n                /*\r\n                // window.scrollTo(0, element[0].offsetTop - 100);\r\n                function onClick(e) {\r\n                    var closest = Utils.getClosestElement(e.target, element[0]);\r\n                    if (closest === null) {\r\n                        modal.reject(null);\r\n                    }\r\n                    // console.log('onClick', closest);\r\n                }\r\n                function addListeners() {\r\n                    angular.element(window).on('click', onClick);\r\n                }\r\n                function removeListeners() {\r\n                    angular.element(window).off('click', onClick);\r\n                }\r\n                scope.$on('destroy', function () {\r\n                    removeListeners();\r\n                });\r\n                setTimeout(function () {\r\n                    addListeners();\r\n                }, 500);\r\n                */\r\n            }\r\n        };\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.provider('$modal', [function $modalProvider() {\r\n\r\n        var modals = [];\r\n        var routes = {};\r\n\r\n        this.modals = modals;\r\n        this.routes = routes;\r\n        this.when = when;\r\n\r\n        function when(path, modal) {\r\n            routes[path] = modal;\r\n            return this;\r\n        }\r\n\r\n        this.$get = ['$q', '$timeout', function modalFactory($q, $timeout) {\r\n\r\n            function popModal(modal) {\r\n                // console.log('modalProvider.popModal', modal);                \r\n                var index = -1;\r\n                angular.forEach(modals, function(m, i) {\r\n                    if (m === modal) {\r\n                        index = i;\r\n                    }\r\n                });\r\n                if (index !== -1) {\r\n                    $timeout(function() {\r\n                        modal.active = false;\r\n                        modals.splice(index, 1);\r\n                        if (modals.length) {\r\n                            modals[modals.length - 1].active = true;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n\r\n            function closeModal(modal) {\r\n                // console.log('modalProvider.closeModal', modal);                \r\n                var index = -1;\r\n                angular.forEach(modals, function(m, i) {\r\n                    if (m === modal) {\r\n                        index = i;\r\n                    }\r\n                });\r\n                if (index !== -1) {\r\n                    modal.active = false;\r\n                    $timeout(function() {\r\n                        while (modals.length) {\r\n                            modals.splice(modals.length - 1, 1);\r\n                        }\r\n                    }, 500);\r\n                }\r\n            }\r\n\r\n            function addModal(path, params) {\r\n                // console.log('modalProvider.addModal', path, params);\r\n                var deferred = $q.defer();\r\n                params = params || null;\r\n                var modal = {\r\n                    title: 'Untitled',\r\n                    controller: null,\r\n                    templateUrl: null,\r\n                    params: params,\r\n                };\r\n                var current = routes[path];\r\n                if (current) {\r\n                    angular.extend(modal, current);\r\n                }\r\n                modal.deferred = deferred;\r\n                modal.back = function(data) {\r\n                    popModal(this);\r\n                    modal.deferred.resolve(data, modal);\r\n                }\r\n                modal.resolve = function(data) {\r\n                    closeModal(this);\r\n                    modal.deferred.resolve(data, modal);\r\n                }\r\n                modal.reject = function() {\r\n                    closeModal(this);\r\n                    modal.deferred.reject(modal);\r\n                }\r\n                modals.push(modal);\r\n                angular.forEach(modals, function(m, i) {\r\n                    m.active = false;\r\n                });\r\n                if (modals.length) {\r\n                    modal.active = true;\r\n                } else {\r\n                    $timeout(function() {\r\n                        modal.active = true;\r\n                        // window.scrollTo(0, 0);\r\n                    }, 500);\r\n                }\r\n                return deferred.promise;\r\n            }\r\n\r\n            return {\r\n                modals: modals,\r\n                addModal: addModal,\r\n            };\r\n        }];\r\n\r\n    }]);\r\n\r\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('nav', ['$parse', 'Nav', function ($parse, Nav) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function (element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/nav/nav';\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\titems: '=nav',\n\t\t\t},\n\t\t\tlink: function (scope, element, attributes, model) {\n\t\t\t\tscope.$watch('items', function (value) {\n\t\t\t\t\t// console.log(value instanceof Nav, value);\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tif (angular.isArray(value)) {\n\t\t\t\t\t\t\tvar onLink = $parse(attributes.onLink)(scope.$parent);\n\t\t\t\t\t\t\tvar onNav = $parse(attributes.onNav)(scope.$parent);\n\t\t\t\t\t\t\tvar nav = new Nav({\n\t\t\t\t\t\t\t\tonLink: onLink,\n\t\t\t\t\t\t\t\tonNav: onNav\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tnav.setItems(value);\n\t\t\t\t\t\t\tscope.item = nav;\n\n\t\t\t\t\t\t} else if (value instanceof Nav) {\n\t\t\t\t\t\t\tscope.item = value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t};\n    }]);\n\n\tapp.directive('navItem', ['$timeout', function ($timeout) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function (element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/nav/nav-item';\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\titem: '=navItem',\n\t\t\t},\n\t\t\tlink: function (scope, element, attributes, model) {\n\t\t\t\tvar navItem = angular.element(element[0].querySelector('.nav-link'));\n\n\t\t\t\tvar output;\n\n\t\t\t\tfunction itemOpen(item, immediate) {\n\t\t\t\t\tvar state = item.$nav.state;\n\t\t\t\t\tstate.active = true;\n\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\tstate.immediate = immediate;\n\t\t\t\t\t\tstate.closed = state.closing = false;\n\t\t\t\t\t\tstate.opening = true;\n\t\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t\tstate.opening = false;\n\t\t\t\t\t\t\tstate.opened = true;\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction itemClose(item, immediate) {\n\t\t\t\t\tvar state = item.$nav.state;\n\t\t\t\t\tstate.active = false;\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\tstate.immediate = immediate;\n\t\t\t\t\t\tstate.opened = state.opening = false;\n\t\t\t\t\t\tstate.closing = true;\n\t\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t\tstate.closing = false;\n\t\t\t\t\t\t\tstate.closed = true;\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tif (item.items) {\n\t\t\t\t\t\tangular.forEach(item.items, function (o) {\n\t\t\t\t\t\t\titemClose(o, true);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction itemToggle(item) {\n\t\t\t\t\t// console.log('itemToggle', item);\n\t\t\t\t\tvar state = item.$nav.state;\n\t\t\t\t\tstate.active = item.items ? !state.active : true;\n\t\t\t\t\tif (state.active) {\n\t\t\t\t\t\tif (item.$nav.parent) {\n\t\t\t\t\t\t\tangular.forEach(item.$nav.parent.items, function (o) {\n\t\t\t\t\t\t\t\tif (o !== item) {\n\t\t\t\t\t\t\t\t\titemClose(o, true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\titemOpen(item);\n\t\t\t\t\t} else {\n\t\t\t\t\t\titemClose(item);\n\t\t\t\t\t}\n\t\t\t\t\t// console.log(state);\n\t\t\t\t}\n\n\t\t\t\tfunction onTap(e) {\n\t\t\t\t\tvar item = scope.item;\n\t\t\t\t\t// console.log('Item.onTap', item);\n\t\t\t\t\tvar state = item.$nav.state;\n\t\t\t\t\tif (state.active) {\n\t\t\t\t\t\toutput = false;\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t} else if (item.$nav.onNav) {\n\t\t\t\t\t\tvar promise = item.$nav.onNav(item, item.$nav);\n\t\t\t\t\t\tif (promise && typeof promise.then === 'function') {\n\t\t\t\t\t\t\tpromise.then(function (resolved) {\n\t\t\t\t\t\t\t\t// go on\n\t\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t\t}, function (rejected) {\n\t\t\t\t\t\t\t\t// do nothing\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\toutput = false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toutput = promise;\n\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction trigger() {\n\t\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t\titemToggle(item);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onTouchStart(e) {\n\t\t\t\t\t// console.log('Item.onTouchStart', e);\n\t\t\t\t\tonTap(e);\n\t\t\t\t\tnavItem\n\t\t\t\t\t\t.off('mousedown', onMouseDown);\n\t\t\t\t\t// return r || prevent(e);\n\t\t\t\t}\n\n\t\t\t\tfunction onMouseDown(e) {\n\t\t\t\t\t// console.log('Item.onMouseDown', e);\n\t\t\t\t\tonTap(e);\n\t\t\t\t\tnavItem\n\t\t\t\t\t\t.off('touchstart', onTouchStart);\n\t\t\t\t\t// return r || prevent(e);\n\t\t\t\t}\n\n\t\t\t\tfunction onClick(e) {\n\t\t\t\t\t// console.log('Item.onClick', e);\n\t\t\t\t\treturn prevent(e);\n\t\t\t\t}\n\n\t\t\t\tfunction prevent(e) {\n\t\t\t\t\tif (output === false) {\n\t\t\t\t\t\t// console.log('Item.prevent', e);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t// e.stopPropagation();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction addListeners() {\n\t\t\t\t\tnavItem\n\t\t\t\t\t\t.on('touchstart', onTouchStart)\n\t\t\t\t\t\t.on('mousedown', onMouseDown)\n\t\t\t\t\t\t.on('click', onClick);\n\t\t\t\t}\n\n\t\t\t\tfunction removeListeners() {\n\t\t\t\t\tnavItem\n\t\t\t\t\t\t.off('touchstart', onTouchStart)\n\t\t\t\t\t\t.off('mousedown', onMouseDown)\n\t\t\t\t\t\t.off('click', onClick);\n\t\t\t\t}\n\n\t\t\t\taddListeners();\n\n\t\t\t\tscope.$on('$destroy', function () {\n\t\t\t\t\tremoveListeners();\n\t\t\t\t});\n\t\t\t}\n\t\t};\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('Nav', ['$silent', function($silent) {\n        function Nav(options) {\n            var nav = this;\n            var defaults = {\n                items: [],\n            }\n            angular.extend(nav, defaults);\n            if (options) {\n                angular.extend(nav, options);\n            }\n            nav.setNav(nav, null);\n        }\n        Nav.prototype = {\n            setItems: function(items) {\n                var nav = this;\n                nav.path = $silent.path();\n                nav.items = items;\n                nav.setNavs(items, nav);\n            },\n            setNavs: function(items, parent) {\n                var nav = this;\n                if (items) {\n                    angular.forEach(items, function(item) {\n                        nav.setNav(item, parent);\n                        nav.setNavs(item.items, item);\n                    });\n                }\n            },\n            setNav: function(item, parent) {\n                var nav = this;\n                var $nav = {\n                    parent: parent || null,\n                    level: parent ? parent.$nav.level + 1 : 0,\n                    state: {},\n                    addItems: function(x) {\n                        nav.addItems(x, item);\n                    },\n                    onNav: nav.onNav,\n                };\n                item.$nav = $nav;\n                $nav.link = nav.getLink(item);\n                if ($nav.link === nav.path) {\n                    $nav.state.active = true;\n                    $nav.state.opened = true;\n                    while ($nav.parent) {\n                        $nav = $nav.parent.$nav;\n                        $nav.state.active = true;\n                        $nav.state.opened = true;\n                    }\n                }\n            },\n            addItems: function(itemOrItems, parent) {\n                var nav = this;\n                if (angular.isArray(itemOrItems)) {\n                    angular.forEach(itemOrItems, function(item) {\n                        nav.addItem(item, parent);\n                    });\n                } else {\n                    nav.addItem(itemOrItems, parent);\n                }\n            },\n            addItem: function(item, parent) {\n                var nav = this,\n                    onLink = nav.onLink,\n                    onNav = nav.onNav;\n                nav.setNav(item, parent);\n                if (parent) {\n                    parent.items = parent.items || [];\n                    parent.items.push(item);\n                }\n            },\n            getLink: function(item) {\n                var link = null;\n                if (this.onLink) {\n                    link = this.onLink(item, item.$nav);\n                } else {\n                    link = item.link;\n                }\n                return link;\n            },\n        };\n        var statics = {\n            silent: function(path) {\n                $silent.silent(path);\n            },\n            path: function(path) {\n                $silent.path(path);\n            },\n        };\n        angular.extend(Nav, statics);\n        return Nav;\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('$promise', ['$q', function($q) {\n        function $promise(callback) {\n            if (typeof callback !== 'function') {\n                throw ('promise resolve callback missing');\n            }\n            var deferred = $q.defer();\n            callback(deferred);\n            return deferred.promise;\n        }\n        var statics = {\n            all: function(promises) {\n                return $q.all(promises);\n            },\n        };\n        angular.extend($promise, statics);\n        return $promise;\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.service('Router', ['$location', '$timeout', function($location, $timeout) {\n\n        var service = this;\n        service.redirect = redirect;\n        service.path = path;\n        service.apply = apply;\n\n        function redirect(path, msecs) {\n            function doRedirect() {\n                $location.$$lastRequestedPath = $location.path();\n                $location.path(path);\n            }\n            if (msecs) {\n                $timeout(function() {\n                    doRedirect();\n                }, msecs);\n            } else {\n                doRedirect();\n            }\n        }\n\n        function path(path, msecs) {\n            function doRetry() {\n                path = $location.$$lastRequestedPath || path;\n                $location.$$lastRequestedPath = null;\n                $location.path(path);\n            }\n            if (msecs) {\n                $timeout(function() {\n                    doRetry();\n                }, msecs);\n            } else {\n                doRetry();\n            }\n        }\n\n        function apply(path, msecs) {\n            function doRetry() {\n                $location.path(path);\n            }\n            if (msecs) {\n                $timeout(function() {\n                    doRetry();\n                }, msecs);\n            } else {\n                $timeout(function() {\n                    doRetry();\n                });\n            }\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('$silent', ['$rootScope', '$location', function($rootScope, $location) {\n        function $silent() {}\n\n        var $path;\n\n        function unlink() {\n            var listeners = $rootScope.$$listeners.$locationChangeSuccess;\n            angular.forEach(listeners, function(value, name) {\n                if (value === listener) {\n                    return;\n                }\n\n                function relink() {\n                    listeners[name] = value;\n                }\n                listeners[name] = relink; // temporary unlinking\n            });\n        }\n\n        function listener(e) {\n            // console.log('onLocationChangeSuccess', e);\n            if ($path === $location.path()) {\n                unlink();\n            }\n            $path = null;\n        }\n\n        var statics = {\n            silent: function(path, replace) {\n                // this.prev = $location.path(); ???\n                var location = $location.url(path);\n                if (replace) {\n                    location.replace();\n                }\n                $path = $location.path();\n            },\n            path: function(path) {\n                return $location.path(path);\n            },\n        };\n\n        angular.extend($silent, statics);\n        $rootScope.$$listeners.$locationChangeSuccess.unshift(listener);\n        // console.log('$rootScope.$$listeners.$locationChangeSuccess', $rootScope.$$listeners.$locationChangeSuccess);\n        return $silent;\n    }]);\n\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.factory('State', ['$timeout', function($timeout) {\r\n        var DELAY = 2000;\r\n\r\n        function State() {\r\n            this.errors = [];\r\n            this.isReady = false;\r\n            this.idle();\r\n        }\r\n\r\n        State.prototype = {\r\n            idle: function() {\r\n                var state = this;\r\n                state.isBusy = false;\r\n                state.isError = false;\r\n                state.isErroring = false;\r\n                state.isSuccess = false;\r\n                state.isSuccessing = false;\r\n                state.button = null;\r\n                state.errors = [];\r\n            },\r\n            busy: function() {\r\n                var state = this;\r\n                if (!state.isBusy) {\r\n                    state.isBusy = true;\r\n                    state.isError = false;\r\n                    state.isErroring = false;\r\n                    state.isSuccess = false;\r\n                    state.isSuccessing = false;\r\n                    state.errors = [];\r\n                    return true;\r\n                } else {\r\n                    return false;\r\n                }\r\n            },\r\n            error: function error(error) {\r\n                console.log('State.error', error);\r\n                var state = this;\r\n                state.isBusy = false;\r\n                state.isError = true;\r\n                state.isErroring = true;\r\n                state.isSuccess = false;\r\n                state.isSuccessing = false;\r\n                state.errors.push(error);\r\n                $timeout(function() {\r\n                    state.isErroring = false;\r\n                }, DELAY);\r\n            },\r\n            ready: function ready() {\r\n                var state = this;\r\n                state.idle();\r\n                state.isReady = true;\r\n            },\r\n            success: function success() {\r\n                var state = this;\r\n                state.isBusy = false;\r\n                state.isError = false;\r\n                state.isErroring = false;\r\n                state.isSuccess = true;\r\n                state.isSuccessing = true;\r\n                state.errors = [];\r\n                $timeout(function() {\r\n                    state.isSuccessing = false;\r\n                }, DELAY);\r\n            },\r\n            enabled: function enabled() {\r\n                var state = this;\r\n                return !state.isBusy && !state.isErroring && !state.isSuccessing;\r\n            },\r\n            errorMessage: function errorMessage() {\r\n                var state = this;\r\n                return state.isError ? state.errors[state.errors.length - 1] : null;\r\n            },\r\n            submitClass: function submitClass() {\r\n                var state = this;\r\n                return {\r\n                    busy: state.isBusy,\r\n                    ready: state.isReady,\r\n                    successing: state.isSuccessing,\r\n                    success: state.isSuccess,\r\n                    errorring: state.isErroring,\r\n                    error: state.isError,\r\n                };\r\n            },\r\n            labels: function labels(addons) {\r\n                var state = this;\r\n                var defaults = {\r\n                    ready: 'submit',\r\n                    busy: 'sending',\r\n                    error: 'error',\r\n                    success: 'success',\r\n                };\r\n                if (addons) {\r\n                    angular.extend(defaults, addons);\r\n                }\r\n                var label = defaults.ready;\r\n                if (state.isBusy) {\r\n                    label = defaults.busy;\r\n                } else if (state.isSuccess) {\r\n                    label = defaults.success;\r\n                } else if (state.isError) {\r\n                    label = defaults.error;\r\n                }\r\n                return label;\r\n            },\r\n            classes: function classes(addons) {\r\n                var state = this,\r\n                    classes = null;\r\n                classes = {\r\n                    ready: state.isReady,\r\n                    busy: state.isBusy,\r\n                    successing: state.isSuccessing,\r\n                    success: state.isSuccess,\r\n                    errorring: state.isErroring,\r\n                    error: state.isError,\r\n                };\r\n                if (addons) {\r\n                    angular.forEach(addons, function(value, key) {\r\n                        classes[value] = classes[key];\r\n                    });\r\n                }\r\n                return classes;\r\n            }\r\n        };\r\n\r\n        return State;\r\n    }]);\r\n\r\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('Cookie', ['$q', '$window', function($q, $window) {\n        function Cookie() {}\n        Cookie.TIMEOUT = 5 * 60 * 1000; // five minutes\n        Cookie._set = function(name, value, days) {\n            var expires;\n            if (days) {\n                var date = new Date();\n                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n                expires = '; expires=' + date.toGMTString();\n            } else {\n                expires = '';\n            }\n            $window.document.cookie = name + '=' + value + expires + '; path=/';\n        };\n        Cookie.exists = function(name) {\n            return $window.document.cookie.indexOf(';' + name + '=') !== -1 || $window.document.cookie.indexOf(name + '=') === 0;\n        };\n        Cookie.get = function(name) {\n            var cookieName = name + \"=\";\n            var ca = $window.document.cookie.split(';');\n            for (var i = 0; i < ca.length; i++) {\n                var c = ca[i];\n                while (c.charAt(0) == ' ') {\n                    c = c.substring(1, c.length);\n                }\n                if (c.indexOf(cookieName) === 0) {\n                    var value = c.substring(cookieName.length, c.length);\n                    var model = null;\n                    try {\n                        model = JSON.parse(decodeURIComponent(atob(value)));\n                    } catch (e) {\n                        console.log('Cookie.get.error parsing', key, e);\n                    }\n                    return model;\n                }\n            }\n            return null;\n        };\n        Cookie.set = function(name, value, days) {\n            try {\n                var cache = [];\n                var json = JSON.stringify(value, function(key, value) {\n                    if (key === 'pool') {\n                        return;\n                    }\n                    if (typeof value === 'object' && value !== null) {\n                        if (cache.indexOf(value) !== -1) {\n                            // Circular reference found, discard key\n                            return;\n                        }\n                        cache.push(value);\n                    }\n                    return value;\n                });\n                cache = null;\n                Cookie._set(name, btoa(encodeURIComponent(json)), days);\n            } catch (e) {\n                console.log('Cookie.set.error serializing', name, value, e);\n            }\n        };\n        Cookie.delete = function(name) {\n            Cookie._set(name, \"\", -1);\n        };\n        Cookie.on = function(name) {\n            var deferred = $q.defer();\n            var i, interval = 1000,\n                elapsed = 0,\n                timeout = Cookie.TIMEOUT;\n\n            function checkCookie() {\n                if (elapsed > timeout) {\n                    deferred.reject('timeout');\n                } else {\n                    var c = Cookie.get(name);\n                    if (c) {\n                        deferred.resolve(c);\n                    } else {\n                        elapsed += interval;\n                        i = setTimeout(checkCookie, interval);\n                    }\n                }\n            }\n            checkCookie();\n            return deferred.promise;\n        };\n        return Cookie;\n    }]);\n\n    app.factory('LocalStorage', ['$q', '$window', 'Cookie', function($q, $window, Cookie) {\n        function LocalStorage() {}\n\n        function isLocalStorageSupported() {\n            var supported = false;\n            try {\n                supported = 'localStorage' in $window && $window.localStorage !== null;\n                if (supported) {\n                    $window.localStorage.setItem('test', '1');\n                    $window.localStorage.removeItem('test');\n                } else {\n                    supported = false;\n                }\n            } catch (e) {\n                supported = false;\n            }\n            return supported;\n        }\n        LocalStorage.isSupported = isLocalStorageSupported();\n        if (LocalStorage.isSupported) {\n            LocalStorage.exists = function(name) {\n                return $window.localStorage[name] !== undefined;\n            };\n            LocalStorage.get = function(name) {\n                var value = null;\n                if ($window.localStorage[name] !== undefined) {\n                    try {\n                        value = JSON.parse($window.localStorage[name]);\n                    } catch (e) {\n                        console.log('LocalStorage.get.error parsing', name, e);\n                    }\n                }\n                return value;\n            };\n            LocalStorage.set = function(name, value) {\n                try {\n                    var cache = [];\n                    var json = JSON.stringify(value, function(key, value) {\n                        if (key === 'pool') {\n                            return;\n                        }\n                        if (typeof value === 'object' && value !== null) {\n                            if (cache.indexOf(value) !== -1) {\n                                // Circular reference found, discard key\n                                return;\n                            }\n                            cache.push(value);\n                        }\n                        return value;\n                    });\n                    cache = null;\n                    $window.localStorage.setItem(name, json);\n                } catch (e) {\n                    console.log('LocalStorage.set.error serializing', name, value, e);\n                }\n            };\n            LocalStorage.delete = function(name) {\n                $window.localStorage.removeItem(name);\n            };\n            LocalStorage.on = function(name) {\n                var deferred = $q.defer();\n                var i, timeout = Cookie.TIMEOUT;\n\n                function storageEvent(e) {\n                    // console.log('LocalStorage.on', name, e);\n                    clearTimeout(i);\n                    if (e.originalEvent.key == name) {\n                        try {\n                            var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n                            deferred.resolve(value);\n                        } catch (error) {\n                            console.log('LocalStorage.on.error parsing', name, error);\n                            deferred.reject('error parsing ' + name);\n                        }\n                    }\n                }\n                angular.element($window).on('storage', storageEvent);\n                i = setTimeout(function() {\n                    deferred.reject('timeout');\n                }, timeout);\n                return deferred.promise;\n            };\n        } else {\n            console.log('LocalStorage.unsupported switching to cookies');\n            LocalStorage.exists = Cookie.exists;\n            LocalStorage.set = Cookie.set;\n            LocalStorage.get = Cookie.get;\n            LocalStorage.delete = Cookie.delete;\n            LocalStorage.on = Cookie.on;\n        }\n        return LocalStorage;\n    }]);\n\n    app.factory('SessionStorage', ['$q', '$window', 'Cookie', function($q, $window, Cookie) {\n        function SessionStorage() {}\n\n        function isSessionStorageSupported() {\n            var supported = false;\n            try {\n                supported = 'sessionStorage' in $window && $window.sessionStorage !== undefined;\n                if (supported) {\n                    $window.sessionStorage.setItem('test', '1');\n                    $window.sessionStorage.removeItem('test');\n                } else {\n                    supported = false;\n                }\n            } catch (e) {\n                supported = false;\n            }\n            return supported;\n        }\n        SessionStorage.isSupported = isSessionStorageSupported();\n        if (SessionStorage.isSupported) {\n            SessionStorage.exists = function(name) {\n                return $window.sessionStorage[name] !== undefined;\n            };\n            SessionStorage.get = function(name) {\n                var value = null;\n                if ($window.sessionStorage[name] !== undefined) {\n                    try {\n                        value = JSON.parse($window.sessionStorage[name]);\n                    } catch (e) {\n                        console.log('SessionStorage.get.error parsing', name, e);\n                    }\n                }\n                return value;\n            };\n            SessionStorage.set = function(name, value) {\n                try {\n                    var cache = [];\n                    var json = JSON.stringify(value, function(key, value) {\n                        if (key === 'pool') {\n                            return;\n                        }\n                        if (typeof value === 'object' && value !== null) {\n                            if (cache.indexOf(value) !== -1) {\n                                // Circular reference found, discard key\n                                return;\n                            }\n                            cache.push(value);\n                        }\n                        return value;\n                    });\n                    cache = null;\n                    $window.sessionStorage.setItem(name, json);\n                } catch (e) {\n                    console.log('SessionStorage.set.error serializing', name, value, e);\n                }\n            };\n            SessionStorage.delete = function(name) {\n                $window.sessionStorage.removeItem(name);\n            };\n            SessionStorage.on = function(name) {\n                var deferred = $q.defer();\n                var i, timeout = Cookie.TIMEOUT;\n\n                function storageEvent(e) {\n                    // console.log('SessionStorage.on', name, e);\n                    clearTimeout(i);\n                    if (e.originalEvent.key === name) {\n                        try {\n                            var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n                            deferred.resolve(value);\n                        } catch (error) {\n                            console.log('SessionStorage.on.error parsing', name, error);\n                            deferred.reject('error parsing ' + name);\n                        }\n                    }\n                }\n                angular.element($window).on('storage', storageEvent);\n                i = setTimeout(function() {\n                    deferred.reject('timeout');\n                }, timeout);\n                return deferred.promise;\n            };\n        } else {\n            console.log('SessionStorage.unsupported switching to cookies');\n            SessionStorage.exists = Cookie.exists;\n            SessionStorage.set = Cookie.set;\n            SessionStorage.get = Cookie.get;\n            SessionStorage.delete = Cookie.delete;\n            SessionStorage.on = Cookie.on;\n        }\n        return SessionStorage;\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('Vector', function() {\n        function Vector(x, y) {\n            this.x = x || 0;\n            this.y = y || 0;\n        }\n        Vector.make = function(a, b) {\n            return new Vector(b.x - a.x, b.y - a.y);\n        };\n        Vector.size = function(a) {\n            return Math.sqrt(a.x * a.x + a.y * a.y);\n        };\n        Vector.normalize = function(a) {\n            var l = Vector.size(a);\n            a.x /= l;\n            a.y /= l;\n            return a;\n        };\n        Vector.incidence = function(a, b) {\n            var angle = Math.atan2(b.y, b.x) - Math.atan2(a.y, a.x);\n            // if (angle < 0) angle += 2 * Math.PI;\n            // angle = Math.min(angle, (Math.PI * 2 - angle));\n            return angle;\n        };\n        Vector.distance = function(a, b) {\n            return Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));\n        };\n        Vector.cross = function(a, b) {\n            return (a.x * b.y) - (a.y * b.x);\n        };\n        Vector.difference = function(a, b) {\n            return new Vector(a.x - b.x, a.y - b.y);\n        };\n        Vector.power = function(a, b) {\n            var x = Math.abs(b.x - a.x);\n            var y = Math.abs(b.y - a.y);\n            return (x + y) / 2;\n        };\n        Vector.prototype = {\n            size: function() {\n                return Vector.size(this);\n            },\n            normalize: function() {\n                return Vector.normalize(this);\n            },\n            incidence: function(b) {\n                return Vector.incidence(this, b);\n            },\n            cross: function(b) {\n                return Vector.cross(this, b);\n            },\n            distance: function(b) {\n                return Vector.distance(this, b);\n            },\n            difference: function(b) {\n                return Vector.difference(this, b);\n            },\n            power: function() {\n                return (Math.abs(this.x) + Math.abs(this.y)) / 2;\n            },\n            towards: function(b, friction) {\n                friction = friction || 0.125;\n                this.x += (b.x - this.x) * friction;\n                this.y += (b.y - this.y) * friction;\n                return this;\n            },\n            add: function(b) {\n                this.x += b.x;\n                this.y += b.y;\n                return this;\n            },\n            friction: function(b) {\n                this.x *= b;\n                this.y *= b;\n                return this;\n            },\n            copy: function(b) {\n                return new Vector(this.x, this.y);\n            },\n            toString: function() {\n                return '{' + this.x + ',' + this.y + '}';\n            },\n        };\n        return Vector;\n    });\n\n    app.factory('Utils', ['$compile', '$controller', 'Vector', function($compile, $controller, Vector) {\n        (function() {\n            // POLYFILL window.requestAnimationFrame\n            var lastTime = 0;\n            var vendors = ['ms', 'moz', 'webkit', 'o'];\n            for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n                window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n                window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||\n                    window[vendors[x] + 'CancelRequestAnimationFrame'];\n            }\n            if (!window.requestAnimationFrame) {\n                window.requestAnimationFrame = function(callback, element) {\n                    var currTime = new Date().getTime();\n                    var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n                    var id = window.setTimeout(function() { callback(currTime + timeToCall); }, timeToCall);\n                    lastTime = currTime + timeToCall;\n                    return id;\n                };\n            }\n            if (!window.cancelAnimationFrame) {\n                window.cancelAnimationFrame = function(id) {\n                    clearTimeout(id);\n                };\n            }\n        }());\n        (function() {\n            // POLYFILL Array.prototype.reduce\n            // Production steps of ECMA-262, Edition 5, 15.4.4.21\n            // Reference: http://es5.github.io/#x15.4.4.21\n            // https://tc39.github.io/ecma262/#sec-array.prototype.reduce\n            if (!Array.prototype.reduce) {\n                Object.defineProperty(Array.prototype, 'reduce', {\n                    value: function(callback) { // , initialvalue\n                        if (this === null) {\n                            throw new TypeError('Array.prototype.reduce called on null or undefined');\n                        }\n                        if (typeof callback !== 'function') {\n                            throw new TypeError(callback + ' is not a function');\n                        }\n                        var o = Object(this);\n                        var len = o.length >>> 0;\n                        var k = 0;\n                        var value;\n                        if (arguments.length == 2) {\n                            value = arguments[1];\n                        } else {\n                            while (k < len && !(k in o)) {\n                                k++;\n                            }\n                            if (k >= len) {\n                                throw new TypeError('Reduce of empty array with no initial value');\n                            }\n                            value = o[k++];\n                        }\n                        while (k < len) {\n                            if (k in o) {\n                                value = callback(value, o[k], k, o);\n                            }\n                            k++;\n                        }\n                        return value;\n                    }\n                });\n            }\n        }());\n        var _isTouch;\n        var getNow = Date.now || function() {\n            return new Date().getTime();\n        };\n        var ua = window.navigator.userAgent.toLowerCase();\n        var safari = ua.indexOf('safari') !== -1 && ua.indexOf('chrome') === -1;\n        var msie = ua.indexOf('trident') !== -1 || ua.indexOf('edge') !== -1 || ua.indexOf('msie') !== -1;\n        var chrome = !safari && !msie && ua.indexOf('chrome') !== -1;\n        var mobile = ua.indexOf('mobile') !== -1;\n        var isChrome = navigator.userAgent.toLowerCase().indexOf('chrome') > -1;\n        var isSafari = navigator.userAgent.toLowerCase().indexOf('safari') > -1;\n\n        function Utils() {}\n        Utils.reverseSortOn = reverseSortOn;\n        Utils.getTouch = getTouch;\n        Utils.getRelativeTouch = getRelativeTouch;\n        Utils.getClosest = getClosest;\n        Utils.getClosestElement = getClosestElement;\n        Utils.throttle = throttle;\n        Utils.where = where;\n        Utils.format = format;\n        Utils.compileController = compileController;\n        Utils.reducer = reducer;\n        Utils.reducerSetter = reducerSetter;\n        Utils.reducerAdder = reducerAdder;\n        Utils.downloadFile = downloadFile;\n        Utils.serverDownload = serverDownload;\n        Utils.toMd5 = function(string) {\n            return Md5.encode(string);\n        };\n        Utils.ua = {\n            safari: safari,\n            msie: msie,\n            chrome: chrome,\n            mobile: mobile,\n        };\n        angular.forEach(Utils.ua, function(value, key) {\n            if (value) {\n                angular.element(document.getElementsByTagName('body')).addClass(key);\n            }\n        });\n        return Utils;\n\n        function isTouch() {\n            if (!_isTouch) {\n                _isTouch = {\n                    value: ('ontouchstart' in window || 'onmsgesturechange' in window)\n                };\n            }\n            // console.log(_isTouch);\n            return _isTouch.value;\n        }\n\n        function getTouch(e, previous) {\n            var t = new Vector();\n            if (e.type === 'touchstart' || e.type === 'touchmove' || e.type === 'touchend' || e.type === 'touchcancel') {\n                var touch = null;\n                var event = e.originalEvent ? e.originalEvent : e;\n                var touches = event.touches.length ? event.touches : event.changedTouches;\n                if (touches && touches.length) {\n                    touch = touches[0];\n                }\n                if (touch) {\n                    t.x = touch.pageX;\n                    t.y = touch.pageY;\n                }\n            } else if (e.type === 'click' || e.type === 'mousedown' || e.type === 'mouseup' || e.type === 'mousemove' || e.type === 'mouseover' || e.type === 'mouseout' || e.type === 'mouseenter' || e.type === 'mouseleave' || e.type === 'contextmenu') {\n                t.x = e.pageX;\n                t.y = e.pageY;\n            }\n            if (previous) {\n                t.s = Vector.difference(t, previous);\n            }\n            t.type = e.type;\n            return t;\n        }\n\n        function getRelativeTouch(node, point) {\n            var element = angular.element(node); // passing through jqlite for accepting both\n            node = element[0];\n            var rect = node.getBoundingClientRect();\n            // var e = new Vector(rect.left + node.scrollLeft, rect.top + node.scrollTop);\n            var e = new Vector(rect.left, rect.top);\n            return Vector.difference(point, e);\n        }\n\n        function getClosest(el, selector) {\n            var matchesFn, parent;\n            ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'].some(function(fn) {\n                if (typeof document.body[fn] == 'function') {\n                    matchesFn = fn;\n                    return true;\n                }\n                return false;\n            });\n            if (el[matchesFn](selector)) {\n                return el;\n            }\n            while (el !== null) {\n                parent = el.parentElement;\n                if (parent !== null && parent[matchesFn](selector)) {\n                    return parent;\n                }\n                el = parent;\n            }\n            return null;\n        }\n\n        function getClosestElement(el, target) {\n            var matchesFn, parent;\n            if (el === target) {\n                return el;\n            }\n            while (el !== null) {\n                parent = el.parentElement;\n                if (parent !== null && parent === target) {\n                    return parent;\n                }\n                el = parent;\n            }\n            return null;\n        }\n\n        function throttle(func, wait, options) {\n            // Returns a function, that, when invoked, will only be triggered at most once\n            // during a given window of time. Normally, the throttled function will run\n            // as much as it can, without ever going more than once per `wait` duration;\n            // but if you'd like to disable the execution on the leading edge, pass\n            // `{leading: false}`. To disable execution on the trailing edge, ditto.\n            var context, args, result;\n            var timeout = null;\n            var previous = 0;\n            if (!options) options = {};\n            var later = function() {\n                previous = options.leading === false ? 0 : getNow();\n                timeout = null;\n                result = func.apply(context, args);\n                if (!timeout) context = args = null;\n            };\n            return function() {\n                var now = getNow();\n                if (!previous && options.leading === false) previous = now;\n                var remaining = wait - (now - previous);\n                context = this;\n                args = arguments;\n                if (remaining <= 0 || remaining > wait) {\n                    if (timeout) {\n                        clearTimeout(timeout);\n                        timeout = null;\n                    }\n                    previous = now;\n                    result = func.apply(context, args);\n                    if (!timeout) context = args = null;\n                } else if (!timeout && options.trailing !== false) {\n                    timeout = setTimeout(later, remaining);\n                }\n                return result;\n            };\n        }\n\n        function where(array, query) {\n            var found = null;\n            if (array) {\n                angular.forEach(array, function(item) {\n                    var has = true;\n                    angular.forEach(query, function(value, key) {\n                        has = has && item[key] === value;\n                    });\n                    if (has) {\n                        found = item;\n                    }\n                });\n            }\n            return found;\n        }\n\n        function compileController(scope, element, html, data) {\n            // console.log('Utils.compileController', element);\n            element.html(html);\n            var link = $compile(element.contents());\n            if (data.controller) {\n                var $scope = scope.$new();\n                angular.extend($scope, data);\n                var controller = $controller(data.controller, { $scope: $scope });\n                if (data.controllerAs) {\n                    scope[data.controllerAs] = controller;\n                }\n                element.data('$ngControllerController', controller);\n                element.children().data('$ngControllerController', controller);\n                scope = $scope;\n            }\n            link(scope);\n        }\n\n        function reverseSortOn(key) {\n            return function(a, b) {\n                if (a[key] < b[key]) {\n                    return 1;\n                }\n                if (a[key] > b[key]) {\n                    return -1;\n                }\n                // a must be equal to b\n                return 0;\n            };\n        }\n\n        function format(string, prepend, expression) {\n            string = string || '';\n            prepend = prepend || '';\n            var splitted = string.split(',');\n            if (splitted.length > 1) {\n                var formatted = splitted.shift();\n                angular.forEach(splitted, function(value, index) {\n                    if (expression) {\n                        formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n                    } else {\n                        formatted = formatted.split('{' + index + '}').join(prepend + value);\n                    }\n                });\n                if (expression) {\n                    return '\\'' + formatted + '\\'';\n                } else {\n                    return formatted;\n                }\n            } else {\n                return prepend + string;\n            }\n        }\n\n        function reducer(o, key) {\n            return o[key];\n        }\n\n        function reducerSetter(o, key, value) {\n            if (typeof key == 'string') {\n                return reducerSetter(o, key.split('.'), value);\n            } else if (key.length == 1 && value !== undefined) {\n                return (o[key[0]] = value);\n            } else if (key.length === 0) {\n                return o;\n            } else {\n                return reducerSetter(o[key[0]], key.slice(1), value);\n            }\n        }\n\n        function reducerAdder(o, key, value) {\n            if (typeof key == 'string') {\n                return reducerAdder(o, key.split('.'), value);\n            } else if (key.length == 1 && value !== undefined) {\n                return (o[key[0]] += value);\n            } else if (key.length === 0) {\n                return o;\n            } else {\n                return reducerAdder(o[key[0]], key.slice(1), value);\n            }\n        }\n\n        function downloadFile(content, name, type) {\n            type = type || 'application/octet-stream';\n            var base64 = null;\n            var blob = new Blob([content], { type: type });\n            var reader = new window.FileReader();\n            reader.readAsDataURL(blob);\n            reader.onloadend = function() {\n                base64 = reader.result;\n                download();\n            };\n\n            function download() {\n                // If in Chrome or Safari - download via virtual link click\n                // if (isChrome || isSafari) {\n                //Creating new link node.\n                if (document.createEvent) {\n                    var anchor = document.createElement('a');\n                    anchor.href = base64;\n                    if (anchor.download !== undefined) {\n                        //Set HTML5 download attribute. This will prevent file from opening if supported.\n                        var downloadName = name || base64.substring(base64.lastIndexOf('/') + 1, base64.length);\n                        anchor.download = downloadName;\n                    }\n                    //Dispatching click event.\n                    var event = document.createEvent('MouseEvents');\n                    event.initEvent('click', true, true);\n                    anchor.dispatchEvent(event);\n                    return true;\n                }\n                // }\n                // Force file download (whether supported by server).\n                var query = '?download';\n                window.open(base64.indexOf('?') > -1 ? base64 : base64 + query, '_self');\n            }\n\n            function __download() {\n                var supportsDownloadAttribute = 'download' in document.createElement('a');\n                if (supportsDownloadAttribute) {\n                    var anchor = document.createElement('a');\n                    anchor.href = 'data:attachment/text;base64,' + encodeURI(window.btoa(content));\n                    anchor.target = '_blank';\n                    anchor.download = name;\n                    //Dispatching click event.\n                    if (document.createEvent) {\n                        var event = document.createEvent('MouseEvents');\n                        event.initEvent('click', true, true);\n                        anchor.dispatchEvent(event);\n                        return true;\n                    }\n                } else if (window.Blob !== undefined && window.saveAs !== undefined) {\n                    var blob = new Blob([content], { type: type });\n                    saveAs(blob, filename);\n                } else {\n                    window.open('data:attachment/text;charset=utf-8,' + encodeURI(content));\n                }\n            }\n            /*\n            var headers = response.headers();\n            // console.log(response);\n            var blob = new Blob([response.data], { type: \"application/octet-stream\" }); // { type: headers['content-type'] });\n            var windowUrl = (window.URL || window.webkitURL);\n            var downloadUrl = windowUrl.createObjectURL(blob);\n            var anchor = document.createElement(\"a\");\n            anchor.href = downloadUrl;\n            var fileNamePattern = /filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/;\n            anchor.download = fileNamePattern.exec(headers['content-disposition'])[1];\n            document.body.appendChild(anchor);\n            anchor.click();\n            windowUrl.revokeObjectURL(blob);\n            anchor.remove();\n            */\n            /*\n            //Dispatching click event.\n            if (document.createEvent) {\n                var e = document.createEvent('MouseEvents');\n                e.initEvent('click', true, true);\n                link.dispatchEvent(e);\n                return true;\n            }\n            */\n        }\n\n        function serverDownload(options) {\n            var defaults = {\n                uri: '/api/reports/download',\n                name: 'Filename',\n                extension: 'txt',\n                type: 'text/plain',\n                content: 'Hello!',\n            };\n            options = angular.extend(defaults, options);\n            var content = JSON.stringify(options); // unescape(encodeURIComponent(JSON.stringify(download)));\n            var form = document.createElement('form');\n            var input = document.createElement('input');\n            input.name = 'download';\n            input.value = content;\n            form.appendChild(input);\n            form.action = options.uri;\n            form.method = 'POST';\n            form.target = 'ProjectDownloads';\n            form.enctype = 'application/x-www-form-urlencoded';\n            // form.enctype = 'multipart/form-data';\n            // form.enctype = 'text/plain';\n            document.body.appendChild(form);\n            form.submit();\n            setTimeout(function() {\n                document.body.removeChild(form);\n            }, 100);\n            // angular.element(form).find('button')[0].click();\n            return Utils;\n        }\n    }]);\n\n}());"]}