{"version":3,"sources":["docs/js/artisan.js"],"names":["angular","module","app","factory","Color","r","g","b","a","arguments","length","this","uint","parseInt","componentToHex","c","hex","toString","luma","color","dot","contrast","darker","pow","min","Math","max","floor","lighter","prototype","toUint","toHex","toRgba","toFixed","alpha","makeSet","foreground","border","light","Shape","shapeCircle","p","cx","cy","sa","ea","PI","ctx","arc","shapeStar","or","ir","steps","x","y","angle","step","moveTo","i","cos","sin","lineTo","shapeRoundRect","rect","w","h","undefined","tl","tr","br","bl","defaultRadius","key","quadraticCurveTo","circle","params","Array","slice","call","beginPath","apply","closePath","star","roundRect","constant","black","white","blue","red","lightBlue","lightYellow","greyLighter","greyLight","greyMedium","grey","map","$q","Painter","Rect","Palette","painter","setSize","buffer","size","pool","rows","getRect","row","canvas","width","height","setCanvas","document","createElement","drawImage","add","path","palette","isString","deferred","defer","img","Image","onload","addShape","resolve","onerror","reject","src","promise","callback","save","clip","translate","clone","setPos","restore","draw","target","pre","drawRect","tint","setFill","fillRect","globalCompositeOperation","console","log","pattern","drawPattern","fillStyle","createPattern","toDataURL","PainterColors","drawingRect","setColors","colors","forEach","value","offsetWidth","offsetHeight","getContext","lineCap","copy","clear","resize","setText","font","align","verticalAlign","textAlign","textBaseline","setStroke","strokeStyle","lineWidth","fillText","text","point","post","maxLength","substr","trim","strokeRect","fill","stroke","begin","close","rotate","xy","image","t","s","flip","scale","directive","$parse","State","Dom","ExpandableLink","scope","element","attributes","model","getStyle","node","style","window","getComputedStyle","display","getPropertyValue","position","top","right","bottom","left","margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left","background-color","getTextStyle","setStyle","cssText","styleObj","placeholder","parentNode","insertBefore","originalCssText","targetElement","addClass","getParents","each","remove","removeClass","removeChild","setRects","boundingClientRect","hasClass","getBoundingClientRect","from","to","relative","absolute","absoluteRight","innerWidth","absoluteLeft","absoluteBottom","innerHeight","absoluteTop","expand","expanded","state","idle","current","dynamics","animate","type","easeInOut","duration","complete","change","update","contract","set","expandableRelative","expandableAbsolute","querySelector","expandable","onDown","e","onUp","getClosestNode","onResize","isBusy","onKeyDown","toLowerCase","tagName","removeListeners","trigger","off","expandableTrigger","$on","on","restrict","link","templateUrl","transclude","message","formatLabel","string","prepend","expression","splitted","split","formatted","shift","index","join","uniqueId","template","control","ngModel","required","form","title","source","label","require","controller","filter","optionLabel","getOptions","number","field","replace","format","precision","validate","minLength","Number","POSITIVE_INFINITY","options","focus","visible","onChange","$parent","onFilter","getType","getClasses","control-focus","control-success","$valid","control-error","$invalid","$submitted","$touched","control-empty","$viewValue","getMessages","$error","toggleVisibility","$http","$templateCache","$compile","compile","$timeout","onRemove","getter","numberPicker","setter","assign","onAdd","nodeRemove","nodeAdd","querySelectorAll","$filter","onFocus","$modelValue","$setViewValue","doBlur","onBlur","$formatters","push","$parsers","unshift","valid","String","indexOf","$setValidity","tap","Events","setTimeout","ngBind","appendChild","listeners","down","priority","$templateRequest","$controller","compileController","html","data","contents","$scope","$new","extend","controllerAs","children","modal","modalView","then","provider","when","routes","modals","$get","popModal","m","active","splice","closeModal","addModal","back","Nav","NavLink","$watch","isArray","onPath","onNav","nav","setItems","item","items","NavItemLink","itemOpen","immediate","$nav","closed","closing","opening","opened","itemClose","o","itemToggle","parent","output","resolved","rejected","onClick","preventDefault","stop","navItem","click","NavToLink","navTo","Silent","defaults","setNav","NavSilent","silent","NavPath","setNavs","level","addItems","getPath","itemOrItems","addItem","statics","publics","open","openAnimation","closeAnimation","popuppable","opacity","spring","frequency","friction","ondragstart","Scrollable","Animate","Style","Utils","render","time","scrollable","setContainer","containerNode","setContent","contentNode","setEnabled","isEnabled","renderX","getCurrent","contentStyle","transform","event","dragStart","dragOn","play","onMove","dragMove","drag","getDrag","abs","dragEnd","dragOff","_onScrollX","dir","interval","wheelX","onWheel","wheelXCheck","onScrollX","enabled","scrollableWhen","windowEvents","move","up","onLeft","onRight","showIndicatorFor","attr","content","scrollableX","getItems","scrollableItem","prev","scrollPrev","next","scrollNext","reset","doReset","newValue","oldValue","wheel","pause","renderY","_onScrollY","wheelY","wheelYCheck","onScrollY","onTop","onBottom","scrollableY","Point","container","flag","getIndicator","indicator","getIndex","currentIndex","scrollToIndex","getItemAtIndex","offset","offsetLeft","offsetTop","busy","start","end","speed","wheeling","dragging","doLeft","finally","scrollToX","doRight","overflow","padding","animating","extendX","snapToNearestX","round","extending","distance","snappable","doTop","scrollToY","doBottom","extendY","snapToNearestY","methods","$promise","VideoSourceLink","canplay","_onCanPlay","video","preload","toggle","playing","onPlaying","onPause","onEnded","onProgress","infos","buffered","onTimeUpdate","currentTime","progressTime","videoElement","native","ticks","cancelAnimationFrame","loop","requestAnimationFrame","lastTime","vendors","currTime","Date","getTime","timeToCall","id","clearTimeout","Hash","DateTime","Range","CalendarFactory","Api","user","onMonthDidChange","date","month","calendar","GetMonthRecords","setAbsencesAndOvertimes","updateCalendar","getFirstWorkingDate","monthExpanded","DAY","all","gantt","absencesAndOvertimes","getParams","response","sources","unworkings","records","monthRecords","record","error","onWeekDidSelect","week","onDayDidSelect","day","currentDay","isBefore","working","resource","days","availableHours","baseHours","ao","hours","recordedHours","has","holiday","weekend","vacation","wasVacation","past","wasWorkable","workable","get","green","orange","setResources","resources","resourceId","setFirstDay","forward","firstWorkingDate","isOutside","getKey","Day","actives","ready","TemplateUrl","url","put","Link","setMonth","setDate","onMonthChange","calendarMonth","getMonthByDate","getDate","d","getDay","dirty","selected","isCurrent","today","onWeekSelect","onDaySelect","updateSelections","doNavMonth","getDayClasses","classes","$today","available","full","status-green","status-orange","Month","Week","service","getMonth","clearMonth","tasks","yyyy","getFullYear","MM","mKey","ceil","months","fromDay","monthDays","weeks","diff","getMonths","num","removeAll","setFullYear","setHours","setMinutes","setSeconds","Calendar","datetime","components","dd","ee","HH","getHours","mm","getMinutes","ss","getSeconds","sss","getMilliseconds","dateToKey","getTimezoneOffset","valueOf","MINUTE","dayDiff","dayLeft","dayRight","getDayByDate","getFullDate","getFullDay","getDayByKey","keyToDate","wKey","weekLeft","monthLeft","ww","getWeek","FIRSTDAYOFWEEK","hourToTime","hour","HOUR","setTime","monthDiff","monthRight","timeToHour","timeToQuarterHour","QUARTER","weekDiff","weekRight","yearDiff","yearLeft","yearRight","getIndexLeft","getIndexRight","getYearLeft","getYearRight","getMonthLeft","getMonthRight","getWeekLeft","getWeekRight","getDayLeft","getDayRight","getWeekDay","offsetDays","now","first","WEEK","SECOND","it_IT","long","RANGE","YEAR","SEMESTER","TRIMESTER","MONTH","short","formats","RangeTypes","range","setDiff","isInside","isAfter","setYear","setSemester","setTrimester","setQuarter","setWeek","setDay","getDiff","dateFrom","dateTo","filters","setDates","is","eachDay","fromKey","toKey","totalDays","getName","RangeExtract","RangeFormat","getShortName","RangeCopy","$range","RangeExpand","RangeGetMonth","RangeAddYear","years","RangeYear","RangeSemester","RangeTrimester","RangeQuarter","RangeMonth","RangeWeek","RangeDay","name","replaced","token","j","f","pop","obj","Object","keys","values","addYear","types","Year","Semester","Trimester","Quarter","defineProperty","vals","isEnumerable","just_now","seconds_ago","a_minute_ago","minutes_ago","an_hour_ago","hours_ago","a_day_ago","days_ago","a_week_ago","weeks_ago","a_month_ago","months_ago","a_year_ago","years_ago","over_a_year_ago","seconds_from_now","a_minute_from_now","minutes_from_now","an_hour_from_now","hours_from_now","a_day_from_now","days_from_now","a_week_from_now","weeks_from_now","a_month_from_now","months_from_now","a_year_from_now","years_from_now","over_a_year_from_now","$rootScope","$interval","$injector","$formats","getDelta","$format","instant","delta","suffix","minute","dateRelative","innerHTML","setInterval","cancelInterval","getBoundRect","getNode","getDocumentNode","getClosest","selector","matchesFn","some","fn","body","parentElement","original","originalEvent","deltaX","wheelDeltaX","deltaY","wheelDeltaY","documentElement","getElement","getNodeOffset","nodeType","getPageScroll","scroll","documentNode","pageXOffset","scrollLeft","pageYOffset","scrollTop","topParentNode","parents","getView","view","clientWidth","clientHeight","getPointInView","TOUCH_EVENTS","touch","touches","changedTouches","pageX","pageY","MOUSE_EVENTS","downloadFile","download","createEvent","anchor","href","base64","downloadName","substring","lastIndexOf","initEvent","dispatchEvent","blob","Blob","reader","FileReader","readAsDataURL","onloadend","result","ua","agent","navigator","userAgent","safari","msie","chrome","mobile","mac","getElementsByTagName","EventsService","Event","timestamp","stopPropagation","setTimestamp","events","onMouseDown","removeTouchEvents","onMouseMove","onMouseUp","onMouseWheel","removeScrollEvents","onMouseScroll","removeWheelEvents","onTouchStart","removeStandardEvents","onTouchMove","onTouchEnd","standardEvents","touchEvents","wheelEvents","scrollEvents","standard","windowElement","listener","mouseEvents","getTouch","previous","difference","getRelativeTouch","hasPassiveEvents","supported","addEventListener","passive","capture","EventTarget","modified","onScroll","scrollWidth","firefox","array","Autolinker","className","toTitleCase","str","txt","charAt","toUpperCase","firstName","lastName","legacyFilter","cost","currency","ratio","formatting","APP","inches","unit","units","IMPERIAL","feet","meters","cm","pounds","oz","kg","weight","grams","minutes","second","seconds","timezone","parseTime","parseHour","val","filterWatcher","_groupBy","collection","dict","property","isObject","isUndefined","isMemoized","memoize","n","currentStyle","toText","TEXT_NODE","nodeValue","ELEMENT_NODE","childNodes","match","div","PointDifference","PointMultiply","mult","setX","setY","multiply","RectMultiply","bottomLeft","bottomRight","center","expandRect","intersect","reduce","reduceRect","offsetRect","setH","setW","topLeft","topRight","Vector","VectorCross","VectorDifference","VectorDistance","sqrt","VectorIncidence","atan2","VectorMake","VectorNormalize","l","VectorPower","VectorSize","cross","incidence","normalize","power","towards","make","HashGet","defineProperties","enumerable","writable","getItem","hash","newItem","once","oldItem","addMany","removeMany","reverse","sort","backward","differs","updatePool","pools","$promiseAll","promises","isError","isErroring","isSuccess","isSuccessing","errors","addons","isReady","successing","success","errorring","DELAY","errorMessage","button","labels","$broadcast","submitClass","transformProperty","every","prefix","props","hoverScale","currentScale","styles","transformOrigin","extract","object","reducer","reducerAdder","reducerSetter","removeValue","reverseSortOn","throttle","func","wait","context","args","timeout","later","leading","getNow","remaining","trailing","toMd5","where","query","found","TypeError","len","k","$locationProvider","$httpProvider","EnvironmentSetHttp","headers","common","environment","language","code","withCredentials","http","interceptors","EnvironmentSetLocation","html5Mode","location","html5","hashPrefix","EnvironmentAdd","config","merge","EnvironmentSet","EnvironmentGet","global","EnvironmentUse","paths","use","plugins","facebook","fields","version","google","googlemaps","clusterer","lat","lng","disableDefaultUI","mapTypeId","scrollwheel","zoom","mapbox","bearing","curve","pitch","culture","iso","Doc","$location","$route","$routeParams","Router","Route","route","$$route","pathParams","originalPath","loadedTemplateUrl","RouteCurrent","View","doc","ViewCurrent","docs","LocalStorage","isAuthorizedOrGoTo","redirect","auth","created_at","expires_in","status","isAuthorized","request","Authorization","access_token","responseError","Message","ModelState","httpError","delete","signOut","SessionStorage","BearerDelete","accessToken","remember","BearerExists","exist","BearerGet","BearerSet","header","HttpPath","api","HttpPromise","method","HttpGet","HttpPost","HttpPut","HttpPatch","HttpDelete","HttpStatic","HttpFake","msec","patch","static","fake","Preload","loaded","total","progress","PreloadAll","preloads","percent","clearInterval","PreloadStart","xhr","XMLHttpRequest","responseType","onloadstart","onprogress","send","PreloadImage","URL","createObjectURL","OnceLoad","OnceScript","OnceLink","uid","getElementById","scripts","script","nextSibling","links","rel","load","RouterSetControllers","$previousController","$previous","$currentController","$current","$nextController","$next","RouterOnChangeStart","loading","RouterOnChangeSuccess","RouterOnChangeError","rejection","RouterOnUpdate","RouterOnStateReady","RouterIsController","RouterRedirectTo","$$lastRequestedPath","RouterRetryLastRequestedPath","RouterRedirect","msecs","RouterPath","RouterApply","isController","SilentUnlink","$$listeners","$locationChangeSuccess","relink","SilentListener","$path","SilentSilent","SilentPath","CookieDelete","CookieSetter","CookieExists","cookie","CookieGet","cookieName","ca","JSON","parse","decodeURIComponent","atob","CookieOn","checkCookie","elapsed","Cookie","TIMEOUT","CookieSet","cache","json","stringify","btoa","encodeURIComponent","expires","toGMTString","LocalExists","localStorage","LocalGet","LocalSet","setItem","LocalDelete","removeItem","LocalOn","storageEvent","SessionExists","sessionStorage","SessionGet","SessionSet","SessionDelete","SessionOn","$sce","TrustGetValue","trustedValues","TrustSetValue","trustedValue","TrustGetOrSet","TrustHtml","trustAsHtml","TrustResource","trustAsResourceUrl","TrustUrl","$once","storage","FacebookRequire","Facebook","FB","FacebookOnce","init","appId","xfbml","FacebookStatus","authResponse","FacebookGetMe","FacebookLogin","FacebookGetMyPicture","login","FacebookLogout","logout","getMe","getMyPicture","trhow","GoogleRequire","Auth2Init","Google","gapi","GoogleOnce","auth2","onLoaded","client_id","clientId","cookiepolicy","fetch_basic_profile","ux_mode","Auth2Instance","instance","getAuthInstance","GoogleGetMe","GoogleLogin","profile","currentUser","getBasicProfile","getId","getGivenName","getFamilyName","picture","getImageUrl","email","getEmail","readAccessToken","getAuthResponse","isSignedIn","signIn","signed","GoogleLogout","Http","GoogleMaps","GooglemapsLink","Googlemaps","maps","GooglemapsOptions","Map","info","GooglemapsInfo","GooglemapsMarkersRemove","markers","marker","setMap","GooglemapsMarkersSet","bounds","LatLngBounds","category","categories","GooglemapsMarker","GooglemapsClusterer","GooglemapsSetType","typeId","setMapTypeId","InfoWindow","maxWidth","pixelOffset","Size","addListener","outer","$","background","css","find","z-index","cursor","mouseout","latLng","LatLng","latitude","longitude","Marker","icon","scaledSize","origin","contentString","selectedBlog","MarkerClusterer","cssClass","imagePath","setMarkers","setType","connector","apiKey","GoogleMapsGeocoder","geocoder","Geocoder","GoogleMapsType","street","locality","postalCode","city","province","region","country","address_components","long_name","GoogleMapsParse","results","formatted_address","geometry","MapBox","MapboxLink","MapboxMap","mapboxgl","interactive","logoPosition","getCanvasContainer","jumpTo","MapboxFly","flyTo","MapboxFlyPosition","MapboxJump","MapboxJumpPosition","MapboxMarkersRemove","MapboxMarkersSet","MapboxClusterer","MapboxMarkerAdd","area","setAttribute","setLngLat","addTo","markerElement","$emit","MapboxCoordinatesGet","coordinates","altitude","MapboxFeaturesGet","crs","properties","features","addSource","cluster","clusterMaxZoom","clusterRadius","addLayer","paint","circle-color","stops","circle-radius","layout","text-field","text-font","text-size","circle-stroke-width","circle-stroke-color","MapboxBoundsFit","fitBounds","linear","maxZoom","fly","flyPosition","jump","jumpPosition","MapBoxGet"],"mappings":"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","file":"artisan.min.js","sourcesContent":["/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan', ['ng', 'ngRoute', 'ngMessages']);\r\n\r\n}());\n/* global angular, firebase */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Color', [function () {\n\t\tfunction Color(r, g, b, a) {\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tthis.r = (r || r === 0) ? r : 0;\n\t\t\t\tthis.g = (g || g === 0) ? g : 0;\n\t\t\t\tthis.b = (b || b === 0) ? b : 0;\n\t\t\t\tthis.a = (a || a === 0) ? a : 255;\n\t\t\t} else {\n\t\t\t\tvar uint = r || '0xffffff';\n\t\t\t\tuint = parseInt(uint);\n\t\t\t\tif (r.length > 8) {\n\t\t\t\t\tthis.r = uint >> 24 & 0xff;\n\t\t\t\t\tthis.g = uint >> 16 & 0xff;\n\t\t\t\t\tthis.b = uint >> 8 & 0xff;\n\t\t\t\t\tthis.a = uint >> 0 & 0xff;\n\t\t\t\t} else {\n\t\t\t\t\tthis.r = uint >> 16 & 0xff;\n\t\t\t\t\tthis.g = uint >> 8 & 0xff;\n\t\t\t\t\tthis.b = uint >> 0 & 0xff;\n\t\t\t\t\tthis.a = 255;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tColor.componentToHex = function (c) {\n\t\t\tvar hex = c.toString(16);\n\t\t\treturn hex.length == 1 ? '0' + hex : hex;\n\t\t};\n\t\tColor.luma = function (color) {\n\t\t\t// var luma = color.dot({ r: 54.213, g: 182.376, b: 18.411 });\n\t\t\tvar luma = color.dot({\n\t\t\t\tr: 95,\n\t\t\t\tg: 100,\n\t\t\t\tb: 60\n\t\t\t});\n\t\t\treturn luma;\n\t\t};\n\t\tColor.contrast = function (color) {\n\t\t\tvar luma = Color.luma(color);\n\t\t\tif (luma > 0.6) {\n\t\t\t\treturn new Color('0x000000');\n\t\t\t} else {\n\t\t\t\treturn new Color('0xffffff');\n\t\t\t}\n\t\t};\n\t\tColor.darker = function (color, pow, min) {\n\t\t\tmin = min || 0;\n\t\t\tvar r = Math.max(Math.floor(color.r * min), Math.floor(color.r - 255 * pow));\n\t\t\tvar g = Math.max(Math.floor(color.g * min), Math.floor(color.g - 255 * pow));\n\t\t\tvar b = Math.max(Math.floor(color.b * min), Math.floor(color.b - 255 * pow));\n\t\t\treturn new Color(r, g, b, color.a);\n\t\t};\n\t\tColor.lighter = function (color, pow, max) {\n\t\t\tmax = max || 1;\n\t\t\tvar r = Math.min(color.r + Math.floor((255 - color.r) * max), Math.floor(color.r + 255 * pow));\n\t\t\tvar g = Math.min(color.g + Math.floor((255 - color.g) * max), Math.floor(color.g + 255 * pow));\n\t\t\tvar b = Math.min(color.b + Math.floor((255 - color.b) * max), Math.floor(color.b + 255 * pow));\n\t\t\treturn new Color(r, g, b, color.a);\n\t\t};\n\t\t/*\n\t\tColor.rgbaToHex = function (rgba) {\n\t\t    rgba = rgba.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\n\t\t    return (rgba && rgba.length === 4) ? \"#\" +\n\t\t        (\"0\" + parseInt(rgba[1], 10).toString(16)).slice(-2) +\n\t\t        (\"0\" + parseInt(rgba[2], 10).toString(16)).slice(-2) +\n\t\t        (\"0\" + parseInt(rgba[3], 10).toString(16)).slice(-2) : '';\n\t\t}\n\t\t*/\n\t\tColor.prototype = {\n\t\t\ttoUint: function () {\n\t\t\t\treturn (this.r << 24) + (this.g << 16) + (this.b << 8) + (this.a);\n\t\t\t},\n\t\t\ttoHex: function () {\n\t\t\t\treturn '#' + Color.componentToHex(this.r) + Color.componentToHex(this.g) + Color.componentToHex(this.b) + Color.componentToHex(this.a);\n\t\t\t},\n\t\t\ttoRgba: function () {\n\t\t\t\treturn 'rgba(' + this.r + ',' + this.g + ',' + this.b + ',' + (this.a / 255).toFixed(3) + ')';\n\t\t\t},\n\t\t\tdot: function (color) {\n\t\t\t\treturn ((this.r / 255) * (color.r / 255) + (this.g / 255) * (color.g / 255) + (this.b / 255) * (color.b / 255));\n\t\t\t},\n\t\t\talpha: function (pow, min, max) {\n\t\t\t\tmin = min || 0;\n\t\t\t\tmax = max || 1;\n\t\t\t\tthis.a = Math.floor((min + (pow * (max - min))) * 255);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tmakeSet: function () {\n\t\t\t\tthis.foreground = Color.contrast(this);\n\t\t\t\tthis.border = Color.darker(this, 0.3);\n\t\t\t\tthis.light = Color.lighter(this, 0.3);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t};\n\t\treturn Color;\n    }]);\n\n\tapp.factory('Shape', [function () {\n\t\tfunction Shape() {}\n\t\tShape.shapeCircle = function (p, cx, cy, r, sa, ea) {\n\t\t\tsa = sa || 0;\n\t\t\tea = ea || 2 * Math.PI;\n\t\t\tp.ctx.arc(cx, cy, r, sa, ea, false);\n\t\t};\n\t\tShape.shapeStar = function (p, cx, cy, or, ir, steps) {\n\t\t\tvar x, y;\n\t\t\tvar angle = Math.PI / 2 * 3;\n\t\t\tvar step = Math.PI / steps;\n\t\t\tvar ctx = p.ctx;\n\t\t\tctx.moveTo(cx, cy - or);\n\t\t\tfor (i = 0; i < steps; i++) {\n\t\t\t\tx = cx + Math.cos(angle) * or;\n\t\t\t\ty = cy + Math.sin(angle) * or;\n\t\t\t\tctx.lineTo(x, y);\n\t\t\t\tangle += step;\n\t\t\t\tx = cx + Math.cos(angle) * ir;\n\t\t\t\ty = cy + Math.sin(angle) * ir;\n\t\t\t\tctx.lineTo(x, y);\n\t\t\t\tangle += step;\n\t\t\t}\n\t\t\tctx.lineTo(cx, cy - or);\n\t\t};\n\t\tShape.shapeRoundRect = function (p, rect, r) {\n\t\t\tvar ctx = p.ctx,\n\t\t\t\tx = rect.x,\n\t\t\t\ty = rect.y,\n\t\t\t\tw = rect.w,\n\t\t\t\th = rect.h;\n\t\t\tif (typeof r === undefined) {\n\t\t\t\tr = 4;\n\t\t\t}\n\t\t\tif (typeof r === 'number') {\n\t\t\t\tr = {\n\t\t\t\t\ttl: r,\n\t\t\t\t\ttr: r,\n\t\t\t\t\tbr: r,\n\t\t\t\t\tbl: r\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tvar defaultRadius = {\n\t\t\t\t\ttl: 0,\n\t\t\t\t\ttr: 0,\n\t\t\t\t\tbr: 0,\n\t\t\t\t\tbl: 0\n\t\t\t\t};\n\t\t\t\tfor (var key in defaultRadius) {\n\t\t\t\t\tr[key] = r[key] || defaultRadius[key];\n\t\t\t\t}\n\t\t\t}\n\t\t\tctx.moveTo(x + r.tl, y);\n\t\t\tctx.lineTo(x + w - r.tr, y);\n\t\t\tctx.quadraticCurveTo(x + w, y, x + w, y + r.tr);\n\t\t\tctx.lineTo(x + w, y + h - r.br);\n\t\t\tctx.quadraticCurveTo(x + w, y + h, x + w - r.br, y + h);\n\t\t\tctx.lineTo(x + r.bl, y + h);\n\t\t\tctx.quadraticCurveTo(x, y + h, x, y + h - r.bl);\n\t\t\tctx.lineTo(x, y + r.tl);\n\t\t\tctx.quadraticCurveTo(x, y, x + r.tl, y);\n\t\t};\n\t\tShape.circle = function () {\n\t\t\tvar params = Array.prototype.slice.call(arguments);\n\t\t\tvar ctx = params[0].ctx;\n\t\t\tctx.beginPath();\n\t\t\tShape.shapeCircle.apply(this, params);\n\t\t\tctx.closePath();\n\t\t};\n\t\tShape.star = function () {\n\t\t\tvar params = Array.prototype.slice.call(arguments);\n\t\t\tvar ctx = params[0].ctx;\n\t\t\tctx.beginPath();\n\t\t\tShape.shapeStar.apply(this, params);\n\t\t\tctx.closePath();\n\t\t};\n\t\tShape.roundRect = function () {\n\t\t\tvar params = Array.prototype.slice.call(arguments);\n\t\t\tvar ctx = params[0].ctx;\n\t\t\tctx.beginPath();\n\t\t\tShape.shapeRoundRect.apply(this, params);\n\t\t\tctx.closePath();\n\t\t};\n\t\treturn Shape;\n    }]);\n\n\tapp.constant('PainterColors', {\n\t\t/*\n\t\tblack: new Color('0x111111'),\n\t\twhite: new Color('0xffffff'),\n\t\tred: new Color('0xff0000'),\n\t\tgreen: new Color('0x00ff00'),\n\t\tblue: new Color('0x0000ff'),\n\t\tyellow: new Color('0xffff00'),\n\t\tcyan: new Color('0x00ffff'),\n\t\tpurple: new Color('0xff00ff'),\n\t\t*/\n\t\tblack: '0x14191e',\n\t\twhite: '0xffffff',\n\t\tblue: '0x0023FF',\n\t\tred: '0xF21500',\n\t\tlightBlue: '0x79ccf2',\n\t\tlightYellow: '0xfff79a',\n\t\tgreyLighter: '0xf8f8f8',\n\t\tgreyLight: '0xeeeeee',\n\t\tgreyMedium: '0xcccccc',\n\t\tgrey: '0x90939b',\n\t\tmap: '0x24292e',\n\t});\n\n\tapp.factory('Palette', ['$q', 'Painter', 'Rect', function ($q, Painter, Rect) {\n\t\tfunction Palette() {\n\t\t\tthis.painter = new Painter().setSize(0, 0);\n\t\t\tthis.buffer = new Painter().setSize(0, 0);\n\t\t\tthis.size = {\n\t\t\t\tw: 0,\n\t\t\t\th: 0\n\t\t\t};\n\t\t\tthis.pool = {};\n\t\t\tthis.rows = {};\n\t\t}\n\t\tPalette.prototype = {\n\t\t\tgetRect: function (w, h) {\n\t\t\t\tvar p = this.painter,\n\t\t\t\t\tsize = this.size,\n\t\t\t\t\trows = this.rows,\n\t\t\t\t\tr = new Rect(0, 0, w, h),\n\t\t\t\t\trow = rows[h] || {\n\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\ty: size.h\n\t\t\t\t\t};\n\t\t\t\tsize.w = Math.max(size.w, row.x + w);\n\t\t\t\tsize.h = Math.max(size.h, row.y + h);\n\t\t\t\tif (!p.canvas.width && !p.canvas.height) {\n\t\t\t\t\tp.setSize(size.w, size.h);\n\t\t\t\t} else if (size.w > p.canvas.width || size.h > p.canvas.height) {\n\t\t\t\t\t// var img = new Image();\n\t\t\t\t\t// img.src = p.toDataURL();\n\t\t\t\t\t// document.body.appendChild(canvas);\n\t\t\t\t\t// console.log(p.canvas.width, p.canvas.height);\n\t\t\t\t\t// var data = p.ctx.getImageData(0, 0, p.canvas.width, p.canvas.height);\n\t\t\t\t\tvar canvas = p.canvas;\n\t\t\t\t\tp.setCanvas(document.createElement('canvas'));\n\t\t\t\t\tp.setSize(size.w, size.h);\n\t\t\t\t\tp.ctx.drawImage(canvas, 0, 0);\n\t\t\t\t\t// p.ctx.putImageData(data, 0, 0);\n\t\t\t\t\t// p.ctx.drawImage(img, 0, 0);\n\t\t\t\t\t// document.body.removeChild(canvas);\n\t\t\t\t}\n\t\t\t\tr.x = row.x;\n\t\t\t\tr.y = row.y;\n\t\t\t\trow.x += w;\n\t\t\t\trows[h] = row;\n\t\t\t\treturn r;\n\t\t\t},\n\t\t\tadd: function (key, path) {\n\t\t\t\tvar palette = this;\n\t\t\t\tif (angular.isString(path)) {\n\t\t\t\t\tvar deferred = $q.defer();\n\t\t\t\t\tvar img = new Image();\n\t\t\t\t\timg.onload = function () {\n\t\t\t\t\t\tpalette.addShape(key, img.width, img.height, function (p, rect) {\n\t\t\t\t\t\t\tp.ctx.drawImage(img, 0, 0);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdeferred.resolve(img);\n\t\t\t\t\t};\n\t\t\t\t\timg.onerror = function () {\n\t\t\t\t\t\tdeferred.reject('connot load ' + path);\n\t\t\t\t\t};\n\t\t\t\t\timg.src = path;\n\t\t\t\t\treturn deferred.promise;\n\t\t\t\t} else {\n\t\t\t\t\tvar params = Array.prototype.slice.call(arguments);\n\t\t\t\t\treturn palette.addShape.apply(palette, params);\n\t\t\t\t}\n\t\t\t},\n\t\t\taddShape: function (key, w, h, callback) {\n\t\t\t\tvar p = this.painter,\n\t\t\t\t\tr = this.getRect(w, h);\n\t\t\t\tp.ctx.save();\n\t\t\t\tp.ctx.rect(r.x, r.y, r.w, r.h);\n\t\t\t\t// p.ctx.stroke();\n\t\t\t\tp.ctx.clip();\n\t\t\t\tp.ctx.translate(r.x, r.y);\n\t\t\t\tcallback.call(p, p, r.clone().setPos(0, 0));\n\t\t\t\tp.ctx.restore();\n\t\t\t\tthis.pool[key] = r;\n\t\t\t\t// console.log('Painter.add', r);\n\t\t\t},\n\t\t\tdraw: function (target, key, x, y, pre) {\n\t\t\t\tvar r = this.pool[key];\n\t\t\t\tif (r) {\n\t\t\t\t\t// var ctx = target.ctx;\n\t\t\t\t\t// ctx.save();\n\t\t\t\t\ttarget.drawRect(this.painter.canvas, r, {\n\t\t\t\t\t\tx: x,\n\t\t\t\t\t\ty: y,\n\t\t\t\t\t\tw: r.w,\n\t\t\t\t\t\th: r.h\n\t\t\t\t\t}, pre);\n\t\t\t\t\t// target.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, x - r.w / 2, y - r.h / 2, r.w, r.h);\n\t\t\t\t\t// ctx.restore();\n\t\t\t\t}\n\t\t\t},\n\t\t\ttint: function (target, key, x, y, color, pre) {\n\t\t\t\tvar r = this.pool[key];\n\t\t\t\tif (r) {\n\t\t\t\t\tvar p = this.painter,\n\t\t\t\t\t\tb = this.buffer.setSize(r.w, r.h);\n\t\t\t\t\tb.save();\n\t\t\t\t\tb.setFill(color);\n\t\t\t\t\tb.fillRect();\n\t\t\t\t\tb.ctx.globalCompositeOperation = \"destination-atop\";\n\t\t\t\t\tb.ctx.drawImage(p.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n\t\t\t\t\tb.restore();\n\t\t\t\t\tconsole.log(x, y, b.canvas, target.canvas);\n\t\t\t\t\ttarget.draw(b.canvas, {\n\t\t\t\t\t\tx: x,\n\t\t\t\t\t\ty: y\n\t\t\t\t\t}, pre);\n\t\t\t\t}\n\t\t\t},\n\t\t\tpattern: function (target, key, x, y, w, h, color) {\n\t\t\t\tfunction drawPattern(pattern) {\n\t\t\t\t\tvar ctx = target.ctx;\n\t\t\t\t\tctx.save();\n\t\t\t\t\tctx.translate(x, y);\n\t\t\t\t\t// draw\n\t\t\t\t\t// ctx.beginPath();\n\t\t\t\t\t// ctx.rect(-x, -y, w, h);\n\t\t\t\t\tctx.fillStyle = pattern;\n\t\t\t\t\tctx.fillRect(-x, -y, w, h);\n\t\t\t\t\tctx.translate(-x, -y);\n\t\t\t\t\t// ctx.fill();\n\t\t\t\t\tctx.restore();\n\t\t\t\t}\n\t\t\t\tvar r = this.pool[key];\n\t\t\t\tif (r) {\n\t\t\t\t\tvar img = r.img,\n\t\t\t\t\t\tpattern;\n\t\t\t\t\tif (!img || r.color != color) {\n\t\t\t\t\t\tvar b = this.buffer.setSize(r.w, r.h);\n\t\t\t\t\t\tif (color) {\n\t\t\t\t\t\t\tr.color = color;\n\t\t\t\t\t\t\tb.save();\n\t\t\t\t\t\t\tb.setFill(color);\n\t\t\t\t\t\t\tb.fillRect();\n\t\t\t\t\t\t\tb.ctx.globalCompositeOperation = \"destination-atop\";\n\t\t\t\t\t\t\tb.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n\t\t\t\t\t\t\tb.restore();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tb.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n\t\t\t\t\t\t}\n\t\t\t\t\t\timg = new Image();\n\t\t\t\t\t\timg.onload = function () {\n\t\t\t\t\t\t\tr.img = img;\n\t\t\t\t\t\t\tpattern = target.ctx.createPattern(img, \"repeat\");\n\t\t\t\t\t\t\tdrawPattern(pattern);\n\t\t\t\t\t\t};\n\t\t\t\t\t\timg.src = b.toDataURL();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpattern = target.ctx.createPattern(img, \"repeat\");\n\t\t\t\t\t\tdrawPattern(pattern);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t\treturn Palette;\n    }]);\n\n\tapp.factory('Painter', ['Shape', 'Rect', 'Color', 'PainterColors', function (Shape, Rect, Color, PainterColors) {\n\t\tfunction Painter(canvas) {\n\t\t\tcanvas = canvas || document.createElement('canvas');\n\t\t\tthis.rect = new Rect();\n\t\t\tthis.drawingRect = new Rect();\n\t\t\tthis.setColors();\n\t\t\tthis.setCanvas(canvas);\n\t\t}\n\t\tPainter.colors = {};\n\t\tangular.forEach(PainterColors, function (value, key) {\n\t\t\tPainter.colors[key] = new Color(value).makeSet();\n\t\t});\n\t\tvar colors = Painter.colors;\n\t\tPainter.prototype = {\n\t\t\tcolors: Painter.colors,\n\t\t\tsetColors: function () {\n\t\t\t\tvar colors = this.colors;\n\t\t\t\tangular.forEach(PainterColors, function (value, key) {\n\t\t\t\t\tcolors[key] = new Color(value).makeSet();\n\t\t\t\t});\n\t\t\t},\n\t\t\tsetCanvas: function (canvas) {\n\t\t\t\tthis.canvas = canvas;\n\t\t\t\tthis.setSize(canvas.offsetWidth, canvas.offsetHeight);\n\t\t\t\tvar ctx = canvas.getContext('2d');\n\t\t\t\tctx.lineCap = 'square';\n\t\t\t\tthis.ctx = ctx;\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetSize: function (w, h) {\n\t\t\t\tthis.canvas.width = w;\n\t\t\t\tthis.canvas.height = h;\n\t\t\t\tthis.rect.w = w;\n\t\t\t\tthis.rect.h = h;\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tcopy: function (canvas) {\n\t\t\t\tthis.ctx.drawImage(canvas, 0, 0);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tclear: function () {\n\t\t\t\tthis.resize();\n\t\t\t\t// this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tresize: function () {\n\t\t\t\tthis.setSize(this.canvas.offsetWidth, this.canvas.offsetHeight);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetText: function (font, align, verticalAlign, color) {\n\t\t\t\tfont = font || '11px monospace';\n\t\t\t\talign = align || 'center';\n\t\t\t\tverticalAlign = verticalAlign || 'middle';\n\t\t\t\tcolor = color || this.colors.black;\n\t\t\t\tvar ctx = this.ctx;\n\t\t\t\tctx.font = font;\n\t\t\t\tctx.textAlign = align;\n\t\t\t\tctx.textBaseline = verticalAlign;\n\t\t\t\tctx.fillStyle = color.toRgba();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetFill: function (color) {\n\t\t\t\tcolor = color || this.colors.black;\n\t\t\t\tvar ctx = this.ctx;\n\t\t\t\t/*\n\t\t\t\tvar my_gradient = ctx.createLinearGradient(0, 0, 0, 170);\n\t\t\t\tmy_gradient.addColorStop(0, \"black\");\n\t\t\t\tmy_gradient.addColorStop(1, \"white\");\n\t\t\t\tctx.fillStyle = my_gradient;\n\t\t\t\t*/\n\t\t\t\tctx.fillStyle = color.toRgba();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetStroke: function (color, size) {\n\t\t\t\tcolor = color || this.colors.black;\n\t\t\t\tvar ctx = this.ctx;\n\t\t\t\tsize = size || 1;\n\t\t\t\t/*\n\t\t\t\tvar gradient=ctx.createLinearGradient(0,0,170,0);\n\t\t\t\tgradient.addColorStop(\"0\",\"magenta\");\n\t\t\t\tgradient.addColorStop(\"0.5\",\"blue\");\n\t\t\t\tgradient.addColorStop(\"1.0\",\"red\");\n\t\t\t\tctx.strokeStyle = gradient;\n\t\t\t\t*/\n\t\t\t\t// Fill with gradient\n\t\t\t\tctx.strokeStyle = color.toRgba();\n\t\t\t\tctx.lineWidth = size;\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\t/*\n\t\t\tdrawRoundRect: function (rect, r) {\n\t\t\t    rect = rect || this.rect;\n\t\t\t    Shape.roundRect(this, rect, r);\n\t\t\t    return this;\n\t\t\t},\n\t\t\t*/\n\t\t\tfillText: function (text, point, width, post, maxLength) {\n\t\t\t\tif (width) {\n\t\t\t\t\tpost = post || '';\n\t\t\t\t\tmaxLength = maxLength || Math.floor(width / 8);\n\t\t\t\t\tif (text.length > maxLength) {\n\t\t\t\t\t\ttext = text.substr(0, Math.min(text.length, maxLength)).trim() + post;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.ctx.fillText(text, point.x, point.y);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tfillRect: function (rect) {\n\t\t\t\trect = rect || this.rect;\n\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\tx = rect.x,\n\t\t\t\t\ty = rect.y,\n\t\t\t\t\tw = rect.w,\n\t\t\t\t\th = rect.h;\n\t\t\t\tctx.fillRect(x, y, w, h);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tstrokeRect: function (rect) {\n\t\t\t\trect = rect || this.rect;\n\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\tx = rect.x,\n\t\t\t\t\ty = rect.y,\n\t\t\t\t\tw = rect.w,\n\t\t\t\t\th = rect.h;\n\t\t\t\tctx.strokeRect(x, y, w, h);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tfill: function () {\n\t\t\t\tthis.ctx.fill();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tstroke: function () {\n\t\t\t\tthis.ctx.stroke();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tbegin: function () {\n\t\t\t\tthis.ctx.beginPath();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tclose: function () {\n\t\t\t\tthis.ctx.closePath();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsave: function () {\n\t\t\t\tthis.ctx.save();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\trestore: function () {\n\t\t\t\tthis.ctx.restore();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\trotate: function (angle) {\n\t\t\t\tthis.ctx.rotate(angle * Math.PI / 180);\n\t\t\t},\n\t\t\ttranslate: function (xy) {\n\t\t\t\tthis.ctx.translate(xy.x, xy.y);\n\t\t\t},\n\t\t\ttoDataURL: function () {\n\t\t\t\treturn this.canvas.toDataURL();\n\t\t\t},\n\t\t\tdraw: function (image, t, pre) {\n\t\t\t\tif (image) {\n\t\t\t\t\tt.w = t.w || image.width;\n\t\t\t\t\tt.h = t.h || image.height;\n\t\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\t\trect = this.drawingRect,\n\t\t\t\t\t\tx = rect.x = t.x - t.w / 2,\n\t\t\t\t\t\ty = rect.y = t.y - t.h / 2,\n\t\t\t\t\t\tw = rect.w = t.w,\n\t\t\t\t\t\th = rect.h = t.h;\n\t\t\t\t\tctx.save();\n\t\t\t\t\tctx.translate(x, y);\n\t\t\t\t\tif (pre) {\n\t\t\t\t\t\tpre.call(this);\n\t\t\t\t\t}\n\t\t\t\t\tctx.drawImage(image, 0, 0);\n\t\t\t\t\tctx.restore();\n\t\t\t\t\t// console.log('painter.draw', x, y, w, h);\n\t\t\t\t}\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tdrawRect: function (image, s, t, pre) {\n\t\t\t\tif (image) {\n\t\t\t\t\ts.w = s.w || image.width;\n\t\t\t\t\ts.h = s.h || image.height;\n\t\t\t\t\tt.w = t.w || image.width;\n\t\t\t\t\tt.h = t.h || image.height;\n\t\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\t\trect = this.drawingRect,\n\t\t\t\t\t\tx = rect.x = t.x - s.w / 2,\n\t\t\t\t\t\ty = rect.y = t.y - s.h / 2,\n\t\t\t\t\t\tw = rect.w = t.w,\n\t\t\t\t\t\th = rect.h = t.h;\n\t\t\t\t\tctx.save();\n\t\t\t\t\tctx.translate(x, y);\n\t\t\t\t\tif (pre) {\n\t\t\t\t\t\tpre.call(this);\n\t\t\t\t\t}\n\t\t\t\t\tctx.drawImage(image, s.x, s.y, s.w, s.h, 0, 0, t.w, t.h);\n\t\t\t\t\tctx.restore();\n\t\t\t\t\t// console.log('painter.drawRect', x, y, w, h);\n\t\t\t\t}\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tflip: function (scale) {\n\t\t\t\tscale = scale || {\n\t\t\t\t\tx: 1,\n\t\t\t\t\ty: -1\n\t\t\t\t};\n\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\trect = this.drawingRect;\n\t\t\t\tctx.translate(scale.x === -1 ? rect.w : 0, scale.y === -1 ? rect.h : 0);\n\t\t\t\tctx.scale(scale.x, scale.y);\n\t\t\t},\n\t\t};\n\t\treturn Painter;\n    }]);\n\n}());\n\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('expandable', ['$parse', 'State', 'Dom', function ($parse, State, Dom) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\t// template: '<div ng-transclude></div>',\n\t\t\t// transclude: true,\n\t\t\t// replace: true,\n\t\t\t/*\n\t\t\ttemplateUrl: function (element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/components/nav/partial/nav';\n            },\n            */\n\t\t\tlink: ExpandableLink,\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction ExpandableLink(scope, element, attributes, model) {\n\n\t\t\tvar state = new State();\n\t\t\tstate.pow = 0;\n\n\t\t\tvar relative, absolute;\n\n\t\t\tvar target, targetElement;\n\n\t\t\tvar from, to, current,\n\t\t\t\tboundingClientRect, styleObj, originalCssText;\n\n\t\t\tvar expanded = false;\n\n\t\t\tvar placeholder = document.createElement('div'),\n\t\t\t\tplaceholderElement = angular.element(placeholder);\n\t\t\tplaceholderElement.addClass('expandable-placeholder');\n\n\t\t\tfunction getStyle(node) {\n\t\t\t\tvar style = window.getComputedStyle(node, null);\n\t\t\t\tvar styleObj = {\n\t\t\t\t\t'display': style.getPropertyValue('display'),\n\t\t\t\t\t'position': style.getPropertyValue('position'),\n\t\t\t\t\t'width': style.getPropertyValue('width'),\n\t\t\t\t\t'height': style.getPropertyValue('height'),\n\t\t\t\t\t'top': style.getPropertyValue('top'),\n\t\t\t\t\t'right': style.getPropertyValue('right'),\n\t\t\t\t\t'bottom': style.getPropertyValue('bottom'),\n\t\t\t\t\t'left': style.getPropertyValue('left'),\n\t\t\t\t\t'margin-top': style.getPropertyValue('margin-top'),\n\t\t\t\t\t'margin-right': style.getPropertyValue('margin-right'),\n\t\t\t\t\t'margin-bottom': style.getPropertyValue('margin-bottom'),\n\t\t\t\t\t'margin-left': style.getPropertyValue('margin-left'),\n\t\t\t\t\t'padding-top': style.getPropertyValue('padding-top'),\n\t\t\t\t\t'padding-right': style.getPropertyValue('padding-right'),\n\t\t\t\t\t'padding-bottom': style.getPropertyValue('padding-bottom'),\n\t\t\t\t\t'padding-left': style.getPropertyValue('padding-left'),\n\t\t\t\t\t'background-color': style.getPropertyValue('background-color'),\n\t\t\t\t};\n\t\t\t\treturn styleObj;\n\t\t\t}\n\n\t\t\tfunction getTextStyle(style) {\n\t\t\t\tvar text = '';\n\t\t\t\tangular.forEach(style, function (value, key) {\n\t\t\t\t\ttext += key + ': ' + value + '; ';\n\t\t\t\t});\n\t\t\t\treturn text;\n\t\t\t}\n\n\t\t\tfunction setStyle(node, style) {\n\t\t\t\tnode.style.cssText = getTextStyle(style);\n\t\t\t}\n\n\t\t\tfunction add() {\n\t\t\t\tstyleObj = getStyle(target);\n\t\t\t\tsetStyle(placeholder, styleObj);\n\t\t\t\ttarget.parentNode.insertBefore(placeholder, target);\n\t\t\t\toriginalCssText = target.style.cssText;\n\t\t\t\ttargetElement.addClass('expandable-expanding');\n\t\t\t\tDom.getParents(target).each(function (element, node) {\n\t\t\t\t\telement.addClass('expandable-parent');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction remove() {\n\t\t\t\ttarget.style.cssText = originalCssText;\n\t\t\t\ttargetElement.removeClass('expandable-expanding');\n\t\t\t\tplaceholder.parentNode.removeChild(placeholder);\n\t\t\t\tDom.getParents(target).each(function (element, node) {\n\t\t\t\t\telement.removeClass('expandable-parent');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction setRects() {\n\t\t\t\tif (targetElement && targetElement.hasClass('expandable-expanding')) {\n\t\t\t\t\tboundingClientRect = placeholder.getBoundingClientRect();\n\t\t\t\t} else {\n\t\t\t\t\tboundingClientRect = target.getBoundingClientRect();\n\t\t\t\t}\n\t\t\t\tfrom = {\n\t\t\t\t\ttop: 0,\n\t\t\t\t\tleft: 0,\n\t\t\t\t\twidth: boundingClientRect.width, // parseInt(styleObj.width), // boundingClientRect.width,\n\t\t\t\t\theight: boundingClientRect.height, // parseInt(styleObj.height), // boundingClientRect.height,\n\t\t\t\t};\n\t\t\t\tto = {\n\t\t\t\t\ttop: 0 + (relative.top || 0),\n\t\t\t\t\tleft: 0 + (relative.left || 0),\n\t\t\t\t\twidth: from.width + (relative.right || 0),\n\t\t\t\t\theight: from.height + (relative.bottom || 0),\n\t\t\t\t};\n\t\t\t\tif (absolute.top) {\n\t\t\t\t\tto.top = absolute.top - boundingClientRect.top;\n\t\t\t\t}\n\t\t\t\tif (absolute.left) {\n\t\t\t\t\tto.left = absolute.left - boundingClientRect.left;\n\t\t\t\t}\n\t\t\t\tif (absolute.right) {\n\t\t\t\t\tvar absoluteRight = (window.innerWidth - absolute.right);\n\t\t\t\t\tvar absoluteLeft = boundingClientRect.left + to.left;\n\t\t\t\t\tto.width = absoluteRight - absoluteLeft;\n\t\t\t\t}\n\t\t\t\tif (absolute.bottom) {\n\t\t\t\t\tvar absoluteBottom = (window.innerHeight - absolute.bottom);\n\t\t\t\t\tvar absoluteTop = boundingClientRect.top + to.top;\n\t\t\t\t\tto.height = absoluteBottom - absoluteTop;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction expand() {\n\t\t\t\tif (!expanded) {\n\t\t\t\t\tsetRects();\n\t\t\t\t\tadd();\n\t\t\t\t\tcurrent = angular.copy(from);\n\t\t\t\t\tsetStyle(target, from);\n\t\t\t\t\tdynamics.animate(state, {\n\t\t\t\t\t\tpow: 1\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttype: dynamics.easeInOut,\n\t\t\t\t\t\tduration: 350,\n\t\t\t\t\t\tcomplete: function () {\n\t\t\t\t\t\t\texpanded = true;\n\t\t\t\t\t\t\tstate.idle();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchange: function () {\n\t\t\t\t\t\t\tupdate();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tstate.idle();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction contract() {\n\t\t\t\tif (expanded) {\n\t\t\t\t\tdynamics.animate(state, {\n\t\t\t\t\t\tpow: 0\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttype: dynamics.easeInOut,\n\t\t\t\t\t\tduration: 350,\n\t\t\t\t\t\tcomplete: function () {\n\t\t\t\t\t\t\texpanded = false;\n\t\t\t\t\t\t\tremove();\n\t\t\t\t\t\t\tstate.idle();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchange: function () {\n\t\t\t\t\t\t\tupdate();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tstate.idle();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction update() {\n\t\t\t\tcurrent.left = (from.left + (to.left - from.left) * state.pow) + 'px';\n\t\t\t\tcurrent.top = (from.top + (to.top - from.top) * state.pow) + 'px';\n\t\t\t\tcurrent.width = (from.width + (to.width - from.width) * state.pow) + 'px';\n\t\t\t\tcurrent.height = (from.height + (to.height - from.height) * state.pow) + 'px';\n\t\t\t\tsetStyle(target, current);\n\t\t\t}\n\n\t\t\tfunction toggle() {\n\t\t\t\tif (state.busy()) {\n\t\t\t\t\tif (expanded) {\n\t\t\t\t\t\tcontract();\n\t\t\t\t\t} else {\n\t\t\t\t\t\texpand();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction set() {\n\t\t\t\trelative = attributes.expandableRelative ? $parse(attributes.expandableRelative)(scope) : {};\n\t\t\t\tabsolute = attributes.expandableAbsolute ? $parse(attributes.expandableAbsolute)(scope) : {};\n\t\t\t\ttarget = element[0].querySelector(attributes.expandable);\n\t\t\t\tif (target) {\n\t\t\t\t\ttargetElement = angular.element(target);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onDown(e) {\n\t\t\t\tset();\n\t\t\t\tif (target) {\n\t\t\t\t\texpand();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onUp(e) {\n\t\t\t\tif (Dom.getClosestNode(e.target, element[0])) {\n\t\t\t\t\t// nope\n\t\t\t\t} else {\n\t\t\t\t\tset();\n\t\t\t\t\tif (target) {\n\t\t\t\t\t\tcontract();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onResize(e) {\n\t\t\t\tif (expanded || state.isBusy) {\n\t\t\t\t\tsetRects();\n\t\t\t\t\tupdate();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onKeyDown(e) {\n\t\t\t\tvar key = e.key.toLowerCase();\n\t\t\t\tswitch (key) {\n\t\t\t\t\tcase 'escape':\n\t\t\t\t\t\tset();\n\t\t\t\t\t\tif (target) {\n\t\t\t\t\t\t\tcontract();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'enter':\n\t\t\t\t\t\tset();\n\t\t\t\t\t\tif (target && target.tagName && target.tagName.toLowerCase() === 'input') {\n\t\t\t\t\t\t\tcontract();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar trigger = attributes.expandableTrigger ? element[0].querySelector(attributes.expandableTrigger) : null;\n\t\t\ttrigger = trigger ? angular.element(trigger) : element;\n\n\t\t\tfunction addListeners() {\n\t\t\t\ttrigger.on('mousedown touchstart', onDown);\n\t\t\t\telement.on('keydown', onKeyDown);\n\t\t\t\tangular.element(window)\n\t\t\t\t\t.on('click', onUp)\n\t\t\t\t\t.on('resize', onResize);\n\t\t\t}\n\n\t\t\tfunction removeListeners() {\n\t\t\t\ttrigger.off('mousedown touchstart', onDown);\n\t\t\t\telement.off('keydown', onKeyDown);\n\t\t\t\tangular.element(window)\n\t\t\t\t\t.off('click', onUp)\n\t\t\t\t\t.off('resize', onResize);\n\t\t\t}\n\n\t\t\tscope.$on('$destroy', function () {\n\t\t\t\tremoveListeners();\n\t\t\t});\n\n\t\t\taddListeners();\n\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('controlMessages', [function () {\n\t\treturn {\n\t\t\trestrict: 'E',\n\t\t\ttemplateUrl: 'artisan/components/forms/partial/messages',\n\t\t\ttransclude: {\n\t\t\t\t'message': '?messageItems',\n\t\t\t},\n\t\t\tlink: function (scope, element, attributes, model) {}\n\t\t};\n    }]);\n\n\tapp.directive('control', ['$parse', function ($parse) {\n\t\tfunction formatLabel(string, prepend, expression) {\n\t\t\tstring = string || '';\n\t\t\tprepend = prepend || '';\n\t\t\tvar splitted = string.split(',');\n\t\t\tif (splitted.length > 1) {\n\t\t\t\tvar formatted = splitted.shift();\n\t\t\t\tangular.forEach(splitted, function (value, index) {\n\t\t\t\t\tif (expression) {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join(prepend + value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (expression) {\n\t\t\t\t\treturn '\\'' + formatted + '\\'';\n\t\t\t\t} else {\n\t\t\t\t\treturn formatted;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn prepend + string;\n\t\t\t}\n\t\t}\n\t\tvar uniqueId = 0;\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function (element, attributes) {\n\t\t\t\tvar template = 'artisan/components/forms/partial/text';\n\t\t\t\tswitch (attributes.control) {\n\t\t\t\t\tcase 'select':\n\t\t\t\t\t\ttemplate = 'artisan/components/forms/partial/select';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\treturn template;\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\tngModel: '=',\n\t\t\t\trequired: '=',\n\t\t\t\tform: '@',\n\t\t\t\ttitle: '@',\n\t\t\t\tplaceholder: '@',\n\t\t\t\tsource: '=?',\n\t\t\t\tkey: '@?',\n\t\t\t\tlabel: '@?',\n\t\t\t},\n\t\t\trequire: 'ngModel',\n\t\t\ttransclude: true,\n\t\t\tlink: {\n\t\t\t\tpre: function preLink(scope, element, attributes, controller, transclude) {\n\t\t\t\t\tvar label = scope.label = (scope.label ? scope.label : 'name');\n\t\t\t\t\tvar key = scope.key = (scope.key ? scope.key : 'id');\n\t\t\t\t\tif (attributes.control === 'select') {\n\t\t\t\t\t\tvar filter = (attributes.filter ? '| ' + attributes.filter : '');\n\t\t\t\t\t\tvar optionLabel = formatLabel(label, 'item.', true);\n\t\t\t\t\t\tscope.getOptions = function () {\n\t\t\t\t\t\t\treturn attributes.number ?\n\t\t\t\t\t\t\t\t'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in source ' + filter :\n\t\t\t\t\t\t\t\toptionLabel + ' disable when item.disabled for item in source ' + filter + ' track by item.' + key;\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tvar type = scope.type = attributes.control;\n\t\t\t\t\tvar form = scope.form = scope.form || 'form';\n\t\t\t\t\tvar title = scope.title = scope.title || 'untitled';\n\t\t\t\t\tvar placeholder = scope.placeholder = scope.placeholder || title;\n\t\t\t\t\tvar field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\n\t\t\t\t\tscope.format = attributes.format || null;\n\t\t\t\t\tscope.precision = attributes.precision || null;\n\t\t\t\t\tscope.validate = attributes.validate || attributes.control;\n\t\t\t\t\tscope.minLength = attributes.minLength || 0;\n\t\t\t\t\tscope.maxLength = attributes.maxLength || Number.POSITIVE_INFINITY;\n\t\t\t\t\tscope.min = attributes.min || null;\n\t\t\t\t\tscope.max = attributes.max || null;\n\t\t\t\t\tscope.options = $parse(attributes.options)(scope) || {};\n\t\t\t\t\tscope.focus = false;\n\t\t\t\t\tscope.visible = false;\n\t\t\t\t\tscope.onChange = function (model) {\n\t\t\t\t\t\t$parse(attributes.onChange)(scope.$parent);\n\t\t\t\t\t};\n\t\t\t\t\tscope.onFilter = function (model) {\n\t\t\t\t\t\t$parse(attributes.onFilter)(scope.$parent);\n\t\t\t\t\t};\n\t\t\t\t\tscope.getType = function () {\n\t\t\t\t\t\tvar type = 'text';\n\t\t\t\t\t\tswitch (attributes.control) {\n\t\t\t\t\t\t\tcase 'password':\n\t\t\t\t\t\t\t\ttype = scope.visible ? 'text' : 'password';\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\ttype = attributes.control;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn type;\n\t\t\t\t\t};\n\t\t\t\t\tscope.getClasses = function () {\n\t\t\t\t\t\tvar form = $parse(scope.form)(scope.$parent);\n\t\t\t\t\t\tvar field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t'control-focus': scope.focus,\n\t\t\t\t\t\t\t'control-success': field.$valid,\n\t\t\t\t\t\t\t'control-error': field.$invalid && (form.$submitted || field.$touched),\n\t\t\t\t\t\t\t'control-empty': !field.$viewValue\n\t\t\t\t\t\t};\n\t\t\t\t\t};\n\t\t\t\t\tscope.getMessages = function () {\n\t\t\t\t\t\tvar form = $parse(scope.form)(scope.$parent);\n\t\t\t\t\t\tvar field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n\t\t\t\t\t\treturn (form.$submitted || field.$touched) && field.$error;\n\t\t\t\t\t};\n\t\t\t\t\tscope.toggleVisibility = function () {\n\t\t\t\t\t\tscope.visible = !scope.visible;\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t};\n    }]);\n\n\tapp.directive('_control', ['$http', '$templateCache', '$compile', '$parse', function ($http, $templateCache, $compile, $parse) {\n\t\tfunction formatLabel(string, prepend, expression) {\n\t\t\tstring = string || '';\n\t\t\tprepend = prepend || '';\n\t\t\tvar splitted = string.split(',');\n\t\t\tif (splitted.length > 1) {\n\t\t\t\tvar formatted = splitted.shift();\n\t\t\t\tangular.forEach(splitted, function (value, index) {\n\t\t\t\t\tif (expression) {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join(prepend + value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (expression) {\n\t\t\t\t\treturn '\\'' + formatted + '\\'';\n\t\t\t\t} else {\n\t\t\t\t\treturn formatted;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn prepend + string;\n\t\t\t}\n\t\t}\n\t\tvar uniqueId = 0;\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function (element, attributes) {\n\t\t\t\tvar template = 'artisan/components/forms/partial/text';\n\t\t\t\tswitch (attributes.control) {\n\t\t\t\t\tcase 'select':\n\t\t\t\t\t\ttemplate = 'artisan/components/forms/partial/select';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\treturn template;\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\tngModel: '=',\n\t\t\t\trequired: '=',\n\t\t\t\tform: '@',\n\t\t\t\ttitle: '@',\n\t\t\t\tplaceholder: '@',\n\t\t\t},\n\t\t\trequire: 'ngModel',\n\t\t\t/*\n\t\t\tlink: function(scope, element, attributes, model) {\n\t\t\t},\n\t\t\t*/\n\t\t\tcompile: function (element, attributes) {\n\t\t\t\treturn {\n\t\t\t\t\tpre: function (scope, element, attributes) {\n\t\t\t\t\t\tif (attributes.control === 'select') {\n\t\t\t\t\t\t\tvar label = (attributes.label ? attributes.label : 'name');\n\t\t\t\t\t\t\tvar key = (attributes.key ? attributes.key : 'id');\n\t\t\t\t\t\t\tvar filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\n\t\t\t\t\t\t\tvar optionLabel = formatLabel(label, 'item.', true);\n\t\t\t\t\t\t\tscope.options = attributes.number ?\n\t\t\t\t\t\t\t\t'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter :\n\t\t\t\t\t\t\t\toptionLabel + ' disable when item.disabled for item in ' + attributes.source + filter + ' track by item.' + key;\n\t\t\t\t\t\t\tconsole.log('control.compile.pre', scope.options);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar type = scope.type = attributes.control;\n\t\t\t\t\t\tvar form = scope.form = scope.form || 'form';\n\t\t\t\t\t\tvar title = scope.title = scope.title || 'untitled';\n\t\t\t\t\t\tvar placeholder = scope.placeholder = scope.placeholder || title;\n\t\t\t\t\t\tvar field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\n\t\t\t\t\t\tscope.validate = attributes.validate || attributes.control;\n\t\t\t\t\t\tscope.format = attributes.format || null;\n\t\t\t\t\t\tscope.precision = attributes.precision || null;\n\t\t\t\t\t\tscope.validate = attributes.validate || attributes.control;\n\t\t\t\t\t\tscope.minLength = attributes.min || 0;\n\t\t\t\t\t\tscope.maxLength = attributes.max || Number.POSITIVE_INFINITY;\n\t\t\t\t\t\tscope.options = $parse(attributes.options)(scope) || {};\n\t\t\t\t\t\tscope.focus = false;\n\t\t\t\t\t\tscope.visible = false;\n\t\t\t\t\t\tscope.getType = function () {\n\t\t\t\t\t\t\tvar type = 'text';\n\t\t\t\t\t\t\tswitch (attributes.control) {\n\t\t\t\t\t\t\t\tcase 'password':\n\t\t\t\t\t\t\t\t\t// var form = $parse(scope.form)(scope.$parent);\n\t\t\t\t\t\t\t\t\t// var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n\t\t\t\t\t\t\t\t\ttype = scope.visible ? 'text' : 'password';\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\ttype = attributes.control;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// console.log('control.getType', type);\n\t\t\t\t\t\t\treturn type;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.getClasses = function () {\n\t\t\t\t\t\t\tvar form = $parse(scope.form)(scope.$parent);\n\t\t\t\t\t\t\tvar field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t'control-focus': scope.focus,\n\t\t\t\t\t\t\t\t'control-success': field.$valid,\n\t\t\t\t\t\t\t\t'control-error': field.$invalid && (form.$submitted || field.$touched),\n\t\t\t\t\t\t\t\t'control-empty': !field.$viewValue\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.getMessages = function () {\n\t\t\t\t\t\t\tvar form = $parse(scope.form)(scope.$parent);\n\t\t\t\t\t\t\tvar field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n\t\t\t\t\t\t\treturn (form.$submitted || field.$touched) && field.$error;\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\t// post: function (scope, element, attributes) { }\n\t\t\t\t};\n\t\t\t}\n\t\t\t/*\n\t\t\tcompile: function(element, attributes) {\n\t\t\t    element.removeAttr('my-dir'); \n\t\t\t    element.attr('ng-hide', 'true');\n\t\t\t    return function(scope) {\n\t\t\t        $compile(element)(scope);\n\t\t\t    };\n\t\t\t},\n\t\t\t*/\n\t\t};\n    }]);\n\n\tapp.directive('numberPicker', ['$parse', '$timeout', function ($parse, $timeout) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplate: '<div class=\"input-group\">' +\n\t\t\t\t'   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">-</button></span>' +\n\t\t\t\t'   <div ng-transclude></div>' +\n\t\t\t\t'   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">+</button></span>' +\n\t\t\t\t'</div>',\n\t\t\treplace: true,\n\t\t\ttransclude: true,\n\t\t\tlink: function (scope, element, attributes, model) {\n\t\t\t\tvar node = element[0];\n\t\t\t\tvar nodeRemove = node.querySelectorAll('.input-group-btn > .btn')[0];\n\t\t\t\tvar nodeAdd = node.querySelectorAll('.input-group-btn > .btn')[1];\n\n\t\t\t\tfunction onRemove(e) {\n\t\t\t\t\tvar min = $parse(attributes.min)(scope);\n\t\t\t\t\tvar getter = $parse(attributes.numberPicker);\n\t\t\t\t\tvar setter = getter.assign;\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\tsetter(scope, Math.max(min, getter(scope) - 1));\n\t\t\t\t\t});\n\t\t\t\t\t// console.log('numberPicker.onRemove', min);\n\t\t\t\t}\n\n\t\t\t\tfunction onAdd(e) {\n\t\t\t\t\tvar max = $parse(attributes.max)(scope);\n\t\t\t\t\tvar getter = $parse(attributes.numberPicker);\n\t\t\t\t\tvar setter = getter.assign;\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\tsetter(scope, Math.min(max, getter(scope) + 1));\n\t\t\t\t\t});\n\t\t\t\t\t// console.log('numberPicker.onAdd', max);\n\t\t\t\t}\n\n\t\t\t\tfunction addListeners() {\n\t\t\t\t\tangular.element(nodeRemove).on('touchstart mousedown', onRemove);\n\t\t\t\t\tangular.element(nodeAdd).on('touchstart mousedown', onAdd);\n\t\t\t\t}\n\n\t\t\t\tfunction removeListeners() {\n\t\t\t\t\tangular.element(nodeRemove).off('touchstart mousedown', onRemove);\n\t\t\t\t\tangular.element(nodeAdd).off('touchstart mousedown', onAdd);\n\t\t\t\t}\n\t\t\t\tscope.$on('$destroy', function () {\n\t\t\t\t\tremoveListeners();\n\t\t\t\t});\n\t\t\t\taddListeners();\n\t\t\t}\n\t\t};\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.directive('validate', ['$filter', function($filter) {\n        return {\n            require: 'ngModel',\n            link: function(scope, element, attributes, model) {\n                var type = attributes.validate;\n                var format = attributes.format || '';\n                var precision = attributes.precision || 2;\n                var focus = false;\n                // console.log('validate', type);\n                switch (type) {\n                    case 'date':\n                    case 'datetime':\n                    case 'datetime-local':\n                        model.$formatters.push(function(value) {\n                            if (value) {\n                                return $filter('date')(value, format);\n                            } else {\n                                return null;\n                            }\n                        });\n                        break;\n                    case 'number':\n                        model.$parsers.unshift(function(value) {\n                            var valid = false;\n                            if (value !== undefined && value !== \"\") {\n                                valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \n                                value = Number(value);\n                                model.$setValidity('number', valid);\n                                if (valid) {\n                                    model.$setValidity('positive', value >= 0.01);\n                                    if (attributes.min !== undefined) {\n                                        model.$setValidity('range', value >= Number(attributes.min));\n                                    }\n                                    if (attributes.max !== undefined) {\n                                        model.$setValidity('range', value <= Number(attributes.max));\n                                    }\n                                }\n                            } else {\n                                valid = true;\n                                value = Number(value);\n                                model.$setValidity('number', true);\n                                model.$setValidity('positive', true);\n                                if (attributes.min !== undefined) {\n                                    model.$setValidity('range', true);\n                                }\n                                if (attributes.max !== undefined) {\n                                    model.$setValidity('range', true);\n                                }\n                            }\n                            return value;\n                        });\n                        model.$formatters.push(function(value) {\n                            if (value) {\n                                return $filter('number')(value, precision) + ' ' + format;\n                            } else {\n                                return null;\n                            }\n                        });\n                        break;\n                    case 'anynumber':\n                        model.$parsers.unshift(function(value) {\n                            var valid = false;\n                            if (value !== undefined && value !== \"\") {\n                                valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \n                                value = Number(value);\n                                model.$setValidity('number', valid);\n                                if (valid) {\n                                    if (attributes.min !== undefined) {\n                                        model.$setValidity('range', value >= Number(attributes.min));\n                                    }\n                                    if (attributes.max !== undefined) {\n                                        model.$setValidity('range', value <= Number(attributes.max));\n                                    }\n                                }\n                            } else {\n                                valid = true;\n                                value = Number(value);\n                                model.$setValidity('number', true);\n                                if (attributes.min !== undefined) {\n                                    model.$setValidity('range', true);\n                                }\n                                if (attributes.max !== undefined) {\n                                    model.$setValidity('range', true);\n                                }\n                            }\n                            return value;\n                        });\n                        model.$formatters.push(function(value) {\n                            if (value || value === 0) {\n                                return $filter('number')(value, precision) + ' ' + format;\n                            } else {\n                                return null;\n                            }\n                        });\n                        break;\n                }\n\n                function onFocus() {\n                    focus = true;\n                    if (format) {\n                        element[0].value = model.$modelValue || null;\n                        if (!model.$modelValue) {\n                            model.$setViewValue(null);\n                        }\n                    }\n                }\n\n                function doBlur() {\n                    if (format && !model.$invalid) {\n                        switch (type) {\n                            case 'date':\n                            case 'datetime':\n                            case 'datetime-local':\n                                element[0].value = model.$modelValue ? $filter('date')(model.$modelValue, format) : ' ';\n                                break;\n                            default:\n                                element[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\n                                break;\n                        }\n                    }\n                }\n\n                function onBlur() {\n                    focus = false;\n                    doBlur();\n                }\n\n                function addListeners() {\n                    element.on('focus', onFocus);\n                    element.on('blur', onBlur);\n                }\n\n                function removeListeners() {\n                    element.off('focus', onFocus);\n                    element.off('blur', onBlur);\n                }\n                scope.$on('$destroy', function() {\n                    removeListeners();\n                });\n                addListeners();\n            }\n        };\n    }]);\n\n}());\n/* global angular */\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\t// micro interactions\n\n\tfunction tap(Events) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\tpriority: 0,\n\t\t\tlink: link\n\t\t};\n\n\t\tfunction link(scope, element, attributes, model) {\n\t\t\tif (attributes.ngBind) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t/*\n\t\t\tif (attributes.href === '#' && !attributes.ngHref && !attributes.ngClick) {\n\t\t\t\treturn;\n            }\n            */\n\n\t\t\telement.addClass('interaction-tap');\n\t\t\tvar node = document.createElement('interaction');\n\t\t\telement[0].appendChild(node);\n\n\t\t\tfunction onDown(e) {\n\t\t\t\telement.removeClass('interaction-animate');\n\t\t\t\tvoid element.offsetWidth;\n\t\t\t\t// node.style.animationPlayState = \"paused\";\n\t\t\t\tnode.style.left = e.relative.x + 'px';\n\t\t\t\tnode.style.top = e.relative.y + 'px';\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\telement.addClass('interaction-animate');\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\telement.removeClass('interaction-animate');\n\t\t\t\t\t}, 1000);\n\t\t\t\t}, 10);\n\n\t\t\t\t// console.log('tap.onDown', node, node.parentElement);\n\t\t\t}\n\t\t\tvar listeners = { // down, move, up, click\n\t\t\t\tdown: onDown,\n\t\t\t};\n\t\t\tvar events = new Events(element).add(listeners, scope); // passing scope to add remove listeners automatically on $destroy\n\t\t}\n\t}\n\tapp.directive('ngHref', ['Events', tap]);\n\tapp.directive('ngClick', ['Events', tap]);\n\n}());\n/* global angular */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.directive('modalView', ['$parse', '$templateRequest', '$compile', '$controller', 'Dom', function ($parse, $templateRequest, $compile, $controller, Dom) {\r\n\r\n\t\tfunction compileController(scope, element, html, data) {\r\n\t\t\t// console.log('modalView.compileController', element);\r\n\t\t\telement.html(html);\r\n\t\t\tvar link = $compile(element.contents());\r\n\t\t\tif (data.controller) {\r\n\t\t\t\tvar $scope = scope.$new();\r\n\t\t\t\tangular.extend($scope, data);\r\n\t\t\t\tvar controller = $controller(data.controller, {\r\n\t\t\t\t\t$scope: $scope\r\n\t\t\t\t});\r\n\t\t\t\tif (data.controllerAs) {\r\n\t\t\t\t\tscope[data.controllerAs] = controller;\r\n\t\t\t\t}\r\n\t\t\t\telement.data('$ngControllerController', controller);\r\n\t\t\t\telement.children().data('$ngControllerController', controller);\r\n\t\t\t\tscope = $scope;\r\n\t\t\t}\r\n\t\t\tlink(scope);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\trestrict: 'A',\r\n\t\t\tpriority: -400,\r\n\t\t\tlink: function (scope, element, attributes, model) {\r\n\t\t\t\tvar modal = $parse(attributes.modalView);\r\n\t\t\t\tmodal = modal(scope);\r\n\t\t\t\tmodal.templateUrl = modal.templateUrl || 'artisan/components/modals/partial/modal';\r\n\t\t\t\t$templateRequest(modal.templateUrl).then(function (html) {\r\n\t\t\t\t\tcompileController(scope, element, html, modal);\r\n\t\t\t\t});\r\n\t\t\t\t/*\r\n\t\t\t\t// window.scrollTo(0, element[0].offsetTop - 100);\r\n\t\t\t\tfunction onClick(e) {\r\n\t\t\t\t    var closest = Dom.getClosestNode(e.target, element[0]);\r\n\t\t\t\t    if (closest === null) {\r\n\t\t\t\t        modal.reject(null);\r\n\t\t\t\t    }\r\n\t\t\t\t    // console.log('onClick', closest);\r\n\t\t\t\t}\r\n\t\t\t\tfunction addListeners() {\r\n\t\t\t\t    angular.element(window).on('click', onClick);\r\n\t\t\t\t}\r\n\t\t\t\tfunction removeListeners() {\r\n\t\t\t\t    angular.element(window).off('click', onClick);\r\n\t\t\t\t}\r\n\t\t\t\tscope.$on('destroy', function () {\r\n\t\t\t\t    removeListeners();\r\n\t\t\t\t});\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t    addListeners();\r\n\t\t\t\t}, 500);\r\n\t\t\t\t*/\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.provider('$modal', [function $modalProvider() {\r\n\r\n\t\tvar modals = [];\r\n\t\tvar routes = {};\r\n\r\n\t\tthis.modals = modals;\r\n\t\tthis.routes = routes;\r\n\t\tthis.when = when;\r\n\r\n\t\tfunction when(path, modal) {\r\n\t\t\troutes[path] = modal;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tthis.$get = ['$q', '$timeout', function modalFactory($q, $timeout) {\r\n\r\n\t\t\tfunction popModal(modal) {\r\n\t\t\t\t// console.log('modalProvider.popModal', modal);                \r\n\t\t\t\tvar index = -1;\r\n\t\t\t\tangular.forEach(modals, function (m, i) {\r\n\t\t\t\t\tif (m === modal) {\r\n\t\t\t\t\t\tindex = i;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\t$timeout(function () {\r\n\t\t\t\t\t\tmodal.active = false;\r\n\t\t\t\t\t\tmodals.splice(index, 1);\r\n\t\t\t\t\t\tif (modals.length) {\r\n\t\t\t\t\t\t\tmodals[modals.length - 1].active = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction closeModal(modal) {\r\n\t\t\t\t// console.log('modalProvider.closeModal', modal);                \r\n\t\t\t\tvar index = -1;\r\n\t\t\t\tangular.forEach(modals, function (m, i) {\r\n\t\t\t\t\tif (m === modal) {\r\n\t\t\t\t\t\tindex = i;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\tmodal.active = false;\r\n\t\t\t\t\t$timeout(function () {\r\n\t\t\t\t\t\twhile (modals.length) {\r\n\t\t\t\t\t\t\tmodals.splice(modals.length - 1, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 500);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction addModal(path, params) {\r\n\t\t\t\t// console.log('modalProvider.addModal', path, params);\r\n\t\t\t\tvar deferred = $q.defer();\r\n\t\t\t\tparams = params || null;\r\n\t\t\t\tvar modal = {\r\n\t\t\t\t\ttitle: 'Untitled',\r\n\t\t\t\t\tcontroller: null,\r\n\t\t\t\t\ttemplateUrl: null,\r\n\t\t\t\t\tparams: params,\r\n\t\t\t\t};\r\n\t\t\t\tvar current = routes[path];\r\n\t\t\t\tif (current) {\r\n\t\t\t\t\tangular.extend(modal, current);\r\n\t\t\t\t}\r\n\t\t\t\tmodal.deferred = deferred;\r\n\t\t\t\tmodal.back = function (data) {\r\n\t\t\t\t\tpopModal(this);\r\n\t\t\t\t\tmodal.deferred.resolve(data, modal);\r\n\t\t\t\t}\r\n\t\t\t\tmodal.resolve = function (data) {\r\n\t\t\t\t\tcloseModal(this);\r\n\t\t\t\t\tmodal.deferred.resolve(data, modal);\r\n\t\t\t\t}\r\n\t\t\t\tmodal.reject = function () {\r\n\t\t\t\t\tcloseModal(this);\r\n\t\t\t\t\tmodal.deferred.reject(modal);\r\n\t\t\t\t}\r\n\t\t\t\tmodals.push(modal);\r\n\t\t\t\tangular.forEach(modals, function (m, i) {\r\n\t\t\t\t\tm.active = false;\r\n\t\t\t\t});\r\n\t\t\t\tif (modals.length) {\r\n\t\t\t\t\tmodal.active = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$timeout(function () {\r\n\t\t\t\t\t\tmodal.active = true;\r\n\t\t\t\t\t\t// window.scrollTo(0, 0);\r\n\t\t\t\t\t}, 500);\r\n\t\t\t\t}\r\n\t\t\t\treturn deferred.promise;\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tmodals: modals,\r\n\t\t\t\taddModal: addModal,\r\n\t\t\t};\r\n        }];\r\n\r\n    }]);\r\n\r\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('nav', ['$parse', 'Nav', function ($parse, Nav) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function (element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/components/nav/partial/nav';\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\titems: '=nav',\n\t\t\t},\n\t\t\tlink: NavLink,\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction NavLink(scope, element, attributes, model) {\n\t\t\tscope.$watch('items', function (value) {\n\t\t\t\t// console.log(value instanceof Nav, value);\n\t\t\t\tif (value) {\n\t\t\t\t\tif (angular.isArray(value)) {\n\t\t\t\t\t\tvar onPath = $parse(attributes.onPath)(scope.$parent);\n\t\t\t\t\t\tvar onNav = $parse(attributes.onNav)(scope.$parent);\n\t\t\t\t\t\tvar nav = new Nav({\n\t\t\t\t\t\t\tonPath: onPath,\n\t\t\t\t\t\t\tonNav: onNav\n\t\t\t\t\t\t});\n\t\t\t\t\t\tnav.setItems(value);\n\t\t\t\t\t\tscope.item = nav;\n\n\t\t\t\t\t} else if (value instanceof Nav) {\n\t\t\t\t\t\tscope.item = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n    }]);\n\n\tapp.directive('navItem', ['$timeout', 'Events', function ($timeout, Events) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function (element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/components/nav/partial/nav-item';\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\titem: '=navItem',\n\t\t\t},\n\t\t\tlink: NavItemLink,\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction NavItemLink(scope, element, attributes, model) {\n\t\t\tvar navItem = angular.element(element[0].querySelector('.nav-link'));\n\n\t\t\tvar output;\n\n\t\t\tfunction itemOpen(item, immediate) {\n\t\t\t\tvar state = item.$nav.state;\n\t\t\t\tstate.active = true;\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tstate.immediate = immediate;\n\t\t\t\t\tstate.closed = state.closing = false;\n\t\t\t\t\tstate.opening = true;\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\tstate.opening = false;\n\t\t\t\t\t\tstate.opened = true;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction itemClose(item, immediate) {\n\t\t\t\tvar state = item.$nav.state;\n\t\t\t\tstate.active = false;\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tstate.immediate = immediate;\n\t\t\t\t\tstate.opened = state.opening = false;\n\t\t\t\t\tstate.closing = true;\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\tstate.closing = false;\n\t\t\t\t\t\tstate.closed = true;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tif (item.items) {\n\t\t\t\t\tangular.forEach(item.items, function (o) {\n\t\t\t\t\t\titemClose(o, true);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction itemToggle(item) {\n\t\t\t\t// console.log('itemToggle', item);\n\t\t\t\tvar state = item.$nav.state;\n\t\t\t\tstate.active = item.items ? !state.active : true;\n\t\t\t\tif (state.active) {\n\t\t\t\t\tif (item.$nav.parent) {\n\t\t\t\t\t\tangular.forEach(item.$nav.parent.items, function (o) {\n\t\t\t\t\t\t\tif (o !== item) {\n\t\t\t\t\t\t\t\titemClose(o, true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\titemOpen(item);\n\t\t\t\t} else {\n\t\t\t\t\titemClose(item);\n\t\t\t\t}\n\t\t\t\t// console.log(state);\n\t\t\t}\n\n\t\t\tfunction onDown(e) {\n\t\t\t\tvar item = scope.item;\n\t\t\t\t// console.log('Item.onDown', item);\n\t\t\t\tvar state = item.$nav.state;\n\t\t\t\tif (state.active) {\n\t\t\t\t\toutput = false;\n\t\t\t\t\ttrigger();\n\t\t\t\t} else if (item.$nav.onNav) {\n\t\t\t\t\tvar promise = item.$nav.onNav(item, item.$nav);\n\t\t\t\t\tif (promise && typeof promise.then === 'function') {\n\t\t\t\t\t\tpromise.then(function (resolved) {\n\t\t\t\t\t\t\t// go on\n\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t}, function (rejected) {\n\t\t\t\t\t\t\t// do nothing\n\t\t\t\t\t\t});\n\t\t\t\t\t\toutput = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toutput = promise;\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction trigger() {\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\titemToggle(item);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// preventDefault(e);\n\t\t\t}\n\n\t\t\tfunction onClick(e) {\n\t\t\t\t// console.log('Item.onClick', e);\n\t\t\t\treturn preventDefault(e);\n\t\t\t}\n\n\t\t\tfunction preventDefault(e) {\n\t\t\t\tif (output === false) {\n\t\t\t\t\t// console.log('Item.preventDefault', e);\n\t\t\t\t\te.stop();\n\t\t\t\t\t// e.preventDefault();\n\t\t\t\t\t// e.stopPropagation();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar events = new Events(navItem).add({\n\t\t\t\tdown: onDown,\n\t\t\t\tclick: onClick,\n\t\t\t}, scope);\n\t\t}\n\n    }]);\n\n\tapp.directive('navTo', ['$parse', '$timeout', 'Events', function ($parse, $timeout, Events) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\tlink: NavToLink\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction NavToLink(scope, element, attributes) {\n\t\t\tfunction onDown(e) {\n\t\t\t\tconsole.log('navTo.onDown', attributes.navTo);\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tvar callback = $parse(attributes.navTo);\n\t\t\t\t\tcallback(scope);\n\t\t\t\t});\n\t\t\t\te.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar events = new Events(element).add({\n\t\t\t\tdown: onDown,\n\t\t\t}, scope);\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('Nav', ['Silent', function(Silent) {\n\n        function Nav(options) {\n            var nav = this;\n            var defaults = {\n                items: [],\n            }\n            angular.extend(nav, defaults);\n            if (options) {\n                angular.extend(nav, options);\n            }\n            nav.setNav(nav, null);\n        }\n\n        var statics = {\n            silent: NavSilent,\n            path: NavPath,\n        };\n\n        var publics = {\n            addItem: addItem,\n            addItems: addItems,\n            getPath: getPath,\n            setItems: setItems,\n            setNav: setNav,\n            setNavs: setNavs,\n        };\n\n        angular.extend(Nav, statics);\n        angular.extend(Nav.prototype, publics);\n\n        return Nav;\n\n        // static methods\n\n        function NavSilent(path) {\n            Silent.silent(path);\n        }\n\n        function NavPath(path) {\n            Silent.path(path);\n        }\n\n        // prototype methods\n\n        function setItems(items) {\n            var nav = this;\n            nav.path = Silent.path();\n            nav.items = items;\n            nav.setNavs(items, nav);\n        }\n\n        function setNavs(items, parent) {\n            var nav = this;\n            if (items) {\n                angular.forEach(items, function(item) {\n                    nav.setNav(item, parent);\n                    nav.setNavs(item.items, item);\n                });\n            }\n        }\n\n        function setNav(item, parent) {\n            var nav = this;\n            var $nav = {\n                parent: parent || null,\n                level: parent ? parent.$nav.level + 1 : 0,\n                state: {},\n                addItems: function(x) {\n                    nav.addItems(x, item);\n                },\n                onNav: nav.onNav,\n            };\n            item.$nav = $nav;\n            $nav.path = nav.getPath(item);\n            if ($nav.path === nav.path) {\n                $nav.state.active = true;\n                $nav.state.opened = true;\n                while ($nav.parent) {\n                    $nav = $nav.parent.$nav;\n                    $nav.state.active = true;\n                    $nav.state.opened = true;\n                }\n            }\n        }\n\n        function addItems(itemOrItems, parent) {\n            var nav = this;\n            if (angular.isArray(itemOrItems)) {\n                angular.forEach(itemOrItems, function(item) {\n                    nav.addItem(item, parent);\n                });\n            } else {\n                nav.addItem(itemOrItems, parent);\n            }\n        }\n\n        function addItem(item, parent) {\n            var nav = this,\n                onPath = nav.onPath,\n                onNav = nav.onNav;\n            nav.setNav(item, parent);\n            if (parent) {\n                parent.items = parent.items || [];\n                parent.items.push(item);\n            }\n        }\n\n        function getPath(item) {\n            var path = null;\n            if (this.onPath) {\n                path = this.onPath(item, item.$nav);\n            } else {\n                path = item.path;\n            }\n            return path;\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('popuppable', ['$parse', 'State', 'Dom', function ($parse, State, Dom) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\tlink: link,\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction link(scope, element, attributes, model) {\n\n\t\t\tvar state = new State();\n\t\t\tstate.pow = 0;\n\n\t\t\tvar relative, absolute;\n\n\t\t\tvar target, targetElement;\n\n\t\t\tvar from, to, current,\n\t\t\t\tboundingClientRect, styleObj, originalCssText;\n\n\t\t\tvar opened = false;\n\n\t\t\tfunction getStyle(node) {\n\t\t\t\tvar style = window.getComputedStyle(node, null);\n\t\t\t\tvar styleObj = {\n\t\t\t\t\t'display': style.getPropertyValue('display'),\n\t\t\t\t\t'position': style.getPropertyValue('position'),\n\t\t\t\t\t'width': style.getPropertyValue('width'),\n\t\t\t\t\t'height': style.getPropertyValue('height'),\n\t\t\t\t\t'top': style.getPropertyValue('top'),\n\t\t\t\t\t'right': style.getPropertyValue('right'),\n\t\t\t\t\t'bottom': style.getPropertyValue('bottom'),\n\t\t\t\t\t'left': style.getPropertyValue('left'),\n\t\t\t\t\t'margin-top': style.getPropertyValue('margin-top'),\n\t\t\t\t\t'margin-right': style.getPropertyValue('margin-right'),\n\t\t\t\t\t'margin-bottom': style.getPropertyValue('margin-bottom'),\n\t\t\t\t\t'margin-left': style.getPropertyValue('margin-left'),\n\t\t\t\t\t'padding-top': style.getPropertyValue('padding-top'),\n\t\t\t\t\t'padding-right': style.getPropertyValue('padding-right'),\n\t\t\t\t\t'padding-bottom': style.getPropertyValue('padding-bottom'),\n\t\t\t\t\t'padding-left': style.getPropertyValue('padding-left'),\n\t\t\t\t\t'background-color': style.getPropertyValue('background-color'),\n\t\t\t\t};\n\t\t\t\treturn styleObj;\n\t\t\t}\n\n\t\t\tfunction getTextStyle(style) {\n\t\t\t\tvar text = '';\n\t\t\t\tangular.forEach(style, function (value, key) {\n\t\t\t\t\ttext += key + ': ' + value + '; ';\n\t\t\t\t});\n\t\t\t\treturn text;\n\t\t\t}\n\n\t\t\tfunction setStyle(node, style) {\n\t\t\t\tnode.style.cssText = getTextStyle(style);\n\t\t\t}\n\n\t\t\tfunction add() {\n\t\t\t\ttargetElement.addClass('popuppable-opening');\n\t\t\t\tDom.getParents(target).each(function (element, node) {\n\t\t\t\t\telement.addClass('popuppable-parent');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction remove() {\n\t\t\t\ttargetElement.removeClass('popuppable-opening');\n\t\t\t\tDom.getParents(target).each(function (element, node) {\n\t\t\t\t\telement.removeClass('popuppable-parent');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction open() {\n\t\t\t\tif (!opened) {\n\t\t\t\t\tadd();\n\t\t\t\t\tcurrent = angular.copy(from);\n\t\t\t\t\topenAnimation();\n\t\t\t\t} else {\n\t\t\t\t\tstate.idle();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction close() {\n\t\t\t\tif (opened) {\n\t\t\t\t\tcloseAnimation();\n\t\t\t\t} else {\n\t\t\t\t\tstate.idle();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction update() {\n\t\t\t\tcurrent.left = (from.left + (to.left - from.left) * state.pow) + 'px';\n\t\t\t\tcurrent.top = (from.top + (to.top - from.top) * state.pow) + 'px';\n\t\t\t\tcurrent.width = (from.width + (to.width - from.width) * state.pow) + 'px';\n\t\t\t\tcurrent.height = (from.height + (to.height - from.height) * state.pow) + 'px';\n\t\t\t\tsetStyle(target, current);\n\t\t\t}\n\n\t\t\tfunction toggle() {\n\t\t\t\tif (state.busy()) {\n\t\t\t\t\tif (opened) {\n\t\t\t\t\t\tclose();\n\t\t\t\t\t} else {\n\t\t\t\t\t\topen();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction set() {\n\t\t\t\ttarget = element[0].querySelector(attributes.popuppable);\n\t\t\t\tif (target) {\n\t\t\t\t\ttargetElement = angular.element(target);\n\t\t\t\t\ttargetElement.addClass('popuppable-target');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onDown(e) {\n\t\t\t\tset();\n\t\t\t\tif (target) {\n\t\t\t\t\topen();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onUp(e) {\n\t\t\t\tif (Dom.getClosestNode(e.target, element[0])) {\n\t\t\t\t\t// nope\n\t\t\t\t} else {\n\t\t\t\t\tset();\n\t\t\t\t\tif (target) {\n\t\t\t\t\t\tclose();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onResize(e) {\n\t\t\t\tif (opened || state.isBusy) {\n\t\t\t\t\tupdate();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onKeyDown(e) {\n\t\t\t\tvar key = e.key.toLowerCase();\n\t\t\t\tswitch (key) {\n\t\t\t\t\tcase 'escape':\n\t\t\t\t\t\tset();\n\t\t\t\t\t\tif (target) {\n\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'enter':\n\t\t\t\t\t\tset();\n\t\t\t\t\t\tif (target && target.tagName && target.tagName.toLowerCase() === 'input') {\n\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction addListeners() {\n\t\t\t\tvar trigger = element[0].querySelector('.popuppable-trigger');\n\t\t\t\tvar triggerElement = trigger ? angular.element(trigger) : element;\n\t\t\t\ttriggerElement\n\t\t\t\t\t.on('mousedown touchstart', onDown)\n\t\t\t\t\t.on('keydown', onKeyDown);\n\t\t\t\tangular.element(window)\n\t\t\t\t\t.on('click', onUp)\n\t\t\t\t\t.on('resize', onResize);\n\t\t\t}\n\n\t\t\tfunction removeListeners() {\n\t\t\t\tvar trigger = element[0].querySelector('.popuppable-trigger');\n\t\t\t\tvar triggerElement = trigger ? angular.element(trigger) : element;\n\t\t\t\ttriggerElement\n\t\t\t\t\t.off('mousedown touchstart', onDown)\n\t\t\t\t\t.off('keydown', onKeyDown);\n\t\t\t\tangular.element(window)\n\t\t\t\t\t.off('click', onUp)\n\t\t\t\t\t.off('resize', onResize);\n\t\t\t}\n\n\t\t\tscope.$on('$destroy', function () {\n\t\t\t\tremoveListeners();\n\t\t\t});\n\n\t\t\taddListeners();\n\n\t\t\tset();\n\n\t\t\tfunction openAnimation() {\n\t\t\t\tdynamics.animate(target, {\n\t\t\t\t\topacity: 1,\n\t\t\t\t\tscale: 1\n\t\t\t\t}, {\n\t\t\t\t\ttype: dynamics.spring,\n\t\t\t\t\tfrequency: 200,\n\t\t\t\t\tfriction: 270,\n\t\t\t\t\tduration: 800,\n\t\t\t\t\tcomplete: function () {\n\t\t\t\t\t\topened = true;\n\t\t\t\t\t\tstate.idle();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction closeAnimation() {\n\t\t\t\tdynamics.animate(target, {\n\t\t\t\t\topacity: 0,\n\t\t\t\t\tscale: 0.1\n\t\t\t\t}, {\n\t\t\t\t\ttype: dynamics.easeInOut,\n\t\t\t\t\tduration: 300,\n\t\t\t\t\tfriction: 100,\n\t\t\t\t\tcomplete: function () {\n\t\t\t\t\t\topened = false;\n\t\t\t\t\t\tremove();\n\t\t\t\t\t\tstate.idle();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\twindow.ondragstart = function () {\n\t\treturn false;\n\t};\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('scrollableX', ['$parse', '$compile', '$timeout', 'Scrollable', 'Animate', 'Style', 'Events', 'Utils', function ($parse, $compile, $timeout, Scrollable, Animate, Style, Events, Utils) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplate: '<div class=\"scrollable-content\" ng-transclude></div>',\n\t\t\ttransclude: true,\n\t\t\tlink: function (scope, element, attributes, model) {\n\n\t\t\t\tvar onLeft, onRight, showIndicatorFor, scrollableWhen;\n\t\t\t\tif (attributes.onLeft) {\n\t\t\t\t\tonLeft = $parse(attributes.onLeft);\n\t\t\t\t}\n\t\t\t\tif (attributes.onRight) {\n\t\t\t\t\tonRight = $parse(attributes.onRight);\n\t\t\t\t}\n\t\t\t\tif (attributes.showIndicatorFor) {\n\t\t\t\t\tshowIndicatorFor = $parse(attributes.showIndicatorFor);\n\t\t\t\t}\n\t\t\t\tif (attributes.scrollableWhen) {\n\t\t\t\t\tscrollableWhen = $parse(attributes.scrollableWhen);\n\t\t\t\t}\n\n\t\t\t\t// ELEMENTS & STYLESHEETS;\n\t\t\t\telement.attr('unselectable', 'on').addClass('unselectable');\n\t\t\t\tvar containerNode = element[0];\n\t\t\t\tvar contentNode = containerNode.querySelector('.scrollable-content');\n\t\t\t\tvar content = angular.element(content);\n\t\t\t\tvar contentStyle = new Style();\n\n\t\t\t\tvar animate = new Animate(render);\n\n\t\t\t\tvar scrollable = attributes.scrollableX ? $parse(attributes.scrollableX)(scope) : new Scrollable();\n\n\t\t\t\tlink(scrollable);\n\n\t\t\t\tfunction link(scrollable) {\n\t\t\t\t\tscrollable.link({\n\t\t\t\t\t\tgetItems: function () {\n\t\t\t\t\t\t\tif (attributes.scrollableItem) {\n\t\t\t\t\t\t\t\tvar items = containerNode.querySelectorAll(attributes.scrollableItem);\n\t\t\t\t\t\t\t\treturn items;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprev: function () {\n\t\t\t\t\t\t\tscrollable.scrollPrev();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tnext: function () {\n\t\t\t\t\t\t\tscrollable.scrollNext();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\treset: function () {\n\t\t\t\t\t\t\tscrollable.doReset();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonLeft: onLeft,\n\t\t\t\t\t\tonRight: onRight,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/*\n\t\t\t\tscope.$watch(attributes.scrollableX, function (newValue) {\n\t\t\t\t\tconsole.log(newValue);\n\t\t\t\t});\n\t\t\t\t*/\n\n\t\t\t\t/*\n\t\t\t\tvar indicator = null,\n\t\t\t\t\tindicatorNode = null,\n\t\t\t\t\tindicatorStyle;\n\t\t\t\tshowIndicatorFor = false;\n\t\t\t\tif (showIndicatorFor) {\n\t\t\t\t\tindicator = angular.element('<div class=\"indicator\"></div>');\n\t\t\t\t\tindicatorNode = indicator[0];\n\t\t\t\t\tindicatorStyle = new Style();\n\t\t\t\t\telement.append(indicator);\n\t\t\t\t\t$compile(indicator.contents())(scope);\n\t\t\t\t\tvar i = scrollbar.getIndicator();\n\t\t\t\t\tindicatorStyle.transform('translate3d(' + i.x.toFixed(2) + 'px,' + i.y.toFixed(2) + 'px,0)');\n\t\t\t\t\tindicatorStyle.set(indicatorNode);\n\t\t\t\t}\n\t\t\t\t*/\n\n\t\t\t\tfunction render(time) {\n\t\t\t\t\tscrollable.setContainer(containerNode);\n\t\t\t\t\tscrollable.setContent(contentNode);\n\t\t\t\t\tscrollable.setEnabled(isEnabled());\n\t\t\t\t\tvar animating = scrollable.renderX();\n\t\t\t\t\tif (!animating) {\n\t\t\t\t\t\t// animate.pause();\n\t\t\t\t\t}\n\t\t\t\t\tvar current = scrollable.getCurrent();\n\t\t\t\t\tcontentStyle.transform('translate3d(' + current.x.toFixed(2) + 'px,0,0)');\n\t\t\t\t\tcontentStyle.set(contentNode);\n\t\t\t\t\t/*\n\t\t\t\t\tif (showIndicatorFor) {\n\t\t\t\t\t\tif (dragging || wheeling || speed) {\n\t\t\t\t\t\t\tvar percent = c.x / (containerNode.offsetWidth - contentNode.offsetWidth);\n\t\t\t\t\t\t\tpercent = Math.max(0, Math.min(1, percent));\n\t\t\t\t\t\t\ti.x = (containerNode.offsetWidth - indicatorNode.offsetWidth) * (percent);\n\t\t\t\t\t\t\ti.y += (0 - i.y) / 4;\n\t\t\t\t\t\t\t// var count = Math.round(contentNode.offsetWidth / 315);\n\t\t\t\t\t\t\tvar index = Math.max(1, Math.round(percent * showIndicatorFor.rows.length));\n\t\t\t\t\t\t\tindicator.html(index + '/' + showIndicatorFor.count);\n\t\t\t\t\t\t\t// indicator.html((percent * 100).toFixed(2).toString());\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ti.y += (45 - i.y) / 4;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tindicatorStyle.transform('translate3d(' + i.x.toFixed(2) + 'px,' + i.y.toFixed(2) + 'px,0)');\n\t\t\t\t\t\tindicatorStyle.set(indicatorNode);\n\t\t\t\t\t}\n\t\t\t\t\t*/\n\t\t\t\t}\n\n\t\t\t\tfunction undrag() {\n\t\t\t\t\tscrollable.off();\n\t\t\t\t\tdragOff();\n\t\t\t\t}\n\n\t\t\t\tfunction onDown(event) {\n\t\t\t\t\tif (scrollable.dragStart(event.absolute)) {\n\t\t\t\t\t\tdragOn();\n\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onMove(event) {\n\t\t\t\t\tscrollable.dragMove(event.absolute);\n\t\t\t\t\tvar drag = scrollable.getDrag();\n\t\t\t\t\tif (Math.abs(drag.y) > Math.abs(drag.x)) {\n\t\t\t\t\t\tonUp(event);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onUp(event) {\n\t\t\t\t\tscrollable.dragEnd(event.absolute);\n\t\t\t\t\tevent.stop();\n\t\t\t\t\tdragOff();\n\t\t\t\t}\n\n\t\t\t\tfunction _onScrollX(dir, interval) {\n\t\t\t\t\treturn scrollable.wheelX(dir, interval);\n\t\t\t\t}\n\n\t\t\t\tvar onScrollX = _onScrollX;\n\t\t\t\t// var onScrollX = Utils.throttle(_onScrollX, 25);\n\n\t\t\t\tfunction onWheel(event) {\n\t\t\t\t\t// console.log('onWheelX', event.dir, scrollable.wheelXCheck(event.dir));\n\t\t\t\t\tif (scrollable.wheelXCheck(event.dir)) {\n\t\t\t\t\t\tonScrollX(event.dir, event.interval);\n\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction off() {\n\t\t\t\t\tdragOff();\n\t\t\t\t\t// animate.pause();\n\t\t\t\t\tscrollable.off();\n\t\t\t\t}\n\n\t\t\t\tfunction isEnabled() {\n\t\t\t\t\tvar enabled = true;\n\t\t\t\t\tif (scrollableWhen) {\n\t\t\t\t\t\tenabled = enabled && scrollableWhen(scope);\n\t\t\t\t\t}\n\t\t\t\t\tenabled = enabled && window.innerWidth >= 1024;\n\t\t\t\t\tenabled = enabled && (containerNode.offsetWidth < contentNode.offsetWidth);\n\t\t\t\t\treturn enabled;\n\t\t\t\t}\n\n\t\t\t\tfunction onResize() {\n\t\t\t\t\tvar enabled = isEnabled();\n\t\t\t\t\tif (!enabled) {\n\t\t\t\t\t\toff();\n\t\t\t\t\t}\n\t\t\t\t\trender();\n\t\t\t\t}\n\n\t\t\t\tscope.$watch(function () {\n\t\t\t\t\treturn contentNode.offsetWidth;\n\t\t\t\t}, function (newValue, oldValue) {\n\t\t\t\t\tonResize();\n\t\t\t\t});\n\n\t\t\t\tvar events = new Events(element).add({\n\t\t\t\t\tdown: onDown,\n\t\t\t\t\twheel: onWheel,\n\t\t\t\t}, scope);\n\n\t\t\t\tvar windowEvents = new Events(window).add({\n\t\t\t\t\tresize: onResize,\n\t\t\t\t}, scope);\n\n\t\t\t\tfunction dragOn() {\n\t\t\t\t\twindowEvents.add({\n\t\t\t\t\t\tmove: onMove,\n\t\t\t\t\t\tup: onUp,\n\t\t\t\t\t}, scope);\n\t\t\t\t}\n\n\t\t\t\tfunction dragOff() {\n\t\t\t\t\twindowEvents.remove({\n\t\t\t\t\t\tmove: onMove,\n\t\t\t\t\t\tup: onUp,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tscope.$on('$destroy', function () {\n\t\t\t\t\tanimate.pause();\n\t\t\t\t});\n\n\t\t\t},\n\t\t};\n    }]);\n\n\tapp.directive('scrollableY', ['$parse', '$compile', '$timeout', 'Scrollable', 'Animate', 'Style', 'Events', 'Utils', function ($parse, $compile, $timeout, Scrollable, Animate, Style, Events, Utils) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplate: '<div class=\"scrollable-content\" ng-transclude></div>',\n\t\t\ttransclude: true,\n\t\t\tlink: function (scope, element, attributes, model) {\n\n\t\t\t\tvar onTop, onBottom, showIndicatorFor, scrollableWhen;\n\t\t\t\tif (attributes.onTop) {\n\t\t\t\t\tonTop = $parse(attributes.onTop);\n\t\t\t\t}\n\t\t\t\tif (attributes.onBottom) {\n\t\t\t\t\tonBottom = $parse(attributes.onBottom);\n\t\t\t\t}\n\t\t\t\tif (attributes.showIndicatorFor) {\n\t\t\t\t\tshowIndicatorFor = $parse(attributes.showIndicatorFor);\n\t\t\t\t}\n\t\t\t\tif (attributes.scrollableWhen) {\n\t\t\t\t\tscrollableWhen = $parse(attributes.scrollableWhen);\n\t\t\t\t}\n\n\t\t\t\t// ELEMENTS & STYLESHEETS;\n\t\t\t\telement.attr('unselectable', 'on').addClass('unselectable');\n\t\t\t\tvar containerNode = element[0];\n\t\t\t\tvar contentNode = containerNode.querySelector('.scrollable-content');\n\t\t\t\tvar content = angular.element(content);\n\t\t\t\tvar contentStyle = new Style();\n\n\t\t\t\tvar animate = new Animate(render);\n\n\t\t\t\tvar scrollable = attributes.scrollableY ? $parse(attributes.scrollableY)(scope) : new Scrollable();\n\t\t\t\tlink(scrollable);\n\n\t\t\t\tfunction link(scrollable) {\n\t\t\t\t\tscrollable.link({\n\t\t\t\t\t\tgetItems: function () {\n\t\t\t\t\t\t\tif (attributes.scrollableItem) {\n\t\t\t\t\t\t\t\tvar items = containerNode.querySelectorAll(attributes.scrollableItem);\n\t\t\t\t\t\t\t\treturn items;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprev: function () {\n\t\t\t\t\t\t\tscrollable.scrollPrev();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tnext: function () {\n\t\t\t\t\t\t\tscrollable.scrollNext();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\treset: function () {\n\t\t\t\t\t\t\tscrollable.doReset();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonTop: onTop,\n\t\t\t\t\t\tonBottom: onBottom,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction render(time) {\n\t\t\t\t\tscrollable.setContainer(containerNode);\n\t\t\t\t\tscrollable.setContent(contentNode);\n\t\t\t\t\tscrollable.setEnabled(isEnabled());\n\t\t\t\t\tvar animating = scrollable.renderY();\n\t\t\t\t\tif (!animating) {\n\t\t\t\t\t\t// animate.pause();\n\t\t\t\t\t}\n\t\t\t\t\tvar current = scrollable.getCurrent();\n\t\t\t\t\tcontentStyle.transform('translate3d(0,' + current.y.toFixed(2) + 'px,0)');\n\t\t\t\t\tcontentStyle.set(contentNode);\n\t\t\t\t}\n\n\t\t\t\tfunction undrag() {\n\t\t\t\t\tscrollable.off();\n\t\t\t\t\tdragOff();\n\t\t\t\t}\n\n\t\t\t\tfunction onDown(event) {\n\t\t\t\t\tif (scrollable.dragStart(event.absolute)) {\n\t\t\t\t\t\tdragOn();\n\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onMove(event) {\n\t\t\t\t\tscrollable.dragMove(event.absolute);\n\t\t\t\t\tvar drag = scrollable.getDrag();\n\t\t\t\t\tif (Math.abs(drag.x) > Math.abs(drag.y)) {\n\t\t\t\t\t\tonUp(event);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onUp(event) {\n\t\t\t\t\tscrollable.dragEnd(event.absolute);\n\t\t\t\t\tevent.stop();\n\t\t\t\t\tdragOff();\n\t\t\t\t}\n\n\t\t\t\tfunction _onScrollY(dir, interval) {\n\t\t\t\t\treturn scrollable.wheelY(dir, interval);\n\t\t\t\t}\n\n\t\t\t\tvar onScrollY = _onScrollY;\n\t\t\t\t// var onScrollY = Utils.throttle(_onScrollY, 25);\n\n\t\t\t\tfunction onWheel(event) {\n\t\t\t\t\t// console.log('onWheelY', event.dir, scrollable.wheelYCheck(event.dir));\n\t\t\t\t\tif (scrollable.wheelYCheck(event.dir)) {\n\t\t\t\t\t\tonScrollY(event.dir, event.interval);\n\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction off() {\n\t\t\t\t\tdragOff();\n\t\t\t\t\t// animate.pause();\n\t\t\t\t\tscrollable.off();\n\t\t\t\t}\n\n\t\t\t\tfunction isEnabled() {\n\t\t\t\t\tvar enabled = true;\n\t\t\t\t\tif (scrollableWhen) {\n\t\t\t\t\t\tenabled = enabled && scrollableWhen(scope);\n\t\t\t\t\t}\n\t\t\t\t\tenabled = enabled && window.innerWidth >= 1024;\n\t\t\t\t\tenabled = enabled && (containerNode.offsetHeight < contentNode.offsetHeight);\n\t\t\t\t\treturn enabled;\n\t\t\t\t}\n\n\t\t\t\tfunction onResize() {\n\t\t\t\t\tvar enabled = isEnabled();\n\t\t\t\t\tif (!enabled) {\n\t\t\t\t\t\toff();\n\t\t\t\t\t}\n\t\t\t\t\trender();\n\t\t\t\t}\n\n\t\t\t\tscope.$watch(function () {\n\t\t\t\t\treturn contentNode.offsetHeight;\n\t\t\t\t}, function (newValue, oldValue) {\n\t\t\t\t\tonResize();\n\t\t\t\t});\n\n\t\t\t\tvar events = new Events(element).add({\n\t\t\t\t\tdown: onDown,\n\t\t\t\t\twheel: onWheel,\n\t\t\t\t}, scope);\n\n\t\t\t\tvar windowEvents = new Events(window).add({\n\t\t\t\t\tresize: onResize,\n\t\t\t\t}, scope);\n\n\t\t\t\tfunction dragOn() {\n\t\t\t\t\twindowEvents.add({\n\t\t\t\t\t\tmove: onMove,\n\t\t\t\t\t\tup: onUp,\n\t\t\t\t\t}, scope);\n\t\t\t\t}\n\n\t\t\t\tfunction dragOff() {\n\t\t\t\t\twindowEvents.remove({\n\t\t\t\t\t\tmove: onMove,\n\t\t\t\t\t\tup: onUp,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tscope.$on('$destroy', function () {\n\t\t\t\t\tanimate.pause();\n\t\t\t\t});\n\n\t\t\t},\n\t\t};\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('Scrollable', ['Utils', 'Point', 'Rect', function(Utils, Point, Rect) {\n\n        function Scrollable() {\n\n            var padding = 150;\n            var enabled, snappable, busy, dragging, wheeling, down, move, prev;\n            var currentIndex = 0;\n\n            snappable = true;\n\n            var start = new Point(),\n                end = new Point(),\n                current = new Point(),\n                drag = new Point(),\n                indicator = new Point(),\n                offset = new Point(),\n                speed = new Point(),\n                container = new Rect(),\n                content = new Rect(),\n                overflow = new Rect();\n\n            var scrollable = {\n                // properties\n                start: start,\n                end: end,\n                current: current,\n                indicator: indicator,\n                speed: speed,\n                overflow: overflow,\n                container: container,\n                content: content,\n                // methods\n                setContainer: setContainer,\n                setContent: setContent,\n                setEnabled: setEnabled,\n                getCurrent: getCurrent,\n                getDrag: getDrag,\n                getIndicator: getIndicator,\n                getIndex: getIndex,\n                scrollToIndex: scrollToIndex,\n                scrollPrev: scrollPrev,\n                scrollNext: scrollNext,\n                dragStart: dragStart,\n                dragMove: dragMove,\n                dragEnd: dragEnd,\n                doReset: doReset,\n                off: off,\n                // x direction\n                doLeft: doLeft,\n                doRight: doRight,\n                renderX: renderX,\n                scrollToX: scrollToX,\n                wheelX: wheelX,\n                wheelXCheck: wheelXCheck,\n                // y direction\n                doTop: doTop,\n                doBottom: doBottom,\n                renderY: renderY,\n                scrollToY: scrollToY,\n                wheelY: wheelY,\n                wheelYCheck: wheelYCheck,\n            };\n\n            angular.extend(this, scrollable);\n\n            scrollable = this;\n\n            function setContainer(node) {\n                container.width = node.offsetWidth;\n                container.height = node.offsetHeight;\n            }\n\n            function setContent(node) {\n                content.width = node.offsetWidth;\n                content.height = node.offsetHeight;\n            }\n\n            function setEnabled(flag) {\n                enabled = flag;\n            }\n\n            function getCurrent() {\n                return current;\n            }\n\n            function getDrag() {\n                return drag;\n            }\n\n            function getIndicator() {\n                return indicator;\n            }\n\n            function getIndex() {\n                return currentIndex;\n            }\n\n            function scrollToIndex(index) {\n                if (index !== currentIndex) {\n                    currentIndex = index;\n                    var item = getItemAtIndex(index);\n                    if (item) {\n                        offset = new Point(\n                            item.offsetLeft,\n                            item.offsetTop\n                        );\n                        // console.log('scrollToIndex', index, offset);\n                    }\n                    return true;\n                }\n            }\n\n            function dragStart(point) {\n                if (!busy) {\n                    start.x = end.x = current.x;\n                    start.y = end.y = current.y;\n                    speed.x = 0;\n                    speed.y = 0;\n                    down = point;\n                    currentIndex = -1;\n                    wheeling = false;\n                    return true;\n                } else {\n                    return false;\n                }\n            }\n\n            function dragMove(point) {\n                prev = move;\n                move = point;\n                drag.x = move.x - down.x;\n                drag.y = move.y - down.y;\n                dragging = true;\n            }\n\n            function dragEnd() {\n                if (move && prev) {\n                    speed.x += (move.x - prev.x) * 4;\n                    speed.y += (move.y - prev.y) * 4;\n                }\n                start.x = end.x = current.x;\n                start.y = end.y = current.y;\n                dragging = false;\n                move = null;\n                down = null;\n                prev = null;\n            }\n\n            function getItemAtIndex(index) {\n                var item = null;\n                var items = scrollable.getItems();\n                if (items) {\n                    if (index >= 0 && index < items.length) {\n                        item = items[index];\n                    }\n                }\n                // console.log('getItemAtIndex', index, items.length, item);\n                return item;\n            }\n\n            function scrollPrev() {\n                var index = Math.max(0, currentIndex - 1);\n                console.log('scrollPrev', index);\n                scrollToIndex(index);\n            }\n\n            function scrollNext() {\n                var items = scrollable.getItems();\n                var index = Math.min(items.length - 1, currentIndex + 1);\n                console.log('scrollNext', index);\n                scrollToIndex(index);\n            }\n\n            function doReset() {\n                end.x = current.x = 0;\n            }\n\n            function off() {\n                dragging = false;\n                wheeling = false;\n                move = null;\n                down = null;\n            }\n\n            // x - direction\n\n            function doLeft(scope) {\n                if (busy) {\n                    return;\n                }\n                if (!scrollable.onLeft) {\n                    return;\n                }\n                busy = true;\n                scrollable.onLeft(scope).then().finally(function() {\n                    scrollToX(0);\n                });\n            }\n\n            function doRight(scope) {\n                if (busy) {\n                    return;\n                }\n                if (!scrollable.onRight) {\n                    return;\n                }\n                busy = true;\n                scrollable.onRight(scope).then().finally(function() {\n                    var right = container.width - content.width;\n                    if (right > overflow.width) {\n                        start.x = end.x = overflow.width;\n                    } else {\n                        start.x = end.x = overflow.width + padding;\n                    }\n                    scrollToX(0);\n                });\n            }\n\n            function renderX() {\n                var animating = true;\n                if (enabled) {\n                    overflow.x = 0;\n                    overflow.width = container.width - content.width;\n                    if (dragging) {\n                        end.x = start.x + move.x - down.x;\n                        if (extendX()) {\n                            start.x = end.x;\n                            down.x = move.x;\n                        }\n                    } else if (speed.x) {\n                        end.x += speed.x;\n                        speed.x *= 0.75;\n                        if (wheeling) {\n                            extendX();\n                        }\n                        if (Math.abs(speed.x) < 2.05) {\n                            speed.x = 0;\n                            scrollable.wheeling = wheeling = false;\n                            snapToNearestX();\n                        }\n                    } else if (offset) {\n                        end.x = -offset.x;\n                        offset = null;\n                    }\n                    end.x = Math.round(end.x * 10000) / 10000;\n                    end.x = Math.min(overflow.x, end.x);\n                    end.x = Math.max(overflow.width, end.x);\n                    current.x += (end.x - current.x) / 4;\n                    if (speed.x === 0 && Math.abs(end.x - current.x) < 0.05) {\n                        current.x = end.x;\n                        if (!snapToNearestX()) {\n                            animating = false;\n                        }\n                    }\n                    // console.log('renderX', current.x, end.x, overflow.x);\n                } else {\n                    current.x = end.x = 0;\n                    animating = false;\n                }\n                return animating;\n            }\n\n            function extendX() {\n                var extending = false;\n                overflow.x += padding;\n                overflow.width -= padding;\n                if (end.x > overflow.x) {\n                    extending = true;\n                    doLeft();\n                } else if (end.x < overflow.width) {\n                    extending = true;\n                    doRight();\n                }\n                return extending;\n            }\n\n            function snapToNearestX() {\n                var items = scrollable.getItems();\n                if (items) {\n                    var index = -1;\n                    var min = Number.POSITIVE_INFINITY;\n                    angular.forEach(items, function(item, i) {\n                        var distance = Math.abs((end.x + speed.x) - (item.offsetLeft * -1));\n                        if (distance < min) {\n                            min = distance;\n                            index = i;\n                        }\n                    });\n                    if (index !== -1) {\n                        if (snappable) {\n                            return scrollToIndex(index);\n                        } else {\n                            currentIndex = index;\n                        }\n                    }\n                }\n            }\n\n            function wheelXCheck(dir) {\n                // console.log('wheelYCheck', dir < 0 ? (end.x - overflow.width) : (end.x - overflow.x));\n                if (!busy && enabled) {\n                    if (dir < 0) {\n                        return end.x - overflow.width;\n                    } else {\n                        return end.x - overflow.x;\n                    }\n                } else {\n                    return false;\n                }\n            }\n\n            function wheelX(dir, interval) {\n                end.x += dir * 100 / 1000 * interval;\n                speed.x += dir * 100 / 1000 * interval;\n                wheeling = true;\n            }\n\n            function scrollToX(value) {\n                start.x = end.x = value;\n                setTimeout(function() {\n                    off();\n                    busy = false;\n                }, 500);\n            }\n\n            // y - direction\n\n            function doTop(scope) {\n                if (busy) {\n                    return;\n                }\n                if (!scrollable.onTop) {\n                    return;\n                }\n                busy = true;\n                scrollable.onTop(scope).then().finally(function() {\n                    scrollToY(0);\n                });\n            }\n\n            function doBottom(scope) {\n                if (busy) {\n                    return;\n                }\n                if (!scrollable.onBottom) {\n                    return;\n                }\n                busy = true;\n                scrollable.onBottom(scope).then().finally(function() {\n                    var bottom = container.height - content.height;\n                    if (bottom > overflow.height) {\n                        start.y = end.y = overflow.height;\n                    } else {\n                        start.y = end.y = overflow.height + padding;\n                    }\n                    scrollToY(0);\n                });\n            }\n\n            function renderY() {\n                var animating = true;\n                if (enabled) {\n                    overflow.y = 0;\n                    overflow.height = container.height - content.height;\n                    if (dragging) {\n                        end.y = start.y + move.y - down.y;\n                        if (extendY()) {\n                            start.y = end.y;\n                            down.y = move.y;\n                        }\n                    } else if (speed.y) {\n                        end.y += speed.y;\n                        speed.y *= 0.75;\n                        if (wheeling) {\n                            extendY();\n                        }\n                        if (Math.abs(speed.y) < 2.05) {\n                            speed.y = 0;\n                            scrollable.wheeling = wheeling = false;\n                            snapToNearestY();\n                        }\n                    } else if (offset) {\n                        end.y = -offset.y;\n                        offset = null;\n                    }\n                    end.y = Math.round(end.y * 10000) / 10000;\n                    end.y = Math.min(overflow.y, end.y);\n                    end.y = Math.max(overflow.height, end.y);\n                    current.y += (end.y - current.y) / 4;\n                    if (speed.y === 0 && Math.abs(end.y - current.y) < 0.05) {\n                        current.y = end.y;\n                        if (!snapToNearestY()) {\n                            animating = false;\n                        }\n                    }\n                    // console.log(parseFloat(current.y.toFixed(6)), end.y, overflow.y);\n                    // console.log(dragging, wheeling, end.y, speed.y, Math.abs(end.y - current.y));\n                } else {\n                    current.y = end.y = 0;\n                    animating = false;\n                }\n                return animating;\n            }\n\n            function extendY() {\n                var extending = false;\n                overflow.y += padding;\n                overflow.height -= padding;\n                if (end.y > overflow.y) {\n                    extending = true;\n                    doTop();\n                } else if (end.y < overflow.height) {\n                    extending = true;\n                    doBottom();\n                }\n                return extending;\n            }\n\n            function snapToNearestY() {\n                var items = scrollable.getItems();\n                if (items) {\n                    var index = -1;\n                    var min = Number.POSITIVE_INFINITY;\n                    angular.forEach(items, function(item, i) {\n                        var distance = Math.abs((end.y + speed.y) - (item.offsetTop * -1));\n                        if (distance < min) {\n                            min = distance;\n                            index = i;\n                        }\n                    });\n                    // console.log('snapToNearestY', index, min);\n                    if (index !== -1) {\n                        if (snappable) {\n                            return scrollToIndex(index);\n                        } else {\n                            currentIndex = index;\n                        }\n                    }\n                }\n            }\n\n            function wheelYCheck(dir) {\n                // console.log('wheelYCheck', dir < 0 ? (end.y - overflow.height) : (end.y - overflow.y));\n                if (!busy && enabled) {\n                    if (dir < 0) {\n                        return end.y - overflow.height;\n                    } else {\n                        return end.y - overflow.y;\n                    }\n                } else {\n                    return false;\n                }\n            }\n\n            function wheelY(dir, interval) {\n                end.y += dir * 100 / 1000 * interval;\n                speed.y += dir * 100 / 1000 * interval;\n                wheeling = true;\n            }\n\n            function scrollToY(value) {\n                start.y = end.y = value;\n                setTimeout(function() {\n                    off();\n                    busy = false;\n                }, 500);\n            }\n\n        }\n\n        function link(methods) {\n            angular.extend(this, methods);\n        }\n\n        Scrollable.prototype = {\n            link: link,\n            getItems: function() {\n                return [content];\n            },\n        };\n        return Scrollable;\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('videoSource', ['$timeout', '$promise', function ($timeout, $promise) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\tscope: {\n\t\t\t\tsource: '=videoSource',\n\t\t\t\timage: '=videoImage',\n\t\t\t},\n\t\t\ttemplateUrl: function (element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/components/video/partial/video-player';\n\t\t\t},\n\t\t\tlink: VideoSourceLink\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction VideoSourceLink(scope, element, attributes) {\n\n\t\t\tvar native = element[0];\n\t\t\tvar video = native.querySelector('video');\n\t\t\tvar img = native.querySelector('img');\n\t\t\tvar infos = {};\n\t\t\tscope.canplay = false;\n\t\t\tscope.playing = false;\n\t\t\tscope.busy = false;\n\t\t\tscope.toggle = toggle;\n\t\t\tscope.play = play;\n\t\t\tscope.pause = pause;\n\t\t\tscope.infos = infos;\n\n\t\t\t// loop><source src=\"{{source}}\" type=\"video/mp4\"\n\n\t\t\tfunction canplay() {\n\t\t\t\treturn $promise(function (promise) {\n\n\t\t\t\t\tfunction _onCanPlay(e) {\n\t\t\t\t\t\tscope.canplay = true;\n\t\t\t\t\t\tangular.element(video).off('canplay', _onCanPlay);\n\t\t\t\t\t\t// console.log('videoSource._onCanPlay', e);\n\t\t\t\t\t\tpromise.resolve();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (scope.canplay) {\n\t\t\t\t\t\tpromise.resolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tangular.element(video).on('canplay', _onCanPlay);\n\t\t\t\t\t\tvideo.preload = true;\n\t\t\t\t\t\tvideo.src = scope.source;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction toggle() {\n\t\t\t\tif (!scope.busy) {\n\t\t\t\t\tscope.busy = true;\n\t\t\t\t\tif (scope.playing) {\n\t\t\t\t\t\tvideo.pause();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcanplay().then(function () {\n\t\t\t\t\t\t\tvideo.play();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction play() {\n\t\t\t\tif (!scope.busy) {\n\t\t\t\t\tscope.busy = true;\n\t\t\t\t\tcanplay().then(function () {\n\t\t\t\t\t\tvideo.play();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction pause() {\n\t\t\t\tif (!scope.busy) {\n\t\t\t\t\tscope.busy = true;\n\t\t\t\t\tvideo.pause();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onCanPlay(e) {\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tscope.canplay = true;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onPlaying(e) {\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tscope.playing = true;\n\t\t\t\t\tscope.busy = false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onPause(e) {\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tscope.playing = false;\n\t\t\t\t\tscope.busy = false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onEnded(e) {\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tscope.playing = false;\n\t\t\t\t\tscope.busy = false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onProgress(e) {\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tinfos.buffered = video.buffered; // todo: TimeRanges\n\t\t\t\t\t// console.log('onProgress', infos);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onTimeUpdate(e) {\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tinfos.duration = video.duration;\n\t\t\t\t\tinfos.currentTime = video.currentTime;\n\t\t\t\t\tinfos.progressTime = infos.currentTime / infos.duration;\n\t\t\t\t\t// console.log('onTimeUpdate', infos);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar videoElement = angular.element(video);\n\n\t\t\tfunction addListeners() {\n\t\t\t\t// videoElement.on('canplay', onCanPlay);\n\t\t\t\tvideoElement.on('playing', onPlaying);\n\t\t\t\tvideoElement.on('pause', onPause);\n\t\t\t\tvideoElement.on('ended', onEnded);\n\t\t\t\tvideoElement.on('progress', onProgress);\n\t\t\t\tvideoElement.on('timeupdate', onTimeUpdate);\n\t\t\t}\n\n\t\t\tfunction removeListeners() {\n\t\t\t\t// videoElement.off('canplay', onCanPlay);\n\t\t\t\tvideoElement.off('playing', onPlaying);\n\t\t\t\tvideoElement.off('pause', onPause);\n\t\t\t\tvideoElement.off('ended', onEnded);\n\t\t\t\tvideoElement.off('progress', onProgress);\n\t\t\t\tvideoElement.off('timeupdate', onTimeUpdate);\n\t\t\t}\n\n\t\t\taddListeners();\n\t\t\tscope.$on('destroy', function () {\n\t\t\t\tremoveListeners();\n\t\t\t});\n\n\t\t}\n\n    }]);\n\n\t/*\n\tObject.defineProperty(HTMLMediaElement.prototype, 'playing', {\n\t    get: function () {\n\t        return !!(this.currentTime > 0 && !this.paused && !this.ended && this.readyState > 2);\n\t    }\n\t});\n\t*/\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Animate', [function () {\n\n\t\tfunction Animate(callback) {\n\t\t\tthis.callback = callback;\n\t\t\tthis.key = null;\n\t\t\tthis.ticks = 0;\n\t\t}\n\n\t\tvar statics = {};\n\n\t\tvar publics = {\n\t\t\tpause: pause,\n\t\t\tplay: play,\n\t\t\ttoggle: toggle,\n\t\t};\n\n\t\tangular.extend(Animate, statics);\n\t\tangular.extend(Animate.prototype, publics);\n\n\t\treturn Animate;\n\n\t\t// static methods\n\n\t\t// prototype methods\n\n\t\tfunction pause() {\n\t\t\tvar animate = this;\n\t\t\tif (animate.key) {\n\t\t\t\twindow.cancelAnimationFrame(animate.key);\n\t\t\t\tanimate.key = null;\n\t\t\t}\n\t\t}\n\n\t\tfunction play() {\n\t\t\tvar animate = this;\n\n\t\t\tfunction loop(time) {\n\t\t\t\tanimate.ticks++;\n\t\t\t\tanimate.callback(time, animate.ticks);\n\t\t\t\tanimate.key = window.requestAnimationFrame(loop);\n\t\t\t}\n\t\t\tif (!animate.key) {\n\t\t\t\tloop();\n\t\t\t}\n\t\t}\n\n\t\tfunction toggle() {\n\t\t\tvar animate = this;\n\t\t\tif (animate.key) {\n\t\t\t\tanimate.pause();\n\t\t\t} else {\n\t\t\t\tanimate.play();\n\t\t\t}\n\t\t}\n\n    }]);\n\n\t(function () {\n\t\tvar lastTime = 0;\n\t\tvar vendors = ['ms', 'moz', 'webkit', 'o'];\n\t\tfor (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n\t\t\twindow.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n\t\t\twindow.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||\n\t\t\t\twindow[vendors[x] + 'CancelRequestAnimationFrame'];\n\t\t}\n\t\tif (!window.requestAnimationFrame) {\n\t\t\twindow.requestAnimationFrame = function (callback, element) {\n\t\t\t\tvar currTime = new Date().getTime();\n\t\t\t\tvar timeToCall = Math.max(0, 16 - (currTime - lastTime));\n\t\t\t\tvar id = window.setTimeout(function () {\n\t\t\t\t\tcallback(currTime + timeToCall);\n\t\t\t\t}, timeToCall);\n\t\t\t\tlastTime = currTime + timeToCall;\n\t\t\t\treturn id;\n\t\t\t};\n\t\t}\n\t\tif (!window.cancelAnimationFrame) {\n\t\t\twindow.cancelAnimationFrame = function (id) {\n\t\t\t\tclearTimeout(id);\n\t\t\t};\n\t\t}\n\t}());\n\n}());\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('calendarPopupRecords', ['$templateCache', '$parse', '$q', '$timeout', '$filter', 'Hash', 'DateTime', 'Range', 'CalendarFactory', 'State', 'Api', function ($templateCache, $parse, $q, $timeout, $filter, Hash, DateTime, Range, CalendarFactory, State, Api) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplate: function (element, attributes) {\n\t\t\t\treturn '<div calendar-popup=\"options\"></div>';\n\t\t\t},\n\t\t\trequire: 'ngModel',\n\t\t\tscope: {\n\t\t\t\tuser: '=calendarUser',\n\t\t\t},\n\t\t\tlink: function (scope, element, attributes, model, transclude) {\n\n\t\t\t\tvar user = scope.user;\n\n\t\t\t\tvar state = new State();\n\n\t\t\t\tvar options = {\n\t\t\t\t\tonMonthDidChange: onMonthDidChange,\n\t\t\t\t\tonWeekDidSelect: onWeekDidSelect,\n\t\t\t\t\tonDayDidSelect: onDayDidSelect,\n\t\t\t\t};\n\n\t\t\t\tvar sources = {};\n\n\t\t\t\tvar publics = {\n\t\t\t\t\t// user: user,\n\t\t\t\t\tstate: state,\n\t\t\t\t\toptions: options,\n\t\t\t\t\t// sources: sources,\n\t\t\t\t};\n\n\t\t\t\tangular.extend(scope, publics);\n\n\t\t\t\tvar currentDay = Range.Day();\n\n\t\t\t\tstate.busy();\n\t\t\t\t$q.all([\n                    Api.gantt.resources.actives().then(function success(response) {\n\t\t\t\t\t\tsetResources(response);\n\t\t\t\t\t}),\n\n                ]).then(function success(response) {\n\t\t\t\t\tstate.ready();\n\n\t\t\t\t}, function error(error) {\n\t\t\t\t\tstate.error(error);\n\t\t\t\t\t// console.log('calendarPopup.error', error);\n\n\t\t\t\t});\n\n\t\t\t\tfunction onMonthDidChange(date, month, calendar) {\n\t\t\t\t\tvar deferred = $q.defer();\n\t\t\t\t\t// console.log('calendarPopupRecords.onMonthDidChange', month.toString());\n\t\t\t\t\tGetMonthRecords(month).then(function () {\n\t\t\t\t\t\tsetAbsencesAndOvertimes();\n\t\t\t\t\t\tupdateCalendar(date, month, calendar);\n\t\t\t\t\t\tdeferred.resolve(getFirstWorkingDate(date, month, calendar));\n\n\t\t\t\t\t}, function () {\n\t\t\t\t\t\tdeferred.reject();\n\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction GetMonthRecords(month) {\n\t\t\t\t\tvar deferred = $q.defer();\n\t\t\t\t\tvar monthExpanded = Range.expand(month, DateTime.DAY * 7);\n\t\t\t\t\t// console.log('calendarPopupRecords.GetMonthRecords', monthExpanded.toString());\n\t\t\t\t\t$q.all([\n                        Api.gantt.absencesAndOvertimes(monthExpanded.getParams()).then(function success(response) {\n\t\t\t\t\t\t\tsources.absencesAndOvertimes = response;\n\t\t\t\t\t\t}),\n                        Api.gantt.calendar(monthExpanded.getParams()).then(function success(response) {\n\t\t\t\t\t\t\tvar unworkings = {};\n\t\t\t\t\t\t\tangular.forEach(response, function (item) {\n\t\t\t\t\t\t\t\tunworkings[item.key] = item;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tsources.unworkings = unworkings;\n\t\t\t\t\t\t\tsources.calendar = response;\n\t\t\t\t\t\t}),\n                        /*\n                        Api.gantt.planning.full(user.id, monthExpanded.getParams()).then(function (rows) {\n                            sources.monthSlots = rows.map(function (row) {\n                                row.day.date = new Date(row.day.date);\n                                return row;\n                            });\n                        }),\n                        */\n                        Api.gantt.records(user.id, monthExpanded.getParams()).then(function (rows) {\n\t\t\t\t\t\t\tsources.monthRecords = rows.map(function (row) {\n\t\t\t\t\t\t\t\trow.state = new State();\n\t\t\t\t\t\t\t\trow.record.date = new Date(row.record.date);\n\t\t\t\t\t\t\t\treturn row;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}),\n\n                    ]).then(function (response) {\n\t\t\t\t\t\t// state.success();\n\t\t\t\t\t\tdeferred.resolve();\n\n\t\t\t\t\t}, function (error) {\n\t\t\t\t\t\t// state.error(error);\n\t\t\t\t\t\tdeferred.reject();\n\n\t\t\t\t\t});\n\t\t\t\t\treturn deferred.promise;\n\t\t\t\t}\n\n\t\t\t\tfunction onWeekDidSelect(week, month, calendar) {\n\t\t\t\t\t// console.log('calendarPopupRecords.onWeekDidSelect', month.toString());\n\t\t\t\t\t// var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tfunction onDayDidSelect(day, month, calendar) {\n\t\t\t\t\t// var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n\t\t\t\t\tif (!day || currentDay.isBefore(day.date)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// console.log('calendarPopupRecords.onDayDidSelect', day, day.working, day.date);\n\t\t\t\t\tif (day && day.working) {\n\t\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t\tmodel.$setViewValue(day.date);\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction updateCalendar(date, month, calendar) {\n\t\t\t\t\tvar resource = sources.resource;\n\t\t\t\t\tvar monthRecords = sources.monthRecords;\n\t\t\t\t\tif (!monthRecords) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tcalendar.days.each(function (day) {\n\t\t\t\t\t\tvar availableHours = 0;\n\t\t\t\t\t\tif (day.working) {\n\t\t\t\t\t\t\tavailableHours += resource.baseHours;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar ao = resource.absencesAndOvertimes[day.key];\n\t\t\t\t\t\tif (ao) {\n\t\t\t\t\t\t\tavailableHours += ao.hours;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tday.availableHours = availableHours;\n\t\t\t\t\t\tday.recordedHours = 0;\n\t\t\t\t\t\t//\n\t\t\t\t\t\tvar has = availableHours > 0;\n\t\t\t\t\t\tday.working = !sources.unworkings[day.key];\n\t\t\t\t\t\tday.holiday = !day.working && !has && !day.weekend;\n\t\t\t\t\t\tday.vacation = day.working && !has;\n\t\t\t\t\t\tday.wasVacation = day.vacation && day.past;\n\t\t\t\t\t\tday.wasWorkable = day.working && day.past && has;\n\t\t\t\t\t\tday.workable = day.working && !day.past && has;\n\t\t\t\t\t});\n\t\t\t\t\tangular.forEach(monthRecords, function (row) {\n\t\t\t\t\t\tvar day = calendar.days.get(row.record.key);\n\t\t\t\t\t\tif (day) {\n\t\t\t\t\t\t\tday.recordedHours += row.record.hours;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tcalendar.days.each(function (day) {\n\t\t\t\t\t\tday.green = day.working && !currentDay.isBefore(day.date) && day.recordedHours >= 8;\n\t\t\t\t\t\tday.orange = day.working && !currentDay.isBefore(day.date) && day.recordedHours < 8;\n\t\t\t\t\t\t// day.full = day.workable && day.hours >= day.availableHours;\n\t\t\t\t\t\t// day.available = day.workable && day.hours < day.availableHours;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction setResources(resources) {\n\t\t\t\t\tsources.resources = resources;\n\t\t\t\t\tangular.forEach(resources, function (resource) {\n\t\t\t\t\t\tresource.absencesAndOvertimes = {};\n\t\t\t\t\t\tif (resource.id === user.id) {\n\t\t\t\t\t\t\tsources.resource = resource;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction setAbsencesAndOvertimes() {\n\t\t\t\t\tvar resource = sources.resource;\n\t\t\t\t\tif (!resource) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// assegno assenze e straordinari alla risorsa\n\t\t\t\t\tresource.absencesAndOvertimes = {};\n\t\t\t\t\tangular.forEach(sources.absencesAndOvertimes, function (item) {\n\t\t\t\t\t\tif (resource.id === item.resourceId) {\n\t\t\t\t\t\t\tresource.absencesAndOvertimes[item.key] = item;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction getFirstWorkingDate(date, month, calendar) {\n\t\t\t\t\t// console.log('calendarPopupRecords.getFirstWorkingDate', date);\n\t\t\t\t\tvar firstWorkingDate = null;\n\n\t\t\t\t\tfunction setFirstDay() {\n\t\t\t\t\t\tcalendar.days.forward();\n\t\t\t\t\t\tcalendar.days.each(function (day) {\n\t\t\t\t\t\t\tif (!firstWorkingDate && !month.isOutside(day.date) && day.working && !day.vacation) {\n\t\t\t\t\t\t\t\t// console.log('check', day.working, day.vacation, day.date);\n\t\t\t\t\t\t\t\tfirstWorkingDate = day.date;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// console.log('setFirstDay', firstWorkingDate);\n\t\t\t\t\t}\n\t\t\t\t\tif (date) {\n\t\t\t\t\t\tvar key = CalendarFactory.getKey(date);\n\t\t\t\t\t\tvar day = calendar.days.get(key);\n\t\t\t\t\t\t// console.log('getFirstWorkingDate', day.working, day.vacation, date);\n\t\t\t\t\t\tif (day && day.working && !day.vacation) {\n\t\t\t\t\t\t\tfirstWorkingDate = date;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetFirstDay();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetFirstDay();\n\t\t\t\t\t}\n\t\t\t\t\treturn firstWorkingDate;\n\t\t\t\t}\n\n\t\t\t}\n\t\t};\n    }]);\n\n\tapp.directive('calendarPopup', ['$templateCache', '$parse', '$q', '$timeout', '$filter', 'Hash', 'DateTime', 'Range', 'CalendarFactory', 'State', 'Api', function ($templateCache, $parse, $q, $timeout, $filter, Hash, DateTime, Range, CalendarFactory, State, Api) {\n\n\t\treturn {\n\t\t\tpriority: 1002,\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: TemplateUrl,\n\t\t\tscope: {\n\t\t\t\toptions: '=calendarPopup',\n\t\t\t},\n\t\t\tlink: Link,\n\t\t};\n\n\t\tfunction TemplateUrl(element, attributes) {\n\t\t\tvar url = attributes.template;\n\t\t\tif (!url) {\n\t\t\t\turl = 'partials/calendar/popup';\n\t\t\t\tif (!$templateCache.get(url)) {\n\t\t\t\t\t$templateCache.put(url, '<div><json-formatter json=\"item\"></json-formatter></div>');\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn url;\n\t\t}\n\n\t\tfunction Link(scope, element, attributes, model, transclude) {\n\n\t\t\tvar calendar = new CalendarFactory();\n\n\t\t\tvar options = scope.options || {\n\t\t\t\tonMonthDidChange: function () {},\n\t\t\t\tonWeekDidSelect: function () {},\n\t\t\t\tonDayDidSelect: function () {},\n\t\t\t};\n\n\t\t\tvar month = Range.Month();\n\t\t\tvar week = Range.Week();\n\t\t\tvar day = Range.Day();\n\n\t\t\tvar sources = {\n\t\t\t\tmonth: month,\n\t\t\t\tweek: week,\n\t\t\t\tday: day,\n\t\t\t};\n\n\t\t\tvar publics = {\n\t\t\t\tsources: sources,\n\t\t\t\tdoNavMonth: doNavMonth,\n\t\t\t\tonWeekSelect: onWeekSelect,\n\t\t\t\tonDaySelect: onDaySelect,\n\t\t\t\tgetDayClasses: getDayClasses,\n\t\t\t};\n\n\t\t\tangular.extend(scope, publics);\n\n\t\t\t// console.log('scope', scope);\n\n\t\t\tsetMonth(); // Init\n\n\t\t\tfunction setMonth(date) {\n\t\t\t\tif (!date || month.isOutside(date)) {\n\t\t\t\t\tif (date) {\n\t\t\t\t\t\tmonth.setDate(date);\n\t\t\t\t\t}\n\t\t\t\t\tonMonthChange(date);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onMonthChange(date) {\n\t\t\t\tvar calendarMonth = calendar.getMonthByDate(month.getDate());\n\t\t\t\tcalendarMonth.days.each(function (day) {\n\t\t\t\t\tvar d = day.date.getDay();\n\t\t\t\t\tday.dirty = true;\n\t\t\t\t\tday.hours = 0;\n\t\t\t\t\tday.availableHours = 0;\n\t\t\t\t\tday.recordedHours = 0;\n\t\t\t\t\tday.selected = sources.day.isCurrent(day.date);\n\t\t\t\t\tday.past = day.key < Range.today.key;\n\t\t\t\t\tday.weekend = d === 0 || d === 6;\n\t\t\t\t\tday.working = !day.weekend;\n\t\t\t\t\t// reset\n\t\t\t\t\tday.holiday = false;\n\t\t\t\t\tday.vacation = false;\n\t\t\t\t\tday.wasVacation = false;\n\t\t\t\t\tday.wasWorkable = false;\n\t\t\t\t\tday.workable = false;\n\t\t\t\t\tday.green = false;\n\t\t\t\t\tday.orange = false;\n\t\t\t\t});\n\t\t\t\tsources.calendarMonth = calendarMonth;\n\t\t\t\t// console.log('calendarPopup.onMonthChange', calendarMonth);\n\t\t\t\toptions.onMonthDidChange(date, month, calendarMonth);\n\t\t\t}\n\n\t\t\tfunction onWeekSelect(week) {\n\t\t\t\t// console.log('onWeekSelect', week);\n\t\t\t\tif (!week) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (options.onWeekDidSelect(week, month, sources.calendarMonth) === true) {\n\t\t\t\t\t// sources.week.setDate(week.date);\n\t\t\t\t\t// updateSelections();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onDaySelect(day) {\n\t\t\t\t// console.log('onDaySelect', day);\n\t\t\t\tif (!day) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (options.onDayDidSelect(day, month, sources.calendarMonth) === true) {\n\t\t\t\t\tsources.day.setDate(day.date);\n\t\t\t\t\tupdateSelections();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction updateSelections() {\n\t\t\t\tvar calendarMonth = sources.calendarMonth;\n\t\t\t\tcalendarMonth.days.each(function (day) {\n\t\t\t\t\tday.selected = sources.day.isCurrent(day.date);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction doNavMonth(dir) {\n\t\t\t\t// console.log('doNavMonth', dir);\n\t\t\t\tsetMonth(month.getDate(dir));\n\t\t\t}\n\n\t\t\tfunction getDayClasses(day) {\n\t\t\t\tvar classes = {\n\t\t\t\t\t'day': day,\n\t\t\t\t};\n\t\t\t\tif (day) {\n\t\t\t\t\tangular.extend(classes, {\n\t\t\t\t\t\t'today': day.$today,\n\t\t\t\t\t\t'selected': day.selected,\n\t\t\t\t\t\t'workable': day.workable,\n\t\t\t\t\t\t'holiday': day.holiday,\n\t\t\t\t\t\t'vacation': day.vacation,\n\t\t\t\t\t\t'working': day.working,\n\t\t\t\t\t\t'available': day.available,\n\t\t\t\t\t\t'full': day.full,\n\t\t\t\t\t\t'status-green': day.green,\n\t\t\t\t\t\t'status-orange': day.orange,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn classes;\n\t\t\t}\n\n\t\t}\n\n    }]);\n\n}());\n\n/*\n\n(function () {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n    \n    app.directive('calendarPopupRecords', ['$templateCache', '$parse', '$q', '$timeout', '$filter', 'Hash', 'DateTime', 'Range', 'CalendarFactory', 'State', 'Api', function ($templateCache, $parse, $q, $timeout, $filter, Hash, DateTime, Range, CalendarFactory, State, Api) {\n        return {\n            restrict: 'A',\n            template: function (element, attributes) {\n                return '<div calendar-popup=\"options\"></div>';\n            },\n            require: 'ngModel',\n            scope: {\n                user: '=calendarUser',\n            },\n            link: CalendarPopupLink,\n        };\n\n        function CalendarPopupLink(scope, element, attributes, model, transclude) {\n            console.log('calendarPopupRecords.link');\n\n            var user = scope.user;\n\n            var state = new State();\n\n            var options = {\n                onMonthDidChange: onMonthDidChange,\n                onWeekDidSelect: onWeekDidSelect,\n                onDayDidSelect: onDayDidSelect,\n            };\n\n            var sources = {};\n\n            var publics = {\n                // user: user,\n                state: state,\n                options: options,\n                // sources: sources,\n            };\n\n            angular.extend(scope, publics);\n\n            var currentDay = new Range({ type: Range.types.DAY });\n\n            function loadResources() {\n                var deferred = $q.defer();\n                if (sources.resources) {\n                    deferred.resolve();\n                } else {\n                    Api.gantt.resources.actives().then(function success(response) {\n                        setResources(response);\n                        deferred.resolve();\n                    }, function (error) {\n                        deferred.reject();\n                    });\n                }\n                return deferred.promise;\n            }\n\n            function getFirstWorkingDate(date, month, calendar) {\n                // console.log('calendarPopupRecords.getFirstWorkingDate', date);\n                var firstWorkingDate = null;\n                function setFirstDay() {\n                    calendar.days.forward();\n                    calendar.days.each(function (day) {\n                        if (!firstWorkingDate && !month.isOutside(day.date) && day.working && !day.vacation) {\n                            // console.log('check', day.working, day.vacation, day.date);\n                            firstWorkingDate = day.date;\n                        }\n                    });\n                    // console.log('setFirstDay', firstWorkingDate);\n                }\n                if (date) {\n                    var key = CalendarFactory.getKey(date);\n                    var day = calendar.days.get(key);\n                    // console.log('getFirstWorkingDate', day.working, day.vacation, date);\n                    if (day && day.working && !day.vacation) {\n                        firstWorkingDate = date;\n                    } else {\n                        setFirstDay();\n                    }\n                } else {\n                    setFirstDay();\n                }\n                return firstWorkingDate;\n            }\n\n            function getMonthRecords(month) {\n                var deferred = $q.defer();\n                var user = scope.user;\n                var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n                // console.log('calendarPopupRecords.getMonthRecords', monthExpanded.toString());\n                $q.all([\n                    loadResources(),\n                    Api.gantt.absencesAndOvertimes(monthExpanded.getParams()).then(function success(response) {\n                        sources.absencesAndOvertimes = response;\n                    }),\n                    Api.gantt.calendar(monthExpanded.getParams()).then(function success(response) {\n                        var unworkings = {};\n                        angular.forEach(response, function (item) {\n                            unworkings[item.key] = item;\n                        });\n                        sources.unworkings = unworkings;\n                        sources.calendar = response;\n                    }),\n                    Api.gantt.records(user.id, monthExpanded.getParams()).then(function (rows) {\n                        sources.monthRecords = rows.map(function (row) {\n                            row.state = new State();\n                            row.record.date = new Date(row.record.date);\n                            return row;\n                        });\n                    }),\n\n                ]).then(function (response) {\n                    // state.success();\n                    deferred.resolve();\n\n                }, function (error) {\n                    // state.error(error);\n                    deferred.reject();\n\n                });\n                return deferred.promise;\n            }\n\n            function onDayDidSelect(day, month, calendar) {\n                // var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n                if (!day || currentDay.isBefore(day.date)) {\n                    return;\n                }\n                // console.log('calendarPopupRecords.onDayDidSelect', day, day.working, day.date);\n                if (day && day.working) {\n                    $timeout(function () {\n                        model.$setViewValue(day.date);\n                    });\n                    return true;\n                }\n            }\n\n            function onMonthDidChange(date, month, calendar) {\n                var deferred = $q.defer();\n                console.log('calendarPopupRecords.onMonthDidChange', month.toString());\n                getMonthRecords(month).then(function () {\n                    setAbsencesAndOvertimes();\n                    updateCalendar(date, month, calendar);\n                    deferred.resolve(getFirstWorkingDate(date, month, calendar));\n\n                }, function () {\n                    deferred.reject();\n\n                });\n                return deferred.promise;\n            }\n\n            function onWeekDidSelect(week, month, calendar) {\n                // console.log('calendarPopupRecords.onWeekDidSelect', month.toString());\n                // var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n                return true;\n            }\n\n            function setAbsencesAndOvertimes() {\n                var resource = sources.resource;\n                if (!resource) {\n                    return;\n                }\n                // assegno assenze e straordinari alla risorsa\n                resource.absencesAndOvertimes = {};\n                angular.forEach(sources.absencesAndOvertimes, function (item) {\n                    if (resource.id === item.resourceId) {\n                        resource.absencesAndOvertimes[item.key] = item;\n                    }\n                });\n            }\n\n            function setResources(resources) {\n                var user = scope.user;\n                sources.resources = resources;\n                console.log('calendarPopupRecords.setResources', resources.length, user);\n                angular.forEach(resources, function (resource) {\n                    resource.absencesAndOvertimes = {};\n                    if (resource.id === user.id) {\n                        sources.resource = resource;\n                        // console.log('calendarPopupRecords.setResources.resource', resource);\n                    }\n                });\n            }\n\n            function setWorkableDay(day) {\n                var resource = sources.resource;\n                day.working = !sources.unworkings[day.key];\n                var availableHours = 0;\n                if (resource) {\n                    if (day.working) {\n                        availableHours += resource.baseHours;\n                    }\n                    var ao = resource.absencesAndOvertimes[day.key];\n                    if (ao) {\n                        availableHours += ao.hours;\n                    }\n                } else if (day.working) {\n                    availableHours += 8;\n                }\n                var has = availableHours > 0;\n                day.availableHours = availableHours;\n                day.recordedHours = 0;\n                day.holiday = !day.working && !has && !day.weekend;\n                day.vacation = day.working && !has;\n                day.wasVacation = day.vacation && day.past;\n                day.workable = day.working && !day.past && has;\n                day.wasWorkable = day.working && day.past && has;\n            }\n\n            function updateCalendar(date, month, calendar) {\n                calendar.days.each(function (day) {\n                    setWorkableDay(day);\n                });\n            }\n\n            function updateCalendar(date, month, calendar) {                \n                calendar.days.each(function (day) {\n                    setWorkableDay(day);\n                });\n                var monthRecords = sources.monthRecords;\n                if (monthRecords) {\n                    angular.forEach(monthRecords, function (row) {\n                        var day = calendar.days.get(row.record.key);\n                        if (day) {\n                            day.recordedHours += row.record.hours;\n                        }\n                    });\n                    calendar.days.each(function (day) {\n                        day.green = day.working && !currentDay.isBefore(day.date) && day.recordedHours >= 8;\n                        day.orange = day.working && !currentDay.isBefore(day.date) && day.recordedHours < 8;\n                        // day.full = day.workable && day.hours >= day.availableHours;\n                        // day.available = day.workable && day.hours < day.availableHours;\n                    });\n                }\n            }\n\n        }\n    }]);\n\n    app.directive('calendarPopupWorkables', ['$templateCache', '$parse', '$q', '$timeout', '$filter', 'Hash', 'DateTime', 'Range', 'CalendarFactory', 'State', 'Api', function ($templateCache, $parse, $q, $timeout, $filter, Hash, DateTime, Range, CalendarFactory, State, Api) {\n        return {\n            restrict: 'A',\n            template: function (element, attributes) {\n                return '<div calendar-popup=\"options\" template=\"partials/calendar/popup/workables\"></div>';\n            },\n            require: 'ngModel',\n            scope: {\n                user: '=?calendarUser',\n            },\n            link: CalendarPopupLink,\n        };\n\n        function CalendarPopupLink(scope, element, attributes, model, transclude) {\n            console.log('calendarPopupWorkables.link');\n\n            var user = scope.user;\n\n            var state = new State();\n\n            var options = {\n                onMonthDidChange: onMonthDidChange,\n                onWeekDidSelect: onWeekDidSelect,\n                onDayDidSelect: onDayDidSelect,\n            };\n\n            var sources = {};\n\n            var publics = {\n                state: state,\n                options: options,\n            };\n\n            angular.extend(scope, publics);\n\n            var currentDay = new Range({ type: Range.types.DAY });\n\n            function getFirstWorkingDate(date, month, calendar) {\n                var firstWorkingDate = null;\n                function setFirstDay() {\n                    calendar.days.forward();\n                    calendar.days.each(function (day) {\n                        if (!firstWorkingDate && !month.isOutside(day.date) && day.working && !day.vacation) {\n                            firstWorkingDate = day.date;\n                        }\n                    });\n                }\n                if (date) {\n                    var key = CalendarFactory.getKey(date);\n                    var day = calendar.days.get(key);\n                    if (day && day.working && !day.vacation) {\n                        firstWorkingDate = date;\n                    } else {\n                        setFirstDay();\n                    }\n                } else {\n                    setFirstDay();\n                }\n                return firstWorkingDate;\n            }\n\n            function loadResources(monthExpanded) {\n                var deferred = $q.defer();\n                if (sources.resources) {\n                    deferred.resolve();\n                } else {\n                    Api.gantt.resources.actives().then(function success(response) {\n                        setResources(response);\n                        deferred.resolve();\n                    }, function (error) {\n                        deferred.reject();\n                    });\n                }\n                return deferred.promise;\n            }\n\n            function loadAbsencesAndOvertimes(monthExpanded) {\n                return Api.gantt.absencesAndOvertimes(monthExpanded.getParams()).then(function success(response) {\n                    sources.absencesAndOvertimes = response;\n                });\n            }\n\n            function loadCalendar(monthExpanded) {\n                return Api.gantt.calendar(monthExpanded.getParams()).then(function success(response) {\n                    var unworkings = {};\n                    angular.forEach(response, function (item) {\n                        unworkings[item.key] = item;\n                    });\n                    sources.unworkings = unworkings;\n                    sources.calendar = response;\n                })\n            }\n\n            function getMonthRecords(month) {\n                var deferred = $q.defer();\n                var user = scope.user;\n                var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n                var promises;\n                if (user) {\n                    promises = [loadResources(monthExpanded), loadAbsencesAndOvertimes(monthExpanded), loadCalendar(monthExpanded)];\n                } else {\n                    promises = [loadCalendar(monthExpanded)];\n                }\n                $q.all(promises).then(function (response) {\n                    deferred.resolve();\n\n                }, function (error) {\n                    deferred.reject();\n\n                });\n                return deferred.promise;\n            }\n\n            function onDayDidSelect(day, month, calendar) {\n                if (!day) { // || currentDay.isBefore(day.date)) {\n                    return;\n                }\n                if (day && day.working) {\n                    $timeout(function () {\n                        model.$setViewValue(day.date);\n                    });\n                    return true;\n                }\n            }\n\n            function onMonthDidChange(date, month, calendar) {\n                var deferred = $q.defer();\n                console.log('calendarPopupRecords.onMonthDidChange', month.toString());\n                getMonthRecords(month).then(function () {\n                    setAbsencesAndOvertimes();\n                    updateCalendar(date, month, calendar);\n                    deferred.resolve(getFirstWorkingDate(date, month, calendar));\n\n                }, function () {\n                    deferred.reject();\n\n                });\n                return deferred.promise;\n            }\n\n            function onWeekDidSelect(week, month, calendar) {\n                // console.log('calendarPopupRecords.onWeekDidSelect', month.toString());\n                // var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n                return true;\n            }\n\n            function setAbsencesAndOvertimes() {\n                var resource = sources.resource;\n                if (!resource) {\n                    return;\n                }\n                // assegno assenze e straordinari alla risorsa\n                resource.absencesAndOvertimes = {};\n                angular.forEach(sources.absencesAndOvertimes, function (item) {\n                    if (resource.id === item.resourceId) {\n                        resource.absencesAndOvertimes[item.key] = item;\n                    }\n                });\n            }\n\n            function setResources(resources) {\n                var user = scope.user;\n                sources.resources = resources;\n                console.log('calendarPopupRecords.setResources', resources.length, user);\n                angular.forEach(resources, function (resource) {\n                    resource.absencesAndOvertimes = {};\n                    if (resource.id === user.id) {\n                        sources.resource = resource;\n                        // console.log('calendarPopupRecords.setResources.resource', resource);\n                    }\n                });\n            }\n\n            function setWorkableDay(day) {\n                var resource = sources.resource;\n                day.working = !sources.unworkings[day.key];\n                var availableHours = 0;\n                if (resource) {\n                    if (day.working) {\n                        availableHours += resource.baseHours;\n                    }\n                    var ao = resource.absencesAndOvertimes[day.key];\n                    if (ao) {\n                        availableHours += ao.hours;\n                    }\n                } else if (day.working) {\n                    availableHours += 8;\n                }\n                // console.log('setWorkableDay', day.key, 'day.working', day.working, 'availableHours', availableHours);\n                var has = availableHours > 0;\n                day.availableHours = availableHours;\n                day.recordedHours = 0;\n                day.holiday = !day.working && !has && !day.weekend;\n                day.vacation = day.working && !has;\n                day.wasVacation = day.vacation && day.past;\n                day.workable = day.working && !day.past && has;\n                day.wasWorkable = day.working && day.past && has;                \n            }\n\n            function updateCalendar(date, month, calendar) {\n                calendar.days.each(function (day) {\n                    setWorkableDay(day);\n                });\n            }\n\n        }\n    }]);\n\n    app.directive('calendarPopup', ['$templateCache', '$parse', '$q', '$timeout', '$filter', 'Hash', 'DateTime', 'Range', 'CalendarFactory', 'State', 'Api', function ($templateCache, $parse, $q, $timeout, $filter, Hash, DateTime, Range, CalendarFactory, State, Api) {\n        return {\n            restrict: 'A',\n            templateUrl: TemplateUrl,\n            scope: {\n                options: '=calendarPopup',\n            },\n            link: CalendarPopupLink,\n        }\n\n        function TemplateUrl(element, attributes) {\n            var url = attributes.template;\n            if (!url) {\n                url = 'partials/calendar/popup';\n                if (!$templateCache.get(url)) {\n                    $templateCache.put(url, '<div><json-formatter json=\"item\"></json-formatter></div>');\n                }\n            }\n            return url;\n        }\n\n        function CalendarPopupLink(scope, element, attributes, model, transclude) {\n            console.log('calendarPopup.link', scope.options);\n\n            var calendar = new CalendarFactory();\n\n            var options;\n\n            var month = new Range({ type: Range.types.MONTH });\n            var week = new Range({ type: Range.types.WEEK });\n            var day = new Range({ type: Range.types.DAY });\n\n            var sources = {\n                month: month,\n                week: week,\n                day: day,\n            };\n\n            var publics = {\n                sources: sources,\n                doNavMonth: doNavMonth,\n                onWeekSelect: onWeekSelect,\n                onDaySelect: onDaySelect,\n                getDayClasses: getDayClasses,\n            };\n\n            angular.extend(scope, publics);\n\n            // console.log('scope', scope);\n\n            scope.$watch('options', function (newValue) {\n                options = newValue;\n                options = options || {\n                    onMonthDidChange: function () {\n                        var deferred = $q.defer();\n                        deferred.resolve();\n                        return deferred.promise;\n                    },\n                    onWeekDidSelect: function () { },\n                    onDayDidSelect: function () { },\n                }\n                setMonth(); // Init\n            });\n\n            function setMonth(date) {\n                if (!date || month.isOutside(date)) {\n                    onMonthChange(date);\n                }\n            }\n\n            function onMonthChange(date) {\n                var calendarMonth = calendar.getMonthByDate(date); // month.getDate();\n                calendarMonth.days.each(function (day) {\n                    var d = day.date.getDay();\n                    day.dirty = true;\n                    day.hours = 0;\n                    day.availableHours = 0;\n                    day.recordedHours = 0;\n                    day.selected = sources.day.isCurrent(day.date);\n                    day.past = day.key < Range.today.key;\n                    day.weekend = d === 0 || d === 6;\n                    day.working = !day.weekend;\n                    // reset\n                    day.holiday = false;\n                    day.vacation = false;\n                    day.wasVacation = false;\n                    day.wasWorkable = false;\n                    day.workable = false;\n                    day.green = false;\n                    day.orange = false;\n                });\n                // console.log('calendarPopup.onMonthChange', calendarMonth);\n                options.onMonthDidChange(date, Range.currentMonth().setDate(date), calendarMonth).then(function () {\n                    date ? month.setDate(date) : null;\n                    sources.calendarMonth = calendarMonth;\n                    scope.$emit('onMonthDidChange', options);                    \n                });\n            }\n\n            function onWeekSelect(week) {\n                // console.log('onWeekSelect', week);\n                if (!week) {\n                    return;\n                }\n                if (options.onWeekDidSelect(week, month, sources.calendarMonth) === true) {\n                    // sources.week.setDate(week.date);\n                    // updateSelections();\n                    scope.$emit('onWeekDidSelect', options);\n                }\n            }\n\n            function onDaySelect(day) {\n                // console.log('onDaySelect', day);\n                if (!day) {\n                    return;\n                }\n                if (options.onDayDidSelect(day, month, sources.calendarMonth) === true) {\n                    sources.day.setDate(day.date);\n                    updateSelections();\n                    scope.$emit('onDayDidSelect', options);\n                }\n            }\n\n            function updateSelections() {\n                var calendarMonth = sources.calendarMonth;\n                calendarMonth.days.each(function (day) {\n                    day.selected = sources.day.isCurrent(day.date);\n                });\n            }\n\n            function doNavMonth(dir) {\n                // console.log('doNavMonth', dir);\n                setMonth(month.getDate(dir));\n            }\n\n            function getDayClasses(day) {\n                var classes = {\n                    'day': day,\n                }\n                if (day) {\n                    angular.extend(classes, {\n                        'today': day.$today,\n                        'selected': day.selected,\n                        'workable': day.workable,\n                        'holiday': day.holiday,\n                        'vacation': day.vacation,\n                        'working': day.working,\n                        'available': day.available,\n                        'full': day.full,\n                        'status-green': day.green,\n                        'status-orange': day.orange,\n                    });\n                }\n                return classes;\n            }\n\n        }\n\n    }]);\n\n}());\n\n*/\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Calendar', ['DateTime', 'Hash', function (DateTime, Hash) {\n\n\t\tvar service = this;\n\n\t\tvar days = new Hash('key');\n\t\tvar months = new Hash('mKey');\n\n\t\tvar statics = {\n\t\t\tgetDate: getDate,\n\t\t\tclearMonth: clearMonth,\n\t\t\tgetMonthByDate: getMonthByDate,\n\t\t\tgetMonths: getMonths,\n\t\t\tgetMonth: getMonth,\n\t\t\tgetDay: getDay,\n\t\t\tgetKey: getKey,\n\t\t\tdays: days,\n\t\t\tmonths: months,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tfunction getDate(day) {\n\t\t\tif (typeof day.date.getMonth === 'function') {\n\t\t\t\treturn day.date;\n\t\t\t} else {\n\t\t\t\treturn new Date(day.date);\n\t\t\t}\n\t\t}\n\n\t\tfunction clearMonth(month) {\n\t\t\tmonth.days.each(function (day) {\n\t\t\t\tif (day) {\n\t\t\t\t\tday.hours = 0;\n\t\t\t\t\tday.tasks = new Hash('id');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction getMonthByDate(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar yyyy = date.getFullYear();\n\t\t\tvar MM = date.getMonth();\n\t\t\tvar key = Math.ceil(date.getTime() / DateTime.DAY);\n\t\t\tvar mKey = yyyy * 12 + MM;\n\t\t\tvar month = months.get(mKey);\n\t\t\tif (!month) {\n\t\t\t\tvar fromDay = new Date(yyyy, MM, 1).getDay() - 1;\n\t\t\t\tfromDay = fromDay < 0 ? 6 : fromDay;\n\t\t\t\tvar monthDays = new Date(yyyy, MM + 1, 0).getDate();\n\t\t\t\tvar weeks = 6; // Math.ceil((fromDay + monthDays) / 7);\n\t\t\t\t// console.log('month', MM, 'weeks', weeks);\n\t\t\t\tmonth = {\n\t\t\t\t\tdate: date,\n\t\t\t\t\tmKey: mKey,\n\t\t\t\t\tmonth: MM,\n\t\t\t\t\tmonthDays: monthDays,\n\t\t\t\t\tfromDay: fromDay,\n\t\t\t\t\tdays: new Hash('key'),\n\t\t\t\t};\n\t\t\t\tmonth.weeks = new Array(weeks).fill().map(function (o, r) {\n\t\t\t\t\tvar days = new Array(7).fill().map(function (o, c) {\n\t\t\t\t\t\tvar item = null;\n\t\t\t\t\t\tvar d = r * 7 + c - fromDay;\n\t\t\t\t\t\tif (d >= 0 && d < monthDays) {\n\t\t\t\t\t\t\tvar date = new Date(yyyy, MM, d + 1);\n\t\t\t\t\t\t\tvar key = Math.ceil(date.getTime() / DateTime.DAY);\n\t\t\t\t\t\t\titem = {\n\t\t\t\t\t\t\t\t$today: key === DateTime.today.key,\n\t\t\t\t\t\t\t\tc: c,\n\t\t\t\t\t\t\t\tr: r,\n\t\t\t\t\t\t\t\td: d + 1,\n\t\t\t\t\t\t\t\tdate: date,\n\t\t\t\t\t\t\t\tkey: key,\n\t\t\t\t\t\t\t\thours: 0,\n\t\t\t\t\t\t\t\ttasks: new Hash('id'),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tservice.days.add(item);\n\t\t\t\t\t\t\titem = month.days.add(item);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn item;\n\t\t\t\t\t});\n\t\t\t\t\treturn {\n\t\t\t\t\t\tr: r,\n\t\t\t\t\t\tdate: new Date(yyyy, MM, r * 7 - fromDay + 1),\n\t\t\t\t\t\tdays: days,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\tmonth.getMonth = function (diff) {\n\t\t\t\t\tdiff = diff || 0;\n\t\t\t\t\treturn new Date(yyyy, MM + diff, 1);\n\t\t\t\t};\n\t\t\t\tmonth = months.add(month);\n\t\t\t}\n\t\t\treturn month;\n\t\t}\n\n\t\tfunction getMonths(num) {\n\t\t\tdays.removeAll();\n\t\t\tmonths.removeAll();\n\t\t\tvar i = 0;\n\t\t\twhile (i < num) {\n\t\t\t\tvar date = new Date();\n\t\t\t\tdate.setFullYear(DateTime.today.date.getFullYear());\n\t\t\t\tdate.setMonth(DateTime.today.date.getMonth() + i);\n\t\t\t\tdate.setDate(1);\n\t\t\t\tdate.setHours(0);\n\t\t\t\tdate.setMinutes(0);\n\t\t\t\tdate.setSeconds(0);\n\t\t\t\tvar month = getMonthByDate(date);\n\t\t\t\t// console.log('getMonths', month);\n\t\t\t\ti++;\n\t\t\t}\n\t\t\t// console.log('getMonths', months);\n\t\t\treturn months;\n\t\t}\n\n\t\tfunction getMonth(day) {\n\t\t\tvar date = getDate(day);\n\t\t\tvar month = getMonthByDate(date);\n\t\t\treturn month;\n\t\t}\n\n\t\tfunction getDay(days) {\n\t\t\tvar date = new Date(DateTime.today.date);\n\t\t\tdate.setDate(date.getDate() + days);\n\t\t\treturn date;\n\t\t}\n\n\t\tfunction getKey(date) {\n\t\t\treturn Math.ceil(date.getTime() / DateTime.DAY);\n\t\t}\n\n    }]);\n\n\tapp.factory('CalendarFactory', ['DateTime', 'Hash', function (DateTime, Hash) {\n\n\t\tfunction Calendar() {\n\t\t\tthis.days = new Hash('key');\n\t\t\tthis.months = new Hash('mKey');\n\t\t}\n\n\t\tvar statics = {\n\t\t\tclearMonth: clearMonth,\n\t\t\tgetDate: getDate,\n\t\t\tgetDay: getDay,\n\t\t\tgetKey: getKey,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tgetMonths: getMonths,\n\t\t\tgetMonth: getMonth,\n\t\t\tgetMonthByDate: getMonthByDate,\n\t\t};\n\n\t\tangular.extend(Calendar, statics);\n\t\tangular.extend(Calendar.prototype, publics);\n\n\t\treturn Calendar;\n\n\t\t// statics\n\n\t\tfunction clearMonth(month) {\n\t\t\tmonth.days.each(function (day) {\n\t\t\t\tif (day) {\n\t\t\t\t\tday.hours = 0;\n\t\t\t\t\tday.tasks = new Hash('id');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction getDate(day) {\n\t\t\tif (typeof day.date.getMonth === 'function') {\n\t\t\t\treturn day.date;\n\t\t\t} else {\n\t\t\t\treturn new Date(day.date);\n\t\t\t}\n\t\t}\n\n\t\tfunction getDay(days) {\n\t\t\tvar date = new Date(DateTime.today.date);\n\t\t\tdate.setDate(date.getDate() + days);\n\t\t\treturn date;\n\t\t}\n\n\t\tfunction getKey(date) {\n\t\t\treturn Math.ceil(date.getTime() / DateTime.DAY);\n\t\t}\n\n\t\t// publics\n\n\t\tfunction getMonths(num) {\n\t\t\tvar calendar = this;\n\t\t\tcalendar.days.removeAll();\n\t\t\tcalendar.months.removeAll();\n\t\t\tvar i = 0;\n\t\t\twhile (i < num) {\n\t\t\t\tvar date = new Date();\n\t\t\t\tdate.setFullYear(DateTime.today.date.getFullYear());\n\t\t\t\tdate.setMonth(DateTime.today.date.getMonth() + i);\n\t\t\t\tdate.setDate(1);\n\t\t\t\tdate.setHours(0);\n\t\t\t\tdate.setMinutes(0);\n\t\t\t\tdate.setSeconds(0);\n\t\t\t\tvar month = calendar.getMonthByDate(date);\n\t\t\t\t// console.log('getMonths', month);\n\t\t\t\ti++;\n\t\t\t}\n\t\t\t// console.log('getMonths', months);\n\t\t\treturn calendar.months;\n\t\t}\n\n\t\tfunction getMonth(day) {\n\t\t\tvar calendar = this;\n\t\t\tvar date = getDate(day);\n\t\t\tvar month = calendar.getMonthByDate(date);\n\t\t\treturn month;\n\t\t}\n\n\t\tfunction getMonthByDate(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar calendar = this;\n\t\t\tvar yyyy = date.getFullYear();\n\t\t\tvar MM = date.getMonth();\n\t\t\tvar key = Math.ceil(date.getTime() / DateTime.DAY);\n\t\t\tvar mKey = yyyy * 12 + MM;\n\t\t\tvar month = calendar.months.get(mKey);\n\t\t\tif (!month) {\n\t\t\t\tvar fromDay = new Date(yyyy, MM, 1).getDay() - 1;\n\t\t\t\tfromDay = fromDay < 0 ? 6 : fromDay;\n\t\t\t\tvar monthDays = new Date(yyyy, MM + 1, 0).getDate();\n\t\t\t\tvar weeks = 6; // Math.ceil((fromDay + monthDays) / 7);\n\t\t\t\t// console.log('month', MM, 'weeks', weeks);\n\t\t\t\tmonth = {\n\t\t\t\t\tdate: date,\n\t\t\t\t\tmKey: mKey,\n\t\t\t\t\tmonth: MM,\n\t\t\t\t\tmonthDays: monthDays,\n\t\t\t\t\tfromDay: fromDay,\n\t\t\t\t\tdays: new Hash('key'),\n\t\t\t\t};\n\t\t\t\tmonth.weeks = new Array(weeks).fill().map(function (o, r) {\n\t\t\t\t\tvar days = new Array(7).fill().map(function (o, c) {\n\t\t\t\t\t\tvar item = null;\n\t\t\t\t\t\tvar d = r * 7 + c - fromDay;\n\t\t\t\t\t\tif (d >= 0 && d < monthDays) {\n\t\t\t\t\t\t\tvar date = new Date(yyyy, MM, d + 1);\n\t\t\t\t\t\t\tvar key = Math.ceil(date.getTime() / DateTime.DAY);\n\t\t\t\t\t\t\titem = {\n\t\t\t\t\t\t\t\t$today: key === DateTime.today.key,\n\t\t\t\t\t\t\t\tc: c,\n\t\t\t\t\t\t\t\tr: r,\n\t\t\t\t\t\t\t\td: d + 1,\n\t\t\t\t\t\t\t\tdate: date,\n\t\t\t\t\t\t\t\tkey: key,\n\t\t\t\t\t\t\t\thours: 0,\n\t\t\t\t\t\t\t\ttasks: new Hash('id'),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tcalendar.days.add(item);\n\t\t\t\t\t\t\titem = month.days.add(item);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn item;\n\t\t\t\t\t});\n\t\t\t\t\treturn {\n\t\t\t\t\t\tr: r,\n\t\t\t\t\t\tdate: new Date(yyyy, MM, r * 7 - fromDay + 1),\n\t\t\t\t\t\tdays: days,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\tmonth.getMonth = function (diff) {\n\t\t\t\t\tdiff = diff || 0;\n\t\t\t\t\treturn new Date(yyyy, MM + diff, 1);\n\t\t\t\t};\n\t\t\t\tmonth = calendar.months.add(month);\n\t\t\t}\n\t\t\treturn month;\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('DateTime', [function () {\n\n\t\tvar service = this;\n\n\t\tvar SECOND = 1000;\n\t\tvar MINUTE = 60 * SECOND;\n\t\tvar QUARTER = 15 * MINUTE;\n\t\tvar HOUR = 60 * MINUTE;\n\t\tvar DAY = 24 * HOUR;\n\t\tvar WEEK = 7 * DAY;\n\t\tvar FIRSTDAYOFWEEK = 1;\n\n\t\tvar today = getFullDate();\n\n\t\tvar statics = {\n\t\t\tgetIndexLeft: getIndexLeft,\n\t\t\tgetIndexRight: getIndexRight,\n\t\t\t//\n\t\t\tgetDayLeft: getDayLeft,\n\t\t\tgetDayRight: getDayRight,\n\t\t\t//\n\t\t\tgetMonthLeft: getMonthLeft,\n\t\t\tgetMonthRight: getMonthRight,\n\t\t\t//\n\t\t\tgetWeekLeft: getWeekLeft,\n\t\t\tgetWeekRight: getWeekRight,\n\t\t\t//\n\t\t\tgetYearLeft: getYearLeft,\n\t\t\tgetYearRight: getYearRight,\n\t\t\t//\n\t\t\tdateToKey: dateToKey,\n\t\t\t//\n\t\t\tdayDiff: dayDiff,\n\t\t\tdayLeft: dayLeft,\n\t\t\tdayRight: dayRight,\n\t\t\t//\n\t\t\tgetDate: getDate,\n\t\t\tgetFullDate: getFullDate,\n\t\t\tgetDay: getDay,\n\t\t\tgetFullDay: getFullDay,\n\t\t\tgetWeek: getWeek,\n\t\t\tgetDayByKey: getDayByKey,\n\t\t\tgetDayByDate: getDayByDate,\n\t\t\thourToTime: hourToTime,\n\t\t\tkeyToDate: keyToDate,\n\t\t\t//\n\t\t\tmonthDiff: monthDiff,\n\t\t\tmonthLeft: monthLeft,\n\t\t\tmonthRight: monthRight,\n\t\t\t//\n\t\t\ttoday: today,\n\t\t\t//\n\t\t\tweekDiff: weekDiff,\n\t\t\tweekLeft: weekLeft,\n\t\t\tweekRight: weekRight,\n\t\t\t//\n\t\t\tyearDiff: yearDiff,\n\t\t\tyearLeft: yearLeft,\n\t\t\tyearRight: yearRight,\n\t\t\t// conversion\n\t\t\ttimeToHour: timeToHour,\n\t\t\ttimeToQuarterHour: timeToQuarterHour,\n\t\t\t// units\n\t\t\tSECOND: SECOND,\n\t\t\tMINUTE: MINUTE,\n\t\t\tQUARTER: QUARTER,\n\t\t\tHOUR: HOUR,\n\t\t\tDAY: DAY,\n\t\t\tWEEK: WEEK,\n\t\t\tFIRSTDAYOFWEEK: FIRSTDAYOFWEEK,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tfunction datetime(date) {\n\t\t\tdate = date ? new Date(date) : new Date();\n\t\t\treturn date;\n\t\t}\n\n\t\tfunction components(date) {\n\t\t\tdate = datetime(date);\n\t\t\t// console.log($locale.DATETIME_FORMATS.FIRSTDAYOFWEEK);\n\t\t\treturn {\n\t\t\t\tdate: date,\n\t\t\t\tyyyy: date.getFullYear(),\n\t\t\t\tMM: date.getMonth(),\n\t\t\t\tdd: date.getDate(),\n\t\t\t\t// ee: (date.getDay() + $locale.DATETIME_FORMATS.FIRSTDAYOFWEEK) % 7,\n\t\t\t\tee: date.getDay(),\n\t\t\t\tHH: date.getHours(),\n\t\t\t\tmm: date.getMinutes(),\n\t\t\t\tss: date.getSeconds(),\n\t\t\t\tsss: date.getMilliseconds(),\n\t\t\t};\n\t\t}\n\n\t\tfunction dateToKey(date) {\n\t\t\tdate = datetime(date);\n\t\t\tvar offset = date.getTimezoneOffset();\n\t\t\treturn Math.floor((date.valueOf() - offset * MINUTE) / DAY);\n\t\t}\n\n\t\tfunction dayDiff(diff, date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd + diff, c.HH, c.mm, c.ss, c.sss);\n\t\t}\n\n\t\tfunction dayLeft(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd, 0, 0, 0, 0);\n\t\t}\n\n\t\tfunction dayRight(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd, 23, 59, 59, 999);\n\t\t}\n\n\t\tfunction getDate(date) {\n\t\t\tdate = dayLeft(date);\n\t\t\treturn getDayByDate(date);\n\t\t}\n\n\t\tfunction getFullDate(date) {\n\t\t\treturn getFullDay(getDate(date));\n\t\t}\n\n\t\tfunction getDay(date, key) {\n\t\t\treturn {\n\t\t\t\tdate: date,\n\t\t\t\tkey: key,\n\t\t\t};\n\t\t}\n\n\t\tfunction getDayByKey(key) {\n\t\t\treturn getDay(keyToDate(key), key);\n\t\t}\n\n\t\tfunction getDayByDate(date) {\n\t\t\treturn getDay(date, dateToKey(date));\n\t\t}\n\n\t\tfunction getFullDay(day) {\n\t\t\tvar c = components(day.date);\n\t\t\tc.key = day.key;\n\t\t\tc.wKey = dateToKey(weekLeft(day.date));\n\t\t\tc.mKey = dateToKey(monthLeft(day.date));\n\t\t\tc.ww = getWeek(day.date, FIRSTDAYOFWEEK);\n\t\t\treturn c;\n\t\t}\n\n\t\tfunction hourToTime(hour) {\n\t\t\treturn hour * HOUR;\n\t\t}\n\n\t\tfunction keyToDate(key) {\n\t\t\tvar date = new Date();\n\t\t\tvar offset = date.getTimezoneOffset();\n\t\t\treturn new Date(date.setTime(key * DAY + offset * MINUTE));\n\t\t}\n\n\t\tfunction monthDiff(diff, date, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar MM = Math.floor(c.MM / step) * step + diff * step;\n\t\t\treturn new Date(c.yyyy, MM, 1, c.HH, c.mm, c.ss, c.sss);\n\t\t}\n\n\t\tfunction monthLeft(date, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar MM = Math.floor(c.MM / step) * step;\n\t\t\treturn new Date(c.yyyy, MM, 1, 0, 0, 0, 0);\n\t\t}\n\n\t\tfunction monthRight(date, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar MM = Math.floor(c.MM / step) * step;\n\t\t\treturn new Date(c.yyyy, MM + step, 0, 23, 59, 59, 999);\n\t\t}\n\n\t\tfunction timeToHour(time) {\n\t\t\treturn time / HOUR;\n\t\t}\n\n\t\tfunction timeToQuarterHour(time) {\n\t\t\treturn Math.floor(time / QUARTER) * QUARTER / HOUR;\n\t\t}\n\n\t\tfunction weekDiff(diff, date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd + diff * 7, c.HH, c.mm, c.ss, c.sss);\n\t\t}\n\n\t\tfunction weekLeft(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd - c.ee + FIRSTDAYOFWEEK, 0, 0, 0, 0);\n\t\t}\n\n\t\tfunction weekRight(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd - c.ee + FIRSTDAYOFWEEK + 6, 23, 59, 59, 999);\n\t\t}\n\n\t\tfunction yearDiff(diff, date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM + diff * 12, c.dd, c.HH, c.mm, c.ss, c.sss);\n\t\t}\n\n\t\tfunction yearLeft(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, 0, 1, 0, 0, 0, 0);\n\t\t}\n\n\t\tfunction yearRight(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, 12, 0, 23, 59, 59, 999);\n\t\t}\n\n\t\tfunction getIndexLeft(diff, size, step) {\n\t\t\tdiff = diff || 0;\n\t\t\tsize = size || 1;\n\t\t\tstep = step || 1;\n\t\t\tvar index = diff * step;\n\t\t\treturn index;\n\t\t}\n\n\t\tfunction getIndexRight(diff, size, step) {\n\t\t\tsize = size || 1;\n\t\t\tstep = step || 1;\n\t\t\tvar index = getIndexLeft(diff, size, step);\n\t\t\tindex += (size * step) - 1;\n\t\t\treturn index;\n\t\t}\n\n\t\tfunction getYearLeft(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar yyyy = Math.floor(c.yyyy / step) * step;\n\t\t\tyyyy += getIndexLeft(diff, size, step);\n\t\t\tdate = new Date(yyyy, c.MM, c.dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn yearLeft(date);\n\t\t}\n\n\t\tfunction getYearRight(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar yyyy = Math.floor(c.yyyy / step) * step;\n\t\t\tyyyy += getIndexRight(diff, size, step);\n\t\t\tdate = new Date(yyyy, c.MM, c.dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn yearRight(date);\n\t\t}\n\n\t\tfunction getMonthLeft(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar MM = Math.floor(c.MM / step) * step;\n\t\t\tMM += getIndexLeft(diff, size, step);\n\t\t\tdate = new Date(c.yyyy, MM, c.dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn monthLeft(date);\n\t\t}\n\n\t\tfunction getMonthRight(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar MM = Math.floor(c.MM / step) * step;\n\t\t\tMM += getIndexRight(diff, size, step);\n\t\t\tdate = new Date(c.yyyy, MM, c.dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn monthRight(date);\n\t\t}\n\n\t\tfunction getWeekLeft(date, diff, size, step) {\n\t\t\tvar c = components(date);\n\t\t\tvar dd = c.dd + getIndexLeft(diff, size, step) * 7;\n\t\t\tdate = new Date(c.yyyy, c.MM, dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn weekLeft(date);\n\t\t}\n\n\t\tfunction getWeekRight(date, diff, size, step) {\n\t\t\tvar c = components(date);\n\t\t\tvar dd = c.dd + getIndexRight(diff, size, step) * 7;\n\t\t\tdate = new Date(c.yyyy, c.MM, dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn weekRight(date);\n\t\t}\n\n\t\tfunction getDayLeft(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar dd = Math.floor(c.dd / step) * step;\n\t\t\tdd += getIndexLeft(diff, size, step);\n\t\t\tdate = new Date(c.yyyy, c.MM, dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn dayLeft(date);\n\t\t}\n\n\t\tfunction getDayRight(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar dd = Math.floor(c.dd / step) * step;\n\t\t\tdd += getIndexRight(diff, size, step);\n\t\t\tdate = new Date(c.yyyy, c.MM, dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn dayRight(date);\n\t\t}\n\n\t\tfunction getWeekDay(date, offsetDays) {\n\t\t\toffsetDays = offsetDays || 0; // default offsetDays to zero\n\t\t\tvar ee = date.getDay();\n\t\t\tee -= offsetDays;\n\t\t\tif (ee < 0) {\n\t\t\t\tee += 7;\n\t\t\t}\n\t\t\treturn ee;\n\t\t}\n\n\t\tfunction getWeek(date, offsetDays) {\n\t\t\tvar startingDayOfWeek = 4; // first week of year with thursday;\n\t\t\tvar now = getDayByDate(date);\n\t\t\tvar first = getDayByDate(getYearLeft(date)); // diff, size, step\n\t\t\tvar ee = getWeekDay(first.date, offsetDays);\n\t\t\tvar num = now.key - first.key;\n\t\t\tvar week = Math.floor((num + ee) / 7);\n\t\t\tif (ee < startingDayOfWeek) {\n\t\t\t\tweek++;\n\t\t\t\tif (week > 52) {\n\t\t\t\t\t// next year\n\t\t\t\t\tee = getWeekDay(getYearLeft(date, 1), offsetDays);\n\t\t\t\t\t// if the next year starts before the middle of the week, it is week #1 of that year\n\t\t\t\t\tweek = ee < startingDayOfWeek ? 1 : 53;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn week;\n\t\t}\n\n    }]);\n\n\tapp.filter('isoWeek', ['DateTime', function (DateTime) {\n\t\treturn function (value, offsetDays) {\n\t\t\tif (value) {\n\t\t\t\tvar week = DateTime.getWeek(value, offsetDays);\n\t\t\t\treturn week < 10 ? '0' + week : week; // padded\n\t\t\t} else {\n\t\t\t\treturn '-';\n\t\t\t}\n\t\t};\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tvar it_IT = {\n\t\tlong: {\n\t\t\tRANGE: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tYEAR: 'Anno {from|date:yyyy}',\n\t\t\tSEMESTER: 'Semestre {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tTRIMESTER: 'Quadrimestre {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tQUARTER: 'Trimestre {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tMONTH: '{from|date:MMMM yyyy}',\n\t\t\tWEEK: 'Settimana {to|isoWeek:1}',\n\t\t\tDAY: '{from|date:EEEE dd MMM yyyy}',\n\t\t},\n\t\tshort: {\n\t\t\tRANGE: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tYEAR: '{from|date:yyyy}',\n\t\t\tSEMESTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tTRIMESTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tQUARTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tMONTH: '{from|date:MMMM}',\n\t\t\tWEEK: 'W{to|isoWeek:1}',\n\t\t\tDAY: '{from|date:EEEE}',\n\t\t},\n\t\tweek: 1,\n\t};\n\n\tvar en_US = {\n\t\tlong: {\n\t\t\tRANGE: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tYEAR: 'Year {from|date:yyyy}',\n\t\t\tSEMESTER: 'Semester {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tTRIMESTER: 'Trimester {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tQUARTER: 'Quarter {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tMONTH: '{from|date:MMMM yyyy}',\n\t\t\tWEEK: 'Week {from|isoWeek:0}',\n\t\t\tDAY: '{from|date:EEEE MM/dd/yyyy}',\n\t\t},\n\t\tshort: {\n\t\t\tRANGE: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tYEAR: '{from|date:yyyy}',\n\t\t\tSEMESTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tTRIMESTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tQUARTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tMONTH: '{from|date:MMMM}',\n\t\t\tWEEK: 'W{from|isoWeek:0}',\n\t\t\tDAY: '{from|date:EEEE}',\n\t\t},\n\t\tweek: 0,\n\t};\n\n\tvar formats = it_IT;\n\n\tapp.constant('RangeTypes', {\n\t\tRANGE: 10,\n\t\tYEAR: 11,\n\t\tSEMESTER: 12,\n\t\tTRIMESTER: 13,\n\t\tQUARTER: 14,\n\t\tMONTH: 15,\n\t\tWEEK: 16,\n\t\tDAY: 17,\n\t});\n\n\tapp.factory('Range', ['$filter', 'DateTime', 'RangeTypes', function ($filter, DateTime, RangeTypes) {\n\n\t\tfunction Range(options) {\n\t\t\tvar range = this;\n\t\t\trange.from = DateTime.dayLeft();\n\t\t\trange.type = RangeTypes.QUARTER;\n\t\t\tif (options) {\n\t\t\t\tangular.extend(range, options);\n\t\t\t}\n\t\t\trange.setDiff();\n\t\t}\n\n\t\tvar publics = {\n\t\t\tsetYear: setYear,\n\t\t\tsetSemester: setSemester,\n\t\t\tsetTrimester: setTrimester,\n\t\t\tsetQuarter: setQuarter,\n\t\t\tsetMonth: setMonth,\n\t\t\tsetWeek: setWeek,\n\t\t\tsetDay: setDay,\n\n\t\t\tprev: prev,\n\t\t\tnext: next,\n\n\t\t\tgetDiff: getDiff,\n\t\t\tgetParams: getParams,\n\t\t\tgetDate: getDate,\n\t\t\tsetDate: setDate,\n\t\t\tsetDiff: setDiff,\n\n\t\t\tset: set,\n\t\t\tis: is,\n\t\t\tisInside: isInside,\n\t\t\tisOutside: isOutside,\n\t\t\tisCurrent: isCurrent,\n\t\t\tisBefore: isBefore,\n\t\t\tisAfter: isAfter,\n\n\t\t\teachDay: eachDay,\n\t\t\ttotalDays: totalDays,\n\n\t\t\tgetName: getName,\n\t\t\tgetShortName: getShortName,\n\t\t\ttoString: toString,\n\t\t};\n\n\t\tvar statics = {\n\t\t\t//\n\t\t\tcopy: RangeCopy,\n\t\t\texpand: RangeExpand,\n\t\t\tgetMonth: RangeGetMonth,\n\t\t\taddYear: RangeAddYear,\n\t\t\ttypes: RangeTypes,\n\t\t\t// \n\t\t\tYear: RangeYear,\n\t\t\tSemester: RangeSemester,\n\t\t\tTrimester: RangeTrimester,\n\t\t\tQuarter: RangeQuarter,\n\t\t\tMonth: RangeMonth,\n\t\t\tWeek: RangeWeek,\n\t\t\tDay: RangeDay,\n\t\t\t//\n\t\t\tgetDate: DateTime.getDate,\n\t\t\tgetFullDate: DateTime.getFullDate,\n\t\t\tdateToKey: DateTime.dateToKey,\n\t\t\tkeyToDate: DateTime.keyToDate,\n\t\t\tgetDay: DateTime.getDay,\n\t\t\tgetFullDay: DateTime.getFullDay,\n\t\t\tgetDayByKey: DateTime.getDayByKey,\n\t\t\tgetDayByDate: DateTime.getDayByDate,\n\t\t\ttoday: DateTime.today,\n\t\t\tDateTime: DateTime,\n\t\t};\n\n\t\tangular.extend(Range.prototype, publics);\n\t\tangular.extend(Range, statics);\n\n\t\treturn Range;\n\n\t\t// public methods\n\t\tfunction isInside(date) {\n\t\t\tvar range = this;\n\t\t\treturn !range.isOutside(date);\n\t\t}\n\n\t\tfunction isOutside(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar range = this;\n\t\t\tvar outside = date < range.from || date > range.to;\n\t\t\t// console.log('isOutside', date, range.from, range.to);\n\t\t\treturn outside;\n\t\t}\n\n\t\tfunction isCurrent(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar range = this;\n\t\t\treturn !range.isOutside(date);\n\t\t}\n\n\t\tfunction isBefore(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar range = this;\n\t\t\tvar before = range.to < date;\n\t\t\t// console.log('isBefore', before, range.to, date);\n\t\t\treturn before;\n\t\t}\n\n\t\tfunction isAfter(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar range = this;\n\t\t\tvar after = range.from > date;\n\t\t\t// console.log('isAfter', after);\n\t\t\treturn after;\n\t\t}\n\n\t\tfunction setDate(date, diff) {\n\t\t\tvar range = this;\n\t\t\tswitch (range.type) {\n\t\t\t\tcase RangeTypes.YEAR:\n\t\t\t\t\trange.setYear(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.SEMESTER:\n\t\t\t\t\trange.setSemester(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.TRIMESTER:\n\t\t\t\t\trange.setTrimester(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.QUARTER:\n\t\t\t\t\trange.setQuarter(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.MONTH:\n\t\t\t\t\trange.setMonth(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.WEEK:\n\t\t\t\t\trange.setWeek(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.DAY:\n\t\t\t\t\trange.setDay(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction getDate(diff) {\n\t\t\tdiff = diff || 0;\n\t\t\tvar range = this;\n\t\t\tvar date = new Date(range.from);\n\t\t\tswitch (range.type) {\n\t\t\t\tcase RangeTypes.YEAR:\n\t\t\t\t\tdate = new Date(date.setFullYear(date.getFullYear() + diff));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.SEMESTER:\n\t\t\t\t\tdate = new Date(date.setMonth(date.getMonth() + diff * 6));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.TRIMESTER:\n\t\t\t\t\tdate = new Date(date.setMonth(date.getMonth() + diff * 4));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.QUARTER:\n\t\t\t\t\tdate = new Date(date.setMonth(date.getMonth() + diff * 3));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.MONTH:\n\t\t\t\t\tdate = new Date(date.setMonth(date.getMonth() + diff));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.WEEK:\n\t\t\t\t\tdate = new Date(date.setDate(date.getDate() + diff * 7));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.DAY:\n\t\t\t\t\tdate = new Date(date.setDate(date.getDate() + diff));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn date;\n\t\t}\n\n\t\tfunction getDiff(diff) {\n\t\t\tvar range = this;\n\t\t\treturn new Range({\n\t\t\t\ttype: range.type,\n\t\t\t}).setDate(range.from).setDiff(diff);\n\t\t}\n\n\t\tfunction getParams() {\n\t\t\treturn {\n\t\t\t\tdateFrom: new Date(this.from),\n\t\t\t\tdateTo: new Date(this.to),\n\t\t\t};\n\t\t}\n\n\t\tfunction setYear(date, diff, size, step) {\n\t\t\tvar range = this;\n\t\t\trange.from = DateTime.getYearLeft(date, diff, size, step);\n\t\t\trange.to = DateTime.getYearRight(date, diff, size, step);\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction setSemester(date, diff, size) {\n\t\t\treturn this.setMonth(date, diff, size, 6);\n\t\t}\n\n\t\tfunction setTrimester(date, diff, size) {\n\t\t\treturn this.setMonth(date, diff, size, 4);\n\t\t}\n\n\t\tfunction setQuarter(date, diff, size) {\n\t\t\treturn this.setMonth(date, diff, size, 3);\n\t\t}\n\n\t\tfunction setMonth(date, diff, size, step) {\n\t\t\tvar range = this;\n\t\t\trange.from = DateTime.getMonthLeft(date, diff, size, step);\n\t\t\trange.to = DateTime.getMonthRight(date, diff, size, step);\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction setWeek(date, diff, size, step) {\n\t\t\tvar range = this;\n\t\t\trange.from = DateTime.getWeekLeft(date, diff, size, step);\n\t\t\trange.to = DateTime.getWeekRight(date, diff, size, step);\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction setDay(date, diff, size, step) {\n\t\t\tvar range = this;\n\t\t\trange.from = DateTime.getDayLeft(date, diff, size, step);\n\t\t\trange.to = DateTime.getDayRight(date, diff, size, step);\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction prev() {\n\t\t\treturn this.setDiff(-1);\n\t\t}\n\n\t\tfunction next() {\n\t\t\treturn this.setDiff(1);\n\t\t}\n\n\t\tfunction setDiff(diff) {\n\t\t\tvar range = this;\n\t\t\tswitch (range.type) {\n\t\t\t\tcase RangeTypes.YEAR:\n\t\t\t\t\trange.setYear(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.SEMESTER:\n\t\t\t\t\trange.setSemester(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.TRIMESTER:\n\t\t\t\t\trange.setTrimester(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.QUARTER:\n\t\t\t\t\trange.setQuarter(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.MONTH:\n\t\t\t\t\trange.setMonth(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.WEEK:\n\t\t\t\t\trange.setWeek(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.DAY:\n\t\t\t\t\trange.setDay(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction set(filters, source) {\n\t\t\tvar range = this;\n\t\t\tfilters.dateFrom = range.from;\n\t\t\tfilters.dateTo = range.to;\n\t\t\tif (source) {\n\t\t\t\tsource.setDates(filters.dateFrom, filters.dateTo);\n\t\t\t}\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction is(filters) {\n\t\t\tvar range = this,\n\t\t\t\tflag = false;\n\t\t\tif (filters.dateFrom && filters.dateTo) {\n\t\t\t\tflag = filters.dateFrom.getTime() == range.from.getTime() && filters.dateTo.getTime() == range.to.getTime();\n\t\t\t}\n\t\t\treturn flag;\n\t\t}\n\n\t\tfunction eachDay(callback) {\n\t\t\tvar range = this;\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\treturn range;\n\t\t\t}\n\t\t\tvar fromKey = DateTime.dateToKey(range.from);\n\t\t\tvar toKey = DateTime.dateToKey(range.to);\n\t\t\twhile (fromKey <= toKey) {\n\t\t\t\tcallback(DateTime.getDayByKey(fromKey, formats.week));\n\t\t\t\tfromKey++;\n\t\t\t}\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction totalDays() {\n\t\t\tvar range = this;\n\t\t\tvar fromKey = DateTime.dateToKey(range.from);\n\t\t\tvar toKey = DateTime.dateToKey(range.to);\n\t\t\treturn toKey - fromKey + 1;\n\t\t}\n\n\t\tfunction getName() {\n\t\t\tvar range = this;\n\t\t\tvar key = RangeExtract(RangeTypes, range.type);\n\t\t\treturn RangeFormat(range, formats.long[key]);\n\t\t}\n\n\t\tfunction getShortName() {\n\t\t\tvar range = this;\n\t\t\tvar key = RangeExtract(RangeTypes, range.type);\n\t\t\treturn RangeFormat(range, formats.short[key]);\n\t\t}\n\n\t\tfunction toString() {\n\t\t\tvar range = this;\n\t\t\treturn '[' +\n\t\t\t\t$filter('date')(range.from, 'MMM dd yyyy HH:mm:ss.sss') + ', ' +\n\t\t\t\t$filter('date')(range.to, 'MMM dd yyyy HH:mm:ss.sss') +\n\t\t\t\t'] \\'' + range.getName() + '\\'';\n\t\t}\n\n\t\t// static methods        \n\t\tfunction RangeCopy($range) {\n\t\t\tvar range = new Range($range);\n\t\t\trange.from = new Date($range.from);\n\t\t\trange.to = new Date($range.to);\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction RangeExpand(range, time) {\n\t\t\trange = RangeCopy(range);\n\t\t\trange.from = new Date(range.from.getTime() - time);\n\t\t\trange.to = new Date(range.to.getTime() + time);\n\t\t\t// console.log('RangeExpand', range.toString());\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction RangeGetMonth(date) {\n\t\t\tif (!date) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tdate = new Date(date);\n\t\t\tdate.setDate(1);\n\t\t\tdate.setHours(0, 0, 0, 0);\n\t\t\treturn date.getTime();\n\t\t}\n\n\t\tfunction RangeAddYear(date, years) {\n\t\t\tif (!date) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tdate = new Date(date);\n\t\t\treturn new Date(date.setFullYear(date.getFullYear() + years));\n\t\t}\n\n\t\tfunction RangeYear() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.YEAR\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeSemester() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.SEMESTER\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeTrimester() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.TRIMESTER\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeQuarter() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.QUARTER\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeMonth() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.MONTH\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeWeek() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.WEEK\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeDay() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.DAY\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeFormat(range, format) {\n\t\t\tvar name = format;\n\t\t\tname = name.replace(/{(.*?)}/g, function (replaced, token) {\n\t\t\t\tvar a = token.split('|');\n\t\t\t\tvar p = a.shift();\n\t\t\t\tvar f = a.join(''),\n\t\t\t\t\tj;\n\t\t\t\tif (f.indexOf(':') !== -1) {\n\t\t\t\t\tf = f.split(':');\n\t\t\t\t\tj = f.length ? f.pop() : null;\n\t\t\t\t\tf = f.join('');\n\t\t\t\t}\n\t\t\t\t// console.log(token, f, p, j);\n\t\t\t\treturn f.length ? $filter(f)(range[p], j) : range[p];\n\t\t\t});\n\t\t\t// console.log(name);\n\t\t\treturn name;\n\t\t}\n\n\t\tfunction RangeExtract(obj, value) {\n\t\t\treturn Object.keys(obj)[Object.values(obj).indexOf(value)];\n\t\t}\n\n    }]);\n\n\t(function () {\n\t\t// POLYFILL Object.values\n\t\tif (typeof Object.values !== 'function') {\n\t\t\tObject.defineProperty(Object, 'values', {\n\t\t\t\tvalue: function (obj) {\n\t\t\t\t\tvar vals = [];\n\t\t\t\t\tfor (var key in obj) {\n\t\t\t\t\t\tif (has(obj, key) && isEnumerable(obj, key)) {\n\t\t\t\t\t\t\tvals.push(obj[key]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn vals;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}());\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\t/*\n\tapp.value('now', null);\n\t*/\n\n\tapp.value('$formats', {\n\t\tjust_now: 'just now',\n\t\tseconds_ago: '{{num}} seconds ago',\n\t\ta_minute_ago: 'a minute ago',\n\t\tminutes_ago: '{{num}} minutes ago',\n\t\tan_hour_ago: 'an hour ago',\n\t\thours_ago: '{{num}} hours ago',\n\t\ta_day_ago: 'yesterday',\n\t\tdays_ago: '{{num}} days ago',\n\t\ta_week_ago: 'a week ago',\n\t\tweeks_ago: '{{num}} weeks ago',\n\t\ta_month_ago: 'a month ago',\n\t\tmonths_ago: '{{num}} months ago',\n\t\ta_year_ago: 'a year ago',\n\t\tyears_ago: '{{num}} years ago',\n\t\tover_a_year_ago: 'over a year ago',\n\t\tseconds_from_now: '{{num}} seconds from now',\n\t\ta_minute_from_now: 'a minute from now',\n\t\tminutes_from_now: '{{num}} minutes from now',\n\t\tan_hour_from_now: 'an hour from now',\n\t\thours_from_now: '{{num}} hours from now',\n\t\ta_day_from_now: 'tomorrow',\n\t\tdays_from_now: '{{num}} days from now',\n\t\ta_week_from_now: 'a week from now',\n\t\tweeks_from_now: '{{num}} weeks from now',\n\t\ta_month_from_now: 'a month from now',\n\t\tmonths_from_now: '{{num}} months from now',\n\t\ta_year_from_now: 'a year from now',\n\t\tyears_from_now: '{{num}} years from now',\n\t\tover_a_year_from_now: 'over a year from now'\n\t});\n\n\tapp.filter('dateRelative', ['$rootScope', '$interval', '$injector', '$formats', function ($rootScope, $interval, $injector, $formats) {\n\n\t\tvar minute = 60;\n\t\tvar hour = minute * 60;\n\t\tvar day = hour * 24;\n\t\tvar week = day * 7;\n\t\tvar month = day * 30;\n\t\tvar year = day * 365;\n\n\t\tvar $format = getFormat();\n\n\t\tfunction getFormat() {\n\t\t\tif ($injector.has('$format')) {\n\t\t\t\treturn $injector.get('$format');\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\tinstant: function (id, params) {\n\t\t\t\t\t\treturn $formats[id].replace('{{num}}', params.num);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tfunction getDelta(now, date) {\n\t\t\treturn Math.round(Math.abs(now - date) / 1000);\n\t\t}\n\t\t/*\n        $interval(function () {\n            $rootScope.$now = new Date();\n            console.log($rootScope.$now);\n        }, 3 * 1000);\n\t\t*/\n\t\treturn function (date) {\n\t\t\tif (!(date instanceof Date)) {\n\t\t\t\tdate = new Date(date);\n\t\t\t}\n\n\t\t\t// now = now || new Date();\n\t\t\tvar now = new Date();\n\n\t\t\tvar delta = getDelta(now, date);\n\n\t\t\tif (delta > day && delta < week) {\n\t\t\t\tdate = new Date(date.getFullYear(), date.getMonth(), date.getDate(), 0, 0, 0, 0);\n\t\t\t\tdelta = getDelta(now, date);\n\t\t\t}\n\n\t\t\tvar suffix = now >= date ? '_ago' : '_from_now';\n\n\t\t\tfunction format(key, num) {\n\t\t\t\treturn $format.instant(key + (delta > 30 ? suffix : ''), {\n\t\t\t\t\tnum: num\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconsole.log('delta', delta, now, date);\n\n\t\t\tif (delta < 30) {\n\t\t\t\treturn format('just_now');\n\n\t\t\t} else if (delta < minute) {\n\t\t\t\treturn format('seconds', delta);\n\n\t\t\t} else if (delta < 2 * minute) {\n\t\t\t\treturn format('a_minute');\n\n\t\t\t} else if (delta < hour) {\n\t\t\t\treturn format('minutes', Math.floor(delta / minute));\n\n\t\t\t} else if (delta < hour * 2) {\n\t\t\t\treturn format('an_hour');\n\n\t\t\t} else if (delta < day) {\n\t\t\t\treturn format('hours', Math.floor(delta / hour));\n\n\t\t\t} else if (delta < day * 2) {\n\t\t\t\treturn format('a_day');\n\n\t\t\t} else if (delta < week) {\n\t\t\t\treturn format('days', Math.floor(delta / day));\n\n\t\t\t} else if (Math.floor(delta / week) !== 1) {\n\t\t\t\treturn format('a_week');\n\n\t\t\t} else if (delta < month) {\n\t\t\t\treturn format('weeks', Math.floor(delta / week));\n\n\t\t\t} else if (Math.floor(delta / month) !== 1) {\n\t\t\t\treturn format('a_month');\n\n\t\t\t} else if (delta < year) {\n\t\t\t\treturn format('months', Math.floor(delta / month));\n\n\t\t\t} else if (Math.floor(delta / year) !== 1) {\n\t\t\t\treturn format('a_year');\n\n\t\t\t} else {\n\t\t\t\treturn format('over_a_year');\n\n\t\t\t}\n\n\t\t};\n    }]);\n\n\tapp.directive('dateRelative', ['$parse', '$filter', '$interval', function ($parse, $filter, $interval) {\n\t\treturn {\n\t\t\tpriority: 1001,\n\t\t\trestrict: 'A',\n\t\t\tlink: function (scope, element, attributes, model) {\n\n\t\t\t\tfunction setDate() {\n\t\t\t\t\tvar date = $parse(attributes.dateRelative)(scope);\n\t\t\t\t\tvar relative = $filter('dateRelative')(date);\n\t\t\t\t\telement[0].innerHTML = relative;\n\t\t\t\t\t// console.log('dateRelative.setDate', relative);\n\t\t\t\t}\n\n\t\t\t\tsetDate();\n\n\t\t\t\tvar i = setInterval(setDate, 60 * 1000);\n\n\t\t\t\tscope.$on('$destroy', function () {\n\t\t\t\t\tcancelInterval(i);\n\t\t\t\t});\n\n\t\t\t}\n\t\t};\n\t}]);\n\n\t// directive dateRelative -> apply filter every timeout\n\n\t/*\n\tmyApp.config(function ($translateProvider) {\n\t    $translateProvider.translations('en', {\n\t        just_now: 'just now',\n\t        seconds_ago: '{{time}} seconds ago',\n\t    });\n\n\t    $translateProvider.translations('de', {\n\t        just_now: 'soeben',\n\t        seconds_ago: 'vor {{time}} stunden',\n\t    });\n\n\t    $translateProvider.preferredLanguage('en');\n\t});\n\t*/\n\n}());\n/*\n// handle transition on resizing\nvar resizingTimeout;\n$(window).on('resize', function () {\n    clearTimeout(resizingTimeout);\n    $('body').addClass('resizing');\n    resizingTimeout = setTimeout(function () {\n        $('body').removeClass('resizing');\n    }, 100);\n})\n*/\n\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Dom', ['Point', 'Rect', function (Point, Rect) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tgetBoundRect: getBoundRect,\n\t\t\tgetClosest: getClosest,\n\t\t\tgetClosestNode: getClosestNode,\n\t\t\tgetDelta: getDelta,\n\t\t\tgetDocumentNode: getDocumentNode,\n\t\t\tgetElement: getElement,\n\t\t\tgetNode: getNode,\n\t\t\tgetNodeOffset: getNodeOffset,\n\t\t\tgetPageScroll: getPageScroll,\n\t\t\tgetParents: getParents,\n\t\t\tgetView: getView,\n\t\t\tgetPointInView: getPointInView,\n\t\t\tcompileController: compileController,\n\t\t\tdownloadFile: downloadFile,\n\t\t\tua: getUA(),\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// return node element BoundingClientRect\n\t\tfunction getBoundRect(node) {\n\t\t\tnode = getNode(node);\n\t\t\tif (node === window) {\n\t\t\t\tnode = getDocumentNode();\n\t\t\t}\n\t\t\tvar rect = node.getBoundingClientRect();\n\t\t\treturn rect;\n\t\t}\n\n\t\t// return closest parent node that match a selector\n\t\tfunction getClosest(node, selector) {\n\t\t\tvar matchesFn, parent;\n            ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'].some(function (fn) {\n\t\t\t\tif (typeof document.body[fn] == 'function') {\n\t\t\t\t\tmatchesFn = fn;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\tif (node[matchesFn](selector)) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t\twhile (node !== null) {\n\t\t\t\tparent = node.parentElement;\n\t\t\t\tif (parent !== null && parent[matchesFn](selector)) {\n\t\t\t\t\treturn parent;\n\t\t\t\t}\n\t\t\t\tnode = parent;\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\t// return closest parent node that math a target node\n\t\tfunction getClosestNode(node, target) {\n\t\t\tvar parent = null;\n\t\t\tif (node === target) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t\twhile (node !== null) {\n\t\t\t\tparent = node.parentElement;\n\t\t\t\tif (parent !== null && parent === target) {\n\t\t\t\t\treturn parent;\n\t\t\t\t}\n\t\t\t\tnode = parent;\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\t// return wheel delta\n\t\tfunction getDelta(event) {\n\t\t\tvar original = event.originalEvent ? event.originalEvent : event;\n\t\t\tvar type = original.type;\n\t\t\tvar delta = null;\n\t\t\tif (type === 'wheel' || type === 'mousewheel' || type === 'DOMMouseScroll') {\n\t\t\t\tvar deltaX = original.deltaX || original.wheelDeltaX;\n\t\t\t\tvar deltaY = original.deltaY || original.wheelDeltaY;\n\t\t\t\tdelta = new Point(deltaX, deltaY);\n\t\t\t\tif (Math.abs(deltaX) > Math.abs(deltaY)) {\n\t\t\t\t\tdelta.dir = deltaX < 0 ? 1 : -1;\n\t\t\t\t} else {\n\t\t\t\t\tdelta.dir = deltaY < 0 ? 1 : -1;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn delta;\n\t\t}\n\n\t\t// return document element node\n\t\tfunction getDocumentNode() {\n\t\t\tvar documentNode = (document.documentElement || document.body.parentNode || document.body);\n\t\t\treturn documentNode;\n\t\t}\n\n\t\t// return an angular element\n\t\tfunction getElement(element) {\n\t\t\treturn angular.isArray(element) ? element : angular.element(element);\n\t\t}\n\n\t\t// return a native html node\n\t\tfunction getNode(element) {\n\t\t\treturn angular.isArray(element) ? element[0] : element;\n\t\t}\n\n\t\t// return a node offset point\n\t\tfunction getNodeOffset(node) {\n\t\t\tvar offset = new Point();\n\t\t\tnode = getNode(node);\n\t\t\tif (node && node.nodeType === 1) {\n\t\t\t\toffset.x = node.offsetLeft;\n\t\t\t\toffset.y = node.offsetTop;\n\t\t\t}\n\t\t\treturn offset;\n\t\t}\n\n\t\t// return the current page scroll\n\t\tfunction getPageScroll() {\n\t\t\tvar scroll = new Point();\n\t\t\tvar documentNode = getDocumentNode();\n\t\t\tscroll.x = window.pageXOffset || documentNode.scrollLeft;\n\t\t\tscroll.y = window.pageYOffset || documentNode.scrollTop;\n\t\t\treturn scroll;\n\t\t}\n\n\t\t// return an array of node parants\n\t\tfunction getParents(node, topParentNode) {\n\t\t\t// if no topParentNode defined will bubble up all the way to *document*\n\t\t\ttopParentNode = topParentNode || getDocumentNode();\n\t\t\tvar parents = [];\n\t\t\tif (node) {\n\t\t\t\tparents.push(node);\n\t\t\t\tvar parentNode = node.parentNode;\n\t\t\t\twhile (parentNode && parentNode !== topParentNode) {\n\t\t\t\t\tparents.push(parentNode);\n\t\t\t\t\tparentNode = parentNode.parentNode;\n\t\t\t\t}\n\t\t\t\tparents.push(topParentNode); // push that topParentNode you wanted to stop at\n\t\t\t}\n\t\t\tparents.each = function (callback) {\n\t\t\t\tthis.filter(function (node) {\n\t\t\t\t\tif (callback) {\n\t\t\t\t\t\tcallback(angular.element(node), node);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn parents;\n\t\t}\n\n\t\t// return the view rect\n\t\tfunction getView() {\n\t\t\tvar view = new Rect();\n\t\t\tif (window.innerWidth !== undefined) {\n\t\t\t\tview.width = window.innerWidth;\n\t\t\t\tview.height = window.innerHeight;\n\t\t\t} else {\n\t\t\t\tvar documentNode = getDocumentNode();\n\t\t\t\tview.width = documentNode.clientWidth;\n\t\t\t\tview.height = documentNode.clientHeight;\n\t\t\t}\n\t\t\treturn view;\n\t\t}\n\n\t\t// add to constant\n\t\tvar MOUSE_EVENTS = ['click', 'mousedown', 'mouseup', 'mousemove', 'mouseover', 'mouseout', 'mouseenter', 'mouseleave', 'contextmenu'];\n\t\tvar TOUCH_EVENTS = ['touchstart', 'touchmove', 'touchend', 'touchcancel'];\n\n\t\tfunction getPointInView(event) {\n\t\t\tvar original = event.originalEvent ? event.originalEvent : event;\n\t\t\tvar type = original.type;\n\t\t\tvar point = null;\n\t\t\tif (TOUCH_EVENTS.indexOf(type) !== -1) {\n\t\t\t\tvar touch = null;\n\t\t\t\tvar touches = original.touches.length ? original.touches : original.changedTouches;\n\t\t\t\tif (touches && touches.length) {\n\t\t\t\t\ttouch = touches[0];\n\t\t\t\t}\n\t\t\t\tif (touch) {\n\t\t\t\t\tpoint = new Point();\n\t\t\t\t\tpoint.x = touch.pageX;\n\t\t\t\t\tpoint.y = touch.pageY;\n\t\t\t\t}\n\t\t\t} else if (MOUSE_EVENTS.indexOf(type) !== -1) {\n\t\t\t\tpoint = new Point();\n\t\t\t\tpoint.x = original.pageX;\n\t\t\t\tpoint.y = original.pageY;\n\t\t\t}\n\t\t\treturn point;\n\t\t}\n\n\t\tfunction getUA() {\n\t\t\tvar agent = window.navigator.userAgent.toLowerCase();\n\t\t\tvar safari = agent.indexOf('safari') !== -1 && agent.indexOf('chrome') === -1;\n\t\t\tvar msie = agent.indexOf('trident') !== -1 || agent.indexOf('edge') !== -1 || agent.indexOf('msie') !== -1;\n\t\t\tvar chrome = !safari && !msie && agent.indexOf('chrome') !== -1;\n\t\t\tvar mobile = agent.indexOf('mobile') !== -1;\n\t\t\tvar mac = agent.indexOf('macintosh') !== -1;\n\t\t\tvar ua = {\n\t\t\t\tagent: agent,\n\t\t\t\tsafari: safari,\n\t\t\t\tmsie: msie,\n\t\t\t\tchrome: chrome,\n\t\t\t\tmobile: mobile,\n\t\t\t\tmac: mac,\n\t\t\t};\n\t\t\tangular.forEach(ua, function (value, key) {\n\t\t\t\tif (value) {\n\t\t\t\t\tangular.element(document.getElementsByTagName('body')).addClass(key);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn ua;\n\t\t}\n\n\t\t/*\n    function mobilecheck() {\n        var check = false;\n        (function(a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || window.opera);\n        return check;\n    }\n\n    // For those wishing to include tablets in this test (though arguably, you shouldn't), you can use the following function:\n    function mobileAndTabletcheck() {\n        var check = false;\n        (function(a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || window.opera);\n        return check;\n    }\n\n    var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n    var isMobile = mobilecheck();\n    var isMobileAndTabled = mobileAndTabletcheck();\n\t\t*/\n\n\t\tfunction compileController(scope, element, html, data) {\n\t\t\t// console.log('Dom.compileController', element);\n\t\t\telement = getElement(element);\n\t\t\telement.html(html);\n\t\t\tvar link = $compile(element.contents());\n\t\t\tif (data.controller) {\n\t\t\t\tvar $scope = scope.$new();\n\t\t\t\tangular.extend($scope, data);\n\t\t\t\tvar controller = $controller(data.controller, {\n\t\t\t\t\t$scope: $scope\n\t\t\t\t});\n\t\t\t\tif (data.controllerAs) {\n\t\t\t\t\tscope[data.controllerAs] = controller;\n\t\t\t\t}\n\t\t\t\telement.data('$ngControllerController', controller);\n\t\t\t\telement.children().data('$ngControllerController', controller);\n\t\t\t\tscope = $scope;\n\t\t\t}\n\t\t\tlink(scope);\n\t\t}\n\n\t\tfunction downloadFile(content, name, type) {\n\t\t\ttype = type || 'application/octet-stream';\n\t\t\tvar base64 = null;\n\t\t\tvar blob = new Blob([content], {\n\t\t\t\ttype: type\n\t\t\t});\n\t\t\tvar reader = new window.FileReader();\n\t\t\treader.readAsDataURL(blob);\n\t\t\treader.onloadend = function () {\n\t\t\t\tbase64 = reader.result;\n\t\t\t\tdownload();\n\t\t\t};\n\n\t\t\tfunction download() {\n\t\t\t\tif (document.createEvent) {\n\t\t\t\t\tvar anchor = document.createElement('a');\n\t\t\t\t\tanchor.href = base64;\n\t\t\t\t\tif (anchor.download !== undefined) {\n\t\t\t\t\t\tvar downloadName = name || base64.substring(base64.lastIndexOf('/') + 1, base64.length);\n\t\t\t\t\t\tanchor.download = downloadName;\n\t\t\t\t\t}\n\t\t\t\t\tvar event = document.createEvent('MouseEvents');\n\t\t\t\t\tevent.initEvent('click', true, true);\n\t\t\t\t\tanchor.dispatchEvent(event);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tvar query = '?download';\n\t\t\t\twindow.open(base64.indexOf('?') > -1 ? base64 : base64 + query, '_self');\n\t\t\t}\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Event', ['EventsService', 'Dom', 'Point', 'Rect', function (EventsService, Dom, Point, Rect) {\n\n\t\tfunction Event(event, element) {\n\t\t\ttry {\n\t\t\t\tevent = event || window.event;\n\t\t\t\tvar type = event.type;\n\t\t\t\tvar originalEvent = event.originalEvent ? event.originalEvent : event;\n\t\t\t\tvar node = element[0]; // Dom.getNode(element);\n\t\t\t\tvar offset = Dom.getNodeOffset(node);\n\t\t\t\tvar rect = Dom.getBoundRect(node);\n\t\t\t\tvar view = Dom.getView();\n\t\t\t\tvar scroll = Dom.getPageScroll();\n\t\t\t\tvar point = Dom.getPointInView(event);\n\t\t\t\tif (point) {\n\t\t\t\t\tvar absolute = new Point(point.x - scroll.x, point.y - scroll.y);\n\t\t\t\t\tvar relative = new Point(absolute.x - rect.left, absolute.y - rect.top);\n\t\t\t\t\tthis.point = point;\n\t\t\t\t\tthis.absolute = absolute;\n\t\t\t\t\tthis.relative = relative;\n\t\t\t\t}\n\t\t\t\tvar delta = Dom.getDelta(event);\n\t\t\t\tif (delta) {\n\t\t\t\t\tthis.delta = delta;\n\t\t\t\t\tthis.dir = delta.dir;\n\t\t\t\t}\n\t\t\t\tthis.event = event;\n\t\t\t\tthis.type = type;\n\t\t\t\tthis.originalEvent = originalEvent;\n\t\t\t\tthis.element = element;\n\t\t\t\tthis.node = node;\n\t\t\t\tthis.offset = offset;\n\t\t\t\tthis.rect = rect;\n\t\t\t\tthis.view = view;\n\t\t\t\tthis.scroll = scroll;\n\t\t\t\tthis.timestamp = new Date().getTime();\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log('Event.error', error);\n\t\t\t}\n\t\t}\n\n\t\tvar statics = {};\n\n\t\tvar publics = {\n\t\t\tstop: stop,\n\t\t};\n\n\t\tangular.extend(Event, statics);\n\t\tangular.extend(Event.prototype, publics);\n\t\treturn Event;\n\n\t\t// prototype methods\n\n\t\tfunction stop() {\n\t\t\tthis.event.stopPropagation();\n\t\t\tthis.event.preventDefault();\n\t\t}\n\n\t}]);\n\n\tapp.factory('Events', ['EventsService', 'Event', 'Dom', function (EventsService, Event, Dom) {\n\n\t\tfunction Events(element) {\n\t\t\tvar events = this;\n\n\t\t\tthis.element = Dom.getElement(element);\n\t\t\tthis.listeners = {};\n\t\t\tthis.standardEvents = {\n\t\t\t\tclick: {\n\t\t\t\t\tkey: 'click',\n\t\t\t\t\tcallback: onClick\n\t\t\t\t},\n\t\t\t\tdown: {\n\t\t\t\t\tkey: 'mousedown',\n\t\t\t\t\tcallback: onMouseDown\n\t\t\t\t},\n\t\t\t\tmove: {\n\t\t\t\t\tkey: 'mousemove',\n\t\t\t\t\tcallback: onMouseMove\n\t\t\t\t},\n\t\t\t\tup: {\n\t\t\t\t\tkey: 'mouseup',\n\t\t\t\t\tcallback: onMouseUp\n\t\t\t\t},\n\t\t\t\tresize: {\n\t\t\t\t\tkey: 'resize',\n\t\t\t\t\tcallback: onResize\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.touchEvents = {\n\t\t\t\tdown: {\n\t\t\t\t\tkey: 'touchstart',\n\t\t\t\t\tcallback: onTouchStart\n\t\t\t\t},\n\t\t\t\tmove: {\n\t\t\t\t\tkey: 'touchmove',\n\t\t\t\t\tcallback: onTouchMove\n\t\t\t\t},\n\t\t\t\tup: {\n\t\t\t\t\tkey: 'touchend',\n\t\t\t\t\tcallback: onTouchEnd\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.wheelEvents = {\n\t\t\t\twheel: {\n\t\t\t\t\tkey: 'mousewheel',\n\t\t\t\t\tcallback: onMouseWheel\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.scrollEvents = {\n\t\t\t\twheel: {\n\t\t\t\t\tkey: 'DOMMouseScroll',\n\t\t\t\t\tcallback: onMouseScroll\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.timestamp = new Date().getTime();\n\t\t\tthis.setTimestamp = setTimestamp;\n\n\t\t\tfunction setTimestamp(event) {\n\t\t\t\tif (event) {\n\t\t\t\t\tevent.interval = Math.min(250, event.timestamp - events.timestamp);\n\t\t\t\t\t// console.log(event.interval, event.timestamp, events.timestamp);\n\t\t\t\t}\n\t\t\t\tevents.timestamp = new Date().getTime();\n\t\t\t}\n\n\t\t\tfunction onClick(e) {\n\t\t\t\t// console.log('onClick', e, events);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.click.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onMouseDown(e) {\n\t\t\t\t// console.log('onMouseDown', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.down.apply(this, [event]);\n\t\t\t\tevents.removeTouchEvents();\n\t\t\t}\n\n\t\t\tfunction onMouseMove(e) {\n\t\t\t\t// console.log('onMouseMove', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.move.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onMouseUp(e) {\n\t\t\t\t// console.log('onMouseUp', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.up.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onMouseWheel(e) {\n\t\t\t\t// console.log('onMouseWheel', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.wheel.apply(this, [event]);\n\t\t\t\tevents.removeScrollEvents();\n\t\t\t}\n\n\t\t\tfunction onMouseScroll(e) {\n\t\t\t\t// console.log('onMouseScroll', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.wheel.apply(this, [event]);\n\t\t\t\tevents.removeWheelEvents();\n\t\t\t}\n\n\t\t\tfunction onResize(e) {\n\t\t\t\t// console.log('onResize', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.resize.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onTouchStart(e) {\n\t\t\t\t// console.log('onTouchStart', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.down.apply(this, [event]);\n\t\t\t\tevents.removeStandardEvents();\n\t\t\t}\n\n\t\t\tfunction onTouchMove(e) {\n\t\t\t\t// console.log('onTouchMove', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.move.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onTouchEnd(e) {\n\t\t\t\t// console.log('onTouchEnd', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.up.apply(this, [event]);\n\t\t\t}\n\t\t}\n\n\t\tvar statics = {\n\t\t\tgetTouch: getTouch,\n\t\t\tgetRelativeTouch: getRelativeTouch,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tadd: add,\n\t\t\tremove: remove,\n\t\t\tremoveStandardEvents: removeStandardEvents,\n\t\t\tremoveTouchEvents: removeTouchEvents,\n\t\t\tremoveWheelEvents: removeWheelEvents,\n\t\t\tremoveScrollEvents: removeScrollEvents,\n\t\t};\n\n\t\tangular.extend(Events, statics);\n\t\tangular.extend(Events.prototype, publics);\n\t\treturn Events;\n\n\t\t// prototype methods\n\n\t\tfunction add(listeners, scope) {\n\t\t\tvar events = this,\n\t\t\t\tstandard = this.standardEvents,\n\t\t\t\ttouch = this.touchEvents,\n\t\t\t\twheel = this.wheelEvents,\n\t\t\t\tscroll = this.scrollEvents;\n\t\t\tvar element = this.element,\n\t\t\t\twindowElement = angular.element(window);\n\n\t\t\tangular.forEach(listeners, function (callback, key) {\n\t\t\t\tif (events.listeners[key]) {\n\t\t\t\t\tvar listener = {};\n\t\t\t\t\tlistener[key] = events.listeners[key];\n\t\t\t\t\tremove(listener);\n\t\t\t\t}\n\t\t\t\tevents.listeners[key] = callback;\n\t\t\t\tif (standard[key]) {\n\t\t\t\t\tif (key === 'resize') {\n\t\t\t\t\t\twindowElement.on(standard[key].key, standard[key].callback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.on(standard[key].key, standard[key].callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (touch[key]) {\n\t\t\t\t\telement.on(touch[key].key, touch[key].callback);\n\t\t\t\t}\n\t\t\t\tif (wheel[key]) {\n\t\t\t\t\telement.on(wheel[key].key, wheel[key].callback);\n\t\t\t\t}\n\t\t\t\tif (scroll[key]) {\n\t\t\t\t\telement.on(scroll[key].key, scroll[key].callback);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (scope) {\n\t\t\t\tscope.$on('$destroy', function () {\n\t\t\t\t\tevents.remove(listeners);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn events;\n\t\t}\n\n\t\tfunction remove(listeners) {\n\t\t\tvar events = this,\n\t\t\t\tstandard = this.standardEvents,\n\t\t\t\ttouch = this.touchEvents,\n\t\t\t\twheel = this.wheelEvents,\n\t\t\t\tscroll = this.scrollEvents;\n\t\t\tvar element = this.element,\n\t\t\t\twindowElement = angular.element(window);\n\t\t\tangular.forEach(listeners, function (callback, key) {\n\t\t\t\tif (standard[key]) {\n\t\t\t\t\tif (key === 'resize') {\n\t\t\t\t\t\twindowElement.off(standard[key].key, standard[key].callback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.off(standard[key].key, standard[key].callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (touch[key]) {\n\t\t\t\t\telement.off(touch[key].key, touch[key].callback);\n\t\t\t\t}\n\t\t\t\tif (wheel[key]) {\n\t\t\t\t\telement.off(wheel[key].key, wheel[key].callback);\n\t\t\t\t}\n\t\t\t\tif (scroll[key]) {\n\t\t\t\t\telement.off(scroll[key].key, scroll[key].callback);\n\t\t\t\t}\n\t\t\t\tevents.listeners[key] = null;\n\t\t\t});\n\t\t\treturn events;\n\t\t}\n\n\t\tfunction removeStandardEvents() {\n\t\t\tvar events = this,\n\t\t\t\tstandard = events.standardEvents,\n\t\t\t\ttouch = events.touchEvents;\n\t\t\tvar element = events.element;\n\t\t\telement.off('mousedown', standard.down.callback);\n\t\t\telement.off('mousemove', standard.move.callback);\n\t\t\telement.off('mouseup', standard.up.callback);\n\t\t}\n\n\t\tfunction removeTouchEvents() {\n\t\t\tvar events = this,\n\t\t\t\tstandard = events.standardEvents,\n\t\t\t\ttouch = events.touchEvents;\n\t\t\tvar element = events.element;\n\t\t\telement.off('touchstart', touch.down.callback);\n\t\t\telement.off('touchmove', touch.move.callback);\n\t\t\telement.off('touchend', touch.up.callback);\n\t\t}\n\n\t\tfunction removeWheelEvents() {\n\t\t\tvar events = this;\n\t\t\tvar element = events.element;\n\t\t\telement.off('mousewheel', events.mouseEvents.wheel.callback);\n\t\t}\n\n\t\tfunction removeScrollEvents() {\n\t\t\tvar events = this;\n\t\t\tvar element = events.element;\n\t\t\telement.off('DOMMouseScroll', events.scrollEvents.wheel.callback);\n\t\t}\n\n\t\t// statics methods\n\n\t\tfunction getTouch(e, previous) {\n\t\t\tvar point = new Point();\n\t\t\tif (e.type === 'touchstart' || e.type === 'touchmove' || e.type === 'touchend' || e.type === 'touchcancel') {\n\t\t\t\tvar touch = null;\n\t\t\t\tvar event = e.originalEvent ? e.originalEvent : e;\n\t\t\t\tvar touches = event.touches.length ? event.touches : event.changedTouches;\n\t\t\t\tif (touches && touches.length) {\n\t\t\t\t\ttouch = touches[0];\n\t\t\t\t}\n\t\t\t\tif (touch) {\n\t\t\t\t\tpoint.x = touch.pageX;\n\t\t\t\t\tpoint.y = touch.pageY;\n\t\t\t\t}\n\t\t\t} else if (e.type === 'click' || e.type === 'mousedown' || e.type === 'mouseup' || e.type === 'mousemove' || e.type === 'mouseover' || e.type === 'mouseout' || e.type === 'mouseenter' || e.type === 'mouseleave' || e.type === 'contextmenu') {\n\t\t\t\tpoint.x = e.pageX;\n\t\t\t\tpoint.y = e.pageY;\n\t\t\t}\n\t\t\tif (previous) {\n\t\t\t\tpoint.s = Point.difference(t, previous);\n\t\t\t}\n\t\t\tpoint.type = e.type;\n\t\t\treturn point;\n\t\t}\n\n\t\tfunction getRelativeTouch(node, point) {\n\t\t\tnode = angular.isArray(node) ? node[0] : node;\n\t\t\treturn Point.difference(point, {\n\t\t\t\tx: node.offsetLeft,\n\t\t\t\ty: node.offsetTop\n\t\t\t});\n\t\t}\n\n    }]);\n\n\tapp.service('EventsService', ['Dom', function (Dom) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\thasPassiveEvents: hasPassiveEvents,\n\t\t\taddEventListener: getAddEventListener(),\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// prevent history back on mac os\n\n\t\tpreventHistoryNavigation();\n\n\t\t// static methods\n\n\t\tfunction hasPassiveEvents() {\n\t\t\tvar supported = false;\n\t\t\tif (window.addEventListener) {\n\t\t\t\ttry {\n\t\t\t\t\tvar options = Object.defineProperty({}, 'passive', {\n\t\t\t\t\t\tget: function () {\n\t\t\t\t\t\t\tsupported = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\twindow.addEventListener('test', null, options);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('getAddEventListener.isSupprted', e);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn supported;\n\t\t}\n\n\t\tfunction getAddEventListener() {\n\t\t\tvar supported = hasPassiveEvents();\n\t\t\tif (!supported) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar defaults = {\n\t\t\t\tpassive: false,\n\t\t\t\tcapture: false,\n\t\t\t};\n\n\t\t\tfunction getModifiedAddEventListener(original) {\n\t\t\t\tfunction addEventListener(type, listener, options) {\n\t\t\t\t\tif (typeof options !== 'object') {\n\t\t\t\t\t\tvar capture = options === true;\n\t\t\t\t\t\toptions = angular.copy(defaults);\n\t\t\t\t\t\toptions.capture = capture;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toptions = angular.extend(angular.copy(defaults), options);\n\t\t\t\t\t}\n\t\t\t\t\toriginal.call(this, type, listener, options);\n\t\t\t\t}\n\t\t\t\treturn addEventListener;\n\t\t\t}\n\n\t\t\tvar original = EventTarget.prototype.addEventListener;\n\t\t\tvar modified = getModifiedAddEventListener(original);\n\t\t\tEventTarget.prototype.addEventListener = modified;\n\t\t\treturn modified;\n\t\t}\n\n\t\tfunction preventHistoryNavigation() {\n\t\t\tif (!Dom.ua.mac) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Dom.ua.chrome || Dom.ua.safari || Dom.ua.firefox) {\n\t\t\t\twindow.addEventListener('mousewheel', onScroll, {\n\t\t\t\t\tpassive: false\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onScroll(e) {\n\t\t\t\tif (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\t(e.deltaX < 0 && (Dom.getParents(e.target).filter(function (node) {\n\t\t\t\t\t\treturn node.scrollLeft > 0;\n\t\t\t\t\t}).length === 0)) ||\n\t\t\t\t\t(e.deltaX > 0 && (Dom.getParents(e.target).filter(function (node) {\n\t\t\t\t\t\treturn node.scrollWidth - node.scrollLeft > node.clientWidth;\n\t\t\t\t\t}).length === 0))\n\t\t\t\t) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n    }]);\n\n}());\n/* global angular, app, Autolinker */\r\n(function () {\r\n\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.filter('notIn', ['$filter', function ($filter) {\r\n\t\treturn function (array, filters, element) {\r\n\t\t\tif (filters) {\r\n\t\t\t\treturn $filter(\"filter\")(array, function (item) {\r\n\t\t\t\t\tfor (var i = 0; i < filters.length; i++) {\r\n\t\t\t\t\t\tif (filters[i][element] === item[element]) return false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('autolink', [function () {\r\n\t\treturn function (value) {\r\n\t\t\treturn Autolinker.link(value, {\r\n\t\t\t\tclassName: \"a-link\"\r\n\t\t\t});\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('shortName', ['$filter', function ($filter) {\r\n\t\tfunction toTitleCase(str) {\r\n\t\t\treturn str.replace(/\\w\\S*/g, function (txt) {\r\n\t\t\t\treturn txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn function (value) {\r\n\t\t\tif (!value) {\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\tif (value.indexOf(' .') === value.length - 2) {\r\n\t\t\t\tvalue = value.split(' .').join('');\r\n\t\t\t}\r\n\t\t\t/*\r\n\t\t\tvar splitted;\r\n\t\t\tif (value.indexOf('.') !== -1) {\r\n\t\t\t    splitted = value.split('.');\r\n\t\t\t} else {\r\n\t\t\t    splitted = value.split(' ');\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t\tvar splitted = value.split(' ');\r\n\t\t\tvar firstName = splitted.shift();\r\n\t\t\tif (splitted.length) {\r\n\t\t\t\tvar lastName = splitted.join(' ');\r\n\t\t\t\treturn firstName.substr(0, 1).toUpperCase() + '.' + toTitleCase(lastName);\r\n\t\t\t} else {\r\n\t\t\t\treturn firstName;\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customCurrency', ['$filter', function ($filter) {\r\n\t\tvar legacyFilter = $filter('currency');\r\n\t\treturn function (cost, currency) {\r\n\t\t\treturn legacyFilter(cost * currency.ratio, currency.formatting);\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customSize', ['APP', function (APP) {\r\n\t\treturn function (inches) {\r\n\t\t\tif (APP.unit === APP.units.IMPERIAL) {\r\n\t\t\t\tvar feet = Math.floor(inches / 12);\r\n\t\t\t\tinches = inches % 12;\r\n\t\t\t\tinches = Math.round(inches * 10) / 10;\r\n\t\t\t\treturn (feet ? feet + '\\' ' : '') + (inches + '\\'\\'');\r\n\t\t\t} else {\r\n\t\t\t\tvar meters = Math.floor(inches * APP.size.ratio);\r\n\t\t\t\tvar cm = (inches * APP.size.ratio * 100) % 100;\r\n\t\t\t\tcm = Math.round(cm * 10) / 10;\r\n\t\t\t\treturn (meters ? meters + 'm ' : '') + (cm + 'cm');\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customWeight', ['APP', function (APP) {\r\n\t\treturn function (pounds) {\r\n\t\t\tif (APP.unit === APP.units.IMPERIAL) {\r\n\t\t\t\tif (pounds < 1) {\r\n\t\t\t\t\tvar oz = pounds * 16;\r\n\t\t\t\t\toz = Math.round(oz * 10) / 10;\r\n\t\t\t\t\treturn (oz ? oz + 'oz ' : '');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpounds = Math.round(pounds * 100) / 100;\r\n\t\t\t\t\treturn (pounds ? pounds + 'lb ' : '');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar kg = Math.floor(pounds * APP.weight.ratio / 1000);\r\n\t\t\t\tvar grams = (pounds * APP.weight.ratio) % 1000;\r\n\t\t\t\tgrams = Math.round(grams * 10) / 10;\r\n\t\t\t\treturn (kg ? kg + 'kg ' : '') + (grams + 'g');\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customNumber', ['$filter', function ($filter) {\r\n\t\treturn function (value, precision, unit) {\r\n\t\t\tunit = unit || '';\r\n\t\t\t// return ((value || value === 0) ? $filter('number')(value, precision) + unit : '-');\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tif (Math.floor(value) === value) {\r\n\t\t\t\t\tprecision = 0;\r\n\t\t\t\t}\r\n\t\t\t\tvalue = $filter('number')(value, precision) + unit;\r\n\t\t\t} else {\r\n\t\t\t\tvalue = '-';\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('reportNumber', ['$filter', function ($filter) {\r\n\t\treturn function (value, precision, unit) {\r\n\t\t\tunit = unit || '';\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tvalue = $filter('number')(value, precision) + unit;\r\n\t\t\t} else {\r\n\t\t\t\tvalue = '-';\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customHours', [function () {\r\n\t\treturn function (value) {\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tvar hours = Math.floor(value);\r\n\t\t\t\tvar minutes = Math.floor((value - hours) * 60);\r\n\t\t\t\tvar label = hours ? hours + ' H' : '';\r\n\t\t\t\tlabel += minutes ? ' ' + minutes + ' m' : '';\r\n\t\t\t\treturn label;\r\n\t\t\t} else {\r\n\t\t\t\treturn '-';\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customTimer', [function () {\r\n\t\tvar second = 1000;\r\n\t\tvar minute = second * 60;\r\n\t\tvar hour = minute * 60;\r\n\t\treturn function (value) {\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tvar hours = Math.floor(value / hour);\r\n\t\t\t\tvar minutes = Math.floor((value - hours * hour) / minute);\r\n\t\t\t\tvar seconds = Math.floor((value - hours * hour - minutes * minute) / second);\r\n\t\t\t\tvar label = hours ? hours + ' H' : '';\r\n\t\t\t\tlabel += minutes ? ' ' + minutes + ' m' : '';\r\n\t\t\t\tlabel += seconds ? ' ' + seconds + ' s' : '';\r\n\t\t\t\treturn label;\r\n\t\t\t} else {\r\n\t\t\t\treturn '-';\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customDigitalTimer', [function () {\r\n\t\tvar second = 1000;\r\n\t\tvar minute = second * 60;\r\n\t\tvar hour = minute * 60;\r\n\t\treturn function (value) {\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tvar hours = Math.floor(value / hour);\r\n\t\t\t\tvar minutes = Math.floor((value - hours * hour) / minute);\r\n\t\t\t\tvar seconds = Math.floor((value - hours * hour - minutes * minute) / second);\r\n\t\t\t\t// hours = hours % 24;\r\n\t\t\t\treturn (hours < 10 ? '0' : '') + hours + ':' + (minutes < 10 ? '0' : '') + minutes + ':' + (seconds < 10 ? '0' : '') + seconds;\r\n\t\t\t} else {\r\n\t\t\t\treturn '-';\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customDigitalTime', [function () {\r\n\t\tvar second = 1000;\r\n\t\tvar minute = second * 60;\r\n\t\tvar hour = minute * 60;\r\n\t\treturn function (value) {\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tvar hours = Math.floor(value / hour);\r\n\t\t\t\tvar minutes = Math.floor((value - hours * hour) / minute);\r\n\t\t\t\t// hours = hours % 24;\r\n\t\t\t\treturn (hours < 10 ? '0' : '') + hours + ':' + (minutes < 10 ? '0' : '') + minutes;\r\n\t\t\t} else {\r\n\t\t\t\treturn '-';\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customDate', ['$filter', function ($filter) {\r\n\t\tvar filter = $filter('date');\r\n\t\treturn function (value, format, timezone) {\r\n\t\t\treturn value ? filter(value, format, timezone) : '-';\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customTime', ['$filter', function ($filter) {\r\n\t\treturn function (value, placeholder) {\r\n\t\t\tif (value) {\r\n\t\t\t\treturn Utils.parseTime(value);\r\n\t\t\t} else {\r\n\t\t\t\treturn (placeholder ? placeholder : '-');\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customDigital', ['$filter', function ($filter) {\r\n\t\treturn function (value, placeholder) {\r\n\t\t\tif (value) {\r\n\t\t\t\treturn Utils.parseHour(value);\r\n\t\t\t} else {\r\n\t\t\t\treturn (placeholder ? placeholder : '-');\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customString', ['$filter', function ($filter) {\r\n\t\treturn function (value, placeholder) {\r\n\t\t\treturn value ? value : (placeholder ? placeholder : '-');\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customEnum', function () {\r\n\t\treturn function (val) {\r\n\t\t\tval = val + 1;\r\n\t\t\treturn val < 10 ? '0' + val : val;\r\n\t\t};\r\n\t});\r\n\r\n\tapp.filter('groupBy', ['$parse', 'filterWatcher', function ($parse, filterWatcher) {\r\n\t\tfunction _groupBy(collection, getter) {\r\n\t\t\tvar dict = {};\r\n\t\t\tvar key;\r\n\t\t\tangular.forEach(collection, function (item) {\r\n\t\t\t\tkey = getter(item);\r\n\t\t\t\tif (!dict[key]) {\r\n\t\t\t\t\tdict[key] = [];\r\n\t\t\t\t}\r\n\t\t\t\tdict[key].push(item);\r\n\t\t\t});\r\n\t\t\treturn dict;\r\n\t\t}\r\n\t\treturn function (collection, property) {\r\n\t\t\tif (!angular.isObject(collection) || angular.isUndefined(property)) {\r\n\t\t\t\treturn collection;\r\n\t\t\t}\r\n\t\t\treturn filterWatcher.isMemoized('groupBy', arguments) || filterWatcher.memoize('groupBy', arguments, this, _groupBy(collection, $parse(property)));\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('htmlToPlaintext', function () {\r\n\t\tfunction getStyle(n, p) {\r\n\t\t\treturn n.currentStyle ? n.currentStyle[p] : window.getComputedStyle(n, null).getPropertyValue(p);\r\n\t\t}\r\n\r\n\t\tfunction toText(node) {\r\n\t\t\tvar result = '';\r\n\t\t\tif (node.nodeType == document.TEXT_NODE) {\r\n\t\t\t\tvar nodeValue = node.nodeValue;\r\n\t\t\t\tresult = nodeValue;\r\n\t\t\t\tresult = result ? String(result).replace(/</gm, '&lt;') : '';\r\n\t\t\t\tresult = result ? String(result).replace(/>/gm, '&gt;') : '';\r\n\t\t\t} else if (node.nodeType == document.ELEMENT_NODE) {\r\n\t\t\t\tfor (var i = 0, j = node.childNodes.length; i < j; i++) {\r\n\t\t\t\t\tresult += toText(node.childNodes[i]);\r\n\t\t\t\t}\r\n\t\t\t\tvar display = getStyle(node, 'display');\r\n\t\t\t\tif (display.match(/^block/) || display.match(/list/) || display.match(/row/) || node.tagName == 'BR' || node.tagName == 'HR') {\r\n\t\t\t\t\tresult += '\\n<br>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn function (html) {\r\n\t\t\tconsole.log(html);\r\n\t\t\tvar div = document.createElement('div');\r\n\t\t\tdiv.innerHTML = html;\r\n\t\t\treturn toText(div);\r\n\t\t\t// return html ? String(html).replace(/<[^>]+>/gm, '') : '';\r\n\t\t};\r\n\t});\r\n\r\n}());\n/* global angular, firebase */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Point', [function () {\n\n\t\tfunction Point(x, y) {\n\t\t\tthis.x = x || 0;\n\t\t\tthis.y = y || 0;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tdifference: PointDifference,\n\t\t\tmultiply: PointMultiply,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tclone: clone,\n\t\t\tcopy: copy,\n\t\t\tdifference: difference,\n\t\t\tmult: mult,\n\t\t\toffset: offset,\n\t\t\tsetPos: setPos,\n\t\t\tsetX: setX,\n\t\t\tsetY: setY,\n\t\t\ttoString: toString,\n\t\t};\n\n\t\tangular.extend(Point, statics);\n\t\tangular.extend(Point.prototype, publics);\n\n\t\treturn Point;\n\n\t\t// static methods\n\n\t\tfunction PointDifference(a, b) {\n\t\t\treturn new Point(a.x - b.x, a.y - b.y);\n\t\t}\n\n\t\tfunction PointMultiply(point, value) {\n\t\t\tpoint.x *= value;\n\t\t\tpoint.y *= value;\n\t\t\treturn point;\n\t\t}\n\n\t\t// prototype methods\n\n\t\tfunction clone() {\n\t\t\treturn new Point(this.x, this.y);\n\t\t}\n\n\t\tfunction copy(point) {\n\t\t\tthis.x = point.x;\n\t\t\tthis.y = point.y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction difference(b) {\n\t\t\treturn PointDifference(this, b);\n\t\t}\n\n\t\tfunction mult(value) {\n\t\t\treturn PointMultiply(this, value);\n\t\t}\n\n\t\tfunction offset(x, y) {\n\t\t\tthis.x += x;\n\t\t\tthis.y += y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setPos(x, y) {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setX(x) {\n\t\t\tthis.x = x;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setY(y) {\n\t\t\tthis.y = y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction toString() {\n\t\t\treturn '{' + this.x + ',' + this.y + '}';\n\t\t}\n\n    }]);\n\n}());\n/* global angular, firebase */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Rect', [function () {\n\n\t\tfunction Rect(x, y, w, h) {\n\t\t\tthis.x = x || 0;\n\t\t\tthis.y = y || 0;\n\t\t\tthis.w = w || 0;\n\t\t\tthis.h = h || 0;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tmult: RectMultiply,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tbottom: bottom,\n\t\t\tbottomLeft: bottomLeft,\n\t\t\tbottomRight: bottomRight,\n\t\t\tcenter: center,\n\t\t\tclone: clone,\n\t\t\tcopy: copy,\n\t\t\texpand: expand,\n\t\t\texpandRect: expandRect,\n\t\t\tintersect: intersect,\n\t\t\tleft: left,\n\t\t\tmult: mult,\n\t\t\toffset: offset,\n\t\t\treduce: reduce,\n\t\t\treduceRect: reduceRect,\n\t\t\tright: right,\n\t\t\tsetH: setH,\n\t\t\tsetPos: setPos,\n\t\t\tsetSize: setSize,\n\t\t\tsetX: setX,\n\t\t\tsetY: setY,\n\t\t\tsetW: setW,\n\t\t\ttop: top,\n\t\t\ttopLeft: topLeft,\n\t\t\ttopRight: topRight,\n\t\t\ttoString: toString,\n\t\t};\n\n\t\tangular.extend(Rect, statics);\n\t\tangular.extend(Rect.prototype, publics);\n\n\t\treturn Rect;\n\n\t\t// static methods\n\n\t\tfunction RectMultiply(rect, value) {\n\t\t\trect.x *= value;\n\t\t\trect.y *= value;\n\t\t\trect.w *= value;\n\t\t\trect.h *= value;\n\t\t\treturn rect;\n\t\t}\n\n\t\t// prototype methods\n\n\t\tfunction bottom() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w / 2,\n\t\t\t\ty: y + h\n\t\t\t};\n\t\t}\n\n\t\tfunction bottomLeft() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x,\n\t\t\t\ty: y + h\n\t\t\t};\n\t\t}\n\n\t\tfunction bottomRight() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w,\n\t\t\t\ty: y + h\n\t\t\t};\n\t\t}\n\n\t\tfunction center() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w / 2,\n\t\t\t\ty: y + h / 2\n\t\t\t};\n\t\t}\n\n\t\tfunction clone() {\n\t\t\treturn new Rect(this.x, this.y, this.w, this.h);\n\t\t}\n\n\t\tfunction copy(rect) {\n\t\t\tthis.x = rect.x;\n\t\t\tthis.y = rect.y;\n\t\t\tthis.w = rect.w;\n\t\t\tthis.h = rect.h;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction expand(size) {\n\t\t\treturn this.expandRect({\n\t\t\t\tx: size,\n\t\t\t\ty: size,\n\t\t\t\tw: size * 2,\n\t\t\t\th: size * 2\n\t\t\t});\n\t\t}\n\n\t\tfunction expandRect(rect) {\n\t\t\tthis.x -= rect.x || 0;\n\t\t\tthis.y -= rect.y || 0;\n\t\t\tthis.w += rect.w || 0;\n\t\t\tthis.h += rect.h || 0;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction intersect(rect) {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn !(rect.x > x + w || rect.x + rect.w < x || rect.y > y + h || rect.y + rect.h < y);\n\t\t}\n\n\t\tfunction left() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x,\n\t\t\t\ty: y + h / 2\n\t\t\t};\n\t\t}\n\n\t\tfunction mult(value) {\n\t\t\treturn RectMultiply(this, value);\n\t\t}\n\n\t\tfunction offset(x, y) {\n\t\t\tthis.x += x;\n\t\t\tthis.y += y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction reduce(size) {\n\t\t\treturn this.offset(-size);\n\t\t}\n\n\t\tfunction reduceRect(rect) {\n\t\t\treturn this.offsetRect(RectMultiply(rect, -1));\n\t\t}\n\n\t\tfunction right() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w,\n\t\t\t\ty: y + h / 2\n\t\t\t};\n\t\t}\n\n\t\tfunction setH(h) {\n\t\t\tthis.h = h;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setPos(x, y) {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setSize(w, h) {\n\t\t\tthis.w = w;\n\t\t\tthis.h = h;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setX(x) {\n\t\t\tthis.x = x;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setY(y) {\n\t\t\tthis.y = y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setW(w) {\n\t\t\tthis.w = w;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction top() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w / 2,\n\t\t\t\ty: y\n\t\t\t};\n\t\t}\n\n\t\tfunction topLeft() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x,\n\t\t\t\ty: y\n\t\t\t};\n\t\t}\n\n\t\tfunction topRight() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w,\n\t\t\t\ty: y\n\t\t\t};\n\t\t}\n\n\t\tfunction toString() {\n\t\t\treturn '{' + this.x + ',' + this.y + ',' + this.w + ',' + this.h + '}';\n\t\t}\n\n    }]);\n\n}());\n/* global angular, firebase */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Vector', function () {\n\t\tfunction Vector(x, y) {\n\t\t\tthis.x = x || 0;\n\t\t\tthis.y = y || 0;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tcross: VectorCross,\n\t\t\tdifference: VectorDifference,\n\t\t\tdistance: VectorDistance,\n\t\t\tincidence: VectorIncidence,\n\t\t\tmake: VectorMake,\n\t\t\tnormalize: VectorNormalize,\n\t\t\tpower: VectorPower,\n\t\t\tsize: VectorSize,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tadd: add,\n\t\t\tcopy: copy,\n\t\t\tcross: cross,\n\t\t\tdifference: difference,\n\t\t\tdistance: distance,\n\t\t\tfriction: friction,\n\t\t\tincidence: incidence,\n\t\t\tnormalize: normalize,\n\t\t\tpower: power,\n\t\t\tsize: size,\n\t\t\ttowards: towards,\n\t\t\ttoString: toString,\n\t\t};\n\n\t\tangular.extend(Vector, statics);\n\t\tangular.extend(Vector.prototype, publics);\n\n\t\treturn Vector;\n\n\t\t// statics methods\n\n\t\tfunction VectorCross(a, b) {\n\t\t\treturn (a.x * b.y) - (a.y * b.x);\n\t\t}\n\n\t\tfunction VectorDifference(a, b) {\n\t\t\treturn new Vector(a.x - b.x, a.y - b.y);\n\t\t}\n\n\t\tfunction VectorDistance(a, b) {\n\t\t\treturn Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));\n\t\t}\n\n\t\tfunction VectorIncidence(a, b) {\n\t\t\tvar angle = Math.atan2(b.y, b.x) - Math.atan2(a.y, a.x);\n\t\t\treturn angle;\n\t\t}\n\n\t\tfunction VectorMake(a, b) {\n\t\t\treturn new Vector(b.x - a.x, b.y - a.y);\n\t\t}\n\n\t\tfunction VectorNormalize(a) {\n\t\t\tvar l = Vector.size(a);\n\t\t\ta.x /= l;\n\t\t\ta.y /= l;\n\t\t\treturn a;\n\t\t}\n\n\t\tfunction VectorPower(a, b) {\n\t\t\tvar x = Math.abs(b.x - a.x);\n\t\t\tvar y = Math.abs(b.y - a.y);\n\t\t\treturn (x + y) / 2;\n\t\t}\n\n\t\tfunction VectorSize(a) {\n\t\t\treturn Math.sqrt(a.x * a.x + a.y * a.y);\n\t\t}\n\n\t\t// prototype methods\n\n\t\tfunction add(b) {\n\t\t\tthis.x += b.x;\n\t\t\tthis.y += b.y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction copy(b) {\n\t\t\treturn new Vector(this.x, this.y);\n\t\t}\n\n\t\tfunction cross(b) {\n\t\t\treturn VectorCross(this, b);\n\t\t}\n\n\t\tfunction difference(b) {\n\t\t\treturn VectorDifference(this, b);\n\t\t}\n\n\t\tfunction distance(b) {\n\t\t\treturn VectorDistance(this, b);\n\t\t}\n\n\t\tfunction friction(b) {\n\t\t\tthis.x *= b;\n\t\t\tthis.y *= b;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction incidence(b) {\n\t\t\treturn VectorIncidence(this, b);\n\t\t}\n\n\t\tfunction normalize() {\n\t\t\treturn VectorNormalize(this);\n\t\t}\n\n\t\tfunction power() {\n\t\t\treturn (Math.abs(this.x) + Math.abs(this.y)) / 2;\n\t\t}\n\n\t\tfunction size() {\n\t\t\treturn VectorSize(this);\n\t\t}\n\n\t\tfunction towards(b, friction) {\n\t\t\tfriction = friction || 0.125;\n\t\t\tthis.x += (b.x - this.x) * friction;\n\t\t\tthis.y += (b.y - this.y) * friction;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction toString() {\n\t\t\treturn '{' + this.x + ',' + this.y + '}';\n\t\t}\n\n\t});\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Hash', [function () {\n\t\tvar pools = {};\n\n\t\tfunction Hash(key, pool) {\n\t\t\tkey = key || 'id';\n\t\t\tpool = pool ? HashGet(pool) : {};\n\t\t\tObject.defineProperties(this, {\n\t\t\t\tkey: {\n\t\t\t\t\tvalue: key,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\twritable: false\n\t\t\t\t},\n\t\t\t\tpool: {\n\t\t\t\t\tvalue: pool,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\twritable: false\n\t\t\t\t},\n\t\t\t\tlength: {\n\t\t\t\t\tvalue: 0,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\twritable: true\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tvar publics = {\n\t\t\thas: has,\n\t\t\tget: get,\n\t\t\tgetItem: getItem,\n\t\t\tset: set,\n\t\t\tadd: add,\n\t\t\tonce: once,\n\t\t\tremove: remove,\n\t\t\teach: each,\n\t\t\taddMany: addMany,\n\t\t\tremoveMany: removeMany,\n\t\t\tremoveAll: removeAll,\n\t\t\tforward: forward,\n\t\t\tbackward: backward,\n\t\t\tdiffers: differs,\n\t\t\tupdatePool: updatePool,\n\t\t};\n\n\t\tvar statics = {\n\t\t\tget: HashGet,\n\t\t};\n\n\t\tHash.prototype = new Array;\n\t\tangular.extend(Hash.prototype, publics);\n\t\tangular.extend(Hash, statics);\n\n\t\treturn Hash;\n\n\t\t// publics\n\t\tfunction has(id) {\n\t\t\treturn this.pool[id] !== undefined;\n\t\t}\n\n\t\tfunction get(id) {\n\t\t\treturn this.pool[id];\n\t\t}\n\n\t\tfunction getItem(item) {\n\t\t\tvar hash = this,\n\t\t\t\tkey = this.key;\n\t\t\treturn item ? hash.get(item[key]) : null;\n\t\t}\n\n\t\tfunction set(item) {\n\t\t\tvar hash = this,\n\t\t\t\tpool = this.pool,\n\t\t\t\tkey = this.key;\n\t\t\tpool[item[key]] = item;\n\t\t\thash.push(item);\n\t\t\treturn item;\n\t\t}\n\n\t\tfunction add(newItem) {\n\t\t\tvar hash = this;\n\t\t\tvar item = hash.getItem(newItem);\n\t\t\tif (item) {\n\t\t\t\tfor (var i = 0, keys = Object.keys(newItem), p; i < keys.length; i++) {\n\t\t\t\t\tp = keys[i];\n\t\t\t\t\titem[p] = newItem[p];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem = hash.set(newItem);\n\t\t\t}\n\t\t\treturn item;\n\t\t}\n\n\t\tfunction once(newItem, callback) {\n\t\t\tvar hash = this;\n\t\t\tvar item = hash.getItem(newItem);\n\t\t\tif (!item) {\n\t\t\t\titem = hash.set(newItem);\n\t\t\t}\n\t\t\tif (typeof callback == 'function') {\n\t\t\t\tcallback(item);\n\t\t\t}\n\t\t\treturn item;\n\t\t}\n\n\t\tfunction remove(oldItem) {\n\t\t\tvar hash = this,\n\t\t\t\tpool = this.pool,\n\t\t\t\tkey = this.key;\n\t\t\tvar item = hash.getItem(oldItem);\n\t\t\tif (item) {\n\t\t\t\tvar index = hash.indexOf(item);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\thash.splice(index, 1);\n\t\t\t\t}\n\t\t\t\tdelete pool[item[key]];\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction addMany(items) {\n\t\t\tvar hash = this;\n\t\t\tif (!items) {\n\t\t\t\treturn hash;\n\t\t\t}\n\t\t\tvar i = 0;\n\t\t\twhile (i < items.length) {\n\t\t\t\thash.add(items[i]);\n\t\t\t\ti++;\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction removeMany(items) {\n\t\t\tvar hash = this;\n\t\t\tif (!items) {\n\t\t\t\treturn hash;\n\t\t\t}\n\t\t\tvar i = 0;\n\t\t\twhile (i < items.length) {\n\t\t\t\thash.remove(items[i]);\n\t\t\t\ti++;\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction removeAll() {\n\t\t\tvar hash = this,\n\t\t\t\tkey = hash.key,\n\t\t\t\tpool = hash.pool;\n\t\t\tvar i = 0,\n\t\t\t\tt = hash.length,\n\t\t\t\titem;\n\t\t\twhile (hash.length) {\n\t\t\t\titem = hash.shift();\n\t\t\t\tdelete pool[item[key]];\n\t\t\t\ti++;\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction each(callback) {\n\t\t\tvar hash = this;\n\t\t\tif (callback) {\n\t\t\t\tvar i = 0;\n\t\t\t\twhile (i < hash.length) {\n\t\t\t\t\tcallback(hash[i], i);\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction forward(key, reverse) {\n\t\t\tvar hash = this,\n\t\t\t\tkey = (key || this.key);\n\t\t\thash.sort(function (c, d) {\n\t\t\t\tvar a = reverse ? d : c;\n\t\t\t\tvar b = reverse ? c : d;\n\t\t\t\treturn a[key] - b[key];\n\t\t\t});\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction backward(key) {\n\t\t\treturn this.forward(key, true);\n\t\t}\n\n\t\tfunction differs(hash) {\n\t\t\tif (hash.key !== this.key || hash.length !== this.length) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tvar differs = false,\n\t\t\t\t\ti = 0,\n\t\t\t\t\tt = this.length,\n\t\t\t\t\tkey = this.key;\n\t\t\t\twhile (differs && i < t) {\n\t\t\t\t\tdiffers = this[i][key] !== hash[i][key];\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction updatePool() {\n\t\t\tvar hash = this,\n\t\t\t\tpool = this.pool,\n\t\t\t\tkey = this.key;\n\t\t\tObject.keys(pool).forEach(function (key) {\n\t\t\t\tdelete pool[key];\n\t\t\t});\n\t\t\tangular.forEach(hash, function (item) {\n\t\t\t\tpool[item[key]] = item;\n\t\t\t});\n\t\t}\n\n\t\t// statics\n\t\tfunction HashGet(pool) {\n\t\t\treturn pools[pool] = (pools[pool] || {});\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('$promise', ['$q', function ($q) {\n\n\t\tfunction $promise(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\tthrow ('promise resolve callback missing');\n\t\t\t}\n\t\t\tvar deferred = $q.defer();\n\t\t\tcallback(deferred);\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tall: $promiseAll,\n\t\t};\n\n\t\tvar publics = {};\n\n\t\tangular.extend($promise, statics);\n\t\tangular.extend($promise.prototype, publics);\n\n\t\treturn $promise;\n\n\t\tfunction $promiseAll(promises) {\n\t\t\treturn $q.all(promises);\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('State', ['$timeout', '$rootScope', function($timeout, $rootScope) {\n\n        function State() {\n            this.idle();\n        }\n\n        var DELAY = 2000;\n\n        var statics = {};\n\n        var publics = {\n            busy: busy,\n            classes: classes,\n            enabled: enabled,\n            error: error,\n            errorMessage: errorMessage,\n            errors: [],\n            idle: idle,\n            labels: labels,\n            ready: ready,\n            submitClass: submitClass,\n            success: success,\n        };\n\n        angular.extend(State, statics);\n        angular.extend(State.prototype, publics);\n\n        return State;\n\n        // static methods\n\n        // publics methods\n\n        function busy() {\n            var state = this;\n            if (!state.isBusy) {\n                state.isBusy = true;\n                state.isError = false;\n                state.isErroring = false;\n                state.isSuccess = false;\n                state.isSuccessing = false;\n                state.errors = [];\n                return true;\n            } else {\n                return false;\n            }\n        }\n\n        function classes(addons) {\n            var state = this,\n                classes = null;\n            classes = {\n                ready: state.isReady,\n                busy: state.isBusy,\n                successing: state.isSuccessing,\n                success: state.isSuccess,\n                errorring: state.isErroring,\n                error: state.isError,\n            };\n            if (addons) {\n                angular.forEach(addons, function(value, key) {\n                    classes[value] = classes[key];\n                });\n            }\n            return classes;\n        }\n\n        function enabled() {\n            var state = this;\n            return !state.isBusy && !state.isErroring && !state.isSuccessing;\n        }\n\n        function error(error) {\n            console.log('State.error', error);\n            var state = this;\n            state.isBusy = false;\n            state.isError = true;\n            state.isErroring = true;\n            state.isSuccess = false;\n            state.isSuccessing = false;\n            state.errors.push(error);\n            $timeout(function() {\n                state.isErroring = false;\n            }, DELAY);\n        }\n\n        function errorMessage() {\n            var state = this;\n            return state.isError ? state.errors[state.errors.length - 1] : null;\n        }\n\n        function idle() {\n            var state = this;\n            state.isBusy = false;\n            state.isError = false;\n            state.isErroring = false;\n            state.isSuccess = false;\n            state.isSuccessing = false;\n            state.button = null;\n            state.errors = [];\n        }\n\n        function labels(addons) {\n            var state = this;\n            var defaults = {\n                ready: 'submit',\n                busy: 'sending',\n                error: 'error',\n                success: 'success',\n            };\n            if (addons) {\n                angular.extend(defaults, addons);\n            }\n            var label = defaults.ready;\n            if (state.isBusy) {\n                label = defaults.busy;\n            } else if (state.isSuccess) {\n                label = defaults.success;\n            } else if (state.isError) {\n                label = defaults.error;\n            }\n            return label;\n        }\n\n        function ready() {\n            var state = this;\n            state.idle();\n            state.isReady = true;\n            $rootScope.$broadcast('$stateReady', state);\n        }\n\n        function submitClass() {\n            var state = this;\n            return {\n                busy: state.isBusy,\n                ready: state.isReady,\n                successing: state.isSuccessing,\n                success: state.isSuccess,\n                errorring: state.isErroring,\n                error: state.isError,\n            };\n        }\n\n        function success() {\n            var state = this;\n            state.isBusy = false;\n            state.isError = false;\n            state.isErroring = false;\n            state.isSuccess = true;\n            state.isSuccessing = true;\n            state.errors = [];\n            $timeout(function() {\n                state.isSuccessing = false;\n            }, DELAY);\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar transformProperty = detectTransformProperty();\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Style', [function () {\n\n\t\tfunction Style() {\n\t\t\tthis.props = {\n\t\t\t\tscale: 1,\n\t\t\t\thoverScale: 1,\n\t\t\t\tcurrentScale: 1,\n\t\t\t};\n\t\t}\n\n\t\tvar statics = {};\n\n\t\tvar publics = {\n\t\t\tset: set,\n\t\t\ttransform: transform,\n\t\t\ttransformOrigin: transformOrigin,\n\t\t};\n\n\t\tangular.extend(Style, statics);\n\t\tangular.extend(Style.prototype, publics);\n\n\t\treturn Style;\n\n\t\t// static methods\n\n\t\t// prototype methods\n\n\t\tfunction set(element) {\n\t\t\tvar styles = [];\n\t\t\tfor (var key in this) {\n\t\t\t\tif (key !== 'props') {\n\t\t\t\t\tstyles.push(key + ':' + this[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telement.style.cssText = styles.join(';') + ';';\n\t\t}\n\n\t\tfunction transform(transform) {\n\t\t\tthis[transformProperty] = transform;\n\t\t}\n\n\t\tfunction transformOrigin(x, y) {\n\t\t\tthis[transformProperty + '-origin-x'] = (Math.round(x * 1000) / 1000) + '%';\n\t\t\tthis[transformProperty + '-origin-y'] = (Math.round(y * 1000) / 1000) + '%';\n\t\t}\n\n    }]);\n\n\tfunction detectTransformProperty() {\n\t\tvar transformProperty = 'transform',\n\t\t\tsafariPropertyHack = 'webkitTransform';\n\t\tvar div = document.createElement(\"DIV\");\n\t\tif (typeof div.style[transformProperty] !== 'undefined') {\n            ['webkit', 'moz', 'o', 'ms'].every(function (prefix) {\n\t\t\t\tvar e = '-' + prefix + '-transform';\n\t\t\t\tif (typeof div.style[e] !== 'undefined') {\n\t\t\t\t\ttransformProperty = e;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t});\n\t\t} else if (typeof div.style[safariPropertyHack] !== 'undefined') {\n\t\t\ttransformProperty = '-webkit-transform';\n\t\t} else {\n\t\t\ttransformProperty = undefined;\n\t\t}\n\t\treturn transformProperty;\n\t}\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Utils', ['$compile', '$controller', 'Vector', function ($compile, $controller, Vector) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tcompileController: compileController,\n\t\t\textract: extract,\n\t\t\tformat: format,\n\t\t\tindexOf: indexOf,\n\t\t\treducer: reducer,\n\t\t\treducerAdder: reducerAdder,\n\t\t\treducerSetter: reducerSetter,\n\t\t\tremoveValue: removeValue,\n\t\t\treverseSortOn: reverseSortOn,\n\t\t\tthrottle: throttle,\n\t\t\ttoMd5: toMd5,\n\t\t\twhere: where,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tvar getNow = Date.now || function () {\n\t\t\treturn new Date().getTime();\n\t\t};\n\n\t\tfunction compileController(scope, element, html, data) {\n\t\t\t// console.log('Utils.compileController', element);\n\t\t\telement.html(html);\n\t\t\tvar link = $compile(element.contents());\n\t\t\tif (data.controller) {\n\t\t\t\tvar $scope = scope.$new();\n\t\t\t\tangular.extend($scope, data);\n\t\t\t\tvar controller = $controller(data.controller, {\n\t\t\t\t\t$scope: $scope\n\t\t\t\t});\n\t\t\t\tif (data.controllerAs) {\n\t\t\t\t\tscope[data.controllerAs] = controller;\n\t\t\t\t}\n\t\t\t\telement.data('$ngControllerController', controller);\n\t\t\t\telement.children().data('$ngControllerController', controller);\n\t\t\t\tscope = $scope;\n\t\t\t}\n\t\t\tlink(scope);\n\t\t}\n\n\t\tfunction extract(obj, value) {\n\t\t\treturn Object.keys(obj)[Object.values(obj).indexOf(value)];\n\t\t}\n\n\t\tfunction format(string, prepend, expression) {\n\t\t\tstring = string || '';\n\t\t\tprepend = prepend || '';\n\t\t\tvar splitted = string.split(',');\n\t\t\tif (splitted.length > 1) {\n\t\t\t\tvar formatted = splitted.shift();\n\t\t\t\tangular.forEach(splitted, function (value, index) {\n\t\t\t\t\tif (expression) {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join(prepend + value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (expression) {\n\t\t\t\t\treturn '\\'' + formatted + '\\'';\n\t\t\t\t} else {\n\t\t\t\t\treturn formatted;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn prepend + string;\n\t\t\t}\n\t\t}\n\n\t\tfunction indexOf(array, object, key) {\n\t\t\tkey = key || 'id';\n\t\t\tvar index = -1;\n\t\t\tif (array) {\n\t\t\t\tvar i = 0,\n\t\t\t\t\tt = array.length;\n\t\t\t\twhile (i < t) {\n\t\t\t\t\tif (array[i] && array[i][key] === object[key]) {\n\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn index;\n\t\t}\n\n\t\tfunction reducer(o, key) {\n\t\t\treturn o[key];\n\t\t}\n\n\t\tfunction reducerAdder(o, key, value) {\n\t\t\tif (typeof key == 'string') {\n\t\t\t\treturn reducerAdder(o, key.split('.'), value);\n\t\t\t} else if (key.length == 1 && value !== undefined) {\n\t\t\t\treturn (o[key[0]] += value);\n\t\t\t} else if (key.length === 0) {\n\t\t\t\treturn o;\n\t\t\t} else {\n\t\t\t\treturn reducerAdder(o[key[0]], key.slice(1), value);\n\t\t\t}\n\t\t}\n\n\t\tfunction reducerSetter(o, key, value) {\n\t\t\tif (typeof key == 'string') {\n\t\t\t\treturn reducerSetter(o, key.split('.'), value);\n\t\t\t} else if (key.length == 1 && value !== undefined) {\n\t\t\t\treturn (o[key[0]] = value);\n\t\t\t} else if (key.length === 0) {\n\t\t\t\treturn o;\n\t\t\t} else {\n\t\t\t\treturn reducerSetter(o[key[0]], key.slice(1), value);\n\t\t\t}\n\t\t}\n\n\t\tfunction removeValue(array, value) {\n\t\t\tvar index = -1;\n\t\t\tif (array) {\n\t\t\t\tvar i = 0,\n\t\t\t\t\tt = array.length;\n\t\t\t\twhile (i < t) {\n\t\t\t\t\tif (array[i] === value) {\n\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (index !== -1) {\n\t\t\t\tarray.splice(index, 1);\n\t\t\t\treturn value;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tfunction reverseSortOn(key) {\n\t\t\treturn function (a, b) {\n\t\t\t\tif (a[key] < b[key]) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t\tif (a[key] > b[key]) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\t// a must be equal to b\n\t\t\t\treturn 0;\n\t\t\t};\n\t\t}\n\n\t\tfunction throttle(func, wait, options) {\n\t\t\t// Returns a function, that, when invoked, will only be triggered at most once\n\t\t\t// during a given window of time. Normally, the throttled function will run\n\t\t\t// as much as it can, without ever going more than once per `wait` duration;\n\t\t\t// but if you'd like to disable the execution on the leading edge, pass\n\t\t\t// `{leading: false}`. To disable execution on the trailing edge, ditto.\n\t\t\tvar context, args, result;\n\t\t\tvar timeout = null;\n\t\t\tvar previous = 0;\n\t\t\tif (!options) options = {};\n\t\t\tvar later = function () {\n\t\t\t\tprevious = options.leading === false ? 0 : getNow();\n\t\t\t\ttimeout = null;\n\t\t\t\tresult = func.apply(context, args);\n\t\t\t\tif (!timeout) context = args = null;\n\t\t\t};\n\t\t\treturn function () {\n\t\t\t\tvar now = getNow();\n\t\t\t\tif (!previous && options.leading === false) previous = now;\n\t\t\t\tvar remaining = wait - (now - previous);\n\t\t\t\tcontext = this;\n\t\t\t\targs = arguments;\n\t\t\t\tif (remaining <= 0 || remaining > wait) {\n\t\t\t\t\tif (timeout) {\n\t\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\t\ttimeout = null;\n\t\t\t\t\t}\n\t\t\t\t\tprevious = now;\n\t\t\t\t\tresult = func.apply(context, args);\n\t\t\t\t\tif (!timeout) context = args = null;\n\t\t\t\t} else if (!timeout && options.trailing !== false) {\n\t\t\t\t\ttimeout = setTimeout(later, remaining);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t};\n\t\t}\n\n\t\tfunction toMd5(string) {\n\t\t\t// return Md5.encode(string);\n\t\t}\n\n\t\tfunction where(array, query) {\n\t\t\tvar found = null;\n\t\t\tif (array) {\n\t\t\t\tangular.forEach(array, function (item) {\n\t\t\t\t\tvar has = true;\n\t\t\t\t\tangular.forEach(query, function (value, key) {\n\t\t\t\t\t\thas = has && item[key] === value;\n\t\t\t\t\t});\n\t\t\t\t\tif (has) {\n\t\t\t\t\t\tfound = item;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn found;\n\t\t}\n\n    }]);\n\n\t(function () {\n\t\t// POLYFILL Array.prototype.reduce\n\t\t// Production steps of ECMA-262, Edition 5, 15.4.4.21\n\t\t// Reference: http://es5.github.io/#x15.4.4.21\n\t\t// https://tc39.github.io/ecma262/#sec-array.prototype.reduce\n\t\tif (typeof Array.prototype.reduce !== 'function') {\n\t\t\tObject.defineProperty(Array.prototype, 'reduce', {\n\t\t\t\tvalue: function (callback) { // , initialvalue\n\t\t\t\t\tif (this === null) {\n\t\t\t\t\t\tthrow new TypeError('Array.prototype.reduce called on null or undefined');\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof callback !== 'function') {\n\t\t\t\t\t\tthrow new TypeError(callback + ' is not a function');\n\t\t\t\t\t}\n\t\t\t\t\tvar o = Object(this);\n\t\t\t\t\tvar len = o.length >>> 0;\n\t\t\t\t\tvar k = 0;\n\t\t\t\t\tvar value;\n\t\t\t\t\tif (arguments.length == 2) {\n\t\t\t\t\t\tvalue = arguments[1];\n\t\t\t\t\t} else {\n\t\t\t\t\t\twhile (k < len && !(k in o)) {\n\t\t\t\t\t\t\tk++;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (k >= len) {\n\t\t\t\t\t\t\tthrow new TypeError('Reduce of empty array with no initial value');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvalue = o[k++];\n\t\t\t\t\t}\n\t\t\t\t\twhile (k < len) {\n\t\t\t\t\t\tif (k in o) {\n\t\t\t\t\t\t\tvalue = callback(value, o[k], k, o);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tk++;\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}());\n\n\t(function () {\n\t\t// POLYFILL Object.values\n\t\tif (typeof Object.values !== 'function') {\n\t\t\tObject.defineProperty(Object, 'values', {\n\t\t\t\tvalue: function (obj) {\n\t\t\t\t\tvar vals = [];\n\t\t\t\t\tfor (var key in obj) {\n\t\t\t\t\t\tif (has(obj, key) && isEnumerable(obj, key)) {\n\t\t\t\t\t\t\tvals.push(obj[key]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn vals;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}());\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.provider('environment', ['$locationProvider', '$httpProvider', function($locationProvider, $httpProvider) {\n\n        var provider = this;\n\n        var statics = {\n            add: EnvironmentAdd,\n            use: EnvironmentUse,\n        };\n\n        angular.extend(provider, statics);\n\n        var defaults = {\n            plugins: {\n                facebook: {\n                    fields: 'id,name,first_name,last_name,email,gender,picture,cover,link',\n                    scope: 'public_profile, email', // publish_stream\n                    version: 'v2.10',\n                },\n                google: {},\n                googlemaps: {\n                    clusterer: true,\n                    styles: '/googlemaps/applemapesque.json',\n                    options: {\n                        center: {\n                            lat: 43.9023386,\n                            lng: 12.8505094\n                        },\n                        disableDefaultUI: true,\n                        mapTypeId: 'roadmap', // \"hybrid\", \"roadmap\", \"satellite\", \"terrain\"\n                        scrollwheel: true,\n                        // tilt: 0, // 45\n                        zoom: 4.0,\n                    },\n                },\n                mapbox: {\n                    clusterer: true,\n                    options: {\n                        bearing: 0.0,\n                        center: [\n                            12.8505094,\n                            43.9023386\n                        ],\n                        curve: 1,\n                        pitch: 0.0,\n                        speed: 1.5,\n                        zoom: 4.0,\n                    },\n                    version: 'v0.42.0',\n                }\n            },\n            http: {\n                interceptors: [], // ['AuthService'],\n                withCredentials: false,\n            },\n            language: {\n                code: 'en',\n                culture: 'en_US',\n                iso: 'ENU',\n                name: 'English',\n            },\n            location: {\n                hash: '!',\n                html5: false,\n            },\n            paths: {},\n        };\n\n        var global = {};\n\n        if (window.environment) {\n            angular.merge(global, window.environment);\n        }\n\n        var config = {};\n\n        var environment = angular.copy(defaults);\n        angular.merge(environment, global);\n\n        function EnvironmentSetHttp() {\n            $httpProvider.defaults.headers.common[\"Accept-Language\"] = environment.language.code;\n            $httpProvider.defaults.withCredentials = environment.http.withCredentials;\n            $httpProvider.interceptors.push.apply($httpProvider.interceptors, environment.http.interceptors);\n        }\n\n        function EnvironmentSetLocation() {\n            $locationProvider.html5Mode(environment.location.html5);\n            $locationProvider.hashPrefix(environment.location.hash);\n        }\n\n        function EnvironmentAdd(key, data) {\n            config[key] = config[key] ? angular.merge(config[key], data) : data;\n            EnvironmentSet();\n        }\n\n        function EnvironmentSet() {\n            environment = angular.copy(defaults);\n            if (config.environment) {\n                angular.merge(environment, config.environment);\n            }\n            var value = EnvironmentGet();\n            if (value) {\n                angular.merge(environment, value);\n            }\n            angular.merge(environment, global);\n            EnvironmentSetHttp();\n            EnvironmentSetLocation();\n        }\n\n        function EnvironmentUse(key) {\n            if (config[key]) {\n                environment = angular.copy(defaults);\n                angular.merge(environment, config[key]);\n                angular.merge(environment, global);\n                EnvironmentSetHttp();\n                EnvironmentSetLocation();\n            }\n        }\n\n        function EnvironmentGet() {\n            for (var key in config) {\n                var value = config[key];\n                if (value.paths && window.location.href.indexOf(value.paths.app) !== -1) {\n                    return value;\n                }\n            }\n        }\n\n        provider.$get = function() {\n            return environment;\n        };\n\n    }]);\n\n}());\n/* global angular */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.factory('Doc', ['Api', '$promise', function (Api, $promise) {\r\n\r\n\t\tfunction Doc(item) {\r\n\t\t\tif (item) {\r\n\t\t\t\tangular.extend(this, item);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar statics = {};\r\n\r\n\t\tvar publics = {};\r\n\r\n\t\tangular.extend(Doc, statics);\r\n\t\tangular.extend(Doc.prototype, publics);\r\n\r\n\t\treturn Doc;\r\n\r\n\t\t// static methods\r\n\r\n\t\t// prototype methods\r\n\r\n    }]);\r\n\r\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Route', ['$promise', '$location', '$route', '$routeParams', 'Router', function ($promise, $location, $route, $routeParams, Router) {\n\n\t\tfunction Route(current) {\n\n\t\t\tvar route = {\n\t\t\t\tcontroller: current.$$route.controller,\n\t\t\t\tparams: current.params,\n\t\t\t\tpath: $location.path(),\n\t\t\t\tpathParams: current.pathParams,\n\t\t\t\toriginalPath: current.$$route.originalPath,\n\t\t\t\ttemplateUrl: current.loadedTemplateUrl,\n\t\t\t};\n\t\t\tangular.extend(this, route);\n\t\t}\n\n\t\tvar statics = {\n\t\t\tcurrent: RouteCurrent,\n\t\t};\n\n\t\tvar publics = {};\n\n\t\tangular.extend(Route, statics);\n\t\tangular.extend(Route.prototype, publics);\n\n\t\treturn Route;\n\n\t\t// static methods\n\n\t\tfunction RouteCurrent() {\n\t\t\treturn new Route($route.current);\n\t\t}\n\n\t\t// prototype methods\n\n    }]);\n\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.factory('View', ['Api', '$promise', 'environment', 'Doc', 'Route', function(Api, $promise, environment, Doc, Route) {\r\n\r\n        function View(doc, route) {\r\n            var view = {\r\n                doc: doc,\r\n                environment: environment,\r\n                route: route,\r\n            };\r\n            angular.extend(this, view);\r\n        }\r\n\r\n        var statics = {\r\n            current: ViewCurrent, // ViewCurrentSimple\r\n        };\r\n\r\n        var publics = {};\r\n\r\n        angular.extend(View, statics);\r\n        angular.extend(View.prototype, publics);\r\n\r\n        return View;\r\n\r\n        // static methods\r\n\r\n        function ViewCurrent() {\r\n            return $promise(function(promise) {\r\n                var route = Route.current();\r\n                var path = route.path;\r\n                console.log('ViewCurrent', path);\r\n                Api.docs.path(path).then(function(response) {\r\n                    var doc = new Doc(response);\r\n                    var view = new View(doc, route);\r\n                    promise.resolve(view);\r\n\r\n                }, function(error) {\r\n                    promise.reject(error);\r\n\r\n                });\r\n            });\r\n        }\r\n\r\n        function ViewCurrentSimple() {\r\n            return $promise(function(promise) {\r\n                console.log('ViewCurrentSimple');\r\n                var route = Route.current();\r\n                var path = route.path;\r\n                Api.navs.main().then(function(items) {\r\n                    var doc = null,\r\n                        view = null,\r\n                        path = path,\r\n                        pool = ViewPool(items);\r\n                    var item = pool[path];\r\n                    if (item) {\r\n                        doc = new Doc(item);\r\n                        view = new View(doc, route);\r\n                    }\r\n                    promise.resolve(view);\r\n\r\n                }, function(error) {\r\n                    promise.reject(error);\r\n\r\n                });\r\n            });\r\n        }\r\n\r\n        function ViewPool(items) {\r\n            var pool = {};\r\n\r\n            function _getPool(items) {\r\n                if (items) {\r\n                    angular.forEach(items, function(item) {\r\n                        pool[item.path] = item;\r\n                        _getPool(item.items);\r\n                    });\r\n                }\r\n            }\r\n            _getPool(items);\r\n            return pool;\r\n        }\r\n\r\n        // prototype methods\r\n\r\n    }]);\r\n\r\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    // todo\n\n    app.service('AuthService', ['$q', '$rootScope', '$location', 'LocalStorage', 'environment', function($q, $rootScope, $location, LocalStorage, environment) {\n\n        var service = this;\n\n        var statics = {\n            isAuthorizedOrGoTo: isAuthorizedOrGoTo,\n            isAuthorized: isAuthorized,\n            request: request,\n            response: response,\n            responseError: responseError,\n            signOut: signOut,\n        };\n\n        angular.extend(service, statics);\n\n        /* * * * * * * * * * * * * * * * *\n         *  detect current auth storage  *\n         * * * * * * * * * * * * * * * * */\n\n        console.log(environment.plugins);\n\n        // statics methods\n\n        function isAuthorizedOrGoTo(redirect) {\n            var deferred = $q.defer();\n            var auth = LocalStorage.get('authorization');\n            if (auth && auth.created_at + auth.expires_in < new Date().getTime()) {\n                deferred.resolve(auth);\n            } else {\n                deferred.reject({\n                    status: 'unauthorized'\n                });\n                $location.path(redirect);\n            }\n            return deferred.promise;\n        }\n\n        function isAuthorized() {\n            var auth = LocalStorage.get('authorization');\n            return (auth && auth.created_at + auth.expires_in < new Date().getTime());\n        }\n\n        function request(config) {\n            var auth = LocalStorage.get('authorization');\n            if (auth && auth.created_at + auth.expires_in < new Date().getTime()) {\n                config.headers = config.headers || {};\n                config.headers.Authorization = 'Bearer ' + auth.access_token; // add your token from your service or whatever\n            }\n            return config;\n        }\n\n        function response(response) {\n            return response || $q.when(response);\n        }\n\n        function responseError(error) {\n            console.log('AuthService.responseError', error);\n            // your error handler\n            switch (error.status) {\n                case 400:\n                    var errors = [];\n                    if (error.data) {\n                        errors.push(error.data.Message);\n                        for (var key in error.data.ModelState) {\n                            for (var i = 0; i < error.data.ModelState[key].length; i++) {\n                                errors.push(error.data.ModelState[key][i]);\n                            }\n                        }\n                    } else {\n                        errors.push('Server error');\n                    }\n                    error.Message = errors.join(' ');\n                    // warning !!\n                    $rootScope.httpError = error;\n                    $rootScope.$broadcast('onHttpInterceptorError', error);\n                    break;\n                case 404:\n                    error.Message = \"Not found\";\n                    $rootScope.httpError = error;\n                    $rootScope.$broadcast('onHttpInterceptorError', error);\n                    break;\n                case 500:\n                    // console.log('500',error);\n                    $rootScope.httpError = error;\n                    $rootScope.$broadcast('onHttpInterceptorError', error);\n                    break;\n                case 401:\n                    LocalStorage.delete('authorization');\n                    LocalStorage.delete('user');\n                    $location.path('/signin');\n                    break;\n                case -1:\n                    window.open(error.config.path, '_blank');\n                    // status == 0 you lost connection\n            }\n            return $q.reject(error);\n        }\n\n        function signOut() {\n            LocalStorage.delete('authorization');\n            LocalStorage.delete('user');\n            LocalStorage.delete('CampagnoloToken');\n            LocalStorage.delete('GoogleToken');\n            LocalStorage.delete('StravaToken');\n            LocalStorage.delete('FacebookToken');\n            LocalStorage.delete('GarminToken');\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Bearer', ['$http', '$promise', 'SessionStorage', 'LocalStorage', 'environment', function ($http, $promise, SessionStorage, LocalStorage, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\t'delete': BearerDelete,\n\t\t\texist: BearerExists,\n\t\t\tget: BearerGet,\n\t\t\tset: BearerSet,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// statics methods\n\n\t\tfunction BearerDelete(accessToken, remember) {\n\t\t\tSessionStorage.delete('accessToken');\n\t\t\tLocalStorage.delete('accessToken');\n\t\t\tdelete $http.defaults.headers.common['Authorization'];\n\t\t}\n\n\t\tfunction BearerExists(accessToken, remember) {\n\t\t\treturn SessionStorage.exist('accessToken') || LocalStorage.exist('accessToken');\n\t\t}\n\n\t\tfunction BearerGet(accessToken, remember) {\n\t\t\tvar accessToken = null;\n\t\t\tif (SessionStorage.exist('accessToken')) {\n\t\t\t\taccessToken = SessionStorage.get('accessToken');\n\t\t\t\tBearerSet(accessToken);\n\t\t\t} else if (LocalStorage.exist('accessToken')) {\n\t\t\t\taccessToken = LocalStorage.get('accessToken');\n\t\t\t\tBearerSet(accessToken);\n\t\t\t}\n\t\t\treturn accessToken;\n\t\t}\n\n\t\tfunction BearerSet(accessToken, remember) {\n\t\t\tvar header = 'Bearer ' + accessToken;\n\t\t\tdelete $http.defaults.headers.common['Authorization'];\n\t\t\t$http.defaults.headers.common['Authorization'] = header;\n\t\t\tSessionStorage.set('accessToken', accessToken);\n\t\t\tif (remember) {\n\t\t\t\tLocalStorage.set('accessToken', accessToken);\n\t\t\t}\n\t\t\treturn header;\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.service('Http', ['$http', '$promise', '$timeout', 'environment', function ($http, $promise, $timeout, environment) {\r\n\r\n\t\tvar service = this;\r\n\r\n\t\tvar statics = {\r\n\t\t\tget: HttpGet,\r\n\t\t\tpost: HttpPost,\r\n\t\t\tput: HttpPut,\r\n\t\t\tpatch: HttpPatch,\r\n\t\t\t'delete': HttpDelete,\r\n\t\t\t'static': HttpStatic,\r\n\t\t\tfake: HttpFake,\r\n\t\t};\r\n\r\n\t\tangular.extend(service, statics);\r\n\r\n\t\t// statics methods\r\n\r\n\t\tfunction HttpPath(path) {\r\n\t\t\treturn environment.paths.api + path;\r\n\t\t}\r\n\r\n\t\tfunction HttpPromise(method, path, data) {\r\n\t\t\treturn $promise(function (promise) {\r\n\t\t\t\t$http[method](path, data).then(function (response) {\r\n\t\t\t\t\tpromise.resolve(response.data);\r\n\r\n\t\t\t\t}, function (e, status) {\r\n\t\t\t\t\tvar error = (e && e.data) ? e.data : {};\r\n\t\t\t\t\terror.status = e.status;\r\n\t\t\t\t\tpromise.reject(error);\r\n\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction HttpGet(path) {\r\n\t\t\treturn HttpPromise('get', HttpPath(path));\r\n\t\t}\r\n\r\n\t\tfunction HttpPost(path, data) {\r\n\t\t\treturn HttpPromise('post', HttpPath(path), data);\r\n\t\t}\r\n\r\n\t\tfunction HttpPut(path, data) {\r\n\t\t\treturn HttpPromise('put', HttpPath(path), data);\r\n\t\t}\r\n\r\n\t\tfunction HttpPatch(path, data) {\r\n\t\t\treturn HttpPromise('patch', HttpPath(path), data);\r\n\t\t}\r\n\r\n\t\tfunction HttpDelete(path) {\r\n\t\t\treturn HttpPromise('delete', HttpPath(path));\r\n\t\t}\r\n\r\n\t\tfunction HttpStatic(path) {\r\n\t\t\treturn HttpPromise('get', path);\r\n\t\t}\r\n\r\n\t\tfunction HttpFake(data, msec) {\r\n\t\t\tmsec = msec || 1000;\r\n\t\t\treturn $promise(function (promise) {\r\n\t\t\t\t$timeout(function () {\r\n\t\t\t\t\tpromise.resolve({\r\n\t\t\t\t\t\tdata: data\r\n\t\t\t\t\t});\r\n\t\t\t\t}, msec);\r\n\t\t\t});\r\n\t\t}\r\n\r\n    }]);\r\n\r\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Preload', ['$promise', function ($promise) {\n\n\t\tfunction Preload(path) {\n\t\t\tvar preload = this;\n\t\t\tpreload.path = path;\n\t\t\tpreload.loaded = 0;\n\t\t\tpreload.total = 0;\n\t\t\tpreload.progress = 0;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tall: PreloadAll,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tstart: PreloadStart,\n\t\t\timage: PreloadImage,\n\t\t};\n\n\t\tangular.extend(Preload, statics);\n\t\tangular.extend(Preload.prototype, publics);\n\n\t\treturn Preload;\n\n\t\t// statics methods\n\n\t\tfunction PreloadAll(paths, callback) {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tvar preloads = paths.map(function (path) {\n\t\t\t\t\treturn new Preload(path);\n\t\t\t\t});\n\t\t\t\tvar progress = {\n\t\t\t\t\tloaded: 0,\n\t\t\t\t\ttotal: 0,\n\t\t\t\t\tprogress: 0,\n\t\t\t\t\tpreloads: preloads\n\t\t\t\t};\n\t\t\t\tvar i = setInterval(update, 1000 / 10);\n\t\t\t\t$promise.all(\n\t\t\t\t\tpreloads.map(function (preload) {\n\t\t\t\t\t\treturn preload.start();\n\t\t\t\t\t})\n\t\t\t\t).then(function () {\n\t\t\t\t\tclearInterval(i);\n\t\t\t\t\tupdate();\n\t\t\t\t\tpromise.resolve(preloads.slice());\n\t\t\t\t\t// destroy();\n\t\t\t\t}, function (error) {\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t// destroy();\n\t\t\t\t});\n\n\t\t\t\tfunction update() {\n\t\t\t\t\tprogress.loaded = 0;\n\t\t\t\t\tprogress.total = 0;\n\t\t\t\t\tangular.forEach(preloads, function (preload) {\n\t\t\t\t\t\tprogress.loaded += preload.loaded;\n\t\t\t\t\t\tprogress.total += preload.total;\n\t\t\t\t\t});\n\t\t\t\t\tvar percent = progress.total ? progress.loaded / progress.total : 0;\n\t\t\t\t\tif (percent > progress.progress) {\n\t\t\t\t\t\tprogress.progress = percent;\n\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\tcallback(progress);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction destroy() {\n\t\t\t\t\tangular.forEach(preloads, function (preload) {\n\t\t\t\t\t\tpreload.buffer = null;\n\t\t\t\t\t\tpreload.xhr = null;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// instance methods\n\n\t\tfunction PreloadStart() {\n\t\t\tvar preload = this;\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\t\txhr.open(\"GET\", preload.path, true);\n\t\t\t\txhr.responseType = \"arraybuffer\"; // should be after open for ie11\n\t\t\t\txhr.onloadstart = function (e) {\n\t\t\t\t\t/*\n\t\t\t\t\tpreload.loaded = 0;\n\t\t\t\t\tpreload.total = 1;\n\t\t\t\t\tpreload.progress = 0;\n\t\t\t\t\t*/\n\t\t\t\t};\n\t\t\t\txhr.onprogress = function (e) {\n\t\t\t\t\tpreload.loaded = e.loaded;\n\t\t\t\t\tpreload.total = e.total;\n\t\t\t\t\tpreload.progress = e.total ? e.loaded / e.total : 0;\n\t\t\t\t};\n\t\t\t\txhr.onloadend = function (e) {\n\t\t\t\t\tpreload.loaded = preload.total;\n\t\t\t\t\tpreload.progress = 1;\n\t\t\t\t};\n\t\t\t\txhr.onload = function () {\n\t\t\t\t\tpreload.buffer = xhr.response;\n\t\t\t\t\tpromise.resolve(preload);\n\t\t\t\t};\n\t\t\t\txhr.onerror = function (error) {\n\t\t\t\t\tconsole.log('Preload.xhr.onerror', error);\n\t\t\t\t\tpreload.loaded = preload.total;\n\t\t\t\t\tpreload.progress = 1;\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t};\n\t\t\t\txhr.send();\n\t\t\t\tpreload.xhr = xhr;\n\t\t\t});\n\t\t}\n\n\t\tfunction PreloadImage() {\n\t\t\tvar preload = this;\n\t\t\tvar blob = new Blob([preload.buffer]);\n\t\t\tvar image = new Image();\n\t\t\timage.src = window.URL.createObjectURL(blob);\n\t\t\treturn image;\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.service('$once', ['$promise', function($promise) {\n\n        var service = this;\n\n        var statics = {\n            load: OnceLoad,\n            script: OnceScript,\n            link: OnceLink,\n        };\n\n        angular.extend(service, statics);\n\n        var paths = {},\n            uid = 0;\n\n        function OnceLoad(path, callback) {\n            if (path.indexOf('.js')) {\n                return OnceScript(path, callback);\n\n            } else if (path.indexOf('.css')) {\n                return OnceLink(path);\n\n            }\n        }\n\n        function OnceScript(path, callback) {\n            return $promise(function(promise) {\n                try {\n                    var id = (paths[path] = paths[path] || ++uid);\n                    id = 'OnceScript' + id;\n                    if (document.getElementById(id)) {\n                        promise.reject();\n                    } else {\n                        var scripts = document.getElementsByTagName('script');\n                        var script = scripts[scripts.length - 1];\n                        var node = document.createElement('script');\n                        node.id = id;\n                        if (callback) {\n                            if (callback === true) {\n                                callback = id;\n                                path = path.split('{{callback}}').join(callback);\n                            }\n                            window[callback] = function(data) {\n                                promise.resolve(data);\n                            };\n                        } else {\n                            node.addEventListener('load', promise.resolve);\n                        }\n                        node.addEventListener('error', promise.reject);\n                        node.src = path;\n                        script.parentNode.insertBefore(node, script.nextSibling);\n                    }\n                } catch (error) {\n                    promise.reject(error);\n                }\n            });\n        }\n\n        function OnceLink(path) {\n            return $promise(function(promise) {\n                try {\n                    var id = (paths[path] = paths[path] || ++uid);\n                    id = 'OnceStyle' + id;\n                    if (document.getElementById(id)) {\n                        promise.resolve();\n                    } else {\n                        var links = document.getElementsByTagName('link');\n                        var link = links[links.length - 1];\n                        var node = document.createElement('link');\n                        node.id = id;\n                        node.rel = 'stylesheet';\n                        node.href = path;\n                        node.addEventListener('load', promise.resolve);\n                        node.addEventListener('error', promise.reject);\n                        link.parentNode.insertBefore(node, link.nextSibling);\n                    }\n                } catch (error) {\n                    promise.reject(error);\n                }\n            });\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.service('Router', ['$rootScope', '$location', '$route', '$timeout', function($rootScope, $location, $route, $timeout) {\n\n        var service = this;\n\n        var statics = {\n            isController: RouterIsController,\n            redirect: RouterRedirect,\n            path: RouterPath,\n            apply: RouterApply,\n        };\n\n        angular.extend(service, statics);\n\n        $rootScope.$on('$routeChangeStart', RouterOnChangeStart);\n        $rootScope.$on('$routeChangeSuccess', RouterOnChangeSuccess);\n        $rootScope.$on('$routeChangeError', RouterOnChangeError);\n        $rootScope.$on('$routeUpdate', RouterOnUpdate);\n        $rootScope.$on('$stateReady', RouterOnStateReady);\n\n        var $previous, $current, $next;\n        var $previousController, $currentController, $nextController;\n\n        function RouterSetControllers() {\n            $previousController = $previous ? $previous.controller : null;\n            $currentController = $current ? $current.controller : null;\n            $nextController = $next ? $next.controller : null;\n        }\n\n        /*\n        $routeChangeStart\n        Broadcasted before a route change. At this point the route services starts resolving all of the dependencies needed for the route change to occur. Typically this involves fetching the view template as well as any dependencies defined in resolve route property. Once all of the dependencies are resolved $routeChangeSuccess is fired.\n        The route change (and the $location change that triggered it) can be prevented by calling preventDefault method of the event. See $rootScope.Scope for more details about event object.\n        */\n        function RouterOnChangeStart(event, next, current) {\n            $previous = null;\n            $current = current ? current.$$route : null;\n            $next = next ? next.$$route : null;\n            RouterSetControllers();\n            // console.log('Router.RouterOnChangeStart', '$previous', $previous, '$current', $current, '$next', $next);\n            service.loading = true;\n        }\n\n        /*\n        $routeChangeSuccess\n        Broadcasted after a route change has happened successfully. The resolve dependencies are now available in the current.locals property.\n        */\n        function RouterOnChangeSuccess(event, current, previous) {\n            $previous = previous ? previous.$$route : null;\n            $current = current ? current.$$route : null;\n            $next = null;\n            RouterSetControllers();\n            // console.log('Router.RouterOnChangeSuccess', '$previous', $previous, '$current', $current, '$next', $next);\n        }\n\n        /*\n        $routeChangeError\n        Broadcasted if a redirection function fails or any redirection or resolve promises are rejected.\n        */\n        function RouterOnChangeError(event, current, previous, rejection) {\n            $previous = null;\n            $current = previous.$$route || null;\n            $next = null;\n            RouterSetControllers();\n            // console.log('Router.RouterOnChangeError', '$previous', $previous, '$current', $current, '$next', $next);\n        }\n\n        /*\n        $routeUpdate\n        The reloadOnSearch property has been set to false, and we are reusing the same instance of the Controller.\n        */\n        function RouterOnUpdate(event, current) {\n            $previous = current ? current.$$route : null;\n            $current = current ? current.$$route : null;\n            $next = null;\n            RouterSetControllers();\n            // console.log('Router.RouterOnUpdate', '$previous', $previous, '$current', $current, '$next', $next);\n        }\n\n        function RouterOnStateReady(scope, state) {\n            $timeout(function() {\n                service.loading = false;\n            }, 1000);\n        }\n\n        function RouterIsController(controller) {\n            return $currentController === controller;\n        }\n\n        // navigation\n\n        function RouterRedirectTo(path) {\n            $location.$$lastRequestedPath = $location.path();\n            $location.path(path);\n        }\n\n        function RouterRetryLastRequestedPath(path) {\n            path = $location.$$lastRequestedPath || path;\n            $location.$$lastRequestedPath = null;\n            $location.path(path);\n        }\n\n        function RouterRedirect(path, msecs) {\n            if (msecs) {\n                $timeout(function() {\n                    RouterRedirectTo(path);\n                }, msecs);\n            } else {\n                RouterRedirectTo(path);\n            }\n        }\n\n        function RouterPath(path, msecs) {\n            if (msecs) {\n                $timeout(function() {\n                    RouterRetryLastRequestedPath(path);\n                }, msecs);\n            } else {\n                RouterRetryLastRequestedPath(path);\n            }\n        }\n\n        function RouterApply(path, msecs) {\n            if (msecs) {\n                $timeout(function() {\n                    $location.path(path);\n                }, msecs);\n            } else {\n                $timeout(function() {\n                    $location.path(path);\n                });\n            }\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Silent', ['$rootScope', '$location', function ($rootScope, $location) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tsilent: SilentSilent,\n\t\t\tpath: SilentPath,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t$rootScope.$$listeners.$locationChangeSuccess.unshift(SilentListener);\n\t\t// console.log('$rootScope.$$listeners.$locationChangeSuccess', $rootScope.$$listeners.$locationChangeSuccess);\n\n\t\t// private vars\n\n\t\tvar $path;\n\n\t\t// static methods\n\n\t\tfunction SilentGetDomain() {\n\t\t\tvar currentDomain = window.location.protocol + '//' + window.location.hostname + (window.location.port ? ':' + window.location.port : '');\n\t\t\treturn currentDomain;\n\t\t}\n\n\t\tfunction SilentUnlink() {\n\t\t\tvar listeners = $rootScope.$$listeners.$locationChangeSuccess;\n\t\t\tangular.forEach(listeners, function (value, name) {\n\t\t\t\tif (value === listener) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfunction relink() {\n\t\t\t\t\tlisteners[name] = value;\n\t\t\t\t}\n\t\t\t\tlisteners[name] = relink; // temporary unlinking\n\t\t\t});\n\t\t}\n\n\t\tfunction SilentListener(e) {\n\t\t\t// console.log('onLocationChangeSuccess', e);\n\t\t\tif ($path === $location.path()) {\n\t\t\t\tSilentUnlink();\n\t\t\t}\n\t\t\t$path = null;\n\t\t}\n\n\t\tfunction SilentSilent(path, replace) {\n\t\t\t// this.prev = $location.path(); ???\n\t\t\tvar location = $location.url(path);\n\t\t\tif (replace) {\n\t\t\t\tlocation.replace();\n\t\t\t}\n\t\t\t$path = $location.path();\n\t\t}\n\n\t\tfunction SilentPath(path) {\n\t\t\treturn $location.path(path);\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tvar TIMEOUT = 5 * 60 * 1000; // five minutes\n\n\tapp.service('Cookie', ['$promise', function ($promise) {\n\n\t\tvar service = {\n\t\t\tTIMEOUT: TIMEOUT,\n\t\t\t'delete': CookieDelete,\n\t\t\texist: CookieExists,\n\t\t\tget: CookieGet,\n\t\t\ton: CookieOn,\n\t\t\tset: CookieSet,\n\t\t};\n\n\t\tangular.extend(this, service);\n\n\t\tfunction CookieDelete(name) {\n\t\t\tCookieSetter(name, \"\", -1);\n\t\t}\n\n\t\tfunction CookieExists(name) {\n\t\t\treturn document.cookie.indexOf(';' + name + '=') !== -1 || document.cookie.indexOf(name + '=') === 0;\n\t\t}\n\n\t\tfunction CookieGet(name) {\n\t\t\tvar cookieName = name + \"=\";\n\t\t\tvar ca = document.cookie.split(';');\n\t\t\tfor (var i = 0; i < ca.length; i++) {\n\t\t\t\tvar c = ca[i];\n\t\t\t\twhile (c.charAt(0) == ' ') {\n\t\t\t\t\tc = c.substring(1, c.length);\n\t\t\t\t}\n\t\t\t\tif (c.indexOf(cookieName) === 0) {\n\t\t\t\t\tvar value = c.substring(cookieName.length, c.length);\n\t\t\t\t\tvar model = null;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tmodel = JSON.parse(decodeURIComponent(atob(value)));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.log('Cookie.get.error parsing', key, e);\n\t\t\t\t\t}\n\t\t\t\t\treturn model;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction CookieOn(name) {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tvar i, interval = 1000,\n\t\t\t\t\telapsed = 0,\n\t\t\t\t\ttimeout = Cookie.TIMEOUT;\n\n\t\t\t\tfunction checkCookie() {\n\t\t\t\t\tif (elapsed > timeout) {\n\t\t\t\t\t\tpromise.reject('timeout');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar c = CookieGet(name);\n\t\t\t\t\t\tif (c) {\n\t\t\t\t\t\t\tpromise.resolve(c);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telapsed += interval;\n\t\t\t\t\t\t\ti = setTimeout(checkCookie, interval);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcheckCookie();\n\t\t\t});\n\t\t}\n\n\t\tfunction CookieSet(name, value, days) {\n\t\t\ttry {\n\t\t\t\tvar cache = [];\n\t\t\t\tvar json = JSON.stringify(value, function (key, value) {\n\t\t\t\t\tif (key === 'pool') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.indexOf(value) !== -1) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.push(value);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\tcache = null;\n\t\t\t\tCookieSetter(name, btoa(encodeURIComponent(json)), days);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('CookieSet.error serializing', name, value, e);\n\t\t\t}\n\t\t}\n\n\t\tfunction CookieSetter(name, value, days) {\n\t\t\tvar expires;\n\t\t\tif (days) {\n\t\t\t\tvar date = new Date();\n\t\t\t\tdate.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n\t\t\t\texpires = '; expires=' + date.toGMTString();\n\t\t\t} else {\n\t\t\t\texpires = '';\n\t\t\t}\n\t\t\tdocument.cookie = name + '=' + value + expires + '; path=/';\n\t\t}\n\n    }]);\n\n\tapp.service('LocalStorage', ['$promise', 'Cookie', function ($promise, Cookie) {\n\n\t\tvar service = {\n\t\t\tTIMEOUT: TIMEOUT,\n\t\t\t'delete': LocalDelete,\n\t\t\texist: LocalExists,\n\t\t\tget: LocalGet,\n\t\t\ton: LocalOn,\n\t\t\tset: LocalSet,\n\t\t};\n\n\t\tvar supported = LocalSupported();\n\n\t\tif (supported) {\n\t\t\tangular.extend(this, service);\n\t\t} else {\n\t\t\tangular.extend(this, Cookie);\n\t\t}\n\n\t\tthis.supported = supported;\n\n\t\tfunction LocalSupported() {\n\t\t\tvar supported = false;\n\t\t\ttry {\n\t\t\t\tsupported = 'localStorage' in window && window.localStorage !== null;\n\t\t\t\tif (supported) {\n\t\t\t\t\twindow.localStorage.setItem('test', '1');\n\t\t\t\t\twindow.localStorage.removeItem('test');\n\t\t\t\t} else {\n\t\t\t\t\tsupported = false;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tsupported = false;\n\t\t\t}\n\t\t\treturn supported;\n\t\t}\n\n\t\tfunction LocalExists(name) {\n\t\t\treturn window.localStorage[name] !== undefined;\n\t\t}\n\n\t\tfunction LocalGet(name) {\n\t\t\tvar value = null;\n\t\t\tif (window.localStorage[name] !== undefined) {\n\t\t\t\ttry {\n\t\t\t\t\tvalue = JSON.parse(window.localStorage[name]);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('LocalStorage.get.error parsing', name, e);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction LocalSet(name, value) {\n\t\t\ttry {\n\t\t\t\tvar cache = [];\n\t\t\t\tvar json = JSON.stringify(value, function (key, value) {\n\t\t\t\t\tif (key === 'pool') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.indexOf(value) !== -1) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.push(value);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\tcache = null;\n\t\t\t\twindow.localStorage.setItem(name, json);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('LocalStorage.set.error serializing', name, value, e);\n\t\t\t}\n\t\t}\n\n\t\tfunction LocalDelete(name) {\n\t\t\twindow.localStorage.removeItem(name);\n\t\t}\n\n\t\tfunction LocalOn(name) {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tvar i, timeout = Cookie.TIMEOUT;\n\n\t\t\t\tfunction storageEvent(e) {\n\t\t\t\t\t// console.log('LocalStorage.on', name, e);\n\t\t\t\t\tif (i) {\n\t\t\t\t\t\tclearTimeout(i);\n\t\t\t\t\t}\n\t\t\t\t\tif (e.originalEvent.key == name) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n\t\t\t\t\t\t\tpromise.resolve(value);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.log('LocalStorage.on.error parsing', name, error);\n\t\t\t\t\t\t\tpromise.reject('error parsing ' + name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tangular.element(window).on('storage', storageEvent);\n\t\t\t\ti = setTimeout(function () {\n\t\t\t\t\tpromise.reject('timeout');\n\t\t\t\t}, timeout);\n\t\t\t});\n\t\t}\n\n    }]);\n\n\tapp.service('SessionStorage', ['$promise', 'Cookie', function ($promise, Cookie) {\n\n\t\tvar service = {\n\t\t\tTIMEOUT: TIMEOUT,\n\t\t\t'delete': SessionDelete,\n\t\t\texist: SessionExists,\n\t\t\tget: SessionGet,\n\t\t\ton: SessionOn,\n\t\t\tset: SessionSet,\n\t\t};\n\n\t\tvar supported = SessionSupported();\n\n\t\tif (supported) {\n\t\t\tangular.extend(this, service);\n\t\t} else {\n\t\t\tangular.extend(this, Cookie);\n\t\t}\n\n\t\tthis.supported = supported;\n\n\t\tfunction SessionSupported() {\n\t\t\tvar supported = false;\n\t\t\ttry {\n\t\t\t\tsupported = 'sessionStorage' in window && window.sessionStorage !== undefined;\n\t\t\t\tif (supported) {\n\t\t\t\t\twindow.sessionStorage.setItem('test', '1');\n\t\t\t\t\twindow.sessionStorage.removeItem('test');\n\t\t\t\t} else {\n\t\t\t\t\tsupported = false;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tsupported = false;\n\t\t\t}\n\t\t\treturn supported;\n\t\t}\n\n\t\tfunction SessionExists(name) {\n\t\t\treturn window.sessionStorage[name] !== undefined;\n\t\t}\n\n\t\tfunction SessionGet(name) {\n\t\t\tvar value = null;\n\t\t\tif (window.sessionStorage[name] !== undefined) {\n\t\t\t\ttry {\n\t\t\t\t\tvalue = JSON.parse(window.sessionStorage[name]);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('SessionStorage.get.error parsing', name, e);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction SessionSet(name, value) {\n\t\t\ttry {\n\t\t\t\tvar cache = [];\n\t\t\t\tvar json = JSON.stringify(value, function (key, value) {\n\t\t\t\t\tif (key === 'pool') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.indexOf(value) !== -1) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.push(value);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\tcache = null;\n\t\t\t\twindow.sessionStorage.setItem(name, json);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('SessionStorage.set.error serializing', name, value, e);\n\t\t\t}\n\t\t}\n\n\t\tfunction SessionDelete(name) {\n\t\t\twindow.sessionStorage.removeItem(name);\n\t\t}\n\n\t\tfunction SessionOn(name) {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tvar i, timeout = Cookie.TIMEOUT;\n\n\t\t\t\tfunction storageEvent(e) {\n\t\t\t\t\t// console.log('SessionStorage.on', name, e);\n\t\t\t\t\tif (i) {\n\t\t\t\t\t\tclearTimeout(i);\n\t\t\t\t\t}\n\t\t\t\t\tif (e.originalEvent.key === name) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n\t\t\t\t\t\t\tpromise.resolve(value);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.log('SessionStorage.on.error parsing', name, error);\n\t\t\t\t\t\t\tpromise.reject('error parsing ' + name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tangular.element(window).on('storage', storageEvent);\n\t\t\t\ti = setTimeout(function () {\n\t\t\t\t\tpromise.reject('timeout');\n\t\t\t\t}, timeout);\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Trust', ['$sce', function ($sce) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\thtml: TrustHtml,\n\t\t\tresource: TrustResource,\n\t\t\turl: TrustUrl,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// private vars\n\n\t\tvar values = [],\n\t\t\ttrustedValues = [];\n\n\t\tfunction TrustGetValue(value) {\n\t\t\tvar index = values.indexOf(value);\n\t\t\tif (index !== -1) {\n\t\t\t\treturn trustedValues[index];\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tfunction TrustSetValue(value, trustedValue) {\n\t\t\tvalues.push(value);\n\t\t\tvalues.push(trustedValue);\n\t\t}\n\n\t\tfunction TrustGetOrSet(value, callback) {\n\t\t\tvar trustedValue = TrustGetValue(value);\n\t\t\tif (!trustedValue) {\n\t\t\t\ttrustedValue = callback();\n\t\t\t\tTrustSetValue(value, trustedValue);\n\t\t\t}\n\t\t\treturn trustedValue;\n\t\t}\n\n\t\tfunction TrustHtml(value) {\n\t\t\treturn TrustGetOrSet(value, function () {\n\t\t\t\treturn $sce.trustAsHtml(value);\n\t\t\t});\n\t\t}\n\n\t\tfunction TrustResource(value) {\n\t\t\treturn TrustGetOrSet(value, function () {\n\t\t\t\treturn $sce.trustAsResourceUrl(value);\n\t\t\t});\n\t\t}\n\n\t\tfunction TrustUrl(value) {\n\t\t\treturn TrustGetOrSet(value, function () {\n\t\t\t\treturn 'url(\\'' + value + '\\')';\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('FacebookService', ['$promise', '$once', 'LocalStorage', 'environment', function ($promise, $once, storage, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\trequire: FacebookRequire,\n\t\t\tlogin: FacebookLogin,\n\t\t\tlogout: FacebookLogout,\n\t\t\tstatus: FacebookStatus,\n\t\t\tgetMe: FacebookGetMe,\n\t\t\tgetMyPicture: FacebookGetMyPicture,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// private vars\n\n\t\tif (!environment.plugins.facebook) {\n\t\t\ttrhow('FacebookService.error missing config object in environment.plugins.facebook');\n\t\t}\n\n\t\tvar config = environment.plugins.facebook;\n\n\t\t// statics methods\n\n\t\t/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\n\t\t *  calling facebook initializer on page load to avoid popup blockers via asyncronous loading  *\n\t\t * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n\t\tvar authResponse = storage.get('facebook');\n\t\t/*\n\t\tauthResponse = {\n\t\t    accessToken: \"accessTokenXXXXX\",\n\t\t    expiresIn: 4962,\n\t\t    signedRequest: \"signedRequestXXXXX\",\n\t\t    userID: \"10214671620773661\",\n\t\t}\n\t\t*/\n\t\tconsole.log('facebook.storage', authResponse);\n\n\t\tfunction FacebookRequire() {\n\t\t\treturn Facebook();\n\t\t}\n\n\t\tfunction Facebook() {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tif (window.FB !== undefined) {\n\t\t\t\t\tpromise.resolve(window.FB);\n\t\t\t\t} else {\n\t\t\t\t\tFacebookOnce().then(function (success) {\n\t\t\t\t\t\tpromise.resolve(window.FB);\n\t\t\t\t\t}, function (error) {\n\t\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookOnce() {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\t$once.script('//connect.facebook.net/' + environment.language.culture + '/sdk.js', 'fbAsyncInit').then(function () {\n\t\t\t\t\t// console.log('FacebookOnce.fbAsyncInit', window.FB);\n\t\t\t\t\twindow.FB.init({\n\t\t\t\t\t\tappId: config.appId,\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\tcookie: true,\n\t\t\t\t\t\txfbml: true,\n\t\t\t\t\t\tversion: config.version,\n\t\t\t\t\t});\n\t\t\t\t\tpromise.resolve(window.FB);\n\t\t\t\t\t// window.fbAsyncInit = null;\n\t\t\t\t}, function (error) {\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookStatus(response, promise, init) {\n\t\t\tservice.authResponse = null;\n\t\t\tif (response.status === 'connected') {\n\t\t\t\tservice.authResponse = response.authResponse;\n\t\t\t\tstorage.set('facebook', response.authResponse);\n\t\t\t\tpromise.resolve(response);\n\t\t\t} else if (response.status === 'not_authorized') {\n\t\t\t\tstorage.delete('facebook');\n\t\t\t\tif (init) {\n\t\t\t\t\tpromise.resolve(response);\n\t\t\t\t} else {\n\t\t\t\t\tpromise.reject(response);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpromise.reject(response);\n\t\t\t}\n\t\t}\n\n\t\tfunction FacebookGetMe(fields) {\n\t\t\tfields = fields || config.fields;\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tFacebookLogin().then(function (response) {\n\t\t\t\t\twindow.FB.api('/me', {\n\t\t\t\t\t\tfields: fields\n\t\t\t\t\t}, function (response) {\n\t\t\t\t\t\tif (!response || response.error) {\n\t\t\t\t\t\t\tvar error = response ? response.error : 'error';\n\t\t\t\t\t\t\tconsole.log('FacebookGetMe.error', error);\n\t\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('FacebookGetMe.success', response);\n\t\t\t\t\t\t\tpromise.resolve(response);\n\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookGetMyPicture(size) {\n\t\t\tsize = size || 300;\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tFacebookLogin().then(function (facebook) {\n\t\t\t\t\twindow.FB.api('/me/picture', {\n\t\t\t\t\t\twidth: size,\n\t\t\t\t\t\theight: size,\n\t\t\t\t\t\ttype: 'square'\n\t\t\t\t\t}, function (response) {\n\t\t\t\t\t\tif (!response || response.error) {\n\t\t\t\t\t\t\tvar error = response ? response.error : 'error';\n\t\t\t\t\t\t\tconsole.log('FacebookGetMyPicture.error', error);\n\t\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('FacebookGetMyPicture.success', response);\n\t\t\t\t\t\t\tpromise.resolve(response);\n\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookLogin() {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tFacebook().then(function (facebook) {\n\t\t\t\t\tconsole.log('FacebookLogin', facebook);\n\t\t\t\t\tfacebook.login(function (response) {\n\t\t\t\t\t\tFacebookStatus(response, promise);\n\t\t\t\t\t}, {\n\t\t\t\t\t\tscope: config.scope\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookLogout() {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tFacebook().then(function (facebook) {\n\t\t\t\t\tfacebook.logout(function (response) {\n\t\t\t\t\t\tpromise.resolve(response);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\t// todo !!!\n\n\tapp.service('GoogleService', ['$timeout', '$promise', '$once', 'LocalStorage', 'environment', function ($timeout, $promise, $once, storage, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\trequire: GoogleRequire,\n\t\t\tlogin: GoogleLogin,\n\t\t\tlogout: GoogleLogout,\n\t\t\tgetMe: GoogleGetMe,\n\t\t\t// status: GoogleStatus,\n\t\t\t// getMyPicture: GoogleGetMyPicture,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// private vars\n\n\t\tif (!environment.plugins.google) {\n\t\t\ttrhow('GoogleService.error missing config object in environment.plugins.google');\n\t\t}\n\n\t\tvar config = environment.plugins.google;\n\n\t\tvar auth2 = null;\n\n\t\tvar instance = null;\n\n\t\t// statics methods\n\n\t\t/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\n\t\t *  calling google initializer on page load to avoid popup blockers via asyncronous loading  *\n\t\t * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n\t\tvar authResponse = storage.get('google');\n\t\t/*\n\t\tauthResponse = {\n\t\t    access_token: \"accessTokenXXXXX\",\n\t\t    expires_at: 1511992065944,\n\t\t    expires_in: 3600,\n\t\t    first_issued_at: 1511988465944,\n\t\t    id_token: \"idTokenXXXXX\",\n\t\t    idpId: \"google\",\n\t\t    login_hint: \"loginHintXXXXXX\",\n\t\t    scope: \"https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/plus.me openid email profile\"\n\t\t    session_state: {\n\t\t        extraQueryParams: { … }\n\t\t    },\n\t\t    token_type: \"Bearer\"\n\t\t}\n\t\t*/\n\t\tconsole.log('google.storage', authResponse);\n\n\t\tfunction GoogleRequire() {\n\t\t\treturn Auth2Init();\n\t\t}\n\n\t\tfunction Google() {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tif (window.gapi !== undefined) {\n\t\t\t\t\tpromise.resolve(window.gapi);\n\t\t\t\t} else {\n\t\t\t\t\tGoogleOnce().then(function (response) {\n\t\t\t\t\t\tpromise.resolve(window.gapi);\n\t\t\t\t\t}, function (error) {\n\t\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleOnce() {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\t$once.script('https://apis.google.com/js/api:client.js?onload={{callback}}', true).then(function (data) {\n\t\t\t\t\tpromise.resolve(data);\n\t\t\t\t}, function (error) {\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction Auth2Init() {\n\t\t\treturn $promise(function (promise) {\n\n\t\t\t\tif (auth2) {\n\t\t\t\t\tpromise.resolve(auth2);\n\t\t\t\t} else {\n\t\t\t\t\tGoogle().then(function () {\n\t\t\t\t\t\tfunction onLoaded() {\n\t\t\t\t\t\t\tvar result = window.gapi.auth2.init({\n\t\t\t\t\t\t\t\tclient_id: environment.plugins.google.clientId,\n\t\t\t\t\t\t\t\tcookiepolicy: 'single_host_origin',\n\t\t\t\t\t\t\t\tscope: 'profile email',\n\t\t\t\t\t\t\t\tfetch_basic_profile: true,\n\t\t\t\t\t\t\t\tux_mode: 'popup',\n\n\t\t\t\t\t\t\t}).then(function () {\n\t\t\t\t\t\t\t\tauth2 = window.gapi.auth2;\n\t\t\t\t\t\t\t\tconsole.log('Auth2Init.success', auth2);\n\t\t\t\t\t\t\t\tpromise.resolve(auth2);\n\n\t\t\t\t\t\t\t}, function (error) {\n\t\t\t\t\t\t\t\tconsole.log('Auth2Init.error', error);\n\t\t\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (window.gapi.auth2) {\n\t\t\t\t\t\t\tonLoaded();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.gapi.load('auth2', function () {\n\t\t\t\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t\t\t\tonLoaded();\n\t\t\t\t\t\t\t\t}, 200);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}, function (error) {\n\t\t\t\t\t\tconsole.log('Auth2Init.error', error);\n\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction Auth2Instance() {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tif (instance) {\n\t\t\t\t\tpromise.resolve();\n\t\t\t\t} else {\n\t\t\t\t\tAuth2Init().then(function (auth2) {\n\t\t\t\t\t\tinstance = auth2.getAuthInstance();\n\t\t\t\t\t\tconsole.log('GoogleService.Auth2Instance.success', instance);\n\t\t\t\t\t\tpromise.resolve();\n\n\t\t\t\t\t}, function (error) {\n\t\t\t\t\t\tconsole.log('GoogleService.Auth2Instance.error', error);\n\t\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleGetMe() {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tGoogleLogin().then(function (response) {\n\t\t\t\t\tvar profile = instance.currentUser.get().getBasicProfile();\n\t\t\t\t\tvar user = {\n\t\t\t\t\t\tid: profile.getId(),\n\t\t\t\t\t\tname: profile.getName(),\n\t\t\t\t\t\tfirstName: profile.getGivenName(),\n\t\t\t\t\t\tlastName: profile.getFamilyName(),\n\t\t\t\t\t\tpicture: profile.getImageUrl(),\n\t\t\t\t\t\temail: profile.getEmail(),\n\t\t\t\t\t};\n\t\t\t\t\tconsole.log('GoogleGetMe.success', user);\n\t\t\t\t\tpromise.resolve(user);\n\n\t\t\t\t}, function (error) {\n\t\t\t\t\tconsole.log('GoogleGetMe.error', error);\n\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleLogin() {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tAuth2Instance().then(function () {\n\t\t\t\t\tif (instance.isSignedIn && instance.isSignedIn.get()) {\n\t\t\t\t\t\t// Auth2Instance.isSignedIn.listen(onStatus);\n\t\t\t\t\t\treadAccessToken();\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('GoogleLogin.signIn');\n\t\t\t\t\t\tinstance.signIn({\n\t\t\t\t\t\t\tscope: 'profile email',\n\n\t\t\t\t\t\t}).then(function (signed) {\n\t\t\t\t\t\t\treadAccessToken();\n\n\t\t\t\t\t\t}, function (error) {\n\t\t\t\t\t\t\tconsole.log('GoogleLogin.error', error);\n\t\t\t\t\t\t\tstorage.delete('google');\n\t\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction readAccessToken() {\n\t\t\t\t\t\tconsole.log('GoogleLogin.readAccessToken');\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar response = instance.currentUser.get().getAuthResponse(true);\n\t\t\t\t\t\t\tconsole.log('GoogleLogin.readAccessToken.success', response);\n\t\t\t\t\t\t\tstorage.set('google', response);\n\t\t\t\t\t\t\tpromise.resolve({\n\t\t\t\t\t\t\t\tcode: response.access_token,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.log('GoogleLogin.readAccessToken.error', error);\n\t\t\t\t\t\t\tstorage.delete('google');\n\t\t\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction onStatus(signed) {\n\t\t\t\t\t\tconsole.log('GoogleLogin.onStatus', signed);\n\t\t\t\t\t\tif (signed) {\n\t\t\t\t\t\t\treadAccessToken();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, function (error) {\n\t\t\t\t\tconsole.log('GoogleLogin.error', error);\n\t\t\t\t\t// promise.reject(error);\n\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleLogout() {\n\t\t\treturn $promise(function (promise) {\n\n\t\t\t\tAuth2Instance().then(function () {\n\t\t\t\t\tif (instance.isSignedIn && instance.isSignedIn.get()) {\n\t\t\t\t\t\tinstance.signOut().then(function (signed) {\n\t\t\t\t\t\t\tpromise.resolve();\n\n\t\t\t\t\t\t}, function (error) {\n\t\t\t\t\t\t\tconsole.log('GoogleService.signOut.error', error);\n\t\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpromise.resolve();\n\t\t\t\t\t}\n\n\t\t\t\t}, function (error) {\n\t\t\t\t\tconsole.log('GoogleService.signOut.error', error);\n\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    // todo !!!\n\n    app.directive('googlemaps', ['$timeout', '$compile', '$promise', 'Http', 'GoogleMaps', 'environment', function($timeout, $compile, $promise, Http, GoogleMaps, environment) {\n\n        var directive = {\n            restrict: 'A',\n            scope: {\n                connector: '=googlemaps',\n            },\n            link: GooglemapsLink,\n        };\n\n        if (!environment.plugins.googlemaps) {\n            trhow('googlemaps.error missing config object in environment.plugins.googlemaps');\n        }\n\n        var config = environment.plugins.googlemaps;\n\n        return directive;\n\n        function GooglemapsLink(scope, element, attributes) {\n            console.log('GooglemapsLink', arguments);\n\n            var map, options, info, bounds, clusterer;\n            var filters = {};\n            var markers = [];\n\n            var publics = {\n                // methods available for controllers\n                /*\n                fly: MapboxFly,\n                flyPosition: MapboxFlyPosition,\n                jump: MapboxJump,\n                jumpPosition: MapboxJumpPosition,\n                */\n                setMarkers: GooglemapsMarkersSet,\n                setType: GooglemapsSetType,\n            };\n\n            if (scope.connector) {\n                angular.extend(scope.connector, publics);\n            }\n\n            Googlemaps();\n\n            function Googlemaps() {\n                return $promise(function(promise) {\n                    GoogleMaps.maps().then(function() {\n                        GooglemapsOptions().then(function(options) {\n                            map = new google.maps.Map(element[0], options);\n                            info = GooglemapsInfo();\n                            promise.resolve(map);\n                        });\n                    });\n                });\n            }\n\n            function GooglemapsOptions() {\n                return $promise(function(promise) {\n                    var options = angular.copy(config.options);\n                    if (config.styles) {\n                        Http.get(config.styles).then(function(styles) {\n                            options.styles = styles;\n                            promise.resolve(options);\n\n                        }, function(error) {\n                            console.log('GooglemapsOptions.error', 'unable to load styles', config.styles);\n                            promise.resolve(options);\n\n                        });\n\n                    } else {\n                        promise.resolve(options);\n                    }\n                });\n            }\n\n            function GooglemapsMarkersRemove() {\n                angular.forEach(markers, function(marker) {\n                    marker.setMap(null);\n                });\n            }\n\n            function GooglemapsMarkersSet(items) {\n                Googlemaps().then(function(map) {\n                    GooglemapsMarkersRemove();\n                    bounds = new google.maps.LatLngBounds();\n\n                    markers = items.filter(function(item) {\n                        var has = true;\n                        if (filters.month) {\n                            has = has && filters.month.items.has(item.id);\n                        }\n                        if (filters.category) {\n                            has = has && item.categories.indexOf(filters.category.key) !== -1;\n                        }\n                        return has;\n\n                    }).map(function(item) {\n                        return GooglemapsMarker(item);\n\n                    });\n\n                    if (config.clusterer) {\n                        clusterer = GooglemapsClusterer(markers);\n                    }\n\n                });\n            }\n\n            function GooglemapsBoundsFit() {\n                if (!bounds.isEmpty()) {\n                    map.fitBounds(bounds);\n                }\n            }\n\n            function GooglemapsSetType(typeId) {\n                var types = ['hybrid', 'roadmap', 'satellite', 'terrain'];\n                if (types.indexOf(typeId) !== -1) {\n                    map.setMapTypeId(typeId);\n                }\n            }\n\n            function GooglemapsInfo() {\n\n                var info = new google.maps.InfoWindow({\n                    maxWidth: 350,\n                    pixelOffset: new google.maps.Size(0, 15),\n                });\n\n                google.maps.event.addListener(info, 'domready', function() {\n                    var outer = $('.gm-style-iw');\n                    var background = outer.prev();\n                    background.children(':nth-child(2)').css({\n                        'display': 'none'\n                    });\n                    background.children(':nth-child(4)').css({\n                        'display': 'none'\n                    });\n                    outer.parent().parent().css({\n                        left: '115px'\n                    });\n                    background.children(':nth-child(1)').attr('style', function(i, s) {\n                        return s + 'display: none!important';\n                    });\n                    background.children(':nth-child(3)').attr('style', function(i, s) {\n                        return s + 'display: none!important';\n                    });\n                    background.children(':nth-child(3)').find('div').children().attr('style', function(i, s) {\n                        return s + 'opacity: 0!important;';\n                    });\n                    var close = outer.next();\n                    close.css({\n                        'width': '13px',\n                        'height': '13px',\n                        'overflow': 'hidden',\n                        'position': 'absolute',\n                        'right': '56px',\n                        'top': '17px',\n                        'z-index': '10000',\n                        'cursor': 'pointer',\n                        'opacity': 1,\n                        'transform': 'scale(0.8)'\n                    });\n                    close.mouseout(function() {\n                        $(this).css({\n                            opacity: '1'\n                        });\n                    });\n                });\n\n                return info;\n            }\n\n            function GooglemapsMarker(item) {\n\n                var latLng = new google.maps.LatLng(\n                    item.position.latitude,\n                    item.position.longitude\n                );\n\n                var marker = new google.maps.Marker({\n                    position: latLng,\n                    item: item,\n                    icon: {\n                        url: 'img/maps/marker.png',\n                        scaledSize: new google.maps.Size(25, 25),\n                        origin: new google.maps.Point(0, 0),\n                        anchor: new google.maps.Point(0, 0)\n                    },\n                    map: map,\n                    contentString: '<div id=\"iw-container\">' +\n                        '<div class=\"iw-image\" ng-style=\"{ \\'background-image\\': cssUrl(selectedBlog.image.url) }\"></div>' +\n                        '<div class=\"iw-title\" ng-bind=\"selectedBlog.title\"></div>' +\n                        '<div class=\"iw-cta\"><button type=\"button\" class=\"iw-link\" ng-click=\"openBlog(selectedBlog)\">Details</button></div>' +\n                        '</div>'\n                });\n\n                marker.onClick = function() {\n                    var marker = this;\n                    $timeout(function() {\n                        scope.selectedBlog = marker.item;\n                        var html = $compile(marker.contentString)(scope);\n                        info.setContent(html[0]);\n                        info.open(map, marker);\n                    });\n                };\n\n                marker.addListener('click', marker.onClick);\n\n                bounds.extend(latLng);\n\n                return marker;\n            }\n\n            function GooglemapsClusterer(markers) {\n\n                var clusterer = new MarkerClusterer(map, markers, {\n                    cssClass: 'cluster',\n                    imagePath: '/img/gmap/m'\n                });\n\n                return clusterer;\n\n            }\n\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.service('GoogleMaps', ['$promise', '$once', 'environment', function($promise, $once, environment) {\n\n        var service = this;\n\n        var statics = {\n            maps: GoogleMaps,\n            geocoder: GoogleMapsGeocoder,\n            parse: GoogleMapsParse,\n        };\n\n        angular.extend(service, statics);\n\n        if (!environment.plugins.googlemaps) {\n            trhow('GoogleMaps.error missing config object in environment.plugins.googlemaps');\n        }\n\n        function GoogleMaps() {\n            return $promise(function(promise) {\n                var apiKey = environment.plugins.googlemaps.apiKey;\n                $once.script('https://maps.googleapis.com/maps/api/js?key=' + apiKey + '&callback={{callback}}', true).then(function(data) {\n                    promise.resolve(window.google.maps);\n                }, function(error) {\n                    promise.reject(error);\n                });\n            });\n        }\n\n        function GoogleMapsGeocoder() {\n            var service = this;\n            return $promise(function(promise) {\n                GoogleMaps().then(function(maps) {\n                    var geocoder = new maps.Geocoder();\n                    promise.resolve(geocoder);\n\n                }, function(error) {\n                    promise.reject(error);\n\n                });\n            });\n        }\n\n        function GoogleMapsType(type, item) {\n            var types = {\n                street: 'route',\n                number: 'street_number',\n                locality: 'locality',\n                postalCode: 'postal_code',\n                city: 'administrative_area_level_3',\n                province: 'administrative_area_level_2',\n                region: 'administrative_area_level_1',\n                country: 'country',\n            };\n            var label = null;\n            angular.forEach(item.address_components, function(c) {\n                angular.forEach(c.types, function(t) {\n                    if (t === types[type]) {\n                        label = c.long_name;\n                    }\n                });\n            });\n            // console.log('GoogleMapsType', type, item, label);\n            return label;\n        }\n\n        function GoogleMapsParse(results) {\n            var items = null;\n            if (results.length) {\n                items = results.filter(function(item) {\n                    return true; // item.geometry.location_type === 'ROOFTOP' ||\n                    // item.geometry.location_type === 'RANGE_INTERPOLATED' ||\n                    // item.geometry.location_type === 'GEOMETRIC_CENTER';\n                }).map(function(item) {\n                    return {\n                        name: item.formatted_address,\n                        street: GoogleMapsType('street', item),\n                        number: GoogleMapsType('number', item),\n                        locality: GoogleMapsType('locality', item),\n                        postalCode: GoogleMapsType('postalCode', item),\n                        city: GoogleMapsType('city', item),\n                        province: GoogleMapsType('province', item),\n                        region: GoogleMapsType('region', item),\n                        country: GoogleMapsType('country', item),\n                        position: {\n                            lng: item.geometry.location.lng(),\n                            lat: item.geometry.location.lat(),\n                        }\n                    };\n                });\n                /*\n                var first = response.data.results[0];\n                scope.model.position = first.geometry.location;\n                console.log(scope.model);\n                setLocation();\n                */\n            }\n            console.log('GoogleMapsParse', results, items);\n            return items;\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.directive('mapbox', ['$http', '$timeout', '$compile', '$promise', 'MapBox', 'environment', function($http, $timeout, $compile, $promise, MapBox, environment) {\n\n        var directive = {\n            restrict: 'A',\n            scope: {\n                connector: '=mapbox',\n            },\n            link: MapboxLink,\n        };\n\n        if (!environment.plugins.mapbox) {\n            trhow('mapbox.error missing config object in environment.plugins.mapbox');\n        }\n\n        var config = environment.plugins.mapbox;\n\n        return directive;\n\n        function MapboxLink(scope, element, attributes, model) {\n            var map, markers, marker, geocoder, bounds, canvas, dragging, overing;\n\n            var publics = {\n                // methods available for controllers\n                fly: MapboxFly,\n                flyPosition: MapboxFlyPosition,\n                jump: MapboxJump,\n                jumpPosition: MapboxJumpPosition,\n                setMarkers: MapboxMarkersSet,\n                fitBounds: MapboxBoundsFit,\n            };\n\n            if (scope.connector) {\n                angular.extend(scope.connector, publics);\n            }\n\n            function MapboxMap() {\n                return $promise(function(promise) {\n\n                    MapBox.get().then(function(mapboxgl) {\n                        map = new mapboxgl.Map({\n                            container: element[0],\n                            style: config.style,\n                            interactive: true,\n                            logoPosition: 'bottom-right',\n                            // center: config.options.center,\n                            // zoom: config.options.zoom,\n                        });\n                        canvas = map.getCanvasContainer();\n                        /*\n                        scope.map.setAddress = function (item) {\n                        \t// console.log('setAddress', item);\n                        \tscope.map.results = null;\n                        \tflyTo(item.position);\n                        };\n                        scope.map.search = function () {\n                        \t// console.log('address', scope.map.address);\n                        \tscope.map.results = null;\n                        \tgeocodeAddress(scope.map.address);\n                        \treturn true;\n                        };\n                        scope.map.styles = {\n                        \tFICO: 1,\n                        \tSATELLITE: 2,\n                        };\n                        scope.map.style = scope.map.styles.FICO;\n                        scope.map.styleToggle = function () {\n                        \tif (scope.map.style === scope.map.styles.FICO) {\n                        \t\tscope.map.style = scope.map.styles.SATELLITE;\n                        \t\tmap.setStyle('mapbox://styles/mapbox/satellite-v9');\n                        \t} else {\n                        \t\tscope.map.style = scope.map.styles.FICO;\n                        \t\tmap.setStyle('mapbox://styles/mapbox/streets-v9');\n                        \t}\n                        };\n                        scope.map.setStyle = function (style) {\n                        \tscope.map.style = style;\n                        \tif (scope.map.style === scope.map.styles.FICO) {\n                        \t\tmap.setStyle('mapbox://styles/mapbox/streets-v9');\n                        \t} else {\n                        \t\tmap.setStyle('mapbox://styles/mapbox/satellite-v9');\n                        \t}\n                        };                \n                        */\n                        if (config.options) {\n                            map.jumpTo(config.options);\n                        }\n                        promise.resolve(map);\n                    });\n                });\n            }\n\n            function MapboxFly(options) {\n                map.flyTo(options);\n            }\n\n            function MapboxFlyPosition(position) {\n                var options = getOptions({\n                    center: [position.lng, position.lat],\n                    zoom: 20,\n                });\n                MapboxFly(options);\n            }\n\n            function MapboxJump(options) {\n                map.jumpTo(options);\n            }\n\n            function MapboxJumpPosition(position) {\n                var options = getOptions({\n                    center: [position.lng, position.lat],\n                    zoom: 20,\n                });\n                map.MapboxJump(options);\n            }\n\n            /*\n            googleMaps.geocoder().then(function (response) {\n                geocoder = response;\n                init();\n            });\n            */\n\n            function getOptions(options) {\n                return angular.extend(angular.copy(config.options), options);\n            }\n\n            function MapboxMarkersRemove() {\n                if (markers) {\n                    angular.forEach(markers, function(item) {\n                        item.remove();\n                    });\n                }\n            }\n\n            function MapboxMarkersSet(items) {\n                MapboxMap().then(function() {\n                    MapboxMarkersRemove();\n                    markers = [];\n                    if (config.clusterer) {\n                        MapboxClusterer(items);\n\n                    } else {\n                        if (items) {\n                            angular.forEach(items, function(item) {\n                                var marker = MapboxMarkerAdd(item);\n                                markers.push(marker);\n                            });\n                        }\n                    }\n                });\n            }\n\n            function MapboxMarkerAdd(item) {\n                var $scope = scope.$new(true);\n                $scope.item = item;\n                var node = document.createElement('div');\n                node.id = 'point';\n                node.className = 'marker ' + item.area.code;\n                node.className += item.type;\n                node.setAttribute('marker', 'item');\n                var marker = new mapboxgl.Marker(node, {\n                        offset: [-10, -10]\n                    })\n                    .setLngLat([item.position.lng, item.position.lat])\n                    .addTo(map);\n                var markerElement = angular.element(node);\n                markerElement.on('click', function(e) {\n                    // console.log('marker.click', item);\n                    scope.$emit('onMarkerClicked', item);\n                });\n                $compile(markerElement)($scope); // Compiling marker\n                return marker;\n            }\n\n            function MapboxCoordinatesGet(item) {\n                var coordinates = null;\n                if (item.position) {\n                    coordinates = [\n                        item.position.longitude,\n                        item.position.latitude,\n                        item.position.altitude || 0.0,\n                    ];\n                }\n                // [0, 1, 2]; longitude, latitude, altitude\n                return coordinates;\n            }\n\n            function MapboxFeaturesGet(items) {\n                var collection = null;\n                if (items) {\n                    var features = items.map(function(item) {\n                        return {\n                            type: 'Feature',\n                            properties: angular.extend({}, item),\n                            geometry: {\n                                type: 'Point',\n                                coordinates: MapboxCoordinatesGet(item),\n                            }\n                        };\n                    });\n                    collection = {\n                        type: 'FeatureCollection',\n                        crs: {\n                            type: 'name',\n                            properties: {\n                                name: 'urn:ogc:def:crs:OGC:1.3:CRS84'\n                            }\n                        },\n                        features: features,\n                    };\n                }\n                return collection;\n            }\n\n            function MapboxClusterer(items) {\n\n                var collection = MapboxFeaturesGet(items);\n\n                map.on('load', function() {\n                    // Add a new source from our GeoJSON data and set the\n                    // 'cluster' option to true. GL-JS will add the point_count property to your source data.\n                    map.addSource('earthquakes', {\n                        type: 'geojson',\n                        // Point to GeoJSON data. This example visualizes all M1.0+ earthquakes\n                        // from 12/22/15 to 1/21/16 as logged by USGS' Earthquake hazards program.\n                        // data: '/api/mapbox/earthquakes.geo.json',\n                        data: collection,\n                        cluster: true,\n                        clusterMaxZoom: 14, // Max zoom to cluster points on\n                        clusterRadius: 50 // Radius of each cluster when clustering points (defaults to 50)\n                    });\n\n                    map.addLayer({\n                        id: 'clusters',\n                        type: 'circle',\n                        source: 'earthquakes',\n                        filter: ['has', 'point_count'],\n                        paint: {\n                            'circle-color': {\n                                property: 'point_count',\n                                type: 'interval',\n                                stops: [\n                                    [0, '#51bbd6'],\n                                    [100, '#f1f075'],\n                                    [750, '#f28cb1'],\n                                ]\n                            },\n                            'circle-radius': {\n                                property: 'point_count',\n                                type: 'interval',\n                                stops: [\n                                    [0, 20],\n                                    [100, 30],\n                                    [750, 40]\n                                ]\n                            }\n                        }\n                    });\n\n                    map.addLayer({\n                        id: 'cluster-count',\n                        type: 'symbol',\n                        source: 'earthquakes',\n                        filter: ['has', 'point_count'],\n                        layout: {\n                            'text-field': '{point_count_abbreviated}',\n                            'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],\n                            'text-size': 12\n                        }\n                    });\n\n                    map.addLayer({\n                        id: 'unclustered-point',\n                        type: 'circle',\n                        source: 'earthquakes',\n                        filter: ['!has', 'point_count'],\n                        paint: {\n                            'circle-color': '#11b4da',\n                            'circle-radius': 4,\n                            'circle-stroke-width': 1,\n                            'circle-stroke-color': '#fff'\n                        }\n                    });\n                });\n            }\n\n            function MapboxBoundsFit() {\n                if (bounds) {\n                    map.fitBounds(bounds, {\n                        speed: 1.5,\n                        curve: 1,\n                        padding: 30,\n                        linear: false,\n                        maxZoom: 8,\n                    });\n                }\n            }\n\n            function geocodeAddress(address) {\n                geocoder.geocode({\n                    'address': address\n                }, function(results, status) {\n                    $timeout(function() {\n                        if (status === 'OK') {\n                            connector.results = googleMaps.parse(results);\n                        } else {\n                            alert('Geocode was not successful for the following reason: ' + status);\n                        }\n                    });\n                });\n            }\n\n            function reverseGeocode(position) {\n                // console.log('reverseGeocode', position);\n                geocoder.geocode({\n                    'location': position\n                }, function(results, status) {\n                    $timeout(function() {\n                        if (status === 'OK') {\n                            connector.results = googleMaps.parse(results);\n                        } else {\n                            console.log('Geocoder failed due to: ' + status);\n                        }\n                    });\n                });\n            }\n\n            function geolocalize() {\n                if (navigator.geolocation) {\n                    navigator.geolocation.getCurrentPosition(function(p) {\n                        $timeout(function() {\n                            var position = {\n                                lat: p.coords.latitude,\n                                lng: p.coords.longitude\n                            };\n                            flyTo(position);\n                            reverseGeocode(position);\n                        });\n                    }, function(e) {\n                        console.log('error', e);\n                    });\n                } else {\n                    console.log('error', 'Browser doesn\\'t support Geolocation');\n                }\n            }\n\n            /*\n            function flyTo(position) {\n                map.flyTo({\n                    center: [\n                        parseFloat(position.lng),\n                        parseFloat(position.lat)\n                    ],\n                    zoom: 15,\n                    speed: 1.5,\n                    curve: 1,\n                });\n            }\n            */\n\n        }\n    }]);\n\n    app.directive('marker', ['$http', '$timeout', function($http, $timeout) {\n        return {\n            restrict: 'A',\n            scope: {\n                item: '=marker',\n            },\n            template: '<div class=\"inner\">' +\n                '   <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"40\" height=\"40\" viewBox=\"0 0 24 24\">' +\n                '       <path d=\"M12 0c-5.522 0-10 4.395-10 9.815 0 5.505 4.375 9.268 10 14.185 5.625-4.917 10-8.68 10-14.185 0-5.42-4.478-9.815-10-9.815zm0 18c-4.419 0-8-3.582-8-8s3.581-8 8-8 8 3.582 8 8-3.581 8-8 8z\"/>' +\n                '   </svg>' +\n                '   <span ng-bind=\"item.code\"></span>' +\n                '</div>',\n            link: link,\n        };\n\n        function link(scope, element, attributes, model) {\n            // console.log('marker', scope.item);\n        }\n\n    }]);\n\n    /*\n\tapp.service('GoogleMaps', ['$q', '$http', function ($q, $http) {\n\t\tvar _key = 'AIzaSyAYuhIEO-41YT_GdYU6c1N7DyylT_OcMSY';\n\t\tvar _init = false;\n\n\t\tthis.maps = maps;\n\t\tthis.geocoder = geocoder;\n\t\tthis.parse = parse;\n\n\t\tfunction maps() {\n\t\t\tvar deferred = $q.defer();\n\t\t\tif (_init) {\n\t\t\t\tdeferred.resolve(window.google.maps);\n\t\t\t} else {\n\t\t\t\twindow.googleMapsInit = function () {\n\t\t\t\t\tdeferred.resolve(window.google.maps);\n\t\t\t\t\twindow.googleMapsInit = null;\n\t\t\t\t\t_init = true;\n\t\t\t\t};\n\t\t\t\tvar script = document.createElement('script');\n\t\t\t\tscript.setAttribute('async', null);\n\t\t\t\tscript.setAttribute('defer', null);\n\t\t\t\tscript.setAttribute('src', 'https://maps.googleapis.com/maps/api/js?key=' + _key + '&callback=googleMapsInit');\n\t\t\t\tdocument.body.appendChild(script);\n\t\t\t}\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tfunction geocoder() {\n\t\t\tvar service = this;\n\t\t\tvar deferred = $q.defer();\n\t\t\tmaps().then(function (maps) {\n\t\t\t\tvar _geocoder = new maps.Geocoder();\n\t\t\t\tdeferred.resolve(_geocoder);\n\t\t\t}, function (error) {\n\t\t\t\tdeferred.reject(error);\n\t\t\t});\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tfunction getType(type, item) {\n\t\t\tvar types = {\n\t\t\t\tstreet: 'route',\n\t\t\t\tnumber: 'street_number',\n\t\t\t\tlocality: 'locality',\n\t\t\t\tpostalCode: 'postal_code',\n\t\t\t\tcity: 'administrative_area_level_3',\n\t\t\t\tprovince: 'administrative_area_level_2',\n\t\t\t\tregion: 'administrative_area_level_1',\n\t\t\t\tcountry: 'country',\n\t\t\t};\n\t\t\tvar label = null;\n\t\t\tangular.forEach(item.address_components, function (c) {\n\t\t\t\tangular.forEach(c.types, function (t) {\n\t\t\t\t\tif (t === types[type]) {\n\t\t\t\t\t\tlabel = c.long_name;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\t// console.log('googleMaps.getType', type, item, label);\n\t\t\treturn label;\n\t\t}\n\n\t\tfunction parse(results) {\n\t\t\tvar items = null;\n\t\t\tif (results.length) {\n\t\t\t\titems = results.filter(function (item) {\n\t\t\t\t\treturn true; // item.geometry.location_type === 'ROOFTOP' ||\n\t\t\t\t\t// item.geometry.location_type === 'RANGE_INTERPOLATED' ||\n\t\t\t\t\t// item.geometry.location_type === 'GEOMETRIC_CENTER';\n\t\t\t\t}).map(function (item) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: item.formatted_address,\n\t\t\t\t\t\tstreet: getType('street', item),\n\t\t\t\t\t\tnumber: getType('number', item),\n\t\t\t\t\t\tlocality: getType('locality', item),\n\t\t\t\t\t\tpostalCode: getType('postalCode', item),\n\t\t\t\t\t\tcity: getType('city', item),\n\t\t\t\t\t\tprovince: getType('province', item),\n\t\t\t\t\t\tregion: getType('region', item),\n\t\t\t\t\t\tcountry: getType('country', item),\n\t\t\t\t\t\tposition: {\n\t\t\t\t\t\t\tlng: item.geometry.location.lng(),\n\t\t\t\t\t\t\tlat: item.geometry.location.lat(),\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\t\t\tconsole.log('googleMaps.parse', results, items);\n\t\t\treturn items;\n\t\t}\n\n    }]);\n    */\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.service('MapBox', ['$q', '$http', '$promise', '$once', 'environment', function($q, $http, $promise, $once, environment) {\n\n        var service = this;\n\n        var statics = {\n            get: MapBoxGet,\n        };\n\n        angular.extend(service, statics);\n\n        if (!environment.plugins.mapbox) {\n            trhow('MapBox.error missing config object in environment.plugins.mapbox');\n        }\n\n        var config = environment.plugins.mapbox;\n\n        function MapBoxGet() {\n            return $promise(function(promise) {\n                if (window.mapboxgl) {\n                    promise.resolve(window.mapboxgl);\n                } else {\n                    $promise.all([\n                        $once.script('//api.tiles.mapbox.com/mapbox-gl-js/' + config.version + '/mapbox-gl.js'),\n                        $once.link('//api.tiles.mapbox.com/mapbox-gl-js/' + config.version + '/mapbox-gl.css'),\n                    ]).then(function() {\n                        window.mapboxgl.accessToken = config.accessToken;\n                        promise.resolve(window.mapboxgl);\n                    }, function(error) {\n                        promise.reject(error);\n                    });\n                }\n            });\n        }\n\n    }]);\n\n}());"]}