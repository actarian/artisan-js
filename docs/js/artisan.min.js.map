{"version":3,"sources":["docs/js/artisan.js"],"names":["angular","module","app","factory","Color","r","g","b","a","arguments","length","this","uint","parseInt","componentToHex","c","hex","toString","luma","color","dot","contrast","darker","pow","min","Math","max","floor","lighter","prototype","toUint","toHex","toRgba","toFixed","alpha","makeSet","foreground","border","light","Shape","shapeCircle","p","cx","cy","sa","ea","PI","ctx","arc","shapeStar","or","ir","steps","x","y","angle","step","moveTo","i","cos","sin","lineTo","shapeRoundRect","rect","w","h","undefined","tl","tr","br","bl","defaultRadius","key","quadraticCurveTo","circle","params","Array","slice","call","beginPath","apply","closePath","star","roundRect","constant","black","white","blue","red","lightBlue","lightYellow","greyLighter","greyLight","greyMedium","grey","map","$q","Painter","Rect","Palette","painter","setSize","buffer","size","pool","rows","getRect","row","canvas","width","height","setCanvas","document","createElement","drawImage","add","path","palette","isString","deferred","defer","img","Image","onload","addShape","resolve","onerror","reject","src","promise","callback","save","clip","translate","clone","setPos","restore","draw","target","pre","drawRect","tint","setFill","fillRect","globalCompositeOperation","console","log","pattern","drawPattern","fillStyle","createPattern","toDataURL","PainterColors","drawingRect","setColors","colors","forEach","value","offsetWidth","offsetHeight","getContext","lineCap","copy","clear","resize","setText","font","align","verticalAlign","textAlign","textBaseline","setStroke","strokeStyle","lineWidth","fillText","text","point","post","maxLength","substr","trim","strokeRect","fill","stroke","begin","close","rotate","xy","image","t","s","flip","scale","directive","$parse","State","Dom","restrict","link","scope","element","attributes","model","relative","absolute","targetElement","from","to","current","boundingClientRect","styleObj","originalCssText","state","expanded","placeholder","setStyle","node","style","cssText","window","getComputedStyle","display","getPropertyValue","position","top","right","bottom","left","margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left","background-color","parentNode","insertBefore","addClass","getParents","each","setRects","hasClass","getBoundingClientRect","absoluteRight","innerWidth","absoluteLeft","absoluteBottom","innerHeight","absoluteTop","expand","idle","dynamics","animate","type","easeInOut","duration","complete","change","update","contract","removeClass","removeChild","set","expandableRelative","expandableAbsolute","querySelector","expandable","onDown","e","onUp","getClosestNode","onResize","isBusy","onKeyDown","toLowerCase","tagName","trigger","expandableTrigger","$on","off","on","templateUrl","transclude","message","uniqueId","template","control","ngModel","required","form","title","source","label","require","controller","filter","optionLabel","string","prepend","expression","splitted","split","formatted","shift","index","join","formatLabel","getOptions","number","field","replace","format","precision","validate","minLength","Number","POSITIVE_INFINITY","options","focus","visible","onChange","$parent","onFilter","getType","getClasses","control-focus","control-success","$valid","control-error","$invalid","$submitted","$touched","control-empty","$viewValue","getMessages","$error","toggleVisibility","$http","$templateCache","$compile","compile","$timeout","nodeRemove","querySelectorAll","nodeAdd","onRemove","getter","numberPicker","setter","assign","onAdd","$filter","$formatters","push","$parsers","unshift","valid","String","indexOf","$setValidity","onFocus","$modelValue","$setViewValue","onBlur","doBlur","tap","Events","priority","ngBind","appendChild","listeners","down","setTimeout","$templateRequest","$controller","modal","modalView","then","html","data","contents","$scope","$new","extend","controllerAs","children","compileController","provider","modals","routes","when","$get","closeModal","m","active","splice","addModal","back","Nav","items","$watch","isArray","onPath","onNav","nav","setItems","item","output","navItem","itemClose","immediate","$nav","opened","opening","closing","closed","o","itemToggle","parent","preventDefault","stop","resolved","rejected","click","navTo","Silent","setNav","statics","silent","publics","addItem","addItems","itemOrItems","getPath","setNavs","level","open","opacity","spring","frequency","friction","popuppable","ondragstart","Scrollable","Animate","Style","Utils","onLeft","onRight","scrollableWhen","showIndicatorFor","attr","scrollable","containerNode","contentNode","content","contentStyle","render","scrollableX","time","setContainer","setContent","setEnabled","isEnabled","renderX","getCurrent","transform","onMove","event","dragMove","drag","getDrag","abs","dragEnd","dragOff","getItems","scrollableItem","prev","scrollPrev","play","next","scrollNext","reset","doReset","onScrollX","dir","interval","wheelX","enabled","newValue","oldValue","dragStart","windowEvents","move","up","wheel","wheelXCheck","remove","pause","onTop","onBottom","scrollableY","renderY","onScrollY","wheelY","wheelYCheck","Point","snappable","busy","dragging","wheeling","padding","currentIndex","start","end","indicator","offset","speed","container","overflow","flag","getIndicator","getIndex","scrollToIndex","doLeft","doRight","animating","extendX","snapToNearestX","round","scrollToX","doTop","doBottom","extendY","snapToNearestY","scrollToY","getItemAtIndex","offsetLeft","offsetTop","finally","extending","distance","methods","$promise","native","video","infos","canplay","_onCanPlay","preload","onPlaying","playing","onPause","onEnded","onProgress","buffered","onTimeUpdate","currentTime","progressTime","toggle","videoElement","ticks","cancelAnimationFrame","loop","requestAnimationFrame","lastTime","vendors","currTime","Date","getTime","timeToCall","id","clearTimeout","Hash","DateTime","Range","CalendarFactory","Api","user","onMonthDidChange","date","month","calendar","monthExpanded","DAY","all","gantt","absencesAndOvertimes","getParams","response","sources","unworkings","records","monthRecords","record","error","resource","resourceId","setAbsencesAndOvertimes","days","day","availableHours","working","baseHours","ao","hours","has","recordedHours","holiday","weekend","vacation","wasVacation","past","wasWorkable","workable","get","green","currentDay","isBefore","orange","updateCalendar","firstWorkingDate","setFirstDay","forward","isOutside","getKey","getFirstWorkingDate","onWeekDidSelect","week","onDayDidSelect","Day","resources","actives","ready","url","put","Month","Week","doNavMonth","setMonth","getDate","onWeekSelect","calendarMonth","onDaySelect","setDate","selected","isCurrent","getDayClasses","classes","today","$today","available","full","status-green","status-orange","getMonthByDate","d","getDay","dirty","service","months","clearMonth","tasks","getMonths","num","removeAll","setFullYear","getFullYear","getMonth","setHours","setMinutes","setSeconds","ceil","yyyy","MM","mKey","fromDay","monthDays","weeks","diff","Calendar","MINUTE","QUARTER","HOUR","WEEK","FIRSTDAYOFWEEK","getFullDate","getIndexLeft","getIndexRight","getDayLeft","components","dd","dayLeft","HH","mm","ss","sss","getDayRight","dayRight","getMonthLeft","monthLeft","getMonthRight","monthRight","getWeekLeft","weekLeft","getWeekRight","weekRight","getYearLeft","getYearRight","yearRight","dateToKey","dayDiff","getFullDay","getWeek","getDayByKey","keyToDate","getDayByDate","hourToTime","hour","monthDiff","weekDiff","yearDiff","yearLeft","timeToHour","timeToQuarterHour","SECOND","datetime","ee","getHours","getMinutes","getSeconds","getMilliseconds","getTimezoneOffset","valueOf","wKey","ww","setTime","getWeekDay","offsetDays","now","first","formats","long","RANGE","YEAR","SEMESTER","TRIMESTER","MONTH","short","RangeTypes","setDiff","setYear","setSemester","setTrimester","setQuarter","setWeek","setDay","setKey","getDiff","dateFrom","dateTo","range","filters","setDates","is","isInside","isAfter","equals","eachDay","fromKey","toKey","totalDays","getName","RangeExtract","RangeFormat","getShortName","RangeCopy","addYear","years","types","Year","Semester","Trimester","Quarter","$range","name","replaced","token","j","f","pop","obj","Object","keys","values","defineProperty","vals","isEnumerable","just_now","seconds_ago","a_minute_ago","minutes_ago","an_hour_ago","hours_ago","a_day_ago","days_ago","a_week_ago","weeks_ago","a_month_ago","months_ago","a_year_ago","years_ago","over_a_year_ago","seconds_from_now","a_minute_from_now","minutes_from_now","an_hour_from_now","hours_from_now","a_day_from_now","days_from_now","a_week_from_now","weeks_from_now","a_month_from_now","months_from_now","a_year_from_now","years_from_now","over_a_year_from_now","$rootScope","$interval","$injector","$formats","$format","instant","getDelta","delta","suffix","minute","dateRelative","innerHTML","setInterval","cancelInterval","agent","safari","msie","chrome","mobile","mac","ua","getBoundRect","getNode","getDocumentNode","getClosest","selector","matchesFn","some","fn","body","parentElement","original","originalEvent","deltaX","wheelDeltaX","deltaY","wheelDeltaY","getElement","getNodeOffset","nodeType","getPageScroll","scroll","documentNode","pageXOffset","scrollLeft","pageYOffset","scrollTop","topParentNode","parents","getView","view","clientWidth","clientHeight","getPointInView","TOUCH_EVENTS","touch","touches","changedTouches","pageX","pageY","MOUSE_EVENTS","downloadFile","base64","blob","Blob","reader","FileReader","readAsDataURL","onloadend","result","createEvent","anchor","href","download","downloadName","substring","lastIndexOf","initEvent","dispatchEvent","navigator","userAgent","getElementsByTagName","documentElement","EventsService","Event","timestamp","stopPropagation","events","standardEvents","setTimestamp","removeTouchEvents","touchEvents","removeStandardEvents","wheelEvents","removeScrollEvents","scrollEvents","removeWheelEvents","getTouch","previous","difference","getRelativeTouch","standard","windowElement","listener","mouseEvents","hasPassiveEvents","addEventListener","defaults","passive","capture","modified","getModifiedAddEventListener","EventTarget","getAddEventListener","supported","firefox","scrollWidth","preventHistoryNavigation","array","Autolinker","className","firstName","lastName","toUpperCase","txt","charAt","legacyFilter","cost","currency","ratio","formatting","APP","inches","unit","units","IMPERIAL","feet","meters","cm","pounds","oz","kg","weight","grams","minutes","second","seconds","timezone","parseTime","parseHour","val","filterWatcher","collection","property","isObject","isUndefined","isMemoized","memoize","dict","toText","n","TEXT_NODE","nodeValue","ELEMENT_NODE","childNodes","currentStyle","match","div","PointDifference","multiply","PointMultiply","mult","setX","setY","RectMultiply","bottomLeft","bottomRight","center","expandRect","intersect","reduce","reduceRect","offsetRect","setH","setW","topLeft","topRight","Vector","cross","VectorCross","VectorDifference","VectorDistance","incidence","VectorIncidence","make","normalize","VectorNormalize","power","VectorSize","towards","sqrt","atan2","l","pools","HashGet","defineProperties","enumerable","writable","getItem","newItem","once","oldItem","addMany","removeMany","hash","reverse","sort","backward","differs","updatePool","promises","isError","isErroring","isSuccess","isSuccessing","errors","addons","isReady","successing","success","errorring","errorMessage","button","labels","$broadcast","submitClass","transformProperty","every","prefix","detectTransformProperty","props","hoverScale","currentScale","styles","transformOrigin","extract","object","reducer","reducerAdder","reducerSetter","removeValue","reverseSortOn","throttle","func","wait","context","args","timeout","later","leading","getNow","remaining","trailing","toMd5","where","query","found","TypeError","len","k","$locationProvider","$httpProvider","config","merge","environment","paths","location","EnvironmentGet","global","EnvironmentSetHttp","EnvironmentSetLocation","EnvironmentSet","use","plugins","facebook","fields","version","google","googlemaps","clusterer","lat","lng","disableDefaultUI","mapTypeId","scrollwheel","zoom","mapbox","bearing","curve","pitch","http","interceptors","withCredentials","language","code","culture","iso","html5","headers","common","html5Mode","hashPrefix","Doc","$location","$route","$routeParams","Router","Route","route","$$route","pathParams","originalPath","loadedTemplateUrl","View","doc","docs","LocalStorage","isAuthorizedOrGoTo","redirect","auth","created_at","expires_in","status","isAuthorized","request","Authorization","access_token","responseError","Message","ModelState","httpError","delete","signOut","SessionStorage","accessToken","remember","exist","BearerSet","header","HttpPromise","HttpPath","patch","static","fake","msec","api","method","Preload","loaded","total","progress","preloads","percent","clearInterval","xhr","XMLHttpRequest","responseType","onloadstart","onprogress","send","URL","createObjectURL","load","OnceScript","OnceLink","script","uid","getElementById","scripts","nextSibling","links","rel","$previous","$current","$next","$currentController","isController","msecs","RouterRedirectTo","RouterRetryLastRequestedPath","RouterSetControllers","$$lastRequestedPath","loading","rejection","$path","$$listeners","$locationChangeSuccess","TIMEOUT","CookieSetter","cookie","CookieGet","elapsed","Cookie","checkCookie","cache","json","JSON","stringify","btoa","encodeURIComponent","cookieName","ca","parse","decodeURIComponent","atob","expires","toGMTString","localStorage","removeItem","setItem","LocalSupported","sessionStorage","SessionSupported","$sce","TrustGetOrSet","trustAsHtml","trustAsResourceUrl","trustedValues","trustedValue","$once","storage","Facebook","login","FacebookLogin","logout","FacebookStatus","getMe","FB","getMyPicture","trhow","authResponse","init","appId","xfbml","Auth2Init","GoogleLogin","Auth2Instance","instance","isSignedIn","signed","profile","currentUser","getBasicProfile","getId","getGivenName","getFamilyName","picture","getImageUrl","email","getEmail","auth2","Google","gapi","onLoaded","client_id","clientId","cookiepolicy","fetch_basic_profile","ux_mode","getAuthInstance","readAccessToken","getAuthResponse","signIn","Http","GoogleMaps","connector","info","bounds","markers","setMarkers","Googlemaps","marker","setMap","maps","LatLngBounds","category","categories","latLng","LatLng","latitude","longitude","Marker","icon","scaledSize","Size","origin","contentString","onClick","selectedBlog","addListener","MarkerClusterer","cssClass","imagePath","setType","typeId","setMapTypeId","Map","InfoWindow","maxWidth","pixelOffset","outer","$","background","css","find","z-index","cursor","mouseout","geocoder","Geocoder","results","formatted_address","street","GoogleMapsType","locality","postalCode","city","province","region","country","geometry","apiKey","address_components","long_name","MapBox","fly","MapboxFly","flyPosition","jump","jumpTo","jumpPosition","MapboxJump","mapboxgl","interactive","logoPosition","getCanvasContainer","features","properties","coordinates","altitude","MapboxCoordinatesGet","crs","MapboxFeaturesGet","addSource","cluster","clusterMaxZoom","clusterRadius","addLayer","paint","circle-color","stops","circle-radius","layout","text-field","text-font","text-size","circle-stroke-width","circle-stroke-color","area","setAttribute","setLngLat","addTo","markerElement","$emit","MapboxMarkerAdd","fitBounds","flyTo"],"mappings":"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","file":"artisan.min.js","sourcesContent":["/* global angular */\r\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan', ['ng', 'ngRoute', 'ngMessages']);\r\n\r\n}());\r\n\n/* global angular, firebase */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Color', [function() {\n\t\tfunction Color(r, g, b, a) {\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tthis.r = (r || r === 0) ? r : 0;\n\t\t\t\tthis.g = (g || g === 0) ? g : 0;\n\t\t\t\tthis.b = (b || b === 0) ? b : 0;\n\t\t\t\tthis.a = (a || a === 0) ? a : 255;\n\t\t\t} else {\n\t\t\t\tvar uint = r || '0xffffff';\n\t\t\t\tuint = parseInt(uint);\n\t\t\t\tif (r.length > 8) {\n\t\t\t\t\tthis.r = uint >> 24 & 0xff;\n\t\t\t\t\tthis.g = uint >> 16 & 0xff;\n\t\t\t\t\tthis.b = uint >> 8 & 0xff;\n\t\t\t\t\tthis.a = uint >> 0 & 0xff;\n\t\t\t\t} else {\n\t\t\t\t\tthis.r = uint >> 16 & 0xff;\n\t\t\t\t\tthis.g = uint >> 8 & 0xff;\n\t\t\t\t\tthis.b = uint >> 0 & 0xff;\n\t\t\t\t\tthis.a = 255;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tColor.componentToHex = function(c) {\n\t\t\tvar hex = c.toString(16);\n\t\t\treturn hex.length == 1 ? '0' + hex : hex;\n\t\t};\n\t\tColor.luma = function(color) {\n\t\t\t// var luma = color.dot({ r: 54.213, g: 182.376, b: 18.411 });\n\t\t\tvar luma = color.dot({\n\t\t\t\tr: 95,\n\t\t\t\tg: 100,\n\t\t\t\tb: 60\n\t\t\t});\n\t\t\treturn luma;\n\t\t};\n\t\tColor.contrast = function(color) {\n\t\t\tvar luma = Color.luma(color);\n\t\t\tif (luma > 0.6) {\n\t\t\t\treturn new Color('0x000000');\n\t\t\t} else {\n\t\t\t\treturn new Color('0xffffff');\n\t\t\t}\n\t\t};\n\t\tColor.darker = function(color, pow, min) {\n\t\t\tmin = min || 0;\n\t\t\tvar r = Math.max(Math.floor(color.r * min), Math.floor(color.r - 255 * pow));\n\t\t\tvar g = Math.max(Math.floor(color.g * min), Math.floor(color.g - 255 * pow));\n\t\t\tvar b = Math.max(Math.floor(color.b * min), Math.floor(color.b - 255 * pow));\n\t\t\treturn new Color(r, g, b, color.a);\n\t\t};\n\t\tColor.lighter = function(color, pow, max) {\n\t\t\tmax = max || 1;\n\t\t\tvar r = Math.min(color.r + Math.floor((255 - color.r) * max), Math.floor(color.r + 255 * pow));\n\t\t\tvar g = Math.min(color.g + Math.floor((255 - color.g) * max), Math.floor(color.g + 255 * pow));\n\t\t\tvar b = Math.min(color.b + Math.floor((255 - color.b) * max), Math.floor(color.b + 255 * pow));\n\t\t\treturn new Color(r, g, b, color.a);\n\t\t};\n\t\t/*\n\t\tColor.rgbaToHex = function (rgba) {\n\t\t    rgba = rgba.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\n\t\t    return (rgba && rgba.length === 4) ? \"#\" +\n\t\t        (\"0\" + parseInt(rgba[1], 10).toString(16)).slice(-2) +\n\t\t        (\"0\" + parseInt(rgba[2], 10).toString(16)).slice(-2) +\n\t\t        (\"0\" + parseInt(rgba[3], 10).toString(16)).slice(-2) : '';\n\t\t}\n\t\t*/\n\t\tColor.prototype = {\n\t\t\ttoUint: function() {\n\t\t\t\treturn (this.r << 24) + (this.g << 16) + (this.b << 8) + (this.a);\n\t\t\t},\n\t\t\ttoHex: function() {\n\t\t\t\treturn '#' + Color.componentToHex(this.r) + Color.componentToHex(this.g) + Color.componentToHex(this.b) + Color.componentToHex(this.a);\n\t\t\t},\n\t\t\ttoRgba: function() {\n\t\t\t\treturn 'rgba(' + this.r + ',' + this.g + ',' + this.b + ',' + (this.a / 255).toFixed(3) + ')';\n\t\t\t},\n\t\t\tdot: function(color) {\n\t\t\t\treturn ((this.r / 255) * (color.r / 255) + (this.g / 255) * (color.g / 255) + (this.b / 255) * (color.b / 255));\n\t\t\t},\n\t\t\talpha: function(pow, min, max) {\n\t\t\t\tmin = min || 0;\n\t\t\t\tmax = max || 1;\n\t\t\t\tthis.a = Math.floor((min + (pow * (max - min))) * 255);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tmakeSet: function() {\n\t\t\t\tthis.foreground = Color.contrast(this);\n\t\t\t\tthis.border = Color.darker(this, 0.3);\n\t\t\t\tthis.light = Color.lighter(this, 0.3);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t};\n\t\treturn Color;\n    }]);\n\n\tapp.factory('Shape', [function() {\n\t\tfunction Shape() {}\n\t\tShape.shapeCircle = function(p, cx, cy, r, sa, ea) {\n\t\t\tsa = sa || 0;\n\t\t\tea = ea || 2 * Math.PI;\n\t\t\tp.ctx.arc(cx, cy, r, sa, ea, false);\n\t\t};\n\t\tShape.shapeStar = function(p, cx, cy, or, ir, steps) {\n\t\t\tvar x, y;\n\t\t\tvar angle = Math.PI / 2 * 3;\n\t\t\tvar step = Math.PI / steps;\n\t\t\tvar ctx = p.ctx;\n\t\t\tctx.moveTo(cx, cy - or);\n\t\t\tfor (i = 0; i < steps; i++) {\n\t\t\t\tx = cx + Math.cos(angle) * or;\n\t\t\t\ty = cy + Math.sin(angle) * or;\n\t\t\t\tctx.lineTo(x, y);\n\t\t\t\tangle += step;\n\t\t\t\tx = cx + Math.cos(angle) * ir;\n\t\t\t\ty = cy + Math.sin(angle) * ir;\n\t\t\t\tctx.lineTo(x, y);\n\t\t\t\tangle += step;\n\t\t\t}\n\t\t\tctx.lineTo(cx, cy - or);\n\t\t};\n\t\tShape.shapeRoundRect = function(p, rect, r) {\n\t\t\tvar ctx = p.ctx,\n\t\t\t\tx = rect.x,\n\t\t\t\ty = rect.y,\n\t\t\t\tw = rect.w,\n\t\t\t\th = rect.h;\n\t\t\tif (typeof r === undefined) {\n\t\t\t\tr = 4;\n\t\t\t}\n\t\t\tif (typeof r === 'number') {\n\t\t\t\tr = {\n\t\t\t\t\ttl: r,\n\t\t\t\t\ttr: r,\n\t\t\t\t\tbr: r,\n\t\t\t\t\tbl: r\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tvar defaultRadius = {\n\t\t\t\t\ttl: 0,\n\t\t\t\t\ttr: 0,\n\t\t\t\t\tbr: 0,\n\t\t\t\t\tbl: 0\n\t\t\t\t};\n\t\t\t\tfor (var key in defaultRadius) {\n\t\t\t\t\tr[key] = r[key] || defaultRadius[key];\n\t\t\t\t}\n\t\t\t}\n\t\t\tctx.moveTo(x + r.tl, y);\n\t\t\tctx.lineTo(x + w - r.tr, y);\n\t\t\tctx.quadraticCurveTo(x + w, y, x + w, y + r.tr);\n\t\t\tctx.lineTo(x + w, y + h - r.br);\n\t\t\tctx.quadraticCurveTo(x + w, y + h, x + w - r.br, y + h);\n\t\t\tctx.lineTo(x + r.bl, y + h);\n\t\t\tctx.quadraticCurveTo(x, y + h, x, y + h - r.bl);\n\t\t\tctx.lineTo(x, y + r.tl);\n\t\t\tctx.quadraticCurveTo(x, y, x + r.tl, y);\n\t\t};\n\t\tShape.circle = function() {\n\t\t\tvar params = Array.prototype.slice.call(arguments);\n\t\t\tvar ctx = params[0].ctx;\n\t\t\tctx.beginPath();\n\t\t\tShape.shapeCircle.apply(this, params);\n\t\t\tctx.closePath();\n\t\t};\n\t\tShape.star = function() {\n\t\t\tvar params = Array.prototype.slice.call(arguments);\n\t\t\tvar ctx = params[0].ctx;\n\t\t\tctx.beginPath();\n\t\t\tShape.shapeStar.apply(this, params);\n\t\t\tctx.closePath();\n\t\t};\n\t\tShape.roundRect = function() {\n\t\t\tvar params = Array.prototype.slice.call(arguments);\n\t\t\tvar ctx = params[0].ctx;\n\t\t\tctx.beginPath();\n\t\t\tShape.shapeRoundRect.apply(this, params);\n\t\t\tctx.closePath();\n\t\t};\n\t\treturn Shape;\n    }]);\n\n\tapp.constant('PainterColors', {\n\t\t/*\n\t\tblack: new Color('0x111111'),\n\t\twhite: new Color('0xffffff'),\n\t\tred: new Color('0xff0000'),\n\t\tgreen: new Color('0x00ff00'),\n\t\tblue: new Color('0x0000ff'),\n\t\tyellow: new Color('0xffff00'),\n\t\tcyan: new Color('0x00ffff'),\n\t\tpurple: new Color('0xff00ff'),\n\t\t*/\n\t\tblack: '0x14191e',\n\t\twhite: '0xffffff',\n\t\tblue: '0x0023FF',\n\t\tred: '0xF21500',\n\t\tlightBlue: '0x79ccf2',\n\t\tlightYellow: '0xfff79a',\n\t\tgreyLighter: '0xf8f8f8',\n\t\tgreyLight: '0xeeeeee',\n\t\tgreyMedium: '0xcccccc',\n\t\tgrey: '0x90939b',\n\t\tmap: '0x24292e',\n\t});\n\n\tapp.factory('Palette', ['$q', 'Painter', 'Rect', function($q, Painter, Rect) {\n\t\tfunction Palette() {\n\t\t\tthis.painter = new Painter().setSize(0, 0);\n\t\t\tthis.buffer = new Painter().setSize(0, 0);\n\t\t\tthis.size = {\n\t\t\t\tw: 0,\n\t\t\t\th: 0\n\t\t\t};\n\t\t\tthis.pool = {};\n\t\t\tthis.rows = {};\n\t\t}\n\t\tPalette.prototype = {\n\t\t\tgetRect: function(w, h) {\n\t\t\t\tvar p = this.painter,\n\t\t\t\t\tsize = this.size,\n\t\t\t\t\trows = this.rows,\n\t\t\t\t\tr = new Rect(0, 0, w, h),\n\t\t\t\t\trow = rows[h] || {\n\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\ty: size.h\n\t\t\t\t\t};\n\t\t\t\tsize.w = Math.max(size.w, row.x + w);\n\t\t\t\tsize.h = Math.max(size.h, row.y + h);\n\t\t\t\tif (!p.canvas.width && !p.canvas.height) {\n\t\t\t\t\tp.setSize(size.w, size.h);\n\t\t\t\t} else if (size.w > p.canvas.width || size.h > p.canvas.height) {\n\t\t\t\t\t// var img = new Image();\n\t\t\t\t\t// img.src = p.toDataURL();\n\t\t\t\t\t// document.body.appendChild(canvas);\n\t\t\t\t\t// console.log(p.canvas.width, p.canvas.height);\n\t\t\t\t\t// var data = p.ctx.getImageData(0, 0, p.canvas.width, p.canvas.height);\n\t\t\t\t\tvar canvas = p.canvas;\n\t\t\t\t\tp.setCanvas(document.createElement('canvas'));\n\t\t\t\t\tp.setSize(size.w, size.h);\n\t\t\t\t\tp.ctx.drawImage(canvas, 0, 0);\n\t\t\t\t\t// p.ctx.putImageData(data, 0, 0);\n\t\t\t\t\t// p.ctx.drawImage(img, 0, 0);\n\t\t\t\t\t// document.body.removeChild(canvas);\n\t\t\t\t}\n\t\t\t\tr.x = row.x;\n\t\t\t\tr.y = row.y;\n\t\t\t\trow.x += w;\n\t\t\t\trows[h] = row;\n\t\t\t\treturn r;\n\t\t\t},\n\t\t\tadd: function(key, path) {\n\t\t\t\tvar palette = this;\n\t\t\t\tif (angular.isString(path)) {\n\t\t\t\t\tvar deferred = $q.defer();\n\t\t\t\t\tvar img = new Image();\n\t\t\t\t\timg.onload = function() {\n\t\t\t\t\t\tpalette.addShape(key, img.width, img.height, function(p, rect) {\n\t\t\t\t\t\t\tp.ctx.drawImage(img, 0, 0);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdeferred.resolve(img);\n\t\t\t\t\t};\n\t\t\t\t\timg.onerror = function() {\n\t\t\t\t\t\tdeferred.reject('connot load ' + path);\n\t\t\t\t\t};\n\t\t\t\t\timg.src = path;\n\t\t\t\t\treturn deferred.promise;\n\t\t\t\t} else {\n\t\t\t\t\tvar params = Array.prototype.slice.call(arguments);\n\t\t\t\t\treturn palette.addShape.apply(palette, params);\n\t\t\t\t}\n\t\t\t},\n\t\t\taddShape: function(key, w, h, callback) {\n\t\t\t\tvar p = this.painter,\n\t\t\t\t\tr = this.getRect(w, h);\n\t\t\t\tp.ctx.save();\n\t\t\t\tp.ctx.rect(r.x, r.y, r.w, r.h);\n\t\t\t\t// p.ctx.stroke();\n\t\t\t\tp.ctx.clip();\n\t\t\t\tp.ctx.translate(r.x, r.y);\n\t\t\t\tcallback.call(p, p, r.clone().setPos(0, 0));\n\t\t\t\tp.ctx.restore();\n\t\t\t\tthis.pool[key] = r;\n\t\t\t\t// console.log('Painter.add', r);\n\t\t\t},\n\t\t\tdraw: function(target, key, x, y, pre) {\n\t\t\t\tvar r = this.pool[key];\n\t\t\t\tif (r) {\n\t\t\t\t\t// var ctx = target.ctx;\n\t\t\t\t\t// ctx.save();\n\t\t\t\t\ttarget.drawRect(this.painter.canvas, r, {\n\t\t\t\t\t\tx: x,\n\t\t\t\t\t\ty: y,\n\t\t\t\t\t\tw: r.w,\n\t\t\t\t\t\th: r.h\n\t\t\t\t\t}, pre);\n\t\t\t\t\t// target.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, x - r.w / 2, y - r.h / 2, r.w, r.h);\n\t\t\t\t\t// ctx.restore();\n\t\t\t\t}\n\t\t\t},\n\t\t\ttint: function(target, key, x, y, color, pre) {\n\t\t\t\tvar r = this.pool[key];\n\t\t\t\tif (r) {\n\t\t\t\t\tvar p = this.painter,\n\t\t\t\t\t\tb = this.buffer.setSize(r.w, r.h);\n\t\t\t\t\tb.save();\n\t\t\t\t\tb.setFill(color);\n\t\t\t\t\tb.fillRect();\n\t\t\t\t\tb.ctx.globalCompositeOperation = \"destination-atop\";\n\t\t\t\t\tb.ctx.drawImage(p.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n\t\t\t\t\tb.restore();\n\t\t\t\t\tconsole.log(x, y, b.canvas, target.canvas);\n\t\t\t\t\ttarget.draw(b.canvas, {\n\t\t\t\t\t\tx: x,\n\t\t\t\t\t\ty: y\n\t\t\t\t\t}, pre);\n\t\t\t\t}\n\t\t\t},\n\t\t\tpattern: function(target, key, x, y, w, h, color) {\n\t\t\t\tfunction drawPattern(pattern) {\n\t\t\t\t\tvar ctx = target.ctx;\n\t\t\t\t\tctx.save();\n\t\t\t\t\tctx.translate(x, y);\n\t\t\t\t\t// draw\n\t\t\t\t\t// ctx.beginPath();\n\t\t\t\t\t// ctx.rect(-x, -y, w, h);\n\t\t\t\t\tctx.fillStyle = pattern;\n\t\t\t\t\tctx.fillRect(-x, -y, w, h);\n\t\t\t\t\tctx.translate(-x, -y);\n\t\t\t\t\t// ctx.fill();\n\t\t\t\t\tctx.restore();\n\t\t\t\t}\n\t\t\t\tvar r = this.pool[key];\n\t\t\t\tif (r) {\n\t\t\t\t\tvar img = r.img,\n\t\t\t\t\t\tpattern;\n\t\t\t\t\tif (!img || r.color != color) {\n\t\t\t\t\t\tvar b = this.buffer.setSize(r.w, r.h);\n\t\t\t\t\t\tif (color) {\n\t\t\t\t\t\t\tr.color = color;\n\t\t\t\t\t\t\tb.save();\n\t\t\t\t\t\t\tb.setFill(color);\n\t\t\t\t\t\t\tb.fillRect();\n\t\t\t\t\t\t\tb.ctx.globalCompositeOperation = \"destination-atop\";\n\t\t\t\t\t\t\tb.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n\t\t\t\t\t\t\tb.restore();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tb.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n\t\t\t\t\t\t}\n\t\t\t\t\t\timg = new Image();\n\t\t\t\t\t\timg.onload = function() {\n\t\t\t\t\t\t\tr.img = img;\n\t\t\t\t\t\t\tpattern = target.ctx.createPattern(img, \"repeat\");\n\t\t\t\t\t\t\tdrawPattern(pattern);\n\t\t\t\t\t\t};\n\t\t\t\t\t\timg.src = b.toDataURL();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpattern = target.ctx.createPattern(img, \"repeat\");\n\t\t\t\t\t\tdrawPattern(pattern);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t\treturn Palette;\n    }]);\n\n\tapp.factory('Painter', ['Shape', 'Rect', 'Color', 'PainterColors', function(Shape, Rect, Color, PainterColors) {\n\t\tfunction Painter(canvas) {\n\t\t\tcanvas = canvas || document.createElement('canvas');\n\t\t\tthis.rect = new Rect();\n\t\t\tthis.drawingRect = new Rect();\n\t\t\tthis.setColors();\n\t\t\tthis.setCanvas(canvas);\n\t\t}\n\t\tPainter.colors = {};\n\t\tangular.forEach(PainterColors, function(value, key) {\n\t\t\tPainter.colors[key] = new Color(value).makeSet();\n\t\t});\n\t\tvar colors = Painter.colors;\n\t\tPainter.prototype = {\n\t\t\tcolors: Painter.colors,\n\t\t\tsetColors: function() {\n\t\t\t\tvar colors = this.colors;\n\t\t\t\tangular.forEach(PainterColors, function(value, key) {\n\t\t\t\t\tcolors[key] = new Color(value).makeSet();\n\t\t\t\t});\n\t\t\t},\n\t\t\tsetCanvas: function(canvas) {\n\t\t\t\tthis.canvas = canvas;\n\t\t\t\tthis.setSize(canvas.offsetWidth, canvas.offsetHeight);\n\t\t\t\tvar ctx = canvas.getContext('2d');\n\t\t\t\tctx.lineCap = 'square';\n\t\t\t\tthis.ctx = ctx;\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetSize: function(w, h) {\n\t\t\t\tthis.canvas.width = w;\n\t\t\t\tthis.canvas.height = h;\n\t\t\t\tthis.rect.w = w;\n\t\t\t\tthis.rect.h = h;\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tcopy: function(canvas) {\n\t\t\t\tthis.ctx.drawImage(canvas, 0, 0);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tclear: function() {\n\t\t\t\tthis.resize();\n\t\t\t\t// this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tresize: function() {\n\t\t\t\tthis.setSize(this.canvas.offsetWidth, this.canvas.offsetHeight);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetText: function(font, align, verticalAlign, color) {\n\t\t\t\tfont = font || '11px monospace';\n\t\t\t\talign = align || 'center';\n\t\t\t\tverticalAlign = verticalAlign || 'middle';\n\t\t\t\tcolor = color || this.colors.black;\n\t\t\t\tvar ctx = this.ctx;\n\t\t\t\tctx.font = font;\n\t\t\t\tctx.textAlign = align;\n\t\t\t\tctx.textBaseline = verticalAlign;\n\t\t\t\tctx.fillStyle = color.toRgba();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetFill: function(color) {\n\t\t\t\tcolor = color || this.colors.black;\n\t\t\t\tvar ctx = this.ctx;\n\t\t\t\t/*\n\t\t\t\tvar my_gradient = ctx.createLinearGradient(0, 0, 0, 170);\n\t\t\t\tmy_gradient.addColorStop(0, \"black\");\n\t\t\t\tmy_gradient.addColorStop(1, \"white\");\n\t\t\t\tctx.fillStyle = my_gradient;\n\t\t\t\t*/\n\t\t\t\tctx.fillStyle = color.toRgba();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetStroke: function(color, size) {\n\t\t\t\tcolor = color || this.colors.black;\n\t\t\t\tvar ctx = this.ctx;\n\t\t\t\tsize = size || 1;\n\t\t\t\t/*\n\t\t\t\tvar gradient=ctx.createLinearGradient(0,0,170,0);\n\t\t\t\tgradient.addColorStop(\"0\",\"magenta\");\n\t\t\t\tgradient.addColorStop(\"0.5\",\"blue\");\n\t\t\t\tgradient.addColorStop(\"1.0\",\"red\");\n\t\t\t\tctx.strokeStyle = gradient;\n\t\t\t\t*/\n\t\t\t\t// Fill with gradient\n\t\t\t\tctx.strokeStyle = color.toRgba();\n\t\t\t\tctx.lineWidth = size;\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\t/*\n\t\t\tdrawRoundRect: function (rect, r) {\n\t\t\t    rect = rect || this.rect;\n\t\t\t    Shape.roundRect(this, rect, r);\n\t\t\t    return this;\n\t\t\t},\n\t\t\t*/\n\t\t\tfillText: function(text, point, width, post, maxLength) {\n\t\t\t\tif (width) {\n\t\t\t\t\tpost = post || '';\n\t\t\t\t\tmaxLength = maxLength || Math.floor(width / 8);\n\t\t\t\t\tif (text.length > maxLength) {\n\t\t\t\t\t\ttext = text.substr(0, Math.min(text.length, maxLength)).trim() + post;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.ctx.fillText(text, point.x, point.y);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tfillRect: function(rect) {\n\t\t\t\trect = rect || this.rect;\n\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\tx = rect.x,\n\t\t\t\t\ty = rect.y,\n\t\t\t\t\tw = rect.w,\n\t\t\t\t\th = rect.h;\n\t\t\t\tctx.fillRect(x, y, w, h);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tstrokeRect: function(rect) {\n\t\t\t\trect = rect || this.rect;\n\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\tx = rect.x,\n\t\t\t\t\ty = rect.y,\n\t\t\t\t\tw = rect.w,\n\t\t\t\t\th = rect.h;\n\t\t\t\tctx.strokeRect(x, y, w, h);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tfill: function() {\n\t\t\t\tthis.ctx.fill();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tstroke: function() {\n\t\t\t\tthis.ctx.stroke();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tbegin: function() {\n\t\t\t\tthis.ctx.beginPath();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tclose: function() {\n\t\t\t\tthis.ctx.closePath();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsave: function() {\n\t\t\t\tthis.ctx.save();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\trestore: function() {\n\t\t\t\tthis.ctx.restore();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\trotate: function(angle) {\n\t\t\t\tthis.ctx.rotate(angle * Math.PI / 180);\n\t\t\t},\n\t\t\ttranslate: function(xy) {\n\t\t\t\tthis.ctx.translate(xy.x, xy.y);\n\t\t\t},\n\t\t\ttoDataURL: function() {\n\t\t\t\treturn this.canvas.toDataURL();\n\t\t\t},\n\t\t\tdraw: function(image, t, pre) {\n\t\t\t\tif (image) {\n\t\t\t\t\tt.w = t.w || image.width;\n\t\t\t\t\tt.h = t.h || image.height;\n\t\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\t\trect = this.drawingRect,\n\t\t\t\t\t\tx = rect.x = t.x - t.w / 2,\n\t\t\t\t\t\ty = rect.y = t.y - t.h / 2,\n\t\t\t\t\t\tw = rect.w = t.w,\n\t\t\t\t\t\th = rect.h = t.h;\n\t\t\t\t\tctx.save();\n\t\t\t\t\tctx.translate(x, y);\n\t\t\t\t\tif (pre) {\n\t\t\t\t\t\tpre.call(this);\n\t\t\t\t\t}\n\t\t\t\t\tctx.drawImage(image, 0, 0);\n\t\t\t\t\tctx.restore();\n\t\t\t\t\t// console.log('painter.draw', x, y, w, h);\n\t\t\t\t}\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tdrawRect: function(image, s, t, pre) {\n\t\t\t\tif (image) {\n\t\t\t\t\ts.w = s.w || image.width;\n\t\t\t\t\ts.h = s.h || image.height;\n\t\t\t\t\tt.w = t.w || image.width;\n\t\t\t\t\tt.h = t.h || image.height;\n\t\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\t\trect = this.drawingRect,\n\t\t\t\t\t\tx = rect.x = t.x - s.w / 2,\n\t\t\t\t\t\ty = rect.y = t.y - s.h / 2,\n\t\t\t\t\t\tw = rect.w = t.w,\n\t\t\t\t\t\th = rect.h = t.h;\n\t\t\t\t\tctx.save();\n\t\t\t\t\tctx.translate(x, y);\n\t\t\t\t\tif (pre) {\n\t\t\t\t\t\tpre.call(this);\n\t\t\t\t\t}\n\t\t\t\t\tctx.drawImage(image, s.x, s.y, s.w, s.h, 0, 0, t.w, t.h);\n\t\t\t\t\tctx.restore();\n\t\t\t\t\t// console.log('painter.drawRect', x, y, w, h);\n\t\t\t\t}\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tflip: function(scale) {\n\t\t\t\tscale = scale || {\n\t\t\t\t\tx: 1,\n\t\t\t\t\ty: -1\n\t\t\t\t};\n\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\trect = this.drawingRect;\n\t\t\t\tctx.translate(scale.x === -1 ? rect.w : 0, scale.y === -1 ? rect.h : 0);\n\t\t\t\tctx.scale(scale.x, scale.y);\n\t\t\t},\n\t\t};\n\t\treturn Painter;\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('expandable', ['$parse', 'State', 'Dom', function($parse, State, Dom) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\t// template: '<div ng-transclude></div>',\n\t\t\t// transclude: true,\n\t\t\t// replace: true,\n\t\t\t/*\n\t\t\ttemplateUrl: function (element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/components/nav/partial/nav';\n            },\n            */\n\t\t\tlink: ExpandableLink,\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction ExpandableLink(scope, element, attributes, model) {\n\n\t\t\tvar state = new State();\n\t\t\tstate.pow = 0;\n\n\t\t\tvar relative, absolute;\n\n\t\t\tvar target, targetElement;\n\n\t\t\tvar from, to, current,\n\t\t\t\tboundingClientRect, styleObj, originalCssText;\n\n\t\t\tvar expanded = false;\n\n\t\t\tvar placeholder = document.createElement('div'),\n\t\t\t\tplaceholderElement = angular.element(placeholder);\n\t\t\tplaceholderElement.addClass('expandable-placeholder');\n\n\t\t\tfunction getStyle(node) {\n\t\t\t\tvar style = window.getComputedStyle(node, null);\n\t\t\t\tvar styleObj = {\n\t\t\t\t\t'display': style.getPropertyValue('display'),\n\t\t\t\t\t'position': style.getPropertyValue('position'),\n\t\t\t\t\t'width': style.getPropertyValue('width'),\n\t\t\t\t\t'height': style.getPropertyValue('height'),\n\t\t\t\t\t'top': style.getPropertyValue('top'),\n\t\t\t\t\t'right': style.getPropertyValue('right'),\n\t\t\t\t\t'bottom': style.getPropertyValue('bottom'),\n\t\t\t\t\t'left': style.getPropertyValue('left'),\n\t\t\t\t\t'margin-top': style.getPropertyValue('margin-top'),\n\t\t\t\t\t'margin-right': style.getPropertyValue('margin-right'),\n\t\t\t\t\t'margin-bottom': style.getPropertyValue('margin-bottom'),\n\t\t\t\t\t'margin-left': style.getPropertyValue('margin-left'),\n\t\t\t\t\t'padding-top': style.getPropertyValue('padding-top'),\n\t\t\t\t\t'padding-right': style.getPropertyValue('padding-right'),\n\t\t\t\t\t'padding-bottom': style.getPropertyValue('padding-bottom'),\n\t\t\t\t\t'padding-left': style.getPropertyValue('padding-left'),\n\t\t\t\t\t'background-color': style.getPropertyValue('background-color'),\n\t\t\t\t};\n\t\t\t\treturn styleObj;\n\t\t\t}\n\n\t\t\tfunction getTextStyle(style) {\n\t\t\t\tvar text = '';\n\t\t\t\tangular.forEach(style, function(value, key) {\n\t\t\t\t\ttext += key + ': ' + value + '; ';\n\t\t\t\t});\n\t\t\t\treturn text;\n\t\t\t}\n\n\t\t\tfunction setStyle(node, style) {\n\t\t\t\tnode.style.cssText = getTextStyle(style);\n\t\t\t}\n\n\t\t\tfunction add() {\n\t\t\t\tstyleObj = getStyle(target);\n\t\t\t\tsetStyle(placeholder, styleObj);\n\t\t\t\ttarget.parentNode.insertBefore(placeholder, target);\n\t\t\t\toriginalCssText = target.style.cssText;\n\t\t\t\ttargetElement.addClass('expandable-expanding');\n\t\t\t\tDom.getParents(target).each(function(element, node) {\n\t\t\t\t\telement.addClass('expandable-parent');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction remove() {\n\t\t\t\ttarget.style.cssText = originalCssText;\n\t\t\t\ttargetElement.removeClass('expandable-expanding');\n\t\t\t\tplaceholder.parentNode.removeChild(placeholder);\n\t\t\t\tDom.getParents(target).each(function(element, node) {\n\t\t\t\t\telement.removeClass('expandable-parent');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction setRects() {\n\t\t\t\tif (targetElement && targetElement.hasClass('expandable-expanding')) {\n\t\t\t\t\tboundingClientRect = placeholder.getBoundingClientRect();\n\t\t\t\t} else {\n\t\t\t\t\tboundingClientRect = target.getBoundingClientRect();\n\t\t\t\t}\n\t\t\t\tfrom = {\n\t\t\t\t\ttop: 0,\n\t\t\t\t\tleft: 0,\n\t\t\t\t\twidth: boundingClientRect.width, // parseInt(styleObj.width), // boundingClientRect.width,\n\t\t\t\t\theight: boundingClientRect.height, // parseInt(styleObj.height), // boundingClientRect.height,\n\t\t\t\t};\n\t\t\t\tto = {\n\t\t\t\t\ttop: 0 + (relative.top || 0),\n\t\t\t\t\tleft: 0 + (relative.left || 0),\n\t\t\t\t\twidth: from.width + (relative.right || 0),\n\t\t\t\t\theight: from.height + (relative.bottom || 0),\n\t\t\t\t};\n\t\t\t\tif (absolute.top) {\n\t\t\t\t\tto.top = absolute.top - boundingClientRect.top;\n\t\t\t\t}\n\t\t\t\tif (absolute.left) {\n\t\t\t\t\tto.left = absolute.left - boundingClientRect.left;\n\t\t\t\t}\n\t\t\t\tif (absolute.right) {\n\t\t\t\t\tvar absoluteRight = (window.innerWidth - absolute.right);\n\t\t\t\t\tvar absoluteLeft = boundingClientRect.left + to.left;\n\t\t\t\t\tto.width = absoluteRight - absoluteLeft;\n\t\t\t\t}\n\t\t\t\tif (absolute.bottom) {\n\t\t\t\t\tvar absoluteBottom = (window.innerHeight - absolute.bottom);\n\t\t\t\t\tvar absoluteTop = boundingClientRect.top + to.top;\n\t\t\t\t\tto.height = absoluteBottom - absoluteTop;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction expand() {\n\t\t\t\tif (!expanded) {\n\t\t\t\t\tsetRects();\n\t\t\t\t\tadd();\n\t\t\t\t\tcurrent = angular.copy(from);\n\t\t\t\t\tsetStyle(target, from);\n\t\t\t\t\tdynamics.animate(state, {\n\t\t\t\t\t\tpow: 1\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttype: dynamics.easeInOut,\n\t\t\t\t\t\tduration: 350,\n\t\t\t\t\t\tcomplete: function() {\n\t\t\t\t\t\t\texpanded = true;\n\t\t\t\t\t\t\tstate.idle();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchange: function() {\n\t\t\t\t\t\t\tupdate();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tstate.idle();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction contract() {\n\t\t\t\tif (expanded) {\n\t\t\t\t\tdynamics.animate(state, {\n\t\t\t\t\t\tpow: 0\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttype: dynamics.easeInOut,\n\t\t\t\t\t\tduration: 350,\n\t\t\t\t\t\tcomplete: function() {\n\t\t\t\t\t\t\texpanded = false;\n\t\t\t\t\t\t\tremove();\n\t\t\t\t\t\t\tstate.idle();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchange: function() {\n\t\t\t\t\t\t\tupdate();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tstate.idle();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction update() {\n\t\t\t\tcurrent.left = (from.left + (to.left - from.left) * state.pow) + 'px';\n\t\t\t\tcurrent.top = (from.top + (to.top - from.top) * state.pow) + 'px';\n\t\t\t\tcurrent.width = (from.width + (to.width - from.width) * state.pow) + 'px';\n\t\t\t\tcurrent.height = (from.height + (to.height - from.height) * state.pow) + 'px';\n\t\t\t\tsetStyle(target, current);\n\t\t\t}\n\n\t\t\tfunction toggle() {\n\t\t\t\tif (state.busy()) {\n\t\t\t\t\tif (expanded) {\n\t\t\t\t\t\tcontract();\n\t\t\t\t\t} else {\n\t\t\t\t\t\texpand();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction set() {\n\t\t\t\trelative = attributes.expandableRelative ? $parse(attributes.expandableRelative)(scope) : {};\n\t\t\t\tabsolute = attributes.expandableAbsolute ? $parse(attributes.expandableAbsolute)(scope) : {};\n\t\t\t\ttarget = element[0].querySelector(attributes.expandable);\n\t\t\t\tif (target) {\n\t\t\t\t\ttargetElement = angular.element(target);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onDown(e) {\n\t\t\t\tset();\n\t\t\t\tif (target) {\n\t\t\t\t\texpand();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onUp(e) {\n\t\t\t\tif (Dom.getClosestNode(e.target, element[0])) {\n\t\t\t\t\t// nope\n\t\t\t\t} else {\n\t\t\t\t\tset();\n\t\t\t\t\tif (target) {\n\t\t\t\t\t\tcontract();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onResize(e) {\n\t\t\t\tif (expanded || state.isBusy) {\n\t\t\t\t\tsetRects();\n\t\t\t\t\tupdate();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onKeyDown(e) {\n\t\t\t\tvar key = e.key.toLowerCase();\n\t\t\t\tswitch (key) {\n\t\t\t\t\tcase 'escape':\n\t\t\t\t\t\tset();\n\t\t\t\t\t\tif (target) {\n\t\t\t\t\t\t\tcontract();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'enter':\n\t\t\t\t\t\tset();\n\t\t\t\t\t\tif (target && target.tagName && target.tagName.toLowerCase() === 'input') {\n\t\t\t\t\t\t\tcontract();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar trigger = attributes.expandableTrigger ? element[0].querySelector(attributes.expandableTrigger) : null;\n\t\t\ttrigger = trigger ? angular.element(trigger) : element;\n\n\t\t\tfunction addListeners() {\n\t\t\t\ttrigger.on('mousedown touchstart', onDown);\n\t\t\t\telement.on('keydown', onKeyDown);\n\t\t\t\tangular.element(window)\n\t\t\t\t\t.on('click', onUp)\n\t\t\t\t\t.on('resize', onResize);\n\t\t\t}\n\n\t\t\tfunction removeListeners() {\n\t\t\t\ttrigger.off('mousedown touchstart', onDown);\n\t\t\t\telement.off('keydown', onKeyDown);\n\t\t\t\tangular.element(window)\n\t\t\t\t\t.off('click', onUp)\n\t\t\t\t\t.off('resize', onResize);\n\t\t\t}\n\n\t\t\tscope.$on('$destroy', function() {\n\t\t\t\tremoveListeners();\n\t\t\t});\n\n\t\t\taddListeners();\n\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('controlMessages', [function() {\n\t\treturn {\n\t\t\trestrict: 'E',\n\t\t\ttemplateUrl: 'artisan/components/forms/partial/messages',\n\t\t\ttransclude: {\n\t\t\t\t'message': '?messageItems',\n\t\t\t},\n\t\t\tlink: function(scope, element, attributes, model) {}\n\t\t};\n    }]);\n\n\tapp.directive('control', ['$parse', function($parse) {\n\t\tfunction formatLabel(string, prepend, expression) {\n\t\t\tstring = string || '';\n\t\t\tprepend = prepend || '';\n\t\t\tvar splitted = string.split(',');\n\t\t\tif (splitted.length > 1) {\n\t\t\t\tvar formatted = splitted.shift();\n\t\t\t\tangular.forEach(splitted, function(value, index) {\n\t\t\t\t\tif (expression) {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join(prepend + value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (expression) {\n\t\t\t\t\treturn '\\'' + formatted + '\\'';\n\t\t\t\t} else {\n\t\t\t\t\treturn formatted;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn prepend + string;\n\t\t\t}\n\t\t}\n\t\tvar uniqueId = 0;\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function(element, attributes) {\n\t\t\t\tvar template = 'artisan/components/forms/partial/text';\n\t\t\t\tswitch (attributes.control) {\n\t\t\t\t\tcase 'select':\n\t\t\t\t\t\ttemplate = 'artisan/components/forms/partial/select';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\treturn template;\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\tngModel: '=',\n\t\t\t\trequired: '=',\n\t\t\t\tform: '@',\n\t\t\t\ttitle: '@',\n\t\t\t\tplaceholder: '@',\n\t\t\t\tsource: '=?',\n\t\t\t\tkey: '@?',\n\t\t\t\tlabel: '@?',\n\t\t\t},\n\t\t\trequire: 'ngModel',\n\t\t\ttransclude: true,\n\t\t\tlink: {\n\t\t\t\tpre: function preLink(scope, element, attributes, controller, transclude) {\n\t\t\t\t\tvar label = scope.label = (scope.label ? scope.label : 'name');\n\t\t\t\t\tvar key = scope.key = (scope.key ? scope.key : 'id');\n\t\t\t\t\tif (attributes.control === 'select') {\n\t\t\t\t\t\tvar filter = (attributes.filter ? '| ' + attributes.filter : '');\n\t\t\t\t\t\tvar optionLabel = formatLabel(label, 'item.', true);\n\t\t\t\t\t\tscope.getOptions = function() {\n\t\t\t\t\t\t\treturn attributes.number ?\n\t\t\t\t\t\t\t\t'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in source ' + filter :\n\t\t\t\t\t\t\t\toptionLabel + ' disable when item.disabled for item in source ' + filter + ' track by item.' + key;\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tvar type = scope.type = attributes.control;\n\t\t\t\t\tvar form = scope.form = scope.form || 'form';\n\t\t\t\t\tvar title = scope.title = scope.title || 'untitled';\n\t\t\t\t\tvar placeholder = scope.placeholder = scope.placeholder || title;\n\t\t\t\t\tvar field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\n\t\t\t\t\tscope.format = attributes.format || null;\n\t\t\t\t\tscope.precision = attributes.precision || null;\n\t\t\t\t\tscope.validate = attributes.validate || attributes.control;\n\t\t\t\t\tscope.minLength = attributes.minLength || 0;\n\t\t\t\t\tscope.maxLength = attributes.maxLength || Number.POSITIVE_INFINITY;\n\t\t\t\t\tscope.min = attributes.min || null;\n\t\t\t\t\tscope.max = attributes.max || null;\n\t\t\t\t\tscope.options = $parse(attributes.options)(scope) || {};\n\t\t\t\t\tscope.focus = false;\n\t\t\t\t\tscope.visible = false;\n\t\t\t\t\tscope.onChange = function(model) {\n\t\t\t\t\t\t$parse(attributes.onChange)(scope.$parent);\n\t\t\t\t\t};\n\t\t\t\t\tscope.onFilter = function(model) {\n\t\t\t\t\t\t$parse(attributes.onFilter)(scope.$parent);\n\t\t\t\t\t};\n\t\t\t\t\tscope.getType = function() {\n\t\t\t\t\t\tvar type = 'text';\n\t\t\t\t\t\tswitch (attributes.control) {\n\t\t\t\t\t\t\tcase 'password':\n\t\t\t\t\t\t\t\ttype = scope.visible ? 'text' : 'password';\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\ttype = attributes.control;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn type;\n\t\t\t\t\t};\n\t\t\t\t\tscope.getClasses = function() {\n\t\t\t\t\t\tvar form = $parse(scope.form)(scope.$parent);\n\t\t\t\t\t\tvar field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t'control-focus': scope.focus,\n\t\t\t\t\t\t\t'control-success': field.$valid,\n\t\t\t\t\t\t\t'control-error': field.$invalid && (form.$submitted || field.$touched),\n\t\t\t\t\t\t\t'control-empty': !field.$viewValue\n\t\t\t\t\t\t};\n\t\t\t\t\t};\n\t\t\t\t\tscope.getMessages = function() {\n\t\t\t\t\t\tvar form = $parse(scope.form)(scope.$parent);\n\t\t\t\t\t\tvar field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n\t\t\t\t\t\treturn (form.$submitted || field.$touched) && field.$error;\n\t\t\t\t\t};\n\t\t\t\t\tscope.toggleVisibility = function() {\n\t\t\t\t\t\tscope.visible = !scope.visible;\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t};\n    }]);\n\n\tapp.directive('_control', ['$http', '$templateCache', '$compile', '$parse', function($http, $templateCache, $compile, $parse) {\n\t\tfunction formatLabel(string, prepend, expression) {\n\t\t\tstring = string || '';\n\t\t\tprepend = prepend || '';\n\t\t\tvar splitted = string.split(',');\n\t\t\tif (splitted.length > 1) {\n\t\t\t\tvar formatted = splitted.shift();\n\t\t\t\tangular.forEach(splitted, function(value, index) {\n\t\t\t\t\tif (expression) {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join(prepend + value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (expression) {\n\t\t\t\t\treturn '\\'' + formatted + '\\'';\n\t\t\t\t} else {\n\t\t\t\t\treturn formatted;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn prepend + string;\n\t\t\t}\n\t\t}\n\t\tvar uniqueId = 0;\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function(element, attributes) {\n\t\t\t\tvar template = 'artisan/components/forms/partial/text';\n\t\t\t\tswitch (attributes.control) {\n\t\t\t\t\tcase 'select':\n\t\t\t\t\t\ttemplate = 'artisan/components/forms/partial/select';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\treturn template;\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\tngModel: '=',\n\t\t\t\trequired: '=',\n\t\t\t\tform: '@',\n\t\t\t\ttitle: '@',\n\t\t\t\tplaceholder: '@',\n\t\t\t},\n\t\t\trequire: 'ngModel',\n\t\t\t/*\n\t\t\tlink: function(scope, element, attributes, model) {\n\t\t\t},\n\t\t\t*/\n\t\t\tcompile: function(element, attributes) {\n\t\t\t\treturn {\n\t\t\t\t\tpre: function(scope, element, attributes) {\n\t\t\t\t\t\tif (attributes.control === 'select') {\n\t\t\t\t\t\t\tvar label = (attributes.label ? attributes.label : 'name');\n\t\t\t\t\t\t\tvar key = (attributes.key ? attributes.key : 'id');\n\t\t\t\t\t\t\tvar filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\n\t\t\t\t\t\t\tvar optionLabel = formatLabel(label, 'item.', true);\n\t\t\t\t\t\t\tscope.options = attributes.number ?\n\t\t\t\t\t\t\t\t'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter :\n\t\t\t\t\t\t\t\toptionLabel + ' disable when item.disabled for item in ' + attributes.source + filter + ' track by item.' + key;\n\t\t\t\t\t\t\tconsole.log('control.compile.pre', scope.options);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar type = scope.type = attributes.control;\n\t\t\t\t\t\tvar form = scope.form = scope.form || 'form';\n\t\t\t\t\t\tvar title = scope.title = scope.title || 'untitled';\n\t\t\t\t\t\tvar placeholder = scope.placeholder = scope.placeholder || title;\n\t\t\t\t\t\tvar field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\n\t\t\t\t\t\tscope.validate = attributes.validate || attributes.control;\n\t\t\t\t\t\tscope.format = attributes.format || null;\n\t\t\t\t\t\tscope.precision = attributes.precision || null;\n\t\t\t\t\t\tscope.validate = attributes.validate || attributes.control;\n\t\t\t\t\t\tscope.minLength = attributes.min || 0;\n\t\t\t\t\t\tscope.maxLength = attributes.max || Number.POSITIVE_INFINITY;\n\t\t\t\t\t\tscope.options = $parse(attributes.options)(scope) || {};\n\t\t\t\t\t\tscope.focus = false;\n\t\t\t\t\t\tscope.visible = false;\n\t\t\t\t\t\tscope.getType = function() {\n\t\t\t\t\t\t\tvar type = 'text';\n\t\t\t\t\t\t\tswitch (attributes.control) {\n\t\t\t\t\t\t\t\tcase 'password':\n\t\t\t\t\t\t\t\t\t// var form = $parse(scope.form)(scope.$parent);\n\t\t\t\t\t\t\t\t\t// var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n\t\t\t\t\t\t\t\t\ttype = scope.visible ? 'text' : 'password';\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\ttype = attributes.control;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// console.log('control.getType', type);\n\t\t\t\t\t\t\treturn type;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.getClasses = function() {\n\t\t\t\t\t\t\tvar form = $parse(scope.form)(scope.$parent);\n\t\t\t\t\t\t\tvar field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t'control-focus': scope.focus,\n\t\t\t\t\t\t\t\t'control-success': field.$valid,\n\t\t\t\t\t\t\t\t'control-error': field.$invalid && (form.$submitted || field.$touched),\n\t\t\t\t\t\t\t\t'control-empty': !field.$viewValue\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.getMessages = function() {\n\t\t\t\t\t\t\tvar form = $parse(scope.form)(scope.$parent);\n\t\t\t\t\t\t\tvar field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n\t\t\t\t\t\t\treturn (form.$submitted || field.$touched) && field.$error;\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\t// post: function (scope, element, attributes) { }\n\t\t\t\t};\n\t\t\t}\n\t\t\t/*\n\t\t\tcompile: function(element, attributes) {\n\t\t\t    element.removeAttr('my-dir');\n\t\t\t    element.attr('ng-hide', 'true');\n\t\t\t    return function(scope) {\n\t\t\t        $compile(element)(scope);\n\t\t\t    };\n\t\t\t},\n\t\t\t*/\n\t\t};\n    }]);\n\n\tapp.directive('numberPicker', ['$parse', '$timeout', function($parse, $timeout) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplate: '<div class=\"input-group\">' +\n\t\t\t\t'   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">-</button></span>' +\n\t\t\t\t'   <div ng-transclude></div>' +\n\t\t\t\t'   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">+</button></span>' +\n\t\t\t\t'</div>',\n\t\t\treplace: true,\n\t\t\ttransclude: true,\n\t\t\tlink: function(scope, element, attributes, model) {\n\t\t\t\tvar node = element[0];\n\t\t\t\tvar nodeRemove = node.querySelectorAll('.input-group-btn > .btn')[0];\n\t\t\t\tvar nodeAdd = node.querySelectorAll('.input-group-btn > .btn')[1];\n\n\t\t\t\tfunction onRemove(e) {\n\t\t\t\t\tvar min = $parse(attributes.min)(scope);\n\t\t\t\t\tvar getter = $parse(attributes.numberPicker);\n\t\t\t\t\tvar setter = getter.assign;\n\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\tsetter(scope, Math.max(min, getter(scope) - 1));\n\t\t\t\t\t});\n\t\t\t\t\t// console.log('numberPicker.onRemove', min);\n\t\t\t\t}\n\n\t\t\t\tfunction onAdd(e) {\n\t\t\t\t\tvar max = $parse(attributes.max)(scope);\n\t\t\t\t\tvar getter = $parse(attributes.numberPicker);\n\t\t\t\t\tvar setter = getter.assign;\n\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\tsetter(scope, Math.min(max, getter(scope) + 1));\n\t\t\t\t\t});\n\t\t\t\t\t// console.log('numberPicker.onAdd', max);\n\t\t\t\t}\n\n\t\t\t\tfunction addListeners() {\n\t\t\t\t\tangular.element(nodeRemove).on('touchstart mousedown', onRemove);\n\t\t\t\t\tangular.element(nodeAdd).on('touchstart mousedown', onAdd);\n\t\t\t\t}\n\n\t\t\t\tfunction removeListeners() {\n\t\t\t\t\tangular.element(nodeRemove).off('touchstart mousedown', onRemove);\n\t\t\t\t\tangular.element(nodeAdd).off('touchstart mousedown', onAdd);\n\t\t\t\t}\n\t\t\t\tscope.$on('$destroy', function() {\n\t\t\t\t\tremoveListeners();\n\t\t\t\t});\n\t\t\t\taddListeners();\n\t\t\t}\n\t\t};\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('validate', ['$filter', function($filter) {\n\t\treturn {\n\t\t\trequire: 'ngModel',\n\t\t\tlink: function(scope, element, attributes, model) {\n\t\t\t\tvar type = attributes.validate;\n\t\t\t\tvar format = attributes.format || '';\n\t\t\t\tvar precision = attributes.precision || 2;\n\t\t\t\tvar focus = false;\n\t\t\t\t// console.log('validate', type);\n\t\t\t\tswitch (type) {\n\t\t\t\t\tcase 'date':\n\t\t\t\t\tcase 'datetime':\n\t\t\t\t\tcase 'datetime-local':\n\t\t\t\t\t\tmodel.$formatters.push(function(value) {\n\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\treturn $filter('date')(value, format);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'number':\n\t\t\t\t\t\tmodel.$parsers.unshift(function(value) {\n\t\t\t\t\t\t\tvar valid = false;\n\t\t\t\t\t\t\tif (value !== undefined && value !== \"\") {\n\t\t\t\t\t\t\t\tvalid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); //\n\t\t\t\t\t\t\t\tvalue = Number(value);\n\t\t\t\t\t\t\t\tmodel.$setValidity('number', valid);\n\t\t\t\t\t\t\t\tif (valid) {\n\t\t\t\t\t\t\t\t\tmodel.$setValidity('positive', value >= 0.01);\n\t\t\t\t\t\t\t\t\tif (attributes.min !== undefined) {\n\t\t\t\t\t\t\t\t\t\tmodel.$setValidity('range', value >= Number(attributes.min));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (attributes.max !== undefined) {\n\t\t\t\t\t\t\t\t\t\tmodel.$setValidity('range', value <= Number(attributes.max));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvalid = true;\n\t\t\t\t\t\t\t\tvalue = Number(value);\n\t\t\t\t\t\t\t\tmodel.$setValidity('number', true);\n\t\t\t\t\t\t\t\tmodel.$setValidity('positive', true);\n\t\t\t\t\t\t\t\tif (attributes.min !== undefined) {\n\t\t\t\t\t\t\t\t\tmodel.$setValidity('range', true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (attributes.max !== undefined) {\n\t\t\t\t\t\t\t\t\tmodel.$setValidity('range', true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn value;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tmodel.$formatters.push(function(value) {\n\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\treturn $filter('number')(value, precision) + ' ' + format;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'anynumber':\n\t\t\t\t\t\tmodel.$parsers.unshift(function(value) {\n\t\t\t\t\t\t\tvar valid = false;\n\t\t\t\t\t\t\tif (value !== undefined && value !== \"\") {\n\t\t\t\t\t\t\t\tvalid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); //\n\t\t\t\t\t\t\t\tvalue = Number(value);\n\t\t\t\t\t\t\t\tmodel.$setValidity('number', valid);\n\t\t\t\t\t\t\t\tif (valid) {\n\t\t\t\t\t\t\t\t\tif (attributes.min !== undefined) {\n\t\t\t\t\t\t\t\t\t\tmodel.$setValidity('range', value >= Number(attributes.min));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (attributes.max !== undefined) {\n\t\t\t\t\t\t\t\t\t\tmodel.$setValidity('range', value <= Number(attributes.max));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvalid = true;\n\t\t\t\t\t\t\t\tvalue = Number(value);\n\t\t\t\t\t\t\t\tmodel.$setValidity('number', true);\n\t\t\t\t\t\t\t\tif (attributes.min !== undefined) {\n\t\t\t\t\t\t\t\t\tmodel.$setValidity('range', true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (attributes.max !== undefined) {\n\t\t\t\t\t\t\t\t\tmodel.$setValidity('range', true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn value;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tmodel.$formatters.push(function(value) {\n\t\t\t\t\t\t\tif (value || value === 0) {\n\t\t\t\t\t\t\t\treturn $filter('number')(value, precision) + ' ' + format;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tfunction onFocus() {\n\t\t\t\t\tfocus = true;\n\t\t\t\t\tif (format) {\n\t\t\t\t\t\telement[0].value = model.$modelValue || null;\n\t\t\t\t\t\tif (!model.$modelValue) {\n\t\t\t\t\t\t\tmodel.$setViewValue(null);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction doBlur() {\n\t\t\t\t\tif (format && !model.$invalid) {\n\t\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\t\tcase 'date':\n\t\t\t\t\t\t\tcase 'datetime':\n\t\t\t\t\t\t\tcase 'datetime-local':\n\t\t\t\t\t\t\t\telement[0].value = model.$modelValue ? $filter('date')(model.$modelValue, format) : ' ';\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\telement[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onBlur() {\n\t\t\t\t\tfocus = false;\n\t\t\t\t\tdoBlur();\n\t\t\t\t}\n\n\t\t\t\tfunction addListeners() {\n\t\t\t\t\telement.on('focus', onFocus);\n\t\t\t\t\telement.on('blur', onBlur);\n\t\t\t\t}\n\n\t\t\t\tfunction removeListeners() {\n\t\t\t\t\telement.off('focus', onFocus);\n\t\t\t\t\telement.off('blur', onBlur);\n\t\t\t\t}\n\t\t\t\tscope.$on('$destroy', function() {\n\t\t\t\t\tremoveListeners();\n\t\t\t\t});\n\t\t\t\taddListeners();\n\t\t\t}\n\t\t};\n    }]);\n\n}());\n\n/* global angular */\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\t// micro interactions\n\n\tfunction tap(Events) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\tpriority: 0,\n\t\t\tlink: link\n\t\t};\n\n\t\tfunction link(scope, element, attributes, model) {\n\t\t\tif (attributes.ngBind) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t/*\n\t\t\tif (attributes.href === '#' && !attributes.ngHref && !attributes.ngClick) {\n\t\t\t\treturn;\n            }\n            */\n\n\t\t\telement.addClass('interaction-tap');\n\t\t\tvar node = document.createElement('interaction');\n\t\t\telement[0].appendChild(node);\n\n\t\t\tfunction onDown(e) {\n\t\t\t\telement.removeClass('interaction-animate');\n\t\t\t\tvoid element.offsetWidth;\n\t\t\t\t// node.style.animationPlayState = \"paused\";\n\t\t\t\tnode.style.left = e.relative.x + 'px';\n\t\t\t\tnode.style.top = e.relative.y + 'px';\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\telement.addClass('interaction-animate');\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\telement.removeClass('interaction-animate');\n\t\t\t\t\t}, 1000);\n\t\t\t\t}, 10);\n\n\t\t\t\t// console.log('tap.onDown', node, node.parentElement);\n\t\t\t}\n\t\t\tvar listeners = { // down, move, up, click\n\t\t\t\tdown: onDown,\n\t\t\t};\n\t\t\tvar events = new Events(element).add(listeners, scope); // passing scope to add remove listeners automatically on $destroy\n\t\t}\n\t}\n\tapp.directive('ngHref', ['Events', tap]);\n\tapp.directive('ngClick', ['Events', tap]);\n\n}());\n\n/* global angular */\r\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.directive('modalView', ['$parse', '$templateRequest', '$compile', '$controller', 'Dom', function($parse, $templateRequest, $compile, $controller, Dom) {\r\n\r\n\t\tfunction compileController(scope, element, html, data) {\r\n\t\t\t// console.log('modalView.compileController', element);\r\n\t\t\telement.html(html);\r\n\t\t\tvar link = $compile(element.contents());\r\n\t\t\tif (data.controller) {\r\n\t\t\t\tvar $scope = scope.$new();\r\n\t\t\t\tangular.extend($scope, data);\r\n\t\t\t\tvar controller = $controller(data.controller, {\r\n\t\t\t\t\t$scope: $scope\r\n\t\t\t\t});\r\n\t\t\t\tif (data.controllerAs) {\r\n\t\t\t\t\tscope[data.controllerAs] = controller;\r\n\t\t\t\t}\r\n\t\t\t\telement.data('$ngControllerController', controller);\r\n\t\t\t\telement.children().data('$ngControllerController', controller);\r\n\t\t\t\tscope = $scope;\r\n\t\t\t}\r\n\t\t\tlink(scope);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\trestrict: 'A',\r\n\t\t\tpriority: -400,\r\n\t\t\tlink: function(scope, element, attributes, model) {\r\n\t\t\t\tvar modal = $parse(attributes.modalView);\r\n\t\t\t\tmodal = modal(scope);\r\n\t\t\t\tmodal.templateUrl = modal.templateUrl || 'artisan/components/modals/partial/modal';\r\n\t\t\t\t$templateRequest(modal.templateUrl).then(function(html) {\r\n\t\t\t\t\tcompileController(scope, element, html, modal);\r\n\t\t\t\t});\r\n\t\t\t\t/*\r\n\t\t\t\t// window.scrollTo(0, element[0].offsetTop - 100);\r\n\t\t\t\tfunction onClick(e) {\r\n\t\t\t\t    var closest = Dom.getClosestNode(e.target, element[0]);\r\n\t\t\t\t    if (closest === null) {\r\n\t\t\t\t        modal.reject(null);\r\n\t\t\t\t    }\r\n\t\t\t\t    // console.log('onClick', closest);\r\n\t\t\t\t}\r\n\t\t\t\tfunction addListeners() {\r\n\t\t\t\t    angular.element(window).on('click', onClick);\r\n\t\t\t\t}\r\n\t\t\t\tfunction removeListeners() {\r\n\t\t\t\t    angular.element(window).off('click', onClick);\r\n\t\t\t\t}\r\n\t\t\t\tscope.$on('destroy', function () {\r\n\t\t\t\t    removeListeners();\r\n\t\t\t\t});\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t    addListeners();\r\n\t\t\t\t}, 500);\r\n\t\t\t\t*/\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\r\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.provider('$modal', [function $modalProvider() {\r\n\r\n\t\tvar modals = [];\r\n\t\tvar routes = {};\r\n\r\n\t\tthis.modals = modals;\r\n\t\tthis.routes = routes;\r\n\t\tthis.when = when;\r\n\r\n\t\tfunction when(path, modal) {\r\n\t\t\troutes[path] = modal;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tthis.$get = ['$q', '$timeout', function modalFactory($q, $timeout) {\r\n\r\n\t\t\tfunction popModal(modal) {\r\n\t\t\t\t// console.log('modalProvider.popModal', modal);\r\n\t\t\t\tvar index = -1;\r\n\t\t\t\tangular.forEach(modals, function(m, i) {\r\n\t\t\t\t\tif (m === modal) {\r\n\t\t\t\t\t\tindex = i;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\t$timeout(function() {\r\n\t\t\t\t\t\tmodal.active = false;\r\n\t\t\t\t\t\tmodals.splice(index, 1);\r\n\t\t\t\t\t\tif (modals.length) {\r\n\t\t\t\t\t\t\tmodals[modals.length - 1].active = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction closeModal(modal) {\r\n\t\t\t\t// console.log('modalProvider.closeModal', modal);\r\n\t\t\t\tvar index = -1;\r\n\t\t\t\tangular.forEach(modals, function(m, i) {\r\n\t\t\t\t\tif (m === modal) {\r\n\t\t\t\t\t\tindex = i;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\tmodal.active = false;\r\n\t\t\t\t\t$timeout(function() {\r\n\t\t\t\t\t\twhile (modals.length) {\r\n\t\t\t\t\t\t\tmodals.splice(modals.length - 1, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 500);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction addModal(path, params) {\r\n\t\t\t\t// console.log('modalProvider.addModal', path, params);\r\n\t\t\t\tvar deferred = $q.defer();\r\n\t\t\t\tparams = params || null;\r\n\t\t\t\tvar modal = {\r\n\t\t\t\t\ttitle: 'Untitled',\r\n\t\t\t\t\tcontroller: null,\r\n\t\t\t\t\ttemplateUrl: null,\r\n\t\t\t\t\tparams: params,\r\n\t\t\t\t};\r\n\t\t\t\tvar current = routes[path];\r\n\t\t\t\tif (current) {\r\n\t\t\t\t\tangular.extend(modal, current);\r\n\t\t\t\t}\r\n\t\t\t\tmodal.deferred = deferred;\r\n\t\t\t\tmodal.back = function(data) {\r\n\t\t\t\t\tpopModal(this);\r\n\t\t\t\t\tmodal.deferred.resolve(data, modal);\r\n\t\t\t\t}\r\n\t\t\t\tmodal.resolve = function(data) {\r\n\t\t\t\t\tcloseModal(this);\r\n\t\t\t\t\tmodal.deferred.resolve(data, modal);\r\n\t\t\t\t}\r\n\t\t\t\tmodal.reject = function() {\r\n\t\t\t\t\tcloseModal(this);\r\n\t\t\t\t\tmodal.deferred.reject(modal);\r\n\t\t\t\t}\r\n\t\t\t\tmodals.push(modal);\r\n\t\t\t\tangular.forEach(modals, function(m, i) {\r\n\t\t\t\t\tm.active = false;\r\n\t\t\t\t});\r\n\t\t\t\tif (modals.length) {\r\n\t\t\t\t\tmodal.active = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$timeout(function() {\r\n\t\t\t\t\t\tmodal.active = true;\r\n\t\t\t\t\t\t// window.scrollTo(0, 0);\r\n\t\t\t\t\t}, 500);\r\n\t\t\t\t}\r\n\t\t\t\treturn deferred.promise;\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tmodals: modals,\r\n\t\t\t\taddModal: addModal,\r\n\t\t\t};\r\n        }];\r\n\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('nav', ['$parse', 'Nav', function($parse, Nav) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function(element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/components/nav/partial/nav';\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\titems: '=nav',\n\t\t\t},\n\t\t\tlink: NavLink,\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction NavLink(scope, element, attributes, model) {\n\t\t\tscope.$watch('items', function(value) {\n\t\t\t\t// console.log(value instanceof Nav, value);\n\t\t\t\tif (value) {\n\t\t\t\t\tif (angular.isArray(value)) {\n\t\t\t\t\t\tvar onPath = $parse(attributes.onPath)(scope.$parent);\n\t\t\t\t\t\tvar onNav = $parse(attributes.onNav)(scope.$parent);\n\t\t\t\t\t\tvar nav = new Nav({\n\t\t\t\t\t\t\tonPath: onPath,\n\t\t\t\t\t\t\tonNav: onNav\n\t\t\t\t\t\t});\n\t\t\t\t\t\tnav.setItems(value);\n\t\t\t\t\t\tscope.item = nav;\n\n\t\t\t\t\t} else if (value instanceof Nav) {\n\t\t\t\t\t\tscope.item = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n    }]);\n\n\tapp.directive('navItem', ['$timeout', 'Events', function($timeout, Events) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function(element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/components/nav/partial/nav-item';\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\titem: '=navItem',\n\t\t\t},\n\t\t\tlink: NavItemLink,\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction NavItemLink(scope, element, attributes, model) {\n\t\t\tvar navItem = angular.element(element[0].querySelector('.nav-link'));\n\n\t\t\tvar output;\n\n\t\t\tfunction itemOpen(item, immediate) {\n\t\t\t\tvar state = item.$nav.state;\n\t\t\t\tstate.active = true;\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tstate.immediate = immediate;\n\t\t\t\t\tstate.closed = state.closing = false;\n\t\t\t\t\tstate.opening = true;\n\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\tstate.opening = false;\n\t\t\t\t\t\tstate.opened = true;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction itemClose(item, immediate) {\n\t\t\t\tvar state = item.$nav.state;\n\t\t\t\tstate.active = false;\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tstate.immediate = immediate;\n\t\t\t\t\tstate.opened = state.opening = false;\n\t\t\t\t\tstate.closing = true;\n\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\tstate.closing = false;\n\t\t\t\t\t\tstate.closed = true;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tif (item.items) {\n\t\t\t\t\tangular.forEach(item.items, function(o) {\n\t\t\t\t\t\titemClose(o, true);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction itemToggle(item) {\n\t\t\t\t// console.log('itemToggle', item);\n\t\t\t\tvar state = item.$nav.state;\n\t\t\t\tstate.active = item.items ? !state.active : true;\n\t\t\t\tif (state.active) {\n\t\t\t\t\tif (item.$nav.parent) {\n\t\t\t\t\t\tangular.forEach(item.$nav.parent.items, function(o) {\n\t\t\t\t\t\t\tif (o !== item) {\n\t\t\t\t\t\t\t\titemClose(o, true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\titemOpen(item);\n\t\t\t\t} else {\n\t\t\t\t\titemClose(item);\n\t\t\t\t}\n\t\t\t\t// console.log(state);\n\t\t\t}\n\n\t\t\tfunction onDown(e) {\n\t\t\t\tvar item = scope.item;\n\t\t\t\t// console.log('Item.onDown', item);\n\t\t\t\tvar state = item.$nav.state;\n\t\t\t\tif (state.active) {\n\t\t\t\t\toutput = false;\n\t\t\t\t\ttrigger();\n\t\t\t\t} else if (item.$nav.onNav) {\n\t\t\t\t\tvar promise = item.$nav.onNav(item, item.$nav);\n\t\t\t\t\tif (promise && typeof promise.then === 'function') {\n\t\t\t\t\t\tpromise.then(function(resolved) {\n\t\t\t\t\t\t\t// go on\n\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t}, function(rejected) {\n\t\t\t\t\t\t\t// do nothing\n\t\t\t\t\t\t});\n\t\t\t\t\t\toutput = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toutput = promise;\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction trigger() {\n\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\titemToggle(item);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// preventDefault(e);\n\t\t\t}\n\n\t\t\tfunction onClick(e) {\n\t\t\t\t// console.log('Item.onClick', e);\n\t\t\t\treturn preventDefault(e);\n\t\t\t}\n\n\t\t\tfunction preventDefault(e) {\n\t\t\t\tif (output === false) {\n\t\t\t\t\t// console.log('Item.preventDefault', e);\n\t\t\t\t\te.stop();\n\t\t\t\t\t// e.preventDefault();\n\t\t\t\t\t// e.stopPropagation();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar events = new Events(navItem).add({\n\t\t\t\tdown: onDown,\n\t\t\t\tclick: onClick,\n\t\t\t}, scope);\n\t\t}\n\n    }]);\n\n\tapp.directive('navTo', ['$parse', '$timeout', 'Events', function($parse, $timeout, Events) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\tlink: NavToLink\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction NavToLink(scope, element, attributes) {\n\t\t\tfunction onDown(e) {\n\t\t\t\tconsole.log('navTo.onDown', attributes.navTo);\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tvar callback = $parse(attributes.navTo);\n\t\t\t\t\tcallback(scope);\n\t\t\t\t});\n\t\t\t\te.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar events = new Events(element).add({\n\t\t\t\tdown: onDown,\n\t\t\t}, scope);\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Nav', ['Silent', function(Silent) {\n\n\t\tfunction Nav(options) {\n\t\t\tvar nav = this;\n\t\t\tvar defaults = {\n\t\t\t\titems: [],\n\t\t\t}\n\t\t\tangular.extend(nav, defaults);\n\t\t\tif (options) {\n\t\t\t\tangular.extend(nav, options);\n\t\t\t}\n\t\t\tnav.setNav(nav, null);\n\t\t}\n\n\t\tvar statics = {\n\t\t\tsilent: NavSilent,\n\t\t\tpath: NavPath,\n\t\t};\n\n\t\tvar publics = {\n\t\t\taddItem: addItem,\n\t\t\taddItems: addItems,\n\t\t\tgetPath: getPath,\n\t\t\tsetItems: setItems,\n\t\t\tsetNav: setNav,\n\t\t\tsetNavs: setNavs,\n\t\t};\n\n\t\tangular.extend(Nav, statics);\n\t\tangular.extend(Nav.prototype, publics);\n\n\t\treturn Nav;\n\n\t\t// static methods\n\n\t\tfunction NavSilent(path) {\n\t\t\tSilent.silent(path);\n\t\t}\n\n\t\tfunction NavPath(path) {\n\t\t\tSilent.path(path);\n\t\t}\n\n\t\t// prototype methods\n\n\t\tfunction setItems(items) {\n\t\t\tvar nav = this;\n\t\t\tnav.path = Silent.path();\n\t\t\tnav.items = items;\n\t\t\tnav.setNavs(items, nav);\n\t\t}\n\n\t\tfunction setNavs(items, parent) {\n\t\t\tvar nav = this;\n\t\t\tif (items) {\n\t\t\t\tangular.forEach(items, function(item) {\n\t\t\t\t\tnav.setNav(item, parent);\n\t\t\t\t\tnav.setNavs(item.items, item);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction setNav(item, parent) {\n\t\t\tvar nav = this;\n\t\t\tvar $nav = {\n\t\t\t\tparent: parent || null,\n\t\t\t\tlevel: parent ? parent.$nav.level + 1 : 0,\n\t\t\t\tstate: {},\n\t\t\t\taddItems: function(x) {\n\t\t\t\t\tnav.addItems(x, item);\n\t\t\t\t},\n\t\t\t\tonNav: nav.onNav,\n\t\t\t};\n\t\t\titem.$nav = $nav;\n\t\t\t$nav.path = nav.getPath(item);\n\t\t\tif ($nav.path === nav.path) {\n\t\t\t\t$nav.state.active = true;\n\t\t\t\t$nav.state.opened = true;\n\t\t\t\twhile ($nav.parent) {\n\t\t\t\t\t$nav = $nav.parent.$nav;\n\t\t\t\t\t$nav.state.active = true;\n\t\t\t\t\t$nav.state.opened = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction addItems(itemOrItems, parent) {\n\t\t\tvar nav = this;\n\t\t\tif (angular.isArray(itemOrItems)) {\n\t\t\t\tangular.forEach(itemOrItems, function(item) {\n\t\t\t\t\tnav.addItem(item, parent);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tnav.addItem(itemOrItems, parent);\n\t\t\t}\n\t\t}\n\n\t\tfunction addItem(item, parent) {\n\t\t\tvar nav = this,\n\t\t\t\tonPath = nav.onPath,\n\t\t\t\tonNav = nav.onNav;\n\t\t\tnav.setNav(item, parent);\n\t\t\tif (parent) {\n\t\t\t\tparent.items = parent.items || [];\n\t\t\t\tparent.items.push(item);\n\t\t\t}\n\t\t}\n\n\t\tfunction getPath(item) {\n\t\t\tvar path = null;\n\t\t\tif (this.onPath) {\n\t\t\t\tpath = this.onPath(item, item.$nav);\n\t\t\t} else {\n\t\t\t\tpath = item.path;\n\t\t\t}\n\t\t\treturn path;\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('popuppable', ['$parse', 'State', 'Dom', function($parse, State, Dom) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\tlink: link,\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction link(scope, element, attributes, model) {\n\n\t\t\tvar state = new State();\n\t\t\tstate.pow = 0;\n\n\t\t\tvar relative, absolute;\n\n\t\t\tvar target, targetElement;\n\n\t\t\tvar from, to, current,\n\t\t\t\tboundingClientRect, styleObj, originalCssText;\n\n\t\t\tvar opened = false;\n\n\t\t\tfunction getStyle(node) {\n\t\t\t\tvar style = window.getComputedStyle(node, null);\n\t\t\t\tvar styleObj = {\n\t\t\t\t\t'display': style.getPropertyValue('display'),\n\t\t\t\t\t'position': style.getPropertyValue('position'),\n\t\t\t\t\t'width': style.getPropertyValue('width'),\n\t\t\t\t\t'height': style.getPropertyValue('height'),\n\t\t\t\t\t'top': style.getPropertyValue('top'),\n\t\t\t\t\t'right': style.getPropertyValue('right'),\n\t\t\t\t\t'bottom': style.getPropertyValue('bottom'),\n\t\t\t\t\t'left': style.getPropertyValue('left'),\n\t\t\t\t\t'margin-top': style.getPropertyValue('margin-top'),\n\t\t\t\t\t'margin-right': style.getPropertyValue('margin-right'),\n\t\t\t\t\t'margin-bottom': style.getPropertyValue('margin-bottom'),\n\t\t\t\t\t'margin-left': style.getPropertyValue('margin-left'),\n\t\t\t\t\t'padding-top': style.getPropertyValue('padding-top'),\n\t\t\t\t\t'padding-right': style.getPropertyValue('padding-right'),\n\t\t\t\t\t'padding-bottom': style.getPropertyValue('padding-bottom'),\n\t\t\t\t\t'padding-left': style.getPropertyValue('padding-left'),\n\t\t\t\t\t'background-color': style.getPropertyValue('background-color'),\n\t\t\t\t};\n\t\t\t\treturn styleObj;\n\t\t\t}\n\n\t\t\tfunction getTextStyle(style) {\n\t\t\t\tvar text = '';\n\t\t\t\tangular.forEach(style, function(value, key) {\n\t\t\t\t\ttext += key + ': ' + value + '; ';\n\t\t\t\t});\n\t\t\t\treturn text;\n\t\t\t}\n\n\t\t\tfunction setStyle(node, style) {\n\t\t\t\tnode.style.cssText = getTextStyle(style);\n\t\t\t}\n\n\t\t\tfunction add() {\n\t\t\t\ttargetElement.addClass('popuppable-opening');\n\t\t\t\tDom.getParents(target).each(function(element, node) {\n\t\t\t\t\telement.addClass('popuppable-parent');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction remove() {\n\t\t\t\ttargetElement.removeClass('popuppable-opening');\n\t\t\t\tDom.getParents(target).each(function(element, node) {\n\t\t\t\t\telement.removeClass('popuppable-parent');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction open() {\n\t\t\t\tif (!opened) {\n\t\t\t\t\tadd();\n\t\t\t\t\tcurrent = angular.copy(from);\n\t\t\t\t\topenAnimation();\n\t\t\t\t} else {\n\t\t\t\t\tstate.idle();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction close() {\n\t\t\t\tif (opened) {\n\t\t\t\t\tcloseAnimation();\n\t\t\t\t} else {\n\t\t\t\t\tstate.idle();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction update() {\n\t\t\t\tcurrent.left = (from.left + (to.left - from.left) * state.pow) + 'px';\n\t\t\t\tcurrent.top = (from.top + (to.top - from.top) * state.pow) + 'px';\n\t\t\t\tcurrent.width = (from.width + (to.width - from.width) * state.pow) + 'px';\n\t\t\t\tcurrent.height = (from.height + (to.height - from.height) * state.pow) + 'px';\n\t\t\t\tsetStyle(target, current);\n\t\t\t}\n\n\t\t\tfunction toggle() {\n\t\t\t\tif (state.busy()) {\n\t\t\t\t\tif (opened) {\n\t\t\t\t\t\tclose();\n\t\t\t\t\t} else {\n\t\t\t\t\t\topen();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction set() {\n\t\t\t\ttarget = element[0].querySelector(attributes.popuppable);\n\t\t\t\tif (target) {\n\t\t\t\t\ttargetElement = angular.element(target);\n\t\t\t\t\ttargetElement.addClass('popuppable-target');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onDown(e) {\n\t\t\t\tset();\n\t\t\t\tif (target) {\n\t\t\t\t\topen();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onUp(e) {\n\t\t\t\tif (Dom.getClosestNode(e.target, element[0])) {\n\t\t\t\t\t// nope\n\t\t\t\t} else {\n\t\t\t\t\tset();\n\t\t\t\t\tif (target) {\n\t\t\t\t\t\tclose();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onResize(e) {\n\t\t\t\tif (opened || state.isBusy) {\n\t\t\t\t\tupdate();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onKeyDown(e) {\n\t\t\t\tvar key = e.key.toLowerCase();\n\t\t\t\tswitch (key) {\n\t\t\t\t\tcase 'escape':\n\t\t\t\t\t\tset();\n\t\t\t\t\t\tif (target) {\n\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'enter':\n\t\t\t\t\t\tset();\n\t\t\t\t\t\tif (target && target.tagName && target.tagName.toLowerCase() === 'input') {\n\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction addListeners() {\n\t\t\t\tvar trigger = element[0].querySelector('.popuppable-trigger');\n\t\t\t\tvar triggerElement = trigger ? angular.element(trigger) : element;\n\t\t\t\ttriggerElement\n\t\t\t\t\t.on('mousedown touchstart', onDown)\n\t\t\t\t\t.on('keydown', onKeyDown);\n\t\t\t\tangular.element(window)\n\t\t\t\t\t.on('click', onUp)\n\t\t\t\t\t.on('resize', onResize);\n\t\t\t}\n\n\t\t\tfunction removeListeners() {\n\t\t\t\tvar trigger = element[0].querySelector('.popuppable-trigger');\n\t\t\t\tvar triggerElement = trigger ? angular.element(trigger) : element;\n\t\t\t\ttriggerElement\n\t\t\t\t\t.off('mousedown touchstart', onDown)\n\t\t\t\t\t.off('keydown', onKeyDown);\n\t\t\t\tangular.element(window)\n\t\t\t\t\t.off('click', onUp)\n\t\t\t\t\t.off('resize', onResize);\n\t\t\t}\n\n\t\t\tscope.$on('$destroy', function() {\n\t\t\t\tremoveListeners();\n\t\t\t});\n\n\t\t\taddListeners();\n\n\t\t\tset();\n\n\t\t\tfunction openAnimation() {\n\t\t\t\tdynamics.animate(target, {\n\t\t\t\t\topacity: 1,\n\t\t\t\t\tscale: 1\n\t\t\t\t}, {\n\t\t\t\t\ttype: dynamics.spring,\n\t\t\t\t\tfrequency: 200,\n\t\t\t\t\tfriction: 270,\n\t\t\t\t\tduration: 800,\n\t\t\t\t\tcomplete: function() {\n\t\t\t\t\t\topened = true;\n\t\t\t\t\t\tstate.idle();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction closeAnimation() {\n\t\t\t\tdynamics.animate(target, {\n\t\t\t\t\topacity: 0,\n\t\t\t\t\tscale: 0.1\n\t\t\t\t}, {\n\t\t\t\t\ttype: dynamics.easeInOut,\n\t\t\t\t\tduration: 300,\n\t\t\t\t\tfriction: 100,\n\t\t\t\t\tcomplete: function() {\n\t\t\t\t\t\topened = false;\n\t\t\t\t\t\tremove();\n\t\t\t\t\t\tstate.idle();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\twindow.ondragstart = function() {\n\t\treturn false;\n\t};\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('scrollableX', ['$parse', '$compile', '$timeout', 'Scrollable', 'Animate', 'Style', 'Events', 'Utils', function($parse, $compile, $timeout, Scrollable, Animate, Style, Events, Utils) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplate: '<div class=\"scrollable-content\" ng-transclude></div>',\n\t\t\ttransclude: true,\n\t\t\tlink: function(scope, element, attributes, model) {\n\n\t\t\t\tvar onLeft, onRight, showIndicatorFor, scrollableWhen;\n\t\t\t\tif (attributes.onLeft) {\n\t\t\t\t\tonLeft = $parse(attributes.onLeft);\n\t\t\t\t}\n\t\t\t\tif (attributes.onRight) {\n\t\t\t\t\tonRight = $parse(attributes.onRight);\n\t\t\t\t}\n\t\t\t\tif (attributes.showIndicatorFor) {\n\t\t\t\t\tshowIndicatorFor = $parse(attributes.showIndicatorFor);\n\t\t\t\t}\n\t\t\t\tif (attributes.scrollableWhen) {\n\t\t\t\t\tscrollableWhen = $parse(attributes.scrollableWhen);\n\t\t\t\t}\n\n\t\t\t\t// ELEMENTS & STYLESHEETS;\n\t\t\t\telement.attr('unselectable', 'on').addClass('unselectable');\n\t\t\t\tvar containerNode = element[0];\n\t\t\t\tvar contentNode = containerNode.querySelector('.scrollable-content');\n\t\t\t\tvar content = angular.element(content);\n\t\t\t\tvar contentStyle = new Style();\n\n\t\t\t\tvar animate = new Animate(render);\n\n\t\t\t\tvar scrollable = attributes.scrollableX ? $parse(attributes.scrollableX)(scope) : new Scrollable();\n\n\t\t\t\tlink(scrollable);\n\n\t\t\t\tfunction link(scrollable) {\n\t\t\t\t\tscrollable.link({\n\t\t\t\t\t\tgetItems: function() {\n\t\t\t\t\t\t\tif (attributes.scrollableItem) {\n\t\t\t\t\t\t\t\tvar items = containerNode.querySelectorAll(attributes.scrollableItem);\n\t\t\t\t\t\t\t\treturn items;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprev: function() {\n\t\t\t\t\t\t\tscrollable.scrollPrev();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tnext: function() {\n\t\t\t\t\t\t\tscrollable.scrollNext();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\treset: function() {\n\t\t\t\t\t\t\tscrollable.doReset();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonLeft: onLeft,\n\t\t\t\t\t\tonRight: onRight,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/*\n\t\t\t\tscope.$watch(attributes.scrollableX, function (newValue) {\n\t\t\t\t\tconsole.log(newValue);\n\t\t\t\t});\n\t\t\t\t*/\n\n\t\t\t\t/*\n\t\t\t\tvar indicator = null,\n\t\t\t\t\tindicatorNode = null,\n\t\t\t\t\tindicatorStyle;\n\t\t\t\tshowIndicatorFor = false;\n\t\t\t\tif (showIndicatorFor) {\n\t\t\t\t\tindicator = angular.element('<div class=\"indicator\"></div>');\n\t\t\t\t\tindicatorNode = indicator[0];\n\t\t\t\t\tindicatorStyle = new Style();\n\t\t\t\t\telement.append(indicator);\n\t\t\t\t\t$compile(indicator.contents())(scope);\n\t\t\t\t\tvar i = scrollbar.getIndicator();\n\t\t\t\t\tindicatorStyle.transform('translate3d(' + i.x.toFixed(2) + 'px,' + i.y.toFixed(2) + 'px,0)');\n\t\t\t\t\tindicatorStyle.set(indicatorNode);\n\t\t\t\t}\n\t\t\t\t*/\n\n\t\t\t\tfunction render(time) {\n\t\t\t\t\tscrollable.setContainer(containerNode);\n\t\t\t\t\tscrollable.setContent(contentNode);\n\t\t\t\t\tscrollable.setEnabled(isEnabled());\n\t\t\t\t\tvar animating = scrollable.renderX();\n\t\t\t\t\tif (!animating) {\n\t\t\t\t\t\t// animate.pause();\n\t\t\t\t\t}\n\t\t\t\t\tvar current = scrollable.getCurrent();\n\t\t\t\t\tcontentStyle.transform('translate3d(' + current.x.toFixed(2) + 'px,0,0)');\n\t\t\t\t\tcontentStyle.set(contentNode);\n\t\t\t\t\t/*\n\t\t\t\t\tif (showIndicatorFor) {\n\t\t\t\t\t\tif (dragging || wheeling || speed) {\n\t\t\t\t\t\t\tvar percent = c.x / (containerNode.offsetWidth - contentNode.offsetWidth);\n\t\t\t\t\t\t\tpercent = Math.max(0, Math.min(1, percent));\n\t\t\t\t\t\t\ti.x = (containerNode.offsetWidth - indicatorNode.offsetWidth) * (percent);\n\t\t\t\t\t\t\ti.y += (0 - i.y) / 4;\n\t\t\t\t\t\t\t// var count = Math.round(contentNode.offsetWidth / 315);\n\t\t\t\t\t\t\tvar index = Math.max(1, Math.round(percent * showIndicatorFor.rows.length));\n\t\t\t\t\t\t\tindicator.html(index + '/' + showIndicatorFor.count);\n\t\t\t\t\t\t\t// indicator.html((percent * 100).toFixed(2).toString());\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ti.y += (45 - i.y) / 4;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tindicatorStyle.transform('translate3d(' + i.x.toFixed(2) + 'px,' + i.y.toFixed(2) + 'px,0)');\n\t\t\t\t\t\tindicatorStyle.set(indicatorNode);\n\t\t\t\t\t}\n\t\t\t\t\t*/\n\t\t\t\t}\n\n\t\t\t\tfunction undrag() {\n\t\t\t\t\tscrollable.off();\n\t\t\t\t\tdragOff();\n\t\t\t\t}\n\n\t\t\t\tfunction onDown(event) {\n\t\t\t\t\tif (scrollable.dragStart(event.absolute)) {\n\t\t\t\t\t\tdragOn();\n\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onMove(event) {\n\t\t\t\t\tscrollable.dragMove(event.absolute);\n\t\t\t\t\tvar drag = scrollable.getDrag();\n\t\t\t\t\tif (Math.abs(drag.y) > Math.abs(drag.x)) {\n\t\t\t\t\t\tonUp(event);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onUp(event) {\n\t\t\t\t\tscrollable.dragEnd(event.absolute);\n\t\t\t\t\tevent.stop();\n\t\t\t\t\tdragOff();\n\t\t\t\t}\n\n\t\t\t\tfunction _onScrollX(dir, interval) {\n\t\t\t\t\treturn scrollable.wheelX(dir, interval);\n\t\t\t\t}\n\n\t\t\t\tvar onScrollX = _onScrollX;\n\t\t\t\t// var onScrollX = Utils.throttle(_onScrollX, 25);\n\n\t\t\t\tfunction onWheel(event) {\n\t\t\t\t\t// console.log('onWheelX', event.dir, scrollable.wheelXCheck(event.dir));\n\t\t\t\t\tif (scrollable.wheelXCheck(event.dir)) {\n\t\t\t\t\t\tonScrollX(event.dir, event.interval);\n\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction off() {\n\t\t\t\t\tdragOff();\n\t\t\t\t\t// animate.pause();\n\t\t\t\t\tscrollable.off();\n\t\t\t\t}\n\n\t\t\t\tfunction isEnabled() {\n\t\t\t\t\tvar enabled = true;\n\t\t\t\t\tif (scrollableWhen) {\n\t\t\t\t\t\tenabled = enabled && scrollableWhen(scope);\n\t\t\t\t\t}\n\t\t\t\t\tenabled = enabled && window.innerWidth >= 1024;\n\t\t\t\t\tenabled = enabled && (containerNode.offsetWidth < contentNode.offsetWidth);\n\t\t\t\t\treturn enabled;\n\t\t\t\t}\n\n\t\t\t\tfunction onResize() {\n\t\t\t\t\tvar enabled = isEnabled();\n\t\t\t\t\tif (!enabled) {\n\t\t\t\t\t\toff();\n\t\t\t\t\t}\n\t\t\t\t\trender();\n\t\t\t\t}\n\n\t\t\t\tscope.$watch(function() {\n\t\t\t\t\treturn contentNode.offsetWidth;\n\t\t\t\t}, function(newValue, oldValue) {\n\t\t\t\t\tonResize();\n\t\t\t\t});\n\n\t\t\t\tvar events = new Events(element).add({\n\t\t\t\t\tdown: onDown,\n\t\t\t\t\twheel: onWheel,\n\t\t\t\t}, scope);\n\n\t\t\t\tvar windowEvents = new Events(window).add({\n\t\t\t\t\tresize: onResize,\n\t\t\t\t}, scope);\n\n\t\t\t\tfunction dragOn() {\n\t\t\t\t\twindowEvents.add({\n\t\t\t\t\t\tmove: onMove,\n\t\t\t\t\t\tup: onUp,\n\t\t\t\t\t}, scope);\n\t\t\t\t}\n\n\t\t\t\tfunction dragOff() {\n\t\t\t\t\twindowEvents.remove({\n\t\t\t\t\t\tmove: onMove,\n\t\t\t\t\t\tup: onUp,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tscope.$on('$destroy', function() {\n\t\t\t\t\tanimate.pause();\n\t\t\t\t});\n\n\t\t\t},\n\t\t};\n    }]);\n\n\tapp.directive('scrollableY', ['$parse', '$compile', '$timeout', 'Scrollable', 'Animate', 'Style', 'Events', 'Utils', function($parse, $compile, $timeout, Scrollable, Animate, Style, Events, Utils) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplate: '<div class=\"scrollable-content\" ng-transclude></div>',\n\t\t\ttransclude: true,\n\t\t\tlink: function(scope, element, attributes, model) {\n\n\t\t\t\tvar onTop, onBottom, showIndicatorFor, scrollableWhen;\n\t\t\t\tif (attributes.onTop) {\n\t\t\t\t\tonTop = $parse(attributes.onTop);\n\t\t\t\t}\n\t\t\t\tif (attributes.onBottom) {\n\t\t\t\t\tonBottom = $parse(attributes.onBottom);\n\t\t\t\t}\n\t\t\t\tif (attributes.showIndicatorFor) {\n\t\t\t\t\tshowIndicatorFor = $parse(attributes.showIndicatorFor);\n\t\t\t\t}\n\t\t\t\tif (attributes.scrollableWhen) {\n\t\t\t\t\tscrollableWhen = $parse(attributes.scrollableWhen);\n\t\t\t\t}\n\n\t\t\t\t// ELEMENTS & STYLESHEETS;\n\t\t\t\telement.attr('unselectable', 'on').addClass('unselectable');\n\t\t\t\tvar containerNode = element[0];\n\t\t\t\tvar contentNode = containerNode.querySelector('.scrollable-content');\n\t\t\t\tvar content = angular.element(content);\n\t\t\t\tvar contentStyle = new Style();\n\n\t\t\t\tvar animate = new Animate(render);\n\n\t\t\t\tvar scrollable = attributes.scrollableY ? $parse(attributes.scrollableY)(scope) : new Scrollable();\n\t\t\t\tlink(scrollable);\n\n\t\t\t\tfunction link(scrollable) {\n\t\t\t\t\tscrollable.link({\n\t\t\t\t\t\tgetItems: function() {\n\t\t\t\t\t\t\tif (attributes.scrollableItem) {\n\t\t\t\t\t\t\t\tvar items = containerNode.querySelectorAll(attributes.scrollableItem);\n\t\t\t\t\t\t\t\treturn items;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprev: function() {\n\t\t\t\t\t\t\tscrollable.scrollPrev();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tnext: function() {\n\t\t\t\t\t\t\tscrollable.scrollNext();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\treset: function() {\n\t\t\t\t\t\t\tscrollable.doReset();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonTop: onTop,\n\t\t\t\t\t\tonBottom: onBottom,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction render(time) {\n\t\t\t\t\tscrollable.setContainer(containerNode);\n\t\t\t\t\tscrollable.setContent(contentNode);\n\t\t\t\t\tscrollable.setEnabled(isEnabled());\n\t\t\t\t\tvar animating = scrollable.renderY();\n\t\t\t\t\tif (!animating) {\n\t\t\t\t\t\t// animate.pause();\n\t\t\t\t\t}\n\t\t\t\t\tvar current = scrollable.getCurrent();\n\t\t\t\t\tcontentStyle.transform('translate3d(0,' + current.y.toFixed(2) + 'px,0)');\n\t\t\t\t\tcontentStyle.set(contentNode);\n\t\t\t\t}\n\n\t\t\t\tfunction undrag() {\n\t\t\t\t\tscrollable.off();\n\t\t\t\t\tdragOff();\n\t\t\t\t}\n\n\t\t\t\tfunction onDown(event) {\n\t\t\t\t\tif (scrollable.dragStart(event.absolute)) {\n\t\t\t\t\t\tdragOn();\n\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onMove(event) {\n\t\t\t\t\tscrollable.dragMove(event.absolute);\n\t\t\t\t\tvar drag = scrollable.getDrag();\n\t\t\t\t\tif (Math.abs(drag.x) > Math.abs(drag.y)) {\n\t\t\t\t\t\tonUp(event);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onUp(event) {\n\t\t\t\t\tscrollable.dragEnd(event.absolute);\n\t\t\t\t\tevent.stop();\n\t\t\t\t\tdragOff();\n\t\t\t\t}\n\n\t\t\t\tfunction _onScrollY(dir, interval) {\n\t\t\t\t\treturn scrollable.wheelY(dir, interval);\n\t\t\t\t}\n\n\t\t\t\tvar onScrollY = _onScrollY;\n\t\t\t\t// var onScrollY = Utils.throttle(_onScrollY, 25);\n\n\t\t\t\tfunction onWheel(event) {\n\t\t\t\t\t// console.log('onWheelY', event.dir, scrollable.wheelYCheck(event.dir));\n\t\t\t\t\tif (scrollable.wheelYCheck(event.dir)) {\n\t\t\t\t\t\tonScrollY(event.dir, event.interval);\n\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction off() {\n\t\t\t\t\tdragOff();\n\t\t\t\t\t// animate.pause();\n\t\t\t\t\tscrollable.off();\n\t\t\t\t}\n\n\t\t\t\tfunction isEnabled() {\n\t\t\t\t\tvar enabled = true;\n\t\t\t\t\tif (scrollableWhen) {\n\t\t\t\t\t\tenabled = enabled && scrollableWhen(scope);\n\t\t\t\t\t}\n\t\t\t\t\tenabled = enabled && window.innerWidth >= 1024;\n\t\t\t\t\tenabled = enabled && (containerNode.offsetHeight < contentNode.offsetHeight);\n\t\t\t\t\treturn enabled;\n\t\t\t\t}\n\n\t\t\t\tfunction onResize() {\n\t\t\t\t\tvar enabled = isEnabled();\n\t\t\t\t\tif (!enabled) {\n\t\t\t\t\t\toff();\n\t\t\t\t\t}\n\t\t\t\t\trender();\n\t\t\t\t}\n\n\t\t\t\tscope.$watch(function() {\n\t\t\t\t\treturn contentNode.offsetHeight;\n\t\t\t\t}, function(newValue, oldValue) {\n\t\t\t\t\tonResize();\n\t\t\t\t});\n\n\t\t\t\tvar events = new Events(element).add({\n\t\t\t\t\tdown: onDown,\n\t\t\t\t\twheel: onWheel,\n\t\t\t\t}, scope);\n\n\t\t\t\tvar windowEvents = new Events(window).add({\n\t\t\t\t\tresize: onResize,\n\t\t\t\t}, scope);\n\n\t\t\t\tfunction dragOn() {\n\t\t\t\t\twindowEvents.add({\n\t\t\t\t\t\tmove: onMove,\n\t\t\t\t\t\tup: onUp,\n\t\t\t\t\t}, scope);\n\t\t\t\t}\n\n\t\t\t\tfunction dragOff() {\n\t\t\t\t\twindowEvents.remove({\n\t\t\t\t\t\tmove: onMove,\n\t\t\t\t\t\tup: onUp,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tscope.$on('$destroy', function() {\n\t\t\t\t\tanimate.pause();\n\t\t\t\t});\n\n\t\t\t},\n\t\t};\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Scrollable', ['Utils', 'Point', 'Rect', function(Utils, Point, Rect) {\n\n\t\tfunction Scrollable() {\n\n\t\t\tvar padding = 150;\n\t\t\tvar enabled, snappable, busy, dragging, wheeling, down, move, prev;\n\t\t\tvar currentIndex = 0;\n\n\t\t\tsnappable = true;\n\n\t\t\tvar start = new Point(),\n\t\t\t\tend = new Point(),\n\t\t\t\tcurrent = new Point(),\n\t\t\t\tdrag = new Point(),\n\t\t\t\tindicator = new Point(),\n\t\t\t\toffset = new Point(),\n\t\t\t\tspeed = new Point(),\n\t\t\t\tcontainer = new Rect(),\n\t\t\t\tcontent = new Rect(),\n\t\t\t\toverflow = new Rect();\n\n\t\t\tvar scrollable = {\n\t\t\t\t// properties\n\t\t\t\tstart: start,\n\t\t\t\tend: end,\n\t\t\t\tcurrent: current,\n\t\t\t\tindicator: indicator,\n\t\t\t\tspeed: speed,\n\t\t\t\toverflow: overflow,\n\t\t\t\tcontainer: container,\n\t\t\t\tcontent: content,\n\t\t\t\t// methods\n\t\t\t\tsetContainer: setContainer,\n\t\t\t\tsetContent: setContent,\n\t\t\t\tsetEnabled: setEnabled,\n\t\t\t\tgetCurrent: getCurrent,\n\t\t\t\tgetDrag: getDrag,\n\t\t\t\tgetIndicator: getIndicator,\n\t\t\t\tgetIndex: getIndex,\n\t\t\t\tscrollToIndex: scrollToIndex,\n\t\t\t\tscrollPrev: scrollPrev,\n\t\t\t\tscrollNext: scrollNext,\n\t\t\t\tdragStart: dragStart,\n\t\t\t\tdragMove: dragMove,\n\t\t\t\tdragEnd: dragEnd,\n\t\t\t\tdoReset: doReset,\n\t\t\t\toff: off,\n\t\t\t\t// x direction\n\t\t\t\tdoLeft: doLeft,\n\t\t\t\tdoRight: doRight,\n\t\t\t\trenderX: renderX,\n\t\t\t\tscrollToX: scrollToX,\n\t\t\t\twheelX: wheelX,\n\t\t\t\twheelXCheck: wheelXCheck,\n\t\t\t\t// y direction\n\t\t\t\tdoTop: doTop,\n\t\t\t\tdoBottom: doBottom,\n\t\t\t\trenderY: renderY,\n\t\t\t\tscrollToY: scrollToY,\n\t\t\t\twheelY: wheelY,\n\t\t\t\twheelYCheck: wheelYCheck,\n\t\t\t};\n\n\t\t\tangular.extend(this, scrollable);\n\n\t\t\tscrollable = this;\n\n\t\t\tfunction setContainer(node) {\n\t\t\t\tcontainer.width = node.offsetWidth;\n\t\t\t\tcontainer.height = node.offsetHeight;\n\t\t\t}\n\n\t\t\tfunction setContent(node) {\n\t\t\t\tcontent.width = node.offsetWidth;\n\t\t\t\tcontent.height = node.offsetHeight;\n\t\t\t}\n\n\t\t\tfunction setEnabled(flag) {\n\t\t\t\tenabled = flag;\n\t\t\t}\n\n\t\t\tfunction getCurrent() {\n\t\t\t\treturn current;\n\t\t\t}\n\n\t\t\tfunction getDrag() {\n\t\t\t\treturn drag;\n\t\t\t}\n\n\t\t\tfunction getIndicator() {\n\t\t\t\treturn indicator;\n\t\t\t}\n\n\t\t\tfunction getIndex() {\n\t\t\t\treturn currentIndex;\n\t\t\t}\n\n\t\t\tfunction scrollToIndex(index) {\n\t\t\t\tif (index !== currentIndex) {\n\t\t\t\t\tcurrentIndex = index;\n\t\t\t\t\tvar item = getItemAtIndex(index);\n\t\t\t\t\tif (item) {\n\t\t\t\t\t\toffset = new Point(\n\t\t\t\t\t\t\titem.offsetLeft,\n\t\t\t\t\t\t\titem.offsetTop\n\t\t\t\t\t\t);\n\t\t\t\t\t\t// console.log('scrollToIndex', index, offset);\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction dragStart(point) {\n\t\t\t\tif (!busy) {\n\t\t\t\t\tstart.x = end.x = current.x;\n\t\t\t\t\tstart.y = end.y = current.y;\n\t\t\t\t\tspeed.x = 0;\n\t\t\t\t\tspeed.y = 0;\n\t\t\t\t\tdown = point;\n\t\t\t\t\tcurrentIndex = -1;\n\t\t\t\t\twheeling = false;\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction dragMove(point) {\n\t\t\t\tprev = move;\n\t\t\t\tmove = point;\n\t\t\t\tdrag.x = move.x - down.x;\n\t\t\t\tdrag.y = move.y - down.y;\n\t\t\t\tdragging = true;\n\t\t\t}\n\n\t\t\tfunction dragEnd() {\n\t\t\t\tif (move && prev) {\n\t\t\t\t\tspeed.x += (move.x - prev.x) * 4;\n\t\t\t\t\tspeed.y += (move.y - prev.y) * 4;\n\t\t\t\t}\n\t\t\t\tstart.x = end.x = current.x;\n\t\t\t\tstart.y = end.y = current.y;\n\t\t\t\tdragging = false;\n\t\t\t\tmove = null;\n\t\t\t\tdown = null;\n\t\t\t\tprev = null;\n\t\t\t}\n\n\t\t\tfunction getItemAtIndex(index) {\n\t\t\t\tvar item = null;\n\t\t\t\tvar items = scrollable.getItems();\n\t\t\t\tif (items) {\n\t\t\t\t\tif (index >= 0 && index < items.length) {\n\t\t\t\t\t\titem = items[index];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// console.log('getItemAtIndex', index, items.length, item);\n\t\t\t\treturn item;\n\t\t\t}\n\n\t\t\tfunction scrollPrev() {\n\t\t\t\tvar index = Math.max(0, currentIndex - 1);\n\t\t\t\tconsole.log('scrollPrev', index);\n\t\t\t\tscrollToIndex(index);\n\t\t\t}\n\n\t\t\tfunction scrollNext() {\n\t\t\t\tvar items = scrollable.getItems();\n\t\t\t\tvar index = Math.min(items.length - 1, currentIndex + 1);\n\t\t\t\tconsole.log('scrollNext', index);\n\t\t\t\tscrollToIndex(index);\n\t\t\t}\n\n\t\t\tfunction doReset() {\n\t\t\t\tend.x = current.x = 0;\n\t\t\t}\n\n\t\t\tfunction off() {\n\t\t\t\tdragging = false;\n\t\t\t\twheeling = false;\n\t\t\t\tmove = null;\n\t\t\t\tdown = null;\n\t\t\t}\n\n\t\t\t// x - direction\n\n\t\t\tfunction doLeft(scope) {\n\t\t\t\tif (busy) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!scrollable.onLeft) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbusy = true;\n\t\t\t\tscrollable.onLeft(scope).then().finally(function() {\n\t\t\t\t\tscrollToX(0);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction doRight(scope) {\n\t\t\t\tif (busy) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!scrollable.onRight) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbusy = true;\n\t\t\t\tscrollable.onRight(scope).then().finally(function() {\n\t\t\t\t\tvar right = container.width - content.width;\n\t\t\t\t\tif (right > overflow.width) {\n\t\t\t\t\t\tstart.x = end.x = overflow.width;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstart.x = end.x = overflow.width + padding;\n\t\t\t\t\t}\n\t\t\t\t\tscrollToX(0);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction renderX() {\n\t\t\t\tvar animating = true;\n\t\t\t\tif (enabled) {\n\t\t\t\t\toverflow.x = 0;\n\t\t\t\t\toverflow.width = container.width - content.width;\n\t\t\t\t\tif (dragging) {\n\t\t\t\t\t\tend.x = start.x + move.x - down.x;\n\t\t\t\t\t\tif (extendX()) {\n\t\t\t\t\t\t\tstart.x = end.x;\n\t\t\t\t\t\t\tdown.x = move.x;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (speed.x) {\n\t\t\t\t\t\tend.x += speed.x;\n\t\t\t\t\t\tspeed.x *= 0.75;\n\t\t\t\t\t\tif (wheeling) {\n\t\t\t\t\t\t\textendX();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Math.abs(speed.x) < 2.05) {\n\t\t\t\t\t\t\tspeed.x = 0;\n\t\t\t\t\t\t\tscrollable.wheeling = wheeling = false;\n\t\t\t\t\t\t\tsnapToNearestX();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (offset) {\n\t\t\t\t\t\tend.x = -offset.x;\n\t\t\t\t\t\toffset = null;\n\t\t\t\t\t}\n\t\t\t\t\tend.x = Math.round(end.x * 10000) / 10000;\n\t\t\t\t\tend.x = Math.min(overflow.x, end.x);\n\t\t\t\t\tend.x = Math.max(overflow.width, end.x);\n\t\t\t\t\tcurrent.x += (end.x - current.x) / 4;\n\t\t\t\t\tif (speed.x === 0 && Math.abs(end.x - current.x) < 0.05) {\n\t\t\t\t\t\tcurrent.x = end.x;\n\t\t\t\t\t\tif (!snapToNearestX()) {\n\t\t\t\t\t\t\tanimating = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// console.log('renderX', current.x, end.x, overflow.x);\n\t\t\t\t} else {\n\t\t\t\t\tcurrent.x = end.x = 0;\n\t\t\t\t\tanimating = false;\n\t\t\t\t}\n\t\t\t\treturn animating;\n\t\t\t}\n\n\t\t\tfunction extendX() {\n\t\t\t\tvar extending = false;\n\t\t\t\toverflow.x += padding;\n\t\t\t\toverflow.width -= padding;\n\t\t\t\tif (end.x > overflow.x) {\n\t\t\t\t\textending = true;\n\t\t\t\t\tdoLeft();\n\t\t\t\t} else if (end.x < overflow.width) {\n\t\t\t\t\textending = true;\n\t\t\t\t\tdoRight();\n\t\t\t\t}\n\t\t\t\treturn extending;\n\t\t\t}\n\n\t\t\tfunction snapToNearestX() {\n\t\t\t\tvar items = scrollable.getItems();\n\t\t\t\tif (items) {\n\t\t\t\t\tvar index = -1;\n\t\t\t\t\tvar min = Number.POSITIVE_INFINITY;\n\t\t\t\t\tangular.forEach(items, function(item, i) {\n\t\t\t\t\t\tvar distance = Math.abs((end.x + speed.x) - (item.offsetLeft * -1));\n\t\t\t\t\t\tif (distance < min) {\n\t\t\t\t\t\t\tmin = distance;\n\t\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\tif (snappable) {\n\t\t\t\t\t\t\treturn scrollToIndex(index);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcurrentIndex = index;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction wheelXCheck(dir) {\n\t\t\t\t// console.log('wheelYCheck', dir < 0 ? (end.x - overflow.width) : (end.x - overflow.x));\n\t\t\t\tif (!busy && enabled) {\n\t\t\t\t\tif (dir < 0) {\n\t\t\t\t\t\treturn end.x - overflow.width;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn end.x - overflow.x;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction wheelX(dir, interval) {\n\t\t\t\tend.x += dir * 100 / 1000 * interval;\n\t\t\t\tspeed.x += dir * 100 / 1000 * interval;\n\t\t\t\twheeling = true;\n\t\t\t}\n\n\t\t\tfunction scrollToX(value) {\n\t\t\t\tstart.x = end.x = value;\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\toff();\n\t\t\t\t\tbusy = false;\n\t\t\t\t}, 500);\n\t\t\t}\n\n\t\t\t// y - direction\n\n\t\t\tfunction doTop(scope) {\n\t\t\t\tif (busy) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!scrollable.onTop) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbusy = true;\n\t\t\t\tscrollable.onTop(scope).then().finally(function() {\n\t\t\t\t\tscrollToY(0);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction doBottom(scope) {\n\t\t\t\tif (busy) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!scrollable.onBottom) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbusy = true;\n\t\t\t\tscrollable.onBottom(scope).then().finally(function() {\n\t\t\t\t\tvar bottom = container.height - content.height;\n\t\t\t\t\tif (bottom > overflow.height) {\n\t\t\t\t\t\tstart.y = end.y = overflow.height;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstart.y = end.y = overflow.height + padding;\n\t\t\t\t\t}\n\t\t\t\t\tscrollToY(0);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction renderY() {\n\t\t\t\tvar animating = true;\n\t\t\t\tif (enabled) {\n\t\t\t\t\toverflow.y = 0;\n\t\t\t\t\toverflow.height = container.height - content.height;\n\t\t\t\t\tif (dragging) {\n\t\t\t\t\t\tend.y = start.y + move.y - down.y;\n\t\t\t\t\t\tif (extendY()) {\n\t\t\t\t\t\t\tstart.y = end.y;\n\t\t\t\t\t\t\tdown.y = move.y;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (speed.y) {\n\t\t\t\t\t\tend.y += speed.y;\n\t\t\t\t\t\tspeed.y *= 0.75;\n\t\t\t\t\t\tif (wheeling) {\n\t\t\t\t\t\t\textendY();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Math.abs(speed.y) < 2.05) {\n\t\t\t\t\t\t\tspeed.y = 0;\n\t\t\t\t\t\t\tscrollable.wheeling = wheeling = false;\n\t\t\t\t\t\t\tsnapToNearestY();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (offset) {\n\t\t\t\t\t\tend.y = -offset.y;\n\t\t\t\t\t\toffset = null;\n\t\t\t\t\t}\n\t\t\t\t\tend.y = Math.round(end.y * 10000) / 10000;\n\t\t\t\t\tend.y = Math.min(overflow.y, end.y);\n\t\t\t\t\tend.y = Math.max(overflow.height, end.y);\n\t\t\t\t\tcurrent.y += (end.y - current.y) / 4;\n\t\t\t\t\tif (speed.y === 0 && Math.abs(end.y - current.y) < 0.05) {\n\t\t\t\t\t\tcurrent.y = end.y;\n\t\t\t\t\t\tif (!snapToNearestY()) {\n\t\t\t\t\t\t\tanimating = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// console.log(parseFloat(current.y.toFixed(6)), end.y, overflow.y);\n\t\t\t\t\t// console.log(dragging, wheeling, end.y, speed.y, Math.abs(end.y - current.y));\n\t\t\t\t} else {\n\t\t\t\t\tcurrent.y = end.y = 0;\n\t\t\t\t\tanimating = false;\n\t\t\t\t}\n\t\t\t\treturn animating;\n\t\t\t}\n\n\t\t\tfunction extendY() {\n\t\t\t\tvar extending = false;\n\t\t\t\toverflow.y += padding;\n\t\t\t\toverflow.height -= padding;\n\t\t\t\tif (end.y > overflow.y) {\n\t\t\t\t\textending = true;\n\t\t\t\t\tdoTop();\n\t\t\t\t} else if (end.y < overflow.height) {\n\t\t\t\t\textending = true;\n\t\t\t\t\tdoBottom();\n\t\t\t\t}\n\t\t\t\treturn extending;\n\t\t\t}\n\n\t\t\tfunction snapToNearestY() {\n\t\t\t\tvar items = scrollable.getItems();\n\t\t\t\tif (items) {\n\t\t\t\t\tvar index = -1;\n\t\t\t\t\tvar min = Number.POSITIVE_INFINITY;\n\t\t\t\t\tangular.forEach(items, function(item, i) {\n\t\t\t\t\t\tvar distance = Math.abs((end.y + speed.y) - (item.offsetTop * -1));\n\t\t\t\t\t\tif (distance < min) {\n\t\t\t\t\t\t\tmin = distance;\n\t\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t// console.log('snapToNearestY', index, min);\n\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\tif (snappable) {\n\t\t\t\t\t\t\treturn scrollToIndex(index);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcurrentIndex = index;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction wheelYCheck(dir) {\n\t\t\t\t// console.log('wheelYCheck', dir < 0 ? (end.y - overflow.height) : (end.y - overflow.y));\n\t\t\t\tif (!busy && enabled) {\n\t\t\t\t\tif (dir < 0) {\n\t\t\t\t\t\treturn end.y - overflow.height;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn end.y - overflow.y;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction wheelY(dir, interval) {\n\t\t\t\tend.y += dir * 100 / 1000 * interval;\n\t\t\t\tspeed.y += dir * 100 / 1000 * interval;\n\t\t\t\twheeling = true;\n\t\t\t}\n\n\t\t\tfunction scrollToY(value) {\n\t\t\t\tstart.y = end.y = value;\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\toff();\n\t\t\t\t\tbusy = false;\n\t\t\t\t}, 500);\n\t\t\t}\n\n\t\t}\n\n\t\tfunction link(methods) {\n\t\t\tangular.extend(this, methods);\n\t\t}\n\n\t\tScrollable.prototype = {\n\t\t\tlink: link,\n\t\t\tgetItems: function() {\n\t\t\t\treturn [content];\n\t\t\t},\n\t\t};\n\t\treturn Scrollable;\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('videoSource', ['$timeout', '$promise', function($timeout, $promise) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\tscope: {\n\t\t\t\tsource: '=videoSource',\n\t\t\t\timage: '=videoImage',\n\t\t\t},\n\t\t\ttemplateUrl: function(element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/components/video/partial/video-player';\n\t\t\t},\n\t\t\tlink: VideoSourceLink\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction VideoSourceLink(scope, element, attributes) {\n\n\t\t\tvar native = element[0];\n\t\t\tvar video = native.querySelector('video');\n\t\t\tvar img = native.querySelector('img');\n\t\t\tvar infos = {};\n\t\t\tscope.canplay = false;\n\t\t\tscope.playing = false;\n\t\t\tscope.busy = false;\n\t\t\tscope.toggle = toggle;\n\t\t\tscope.play = play;\n\t\t\tscope.pause = pause;\n\t\t\tscope.infos = infos;\n\n\t\t\t// loop><source src=\"{{source}}\" type=\"video/mp4\"\n\n\t\t\tfunction canplay() {\n\t\t\t\treturn $promise(function(promise) {\n\n\t\t\t\t\tfunction _onCanPlay(e) {\n\t\t\t\t\t\tscope.canplay = true;\n\t\t\t\t\t\tangular.element(video).off('canplay', _onCanPlay);\n\t\t\t\t\t\t// console.log('videoSource._onCanPlay', e);\n\t\t\t\t\t\tpromise.resolve();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (scope.canplay) {\n\t\t\t\t\t\tpromise.resolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tangular.element(video).on('canplay', _onCanPlay);\n\t\t\t\t\t\tvideo.preload = true;\n\t\t\t\t\t\tvideo.src = scope.source;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction toggle() {\n\t\t\t\tif (!scope.busy) {\n\t\t\t\t\tscope.busy = true;\n\t\t\t\t\tif (scope.playing) {\n\t\t\t\t\t\tvideo.pause();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcanplay().then(function() {\n\t\t\t\t\t\t\tvideo.play();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction play() {\n\t\t\t\tif (!scope.busy) {\n\t\t\t\t\tscope.busy = true;\n\t\t\t\t\tcanplay().then(function() {\n\t\t\t\t\t\tvideo.play();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction pause() {\n\t\t\t\tif (!scope.busy) {\n\t\t\t\t\tscope.busy = true;\n\t\t\t\t\tvideo.pause();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onCanPlay(e) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tscope.canplay = true;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onPlaying(e) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tscope.playing = true;\n\t\t\t\t\tscope.busy = false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onPause(e) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tscope.playing = false;\n\t\t\t\t\tscope.busy = false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onEnded(e) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tscope.playing = false;\n\t\t\t\t\tscope.busy = false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onProgress(e) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tinfos.buffered = video.buffered; // todo: TimeRanges\n\t\t\t\t\t// console.log('onProgress', infos);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onTimeUpdate(e) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tinfos.duration = video.duration;\n\t\t\t\t\tinfos.currentTime = video.currentTime;\n\t\t\t\t\tinfos.progressTime = infos.currentTime / infos.duration;\n\t\t\t\t\t// console.log('onTimeUpdate', infos);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar videoElement = angular.element(video);\n\n\t\t\tfunction addListeners() {\n\t\t\t\t// videoElement.on('canplay', onCanPlay);\n\t\t\t\tvideoElement.on('playing', onPlaying);\n\t\t\t\tvideoElement.on('pause', onPause);\n\t\t\t\tvideoElement.on('ended', onEnded);\n\t\t\t\tvideoElement.on('progress', onProgress);\n\t\t\t\tvideoElement.on('timeupdate', onTimeUpdate);\n\t\t\t}\n\n\t\t\tfunction removeListeners() {\n\t\t\t\t// videoElement.off('canplay', onCanPlay);\n\t\t\t\tvideoElement.off('playing', onPlaying);\n\t\t\t\tvideoElement.off('pause', onPause);\n\t\t\t\tvideoElement.off('ended', onEnded);\n\t\t\t\tvideoElement.off('progress', onProgress);\n\t\t\t\tvideoElement.off('timeupdate', onTimeUpdate);\n\t\t\t}\n\n\t\t\taddListeners();\n\t\t\tscope.$on('destroy', function() {\n\t\t\t\tremoveListeners();\n\t\t\t});\n\n\t\t}\n\n    }]);\n\n\t/*\n\tObject.defineProperty(HTMLMediaElement.prototype, 'playing', {\n\t    get: function () {\n\t        return !!(this.currentTime > 0 && !this.paused && !this.ended && this.readyState > 2);\n\t    }\n\t});\n\t*/\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Animate', [function() {\n\n\t\tfunction Animate(callback) {\n\t\t\tthis.callback = callback;\n\t\t\tthis.key = null;\n\t\t\tthis.ticks = 0;\n\t\t}\n\n\t\tvar statics = {};\n\n\t\tvar publics = {\n\t\t\tpause: pause,\n\t\t\tplay: play,\n\t\t\ttoggle: toggle,\n\t\t};\n\n\t\tangular.extend(Animate, statics);\n\t\tangular.extend(Animate.prototype, publics);\n\n\t\treturn Animate;\n\n\t\t// static methods\n\n\t\t// prototype methods\n\n\t\tfunction pause() {\n\t\t\tvar animate = this;\n\t\t\tif (animate.key) {\n\t\t\t\twindow.cancelAnimationFrame(animate.key);\n\t\t\t\tanimate.key = null;\n\t\t\t}\n\t\t}\n\n\t\tfunction play() {\n\t\t\tvar animate = this;\n\n\t\t\tfunction loop(time) {\n\t\t\t\tanimate.ticks++;\n\t\t\t\tanimate.callback(time, animate.ticks);\n\t\t\t\tanimate.key = window.requestAnimationFrame(loop);\n\t\t\t}\n\t\t\tif (!animate.key) {\n\t\t\t\tloop();\n\t\t\t}\n\t\t}\n\n\t\tfunction toggle() {\n\t\t\tvar animate = this;\n\t\t\tif (animate.key) {\n\t\t\t\tanimate.pause();\n\t\t\t} else {\n\t\t\t\tanimate.play();\n\t\t\t}\n\t\t}\n\n    }]);\n\n\t(function() {\n\t\tvar lastTime = 0;\n\t\tvar vendors = ['ms', 'moz', 'webkit', 'o'];\n\t\tfor (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n\t\t\twindow.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n\t\t\twindow.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||\n\t\t\t\twindow[vendors[x] + 'CancelRequestAnimationFrame'];\n\t\t}\n\t\tif (!window.requestAnimationFrame) {\n\t\t\twindow.requestAnimationFrame = function(callback, element) {\n\t\t\t\tvar currTime = new Date().getTime();\n\t\t\t\tvar timeToCall = Math.max(0, 16 - (currTime - lastTime));\n\t\t\t\tvar id = window.setTimeout(function() {\n\t\t\t\t\tcallback(currTime + timeToCall);\n\t\t\t\t}, timeToCall);\n\t\t\t\tlastTime = currTime + timeToCall;\n\t\t\t\treturn id;\n\t\t\t};\n\t\t}\n\t\tif (!window.cancelAnimationFrame) {\n\t\t\twindow.cancelAnimationFrame = function(id) {\n\t\t\t\tclearTimeout(id);\n\t\t\t};\n\t\t}\n\t}());\n\n}());\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('calendarPopupRecords', ['$templateCache', '$parse', '$q', '$timeout', '$filter', 'Hash', 'DateTime', 'Range', 'CalendarFactory', 'State', 'Api', function($templateCache, $parse, $q, $timeout, $filter, Hash, DateTime, Range, CalendarFactory, State, Api) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplate: function(element, attributes) {\n\t\t\t\treturn '<div calendar-popup=\"options\"></div>';\n\t\t\t},\n\t\t\trequire: 'ngModel',\n\t\t\tscope: {\n\t\t\t\tuser: '=calendarUser',\n\t\t\t},\n\t\t\tlink: function(scope, element, attributes, model, transclude) {\n\n\t\t\t\tvar user = scope.user;\n\n\t\t\t\tvar state = new State();\n\n\t\t\t\tvar options = {\n\t\t\t\t\tonMonthDidChange: onMonthDidChange,\n\t\t\t\t\tonWeekDidSelect: onWeekDidSelect,\n\t\t\t\t\tonDayDidSelect: onDayDidSelect,\n\t\t\t\t};\n\n\t\t\t\tvar sources = {};\n\n\t\t\t\tvar publics = {\n\t\t\t\t\t// user: user,\n\t\t\t\t\tstate: state,\n\t\t\t\t\toptions: options,\n\t\t\t\t\t// sources: sources,\n\t\t\t\t};\n\n\t\t\t\tangular.extend(scope, publics);\n\n\t\t\t\tvar currentDay = Range.Day();\n\n\t\t\t\tstate.busy();\n\t\t\t\t$q.all([\n                    Api.gantt.resources.actives().then(function success(response) {\n\t\t\t\t\t\tsetResources(response);\n\t\t\t\t\t}),\n\n                ]).then(function success(response) {\n\t\t\t\t\tstate.ready();\n\n\t\t\t\t}, function error(error) {\n\t\t\t\t\tstate.error(error);\n\t\t\t\t\t// console.log('calendarPopup.error', error);\n\n\t\t\t\t});\n\n\t\t\t\tfunction onMonthDidChange(date, month, calendar) {\n\t\t\t\t\tvar deferred = $q.defer();\n\t\t\t\t\t// console.log('calendarPopupRecords.onMonthDidChange', month.toString());\n\t\t\t\t\tGetMonthRecords(month).then(function() {\n\t\t\t\t\t\tsetAbsencesAndOvertimes();\n\t\t\t\t\t\tupdateCalendar(date, month, calendar);\n\t\t\t\t\t\tdeferred.resolve(getFirstWorkingDate(date, month, calendar));\n\n\t\t\t\t\t}, function() {\n\t\t\t\t\t\tdeferred.reject();\n\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction GetMonthRecords(month) {\n\t\t\t\t\tvar deferred = $q.defer();\n\t\t\t\t\tvar monthExpanded = Range.expand(month, DateTime.DAY * 7);\n\t\t\t\t\t// console.log('calendarPopupRecords.GetMonthRecords', monthExpanded.toString());\n\t\t\t\t\t$q.all([\n                        Api.gantt.absencesAndOvertimes(monthExpanded.getParams()).then(function success(response) {\n\t\t\t\t\t\t\tsources.absencesAndOvertimes = response;\n\t\t\t\t\t\t}),\n                        Api.gantt.calendar(monthExpanded.getParams()).then(function success(response) {\n\t\t\t\t\t\t\tvar unworkings = {};\n\t\t\t\t\t\t\tangular.forEach(response, function(item) {\n\t\t\t\t\t\t\t\tunworkings[item.key] = item;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tsources.unworkings = unworkings;\n\t\t\t\t\t\t\tsources.calendar = response;\n\t\t\t\t\t\t}),\n                        /*\n                        Api.gantt.planning.full(user.id, monthExpanded.getParams()).then(function (rows) {\n                            sources.monthSlots = rows.map(function (row) {\n                                row.day.date = new Date(row.day.date);\n                                return row;\n                            });\n                        }),\n                        */\n                        Api.gantt.records(user.id, monthExpanded.getParams()).then(function(rows) {\n\t\t\t\t\t\t\tsources.monthRecords = rows.map(function(row) {\n\t\t\t\t\t\t\t\trow.state = new State();\n\t\t\t\t\t\t\t\trow.record.date = new Date(row.record.date);\n\t\t\t\t\t\t\t\treturn row;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}),\n\n                    ]).then(function(response) {\n\t\t\t\t\t\t// state.success();\n\t\t\t\t\t\tdeferred.resolve();\n\n\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\t// state.error(error);\n\t\t\t\t\t\tdeferred.reject();\n\n\t\t\t\t\t});\n\t\t\t\t\treturn deferred.promise;\n\t\t\t\t}\n\n\t\t\t\tfunction onWeekDidSelect(week, month, calendar) {\n\t\t\t\t\t// console.log('calendarPopupRecords.onWeekDidSelect', month.toString());\n\t\t\t\t\t// var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tfunction onDayDidSelect(day, month, calendar) {\n\t\t\t\t\t// var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n\t\t\t\t\tif (!day || currentDay.isBefore(day.date)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// console.log('calendarPopupRecords.onDayDidSelect', day, day.working, day.date);\n\t\t\t\t\tif (day && day.working) {\n\t\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\t\tmodel.$setViewValue(day.date);\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction updateCalendar(date, month, calendar) {\n\t\t\t\t\tvar resource = sources.resource;\n\t\t\t\t\tvar monthRecords = sources.monthRecords;\n\t\t\t\t\tif (!monthRecords) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tcalendar.days.each(function(day) {\n\t\t\t\t\t\tvar availableHours = 0;\n\t\t\t\t\t\tif (day.working) {\n\t\t\t\t\t\t\tavailableHours += resource.baseHours;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar ao = resource.absencesAndOvertimes[day.key];\n\t\t\t\t\t\tif (ao) {\n\t\t\t\t\t\t\tavailableHours += ao.hours;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tday.availableHours = availableHours;\n\t\t\t\t\t\tday.recordedHours = 0;\n\t\t\t\t\t\t//\n\t\t\t\t\t\tvar has = availableHours > 0;\n\t\t\t\t\t\tday.working = !sources.unworkings[day.key];\n\t\t\t\t\t\tday.holiday = !day.working && !has && !day.weekend;\n\t\t\t\t\t\tday.vacation = day.working && !has;\n\t\t\t\t\t\tday.wasVacation = day.vacation && day.past;\n\t\t\t\t\t\tday.wasWorkable = day.working && day.past && has;\n\t\t\t\t\t\tday.workable = day.working && !day.past && has;\n\t\t\t\t\t});\n\t\t\t\t\tangular.forEach(monthRecords, function(row) {\n\t\t\t\t\t\tvar day = calendar.days.get(row.record.key);\n\t\t\t\t\t\tif (day) {\n\t\t\t\t\t\t\tday.recordedHours += row.record.hours;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tcalendar.days.each(function(day) {\n\t\t\t\t\t\tday.green = day.working && !currentDay.isBefore(day.date) && day.recordedHours >= 8;\n\t\t\t\t\t\tday.orange = day.working && !currentDay.isBefore(day.date) && day.recordedHours < 8;\n\t\t\t\t\t\t// day.full = day.workable && day.hours >= day.availableHours;\n\t\t\t\t\t\t// day.available = day.workable && day.hours < day.availableHours;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction setResources(resources) {\n\t\t\t\t\tsources.resources = resources;\n\t\t\t\t\tangular.forEach(resources, function(resource) {\n\t\t\t\t\t\tresource.absencesAndOvertimes = {};\n\t\t\t\t\t\tif (resource.id === user.id) {\n\t\t\t\t\t\t\tsources.resource = resource;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction setAbsencesAndOvertimes() {\n\t\t\t\t\tvar resource = sources.resource;\n\t\t\t\t\tif (!resource) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// assegno assenze e straordinari alla risorsa\n\t\t\t\t\tresource.absencesAndOvertimes = {};\n\t\t\t\t\tangular.forEach(sources.absencesAndOvertimes, function(item) {\n\t\t\t\t\t\tif (resource.id === item.resourceId) {\n\t\t\t\t\t\t\tresource.absencesAndOvertimes[item.key] = item;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction getFirstWorkingDate(date, month, calendar) {\n\t\t\t\t\t// console.log('calendarPopupRecords.getFirstWorkingDate', date);\n\t\t\t\t\tvar firstWorkingDate = null;\n\n\t\t\t\t\tfunction setFirstDay() {\n\t\t\t\t\t\tcalendar.days.forward();\n\t\t\t\t\t\tcalendar.days.each(function(day) {\n\t\t\t\t\t\t\tif (!firstWorkingDate && !month.isOutside(day.date) && day.working && !day.vacation) {\n\t\t\t\t\t\t\t\t// console.log('check', day.working, day.vacation, day.date);\n\t\t\t\t\t\t\t\tfirstWorkingDate = day.date;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// console.log('setFirstDay', firstWorkingDate);\n\t\t\t\t\t}\n\t\t\t\t\tif (date) {\n\t\t\t\t\t\tvar key = CalendarFactory.getKey(date);\n\t\t\t\t\t\tvar day = calendar.days.get(key);\n\t\t\t\t\t\t// console.log('getFirstWorkingDate', day.working, day.vacation, date);\n\t\t\t\t\t\tif (day && day.working && !day.vacation) {\n\t\t\t\t\t\t\tfirstWorkingDate = date;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetFirstDay();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetFirstDay();\n\t\t\t\t\t}\n\t\t\t\t\treturn firstWorkingDate;\n\t\t\t\t}\n\n\t\t\t}\n\t\t};\n    }]);\n\n\tapp.directive('calendarPopup', ['$templateCache', '$parse', '$q', '$timeout', '$filter', 'Hash', 'DateTime', 'Range', 'CalendarFactory', 'State', 'Api', function($templateCache, $parse, $q, $timeout, $filter, Hash, DateTime, Range, CalendarFactory, State, Api) {\n\n\t\treturn {\n\t\t\tpriority: 1002,\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: TemplateUrl,\n\t\t\tscope: {\n\t\t\t\toptions: '=calendarPopup',\n\t\t\t},\n\t\t\tlink: Link,\n\t\t};\n\n\t\tfunction TemplateUrl(element, attributes) {\n\t\t\tvar url = attributes.template;\n\t\t\tif (!url) {\n\t\t\t\turl = 'partials/calendar/popup';\n\t\t\t\tif (!$templateCache.get(url)) {\n\t\t\t\t\t$templateCache.put(url, '<div><json-formatter json=\"item\"></json-formatter></div>');\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn url;\n\t\t}\n\n\t\tfunction Link(scope, element, attributes, model, transclude) {\n\n\t\t\tvar calendar = new CalendarFactory();\n\n\t\t\tvar options = scope.options || {\n\t\t\t\tonMonthDidChange: function() {},\n\t\t\t\tonWeekDidSelect: function() {},\n\t\t\t\tonDayDidSelect: function() {},\n\t\t\t};\n\n\t\t\tvar month = Range.Month();\n\t\t\tvar week = Range.Week();\n\t\t\tvar day = Range.Day();\n\n\t\t\tvar sources = {\n\t\t\t\tmonth: month,\n\t\t\t\tweek: week,\n\t\t\t\tday: day,\n\t\t\t};\n\n\t\t\tvar publics = {\n\t\t\t\tsources: sources,\n\t\t\t\tdoNavMonth: doNavMonth,\n\t\t\t\tonWeekSelect: onWeekSelect,\n\t\t\t\tonDaySelect: onDaySelect,\n\t\t\t\tgetDayClasses: getDayClasses,\n\t\t\t};\n\n\t\t\tangular.extend(scope, publics);\n\n\t\t\t// console.log('scope', scope);\n\n\t\t\tsetMonth(); // Init\n\n\t\t\tfunction setMonth(date) {\n\t\t\t\tif (!date || month.isOutside(date)) {\n\t\t\t\t\tif (date) {\n\t\t\t\t\t\tmonth.setDate(date);\n\t\t\t\t\t}\n\t\t\t\t\tonMonthChange(date);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onMonthChange(date) {\n\t\t\t\tvar calendarMonth = calendar.getMonthByDate(month.getDate());\n\t\t\t\tcalendarMonth.days.each(function(day) {\n\t\t\t\t\tvar d = day.date.getDay();\n\t\t\t\t\tday.dirty = true;\n\t\t\t\t\tday.hours = 0;\n\t\t\t\t\tday.availableHours = 0;\n\t\t\t\t\tday.recordedHours = 0;\n\t\t\t\t\tday.selected = sources.day.isCurrent(day.date);\n\t\t\t\t\tday.past = day.key < Range.today.key;\n\t\t\t\t\tday.weekend = d === 0 || d === 6;\n\t\t\t\t\tday.working = !day.weekend;\n\t\t\t\t\t// reset\n\t\t\t\t\tday.holiday = false;\n\t\t\t\t\tday.vacation = false;\n\t\t\t\t\tday.wasVacation = false;\n\t\t\t\t\tday.wasWorkable = false;\n\t\t\t\t\tday.workable = false;\n\t\t\t\t\tday.green = false;\n\t\t\t\t\tday.orange = false;\n\t\t\t\t});\n\t\t\t\tsources.calendarMonth = calendarMonth;\n\t\t\t\t// console.log('calendarPopup.onMonthChange', calendarMonth);\n\t\t\t\toptions.onMonthDidChange(date, month, calendarMonth);\n\t\t\t}\n\n\t\t\tfunction onWeekSelect(week) {\n\t\t\t\t// console.log('onWeekSelect', week);\n\t\t\t\tif (!week) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (options.onWeekDidSelect(week, month, sources.calendarMonth) === true) {\n\t\t\t\t\t// sources.week.setDate(week.date);\n\t\t\t\t\t// updateSelections();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onDaySelect(day) {\n\t\t\t\t// console.log('onDaySelect', day);\n\t\t\t\tif (!day) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (options.onDayDidSelect(day, month, sources.calendarMonth) === true) {\n\t\t\t\t\tsources.day.setDate(day.date);\n\t\t\t\t\tupdateSelections();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction updateSelections() {\n\t\t\t\tvar calendarMonth = sources.calendarMonth;\n\t\t\t\tcalendarMonth.days.each(function(day) {\n\t\t\t\t\tday.selected = sources.day.isCurrent(day.date);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction doNavMonth(dir) {\n\t\t\t\t// console.log('doNavMonth', dir);\n\t\t\t\tsetMonth(month.getDate(dir));\n\t\t\t}\n\n\t\t\tfunction getDayClasses(day) {\n\t\t\t\tvar classes = {\n\t\t\t\t\t'day': day,\n\t\t\t\t};\n\t\t\t\tif (day) {\n\t\t\t\t\tangular.extend(classes, {\n\t\t\t\t\t\t'today': day.$today,\n\t\t\t\t\t\t'selected': day.selected,\n\t\t\t\t\t\t'workable': day.workable,\n\t\t\t\t\t\t'holiday': day.holiday,\n\t\t\t\t\t\t'vacation': day.vacation,\n\t\t\t\t\t\t'working': day.working,\n\t\t\t\t\t\t'available': day.available,\n\t\t\t\t\t\t'full': day.full,\n\t\t\t\t\t\t'status-green': day.green,\n\t\t\t\t\t\t'status-orange': day.orange,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn classes;\n\t\t\t}\n\n\t\t}\n\n    }]);\n\n}());\n\n/*\n\n(function () {\n    \"use strict\";\n\n    var app = angular.module('app');\n\n\n    app.directive('calendarPopupRecords', ['$templateCache', '$parse', '$q', '$timeout', '$filter', 'Hash', 'DateTime', 'Range', 'CalendarFactory', 'State', 'Api', function ($templateCache, $parse, $q, $timeout, $filter, Hash, DateTime, Range, CalendarFactory, State, Api) {\n        return {\n            restrict: 'A',\n            template: function (element, attributes) {\n                return '<div calendar-popup=\"options\"></div>';\n            },\n            require: 'ngModel',\n            scope: {\n                user: '=calendarUser',\n            },\n            link: CalendarPopupLink,\n        };\n\n        function CalendarPopupLink(scope, element, attributes, model, transclude) {\n            console.log('calendarPopupRecords.link');\n\n            var user = scope.user;\n\n            var state = new State();\n\n            var options = {\n                onMonthDidChange: onMonthDidChange,\n                onWeekDidSelect: onWeekDidSelect,\n                onDayDidSelect: onDayDidSelect,\n            };\n\n            var sources = {};\n\n            var publics = {\n                // user: user,\n                state: state,\n                options: options,\n                // sources: sources,\n            };\n\n            angular.extend(scope, publics);\n\n            var currentDay = new Range({ type: Range.types.DAY });\n\n            function loadResources() {\n                var deferred = $q.defer();\n                if (sources.resources) {\n                    deferred.resolve();\n                } else {\n                    Api.gantt.resources.actives().then(function success(response) {\n                        setResources(response);\n                        deferred.resolve();\n                    }, function (error) {\n                        deferred.reject();\n                    });\n                }\n                return deferred.promise;\n            }\n\n            function getFirstWorkingDate(date, month, calendar) {\n                // console.log('calendarPopupRecords.getFirstWorkingDate', date);\n                var firstWorkingDate = null;\n                function setFirstDay() {\n                    calendar.days.forward();\n                    calendar.days.each(function (day) {\n                        if (!firstWorkingDate && !month.isOutside(day.date) && day.working && !day.vacation) {\n                            // console.log('check', day.working, day.vacation, day.date);\n                            firstWorkingDate = day.date;\n                        }\n                    });\n                    // console.log('setFirstDay', firstWorkingDate);\n                }\n                if (date) {\n                    var key = CalendarFactory.getKey(date);\n                    var day = calendar.days.get(key);\n                    // console.log('getFirstWorkingDate', day.working, day.vacation, date);\n                    if (day && day.working && !day.vacation) {\n                        firstWorkingDate = date;\n                    } else {\n                        setFirstDay();\n                    }\n                } else {\n                    setFirstDay();\n                }\n                return firstWorkingDate;\n            }\n\n            function getMonthRecords(month) {\n                var deferred = $q.defer();\n                var user = scope.user;\n                var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n                // console.log('calendarPopupRecords.getMonthRecords', monthExpanded.toString());\n                $q.all([\n                    loadResources(),\n                    Api.gantt.absencesAndOvertimes(monthExpanded.getParams()).then(function success(response) {\n                        sources.absencesAndOvertimes = response;\n                    }),\n                    Api.gantt.calendar(monthExpanded.getParams()).then(function success(response) {\n                        var unworkings = {};\n                        angular.forEach(response, function (item) {\n                            unworkings[item.key] = item;\n                        });\n                        sources.unworkings = unworkings;\n                        sources.calendar = response;\n                    }),\n                    Api.gantt.records(user.id, monthExpanded.getParams()).then(function (rows) {\n                        sources.monthRecords = rows.map(function (row) {\n                            row.state = new State();\n                            row.record.date = new Date(row.record.date);\n                            return row;\n                        });\n                    }),\n\n                ]).then(function (response) {\n                    // state.success();\n                    deferred.resolve();\n\n                }, function (error) {\n                    // state.error(error);\n                    deferred.reject();\n\n                });\n                return deferred.promise;\n            }\n\n            function onDayDidSelect(day, month, calendar) {\n                // var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n                if (!day || currentDay.isBefore(day.date)) {\n                    return;\n                }\n                // console.log('calendarPopupRecords.onDayDidSelect', day, day.working, day.date);\n                if (day && day.working) {\n                    $timeout(function () {\n                        model.$setViewValue(day.date);\n                    });\n                    return true;\n                }\n            }\n\n            function onMonthDidChange(date, month, calendar) {\n                var deferred = $q.defer();\n                console.log('calendarPopupRecords.onMonthDidChange', month.toString());\n                getMonthRecords(month).then(function () {\n                    setAbsencesAndOvertimes();\n                    updateCalendar(date, month, calendar);\n                    deferred.resolve(getFirstWorkingDate(date, month, calendar));\n\n                }, function () {\n                    deferred.reject();\n\n                });\n                return deferred.promise;\n            }\n\n            function onWeekDidSelect(week, month, calendar) {\n                // console.log('calendarPopupRecords.onWeekDidSelect', month.toString());\n                // var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n                return true;\n            }\n\n            function setAbsencesAndOvertimes() {\n                var resource = sources.resource;\n                if (!resource) {\n                    return;\n                }\n                // assegno assenze e straordinari alla risorsa\n                resource.absencesAndOvertimes = {};\n                angular.forEach(sources.absencesAndOvertimes, function (item) {\n                    if (resource.id === item.resourceId) {\n                        resource.absencesAndOvertimes[item.key] = item;\n                    }\n                });\n            }\n\n            function setResources(resources) {\n                var user = scope.user;\n                sources.resources = resources;\n                console.log('calendarPopupRecords.setResources', resources.length, user);\n                angular.forEach(resources, function (resource) {\n                    resource.absencesAndOvertimes = {};\n                    if (resource.id === user.id) {\n                        sources.resource = resource;\n                        // console.log('calendarPopupRecords.setResources.resource', resource);\n                    }\n                });\n            }\n\n            function setWorkableDay(day) {\n                var resource = sources.resource;\n                day.working = !sources.unworkings[day.key];\n                var availableHours = 0;\n                if (resource) {\n                    if (day.working) {\n                        availableHours += resource.baseHours;\n                    }\n                    var ao = resource.absencesAndOvertimes[day.key];\n                    if (ao) {\n                        availableHours += ao.hours;\n                    }\n                } else if (day.working) {\n                    availableHours += 8;\n                }\n                var has = availableHours > 0;\n                day.availableHours = availableHours;\n                day.recordedHours = 0;\n                day.holiday = !day.working && !has && !day.weekend;\n                day.vacation = day.working && !has;\n                day.wasVacation = day.vacation && day.past;\n                day.workable = day.working && !day.past && has;\n                day.wasWorkable = day.working && day.past && has;\n            }\n\n            function updateCalendar(date, month, calendar) {\n                calendar.days.each(function (day) {\n                    setWorkableDay(day);\n                });\n            }\n\n            function updateCalendar(date, month, calendar) {\n                calendar.days.each(function (day) {\n                    setWorkableDay(day);\n                });\n                var monthRecords = sources.monthRecords;\n                if (monthRecords) {\n                    angular.forEach(monthRecords, function (row) {\n                        var day = calendar.days.get(row.record.key);\n                        if (day) {\n                            day.recordedHours += row.record.hours;\n                        }\n                    });\n                    calendar.days.each(function (day) {\n                        day.green = day.working && !currentDay.isBefore(day.date) && day.recordedHours >= 8;\n                        day.orange = day.working && !currentDay.isBefore(day.date) && day.recordedHours < 8;\n                        // day.full = day.workable && day.hours >= day.availableHours;\n                        // day.available = day.workable && day.hours < day.availableHours;\n                    });\n                }\n            }\n\n        }\n    }]);\n\n    app.directive('calendarPopupWorkables', ['$templateCache', '$parse', '$q', '$timeout', '$filter', 'Hash', 'DateTime', 'Range', 'CalendarFactory', 'State', 'Api', function ($templateCache, $parse, $q, $timeout, $filter, Hash, DateTime, Range, CalendarFactory, State, Api) {\n        return {\n            restrict: 'A',\n            template: function (element, attributes) {\n                return '<div calendar-popup=\"options\" template=\"partials/calendar/popup/workables\"></div>';\n            },\n            require: 'ngModel',\n            scope: {\n                user: '=?calendarUser',\n            },\n            link: CalendarPopupLink,\n        };\n\n        function CalendarPopupLink(scope, element, attributes, model, transclude) {\n            console.log('calendarPopupWorkables.link');\n\n            var user = scope.user;\n\n            var state = new State();\n\n            var options = {\n                onMonthDidChange: onMonthDidChange,\n                onWeekDidSelect: onWeekDidSelect,\n                onDayDidSelect: onDayDidSelect,\n            };\n\n            var sources = {};\n\n            var publics = {\n                state: state,\n                options: options,\n            };\n\n            angular.extend(scope, publics);\n\n            var currentDay = new Range({ type: Range.types.DAY });\n\n            function getFirstWorkingDate(date, month, calendar) {\n                var firstWorkingDate = null;\n                function setFirstDay() {\n                    calendar.days.forward();\n                    calendar.days.each(function (day) {\n                        if (!firstWorkingDate && !month.isOutside(day.date) && day.working && !day.vacation) {\n                            firstWorkingDate = day.date;\n                        }\n                    });\n                }\n                if (date) {\n                    var key = CalendarFactory.getKey(date);\n                    var day = calendar.days.get(key);\n                    if (day && day.working && !day.vacation) {\n                        firstWorkingDate = date;\n                    } else {\n                        setFirstDay();\n                    }\n                } else {\n                    setFirstDay();\n                }\n                return firstWorkingDate;\n            }\n\n            function loadResources(monthExpanded) {\n                var deferred = $q.defer();\n                if (sources.resources) {\n                    deferred.resolve();\n                } else {\n                    Api.gantt.resources.actives().then(function success(response) {\n                        setResources(response);\n                        deferred.resolve();\n                    }, function (error) {\n                        deferred.reject();\n                    });\n                }\n                return deferred.promise;\n            }\n\n            function loadAbsencesAndOvertimes(monthExpanded) {\n                return Api.gantt.absencesAndOvertimes(monthExpanded.getParams()).then(function success(response) {\n                    sources.absencesAndOvertimes = response;\n                });\n            }\n\n            function loadCalendar(monthExpanded) {\n                return Api.gantt.calendar(monthExpanded.getParams()).then(function success(response) {\n                    var unworkings = {};\n                    angular.forEach(response, function (item) {\n                        unworkings[item.key] = item;\n                    });\n                    sources.unworkings = unworkings;\n                    sources.calendar = response;\n                })\n            }\n\n            function getMonthRecords(month) {\n                var deferred = $q.defer();\n                var user = scope.user;\n                var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n                var promises;\n                if (user) {\n                    promises = [loadResources(monthExpanded), loadAbsencesAndOvertimes(monthExpanded), loadCalendar(monthExpanded)];\n                } else {\n                    promises = [loadCalendar(monthExpanded)];\n                }\n                $q.all(promises).then(function (response) {\n                    deferred.resolve();\n\n                }, function (error) {\n                    deferred.reject();\n\n                });\n                return deferred.promise;\n            }\n\n            function onDayDidSelect(day, month, calendar) {\n                if (!day) { // || currentDay.isBefore(day.date)) {\n                    return;\n                }\n                if (day && day.working) {\n                    $timeout(function () {\n                        model.$setViewValue(day.date);\n                    });\n                    return true;\n                }\n            }\n\n            function onMonthDidChange(date, month, calendar) {\n                var deferred = $q.defer();\n                console.log('calendarPopupRecords.onMonthDidChange', month.toString());\n                getMonthRecords(month).then(function () {\n                    setAbsencesAndOvertimes();\n                    updateCalendar(date, month, calendar);\n                    deferred.resolve(getFirstWorkingDate(date, month, calendar));\n\n                }, function () {\n                    deferred.reject();\n\n                });\n                return deferred.promise;\n            }\n\n            function onWeekDidSelect(week, month, calendar) {\n                // console.log('calendarPopupRecords.onWeekDidSelect', month.toString());\n                // var monthExpanded = Range.expand(month, DateTime.DAY * 7);\n                return true;\n            }\n\n            function setAbsencesAndOvertimes() {\n                var resource = sources.resource;\n                if (!resource) {\n                    return;\n                }\n                // assegno assenze e straordinari alla risorsa\n                resource.absencesAndOvertimes = {};\n                angular.forEach(sources.absencesAndOvertimes, function (item) {\n                    if (resource.id === item.resourceId) {\n                        resource.absencesAndOvertimes[item.key] = item;\n                    }\n                });\n            }\n\n            function setResources(resources) {\n                var user = scope.user;\n                sources.resources = resources;\n                console.log('calendarPopupRecords.setResources', resources.length, user);\n                angular.forEach(resources, function (resource) {\n                    resource.absencesAndOvertimes = {};\n                    if (resource.id === user.id) {\n                        sources.resource = resource;\n                        // console.log('calendarPopupRecords.setResources.resource', resource);\n                    }\n                });\n            }\n\n            function setWorkableDay(day) {\n                var resource = sources.resource;\n                day.working = !sources.unworkings[day.key];\n                var availableHours = 0;\n                if (resource) {\n                    if (day.working) {\n                        availableHours += resource.baseHours;\n                    }\n                    var ao = resource.absencesAndOvertimes[day.key];\n                    if (ao) {\n                        availableHours += ao.hours;\n                    }\n                } else if (day.working) {\n                    availableHours += 8;\n                }\n                // console.log('setWorkableDay', day.key, 'day.working', day.working, 'availableHours', availableHours);\n                var has = availableHours > 0;\n                day.availableHours = availableHours;\n                day.recordedHours = 0;\n                day.holiday = !day.working && !has && !day.weekend;\n                day.vacation = day.working && !has;\n                day.wasVacation = day.vacation && day.past;\n                day.workable = day.working && !day.past && has;\n                day.wasWorkable = day.working && day.past && has;\n            }\n\n            function updateCalendar(date, month, calendar) {\n                calendar.days.each(function (day) {\n                    setWorkableDay(day);\n                });\n            }\n\n        }\n    }]);\n\n    app.directive('calendarPopup', ['$templateCache', '$parse', '$q', '$timeout', '$filter', 'Hash', 'DateTime', 'Range', 'CalendarFactory', 'State', 'Api', function ($templateCache, $parse, $q, $timeout, $filter, Hash, DateTime, Range, CalendarFactory, State, Api) {\n        return {\n            restrict: 'A',\n            templateUrl: TemplateUrl,\n            scope: {\n                options: '=calendarPopup',\n            },\n            link: CalendarPopupLink,\n        }\n\n        function TemplateUrl(element, attributes) {\n            var url = attributes.template;\n            if (!url) {\n                url = 'partials/calendar/popup';\n                if (!$templateCache.get(url)) {\n                    $templateCache.put(url, '<div><json-formatter json=\"item\"></json-formatter></div>');\n                }\n            }\n            return url;\n        }\n\n        function CalendarPopupLink(scope, element, attributes, model, transclude) {\n            console.log('calendarPopup.link', scope.options);\n\n            var calendar = new CalendarFactory();\n\n            var options;\n\n            var month = new Range({ type: Range.types.MONTH });\n            var week = new Range({ type: Range.types.WEEK });\n            var day = new Range({ type: Range.types.DAY });\n\n            var sources = {\n                month: month,\n                week: week,\n                day: day,\n            };\n\n            var publics = {\n                sources: sources,\n                doNavMonth: doNavMonth,\n                onWeekSelect: onWeekSelect,\n                onDaySelect: onDaySelect,\n                getDayClasses: getDayClasses,\n            };\n\n            angular.extend(scope, publics);\n\n            // console.log('scope', scope);\n\n            scope.$watch('options', function (newValue) {\n                options = newValue;\n                options = options || {\n                    onMonthDidChange: function () {\n                        var deferred = $q.defer();\n                        deferred.resolve();\n                        return deferred.promise;\n                    },\n                    onWeekDidSelect: function () { },\n                    onDayDidSelect: function () { },\n                }\n                setMonth(); // Init\n            });\n\n            function setMonth(date) {\n                if (!date || month.isOutside(date)) {\n                    onMonthChange(date);\n                }\n            }\n\n            function onMonthChange(date) {\n                var calendarMonth = calendar.getMonthByDate(date); // month.getDate();\n                calendarMonth.days.each(function (day) {\n                    var d = day.date.getDay();\n                    day.dirty = true;\n                    day.hours = 0;\n                    day.availableHours = 0;\n                    day.recordedHours = 0;\n                    day.selected = sources.day.isCurrent(day.date);\n                    day.past = day.key < Range.today.key;\n                    day.weekend = d === 0 || d === 6;\n                    day.working = !day.weekend;\n                    // reset\n                    day.holiday = false;\n                    day.vacation = false;\n                    day.wasVacation = false;\n                    day.wasWorkable = false;\n                    day.workable = false;\n                    day.green = false;\n                    day.orange = false;\n                });\n                // console.log('calendarPopup.onMonthChange', calendarMonth);\n                options.onMonthDidChange(date, Range.currentMonth().setDate(date), calendarMonth).then(function () {\n                    date ? month.setDate(date) : null;\n                    sources.calendarMonth = calendarMonth;\n                    scope.$emit('onMonthDidChange', options);\n                });\n            }\n\n            function onWeekSelect(week) {\n                // console.log('onWeekSelect', week);\n                if (!week) {\n                    return;\n                }\n                if (options.onWeekDidSelect(week, month, sources.calendarMonth) === true) {\n                    // sources.week.setDate(week.date);\n                    // updateSelections();\n                    scope.$emit('onWeekDidSelect', options);\n                }\n            }\n\n            function onDaySelect(day) {\n                // console.log('onDaySelect', day);\n                if (!day) {\n                    return;\n                }\n                if (options.onDayDidSelect(day, month, sources.calendarMonth) === true) {\n                    sources.day.setDate(day.date);\n                    updateSelections();\n                    scope.$emit('onDayDidSelect', options);\n                }\n            }\n\n            function updateSelections() {\n                var calendarMonth = sources.calendarMonth;\n                calendarMonth.days.each(function (day) {\n                    day.selected = sources.day.isCurrent(day.date);\n                });\n            }\n\n            function doNavMonth(dir) {\n                // console.log('doNavMonth', dir);\n                setMonth(month.getDate(dir));\n            }\n\n            function getDayClasses(day) {\n                var classes = {\n                    'day': day,\n                }\n                if (day) {\n                    angular.extend(classes, {\n                        'today': day.$today,\n                        'selected': day.selected,\n                        'workable': day.workable,\n                        'holiday': day.holiday,\n                        'vacation': day.vacation,\n                        'working': day.working,\n                        'available': day.available,\n                        'full': day.full,\n                        'status-green': day.green,\n                        'status-orange': day.orange,\n                    });\n                }\n                return classes;\n            }\n\n        }\n\n    }]);\n\n}());\n\n*/\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Calendar', ['DateTime', 'Hash', function(DateTime, Hash) {\n\n\t\tvar service = this;\n\n\t\tvar days = new Hash('key');\n\t\tvar months = new Hash('mKey');\n\n\t\tvar statics = {\n\t\t\tgetDate: getDate,\n\t\t\tclearMonth: clearMonth,\n\t\t\tgetMonthByDate: getMonthByDate,\n\t\t\tgetMonths: getMonths,\n\t\t\tgetMonth: getMonth,\n\t\t\tgetDay: getDay,\n\t\t\tgetKey: getKey,\n\t\t\tdays: days,\n\t\t\tmonths: months,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tfunction getDate(day) {\n\t\t\tif (typeof day.date.getMonth === 'function') {\n\t\t\t\treturn day.date;\n\t\t\t} else {\n\t\t\t\treturn new Date(day.date);\n\t\t\t}\n\t\t}\n\n\t\tfunction clearMonth(month) {\n\t\t\tmonth.days.each(function(day) {\n\t\t\t\tif (day) {\n\t\t\t\t\tday.hours = 0;\n\t\t\t\t\tday.tasks = new Hash('id');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction getMonthByDate(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar yyyy = date.getFullYear();\n\t\t\tvar MM = date.getMonth();\n\t\t\tvar key = Math.ceil(date.getTime() / DateTime.DAY);\n\t\t\tvar mKey = yyyy * 12 + MM;\n\t\t\tvar month = months.get(mKey);\n\t\t\tif (!month) {\n\t\t\t\tvar fromDay = new Date(yyyy, MM, 1).getDay() - 1;\n\t\t\t\tfromDay = fromDay < 0 ? 6 : fromDay;\n\t\t\t\tvar monthDays = new Date(yyyy, MM + 1, 0).getDate();\n\t\t\t\tvar weeks = 6; // Math.ceil((fromDay + monthDays) / 7);\n\t\t\t\t// console.log('month', MM, 'weeks', weeks);\n\t\t\t\tmonth = {\n\t\t\t\t\tdate: date,\n\t\t\t\t\tmKey: mKey,\n\t\t\t\t\tmonth: MM,\n\t\t\t\t\tmonthDays: monthDays,\n\t\t\t\t\tfromDay: fromDay,\n\t\t\t\t\tdays: new Hash('key'),\n\t\t\t\t};\n\t\t\t\tmonth.weeks = new Array(weeks).fill().map(function(o, r) {\n\t\t\t\t\tvar days = new Array(7).fill().map(function(o, c) {\n\t\t\t\t\t\tvar item = null;\n\t\t\t\t\t\tvar d = r * 7 + c - fromDay;\n\t\t\t\t\t\tif (d >= 0 && d < monthDays) {\n\t\t\t\t\t\t\tvar date = new Date(yyyy, MM, d + 1);\n\t\t\t\t\t\t\tvar key = Math.ceil(date.getTime() / DateTime.DAY);\n\t\t\t\t\t\t\titem = {\n\t\t\t\t\t\t\t\t$today: key === DateTime.today.key,\n\t\t\t\t\t\t\t\tc: c,\n\t\t\t\t\t\t\t\tr: r,\n\t\t\t\t\t\t\t\td: d + 1,\n\t\t\t\t\t\t\t\tdate: date,\n\t\t\t\t\t\t\t\tkey: key,\n\t\t\t\t\t\t\t\thours: 0,\n\t\t\t\t\t\t\t\ttasks: new Hash('id'),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tservice.days.add(item);\n\t\t\t\t\t\t\titem = month.days.add(item);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn item;\n\t\t\t\t\t});\n\t\t\t\t\treturn {\n\t\t\t\t\t\tr: r,\n\t\t\t\t\t\tdate: new Date(yyyy, MM, r * 7 - fromDay + 1),\n\t\t\t\t\t\tdays: days,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\tmonth.getMonth = function(diff) {\n\t\t\t\t\tdiff = diff || 0;\n\t\t\t\t\treturn new Date(yyyy, MM + diff, 1);\n\t\t\t\t};\n\t\t\t\tmonth = months.add(month);\n\t\t\t}\n\t\t\treturn month;\n\t\t}\n\n\t\tfunction getMonths(num) {\n\t\t\tdays.removeAll();\n\t\t\tmonths.removeAll();\n\t\t\tvar i = 0;\n\t\t\twhile (i < num) {\n\t\t\t\tvar date = new Date();\n\t\t\t\tdate.setFullYear(DateTime.today.date.getFullYear());\n\t\t\t\tdate.setMonth(DateTime.today.date.getMonth() + i);\n\t\t\t\tdate.setDate(1);\n\t\t\t\tdate.setHours(0);\n\t\t\t\tdate.setMinutes(0);\n\t\t\t\tdate.setSeconds(0);\n\t\t\t\tvar month = getMonthByDate(date);\n\t\t\t\t// console.log('getMonths', month);\n\t\t\t\ti++;\n\t\t\t}\n\t\t\t// console.log('getMonths', months);\n\t\t\treturn months;\n\t\t}\n\n\t\tfunction getMonth(day) {\n\t\t\tvar date = getDate(day);\n\t\t\tvar month = getMonthByDate(date);\n\t\t\treturn month;\n\t\t}\n\n\t\tfunction getDay(days) {\n\t\t\tvar date = new Date(DateTime.today.date);\n\t\t\tdate.setDate(date.getDate() + days);\n\t\t\treturn date;\n\t\t}\n\n\t\tfunction getKey(date) {\n\t\t\treturn Math.ceil(date.getTime() / DateTime.DAY);\n\t\t}\n\n    }]);\n\n\tapp.factory('CalendarFactory', ['DateTime', 'Hash', function(DateTime, Hash) {\n\n\t\tfunction Calendar() {\n\t\t\tthis.days = new Hash('key');\n\t\t\tthis.months = new Hash('mKey');\n\t\t}\n\n\t\tvar statics = {\n\t\t\tclearMonth: clearMonth,\n\t\t\tgetDate: getDate,\n\t\t\tgetDay: getDay,\n\t\t\tgetKey: getKey,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tgetMonths: getMonths,\n\t\t\tgetMonth: getMonth,\n\t\t\tgetMonthByDate: getMonthByDate,\n\t\t};\n\n\t\tangular.extend(Calendar, statics);\n\t\tangular.extend(Calendar.prototype, publics);\n\n\t\treturn Calendar;\n\n\t\t// statics\n\n\t\tfunction clearMonth(month) {\n\t\t\tmonth.days.each(function(day) {\n\t\t\t\tif (day) {\n\t\t\t\t\tday.hours = 0;\n\t\t\t\t\tday.tasks = new Hash('id');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction getDate(day) {\n\t\t\tif (typeof day.date.getMonth === 'function') {\n\t\t\t\treturn day.date;\n\t\t\t} else {\n\t\t\t\treturn new Date(day.date);\n\t\t\t}\n\t\t}\n\n\t\tfunction getDay(days) {\n\t\t\tvar date = new Date(DateTime.today.date);\n\t\t\tdate.setDate(date.getDate() + days);\n\t\t\treturn date;\n\t\t}\n\n\t\tfunction getKey(date) {\n\t\t\treturn Math.ceil(date.getTime() / DateTime.DAY);\n\t\t}\n\n\t\t// publics\n\n\t\tfunction getMonths(num) {\n\t\t\tvar calendar = this;\n\t\t\tcalendar.days.removeAll();\n\t\t\tcalendar.months.removeAll();\n\t\t\tvar i = 0;\n\t\t\twhile (i < num) {\n\t\t\t\tvar date = new Date();\n\t\t\t\tdate.setFullYear(DateTime.today.date.getFullYear());\n\t\t\t\tdate.setMonth(DateTime.today.date.getMonth() + i);\n\t\t\t\tdate.setDate(1);\n\t\t\t\tdate.setHours(0);\n\t\t\t\tdate.setMinutes(0);\n\t\t\t\tdate.setSeconds(0);\n\t\t\t\tvar month = calendar.getMonthByDate(date);\n\t\t\t\t// console.log('getMonths', month);\n\t\t\t\ti++;\n\t\t\t}\n\t\t\t// console.log('getMonths', months);\n\t\t\treturn calendar.months;\n\t\t}\n\n\t\tfunction getMonth(day) {\n\t\t\tvar calendar = this;\n\t\t\tvar date = getDate(day);\n\t\t\tvar month = calendar.getMonthByDate(date);\n\t\t\treturn month;\n\t\t}\n\n\t\tfunction getMonthByDate(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar calendar = this;\n\t\t\tvar yyyy = date.getFullYear();\n\t\t\tvar MM = date.getMonth();\n\t\t\tvar key = Math.ceil(date.getTime() / DateTime.DAY);\n\t\t\tvar mKey = yyyy * 12 + MM;\n\t\t\tvar month = calendar.months.get(mKey);\n\t\t\tif (!month) {\n\t\t\t\tvar fromDay = new Date(yyyy, MM, 1).getDay() - 1;\n\t\t\t\tfromDay = fromDay < 0 ? 6 : fromDay;\n\t\t\t\tvar monthDays = new Date(yyyy, MM + 1, 0).getDate();\n\t\t\t\tvar weeks = 6; // Math.ceil((fromDay + monthDays) / 7);\n\t\t\t\t// console.log('month', MM, 'weeks', weeks);\n\t\t\t\tmonth = {\n\t\t\t\t\tdate: date,\n\t\t\t\t\tmKey: mKey,\n\t\t\t\t\tmonth: MM,\n\t\t\t\t\tmonthDays: monthDays,\n\t\t\t\t\tfromDay: fromDay,\n\t\t\t\t\tdays: new Hash('key'),\n\t\t\t\t};\n\t\t\t\tmonth.weeks = new Array(weeks).fill().map(function(o, r) {\n\t\t\t\t\tvar days = new Array(7).fill().map(function(o, c) {\n\t\t\t\t\t\tvar item = null;\n\t\t\t\t\t\tvar d = r * 7 + c - fromDay;\n\t\t\t\t\t\tif (d >= 0 && d < monthDays) {\n\t\t\t\t\t\t\tvar date = new Date(yyyy, MM, d + 1);\n\t\t\t\t\t\t\tvar key = Math.ceil(date.getTime() / DateTime.DAY);\n\t\t\t\t\t\t\titem = {\n\t\t\t\t\t\t\t\t$today: key === DateTime.today.key,\n\t\t\t\t\t\t\t\tc: c,\n\t\t\t\t\t\t\t\tr: r,\n\t\t\t\t\t\t\t\td: d + 1,\n\t\t\t\t\t\t\t\tdate: date,\n\t\t\t\t\t\t\t\tkey: key,\n\t\t\t\t\t\t\t\thours: 0,\n\t\t\t\t\t\t\t\ttasks: new Hash('id'),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tcalendar.days.add(item);\n\t\t\t\t\t\t\titem = month.days.add(item);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn item;\n\t\t\t\t\t});\n\t\t\t\t\treturn {\n\t\t\t\t\t\tr: r,\n\t\t\t\t\t\tdate: new Date(yyyy, MM, r * 7 - fromDay + 1),\n\t\t\t\t\t\tdays: days,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\tmonth.getMonth = function(diff) {\n\t\t\t\t\tdiff = diff || 0;\n\t\t\t\t\treturn new Date(yyyy, MM + diff, 1);\n\t\t\t\t};\n\t\t\t\tmonth = calendar.months.add(month);\n\t\t\t}\n\t\t\treturn month;\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('DateTime', [function() {\n\n\t\tvar service = this;\n\n\t\tvar SECOND = 1000;\n\t\tvar MINUTE = 60 * SECOND;\n\t\tvar QUARTER = 15 * MINUTE;\n\t\tvar HOUR = 60 * MINUTE;\n\t\tvar DAY = 24 * HOUR;\n\t\tvar WEEK = 7 * DAY;\n\t\tvar FIRSTDAYOFWEEK = 1;\n\n\t\tvar today = getFullDate();\n\n\t\tvar statics = {\n\t\t\tgetIndexLeft: getIndexLeft,\n\t\t\tgetIndexRight: getIndexRight,\n\t\t\t//\n\t\t\tgetDayLeft: getDayLeft,\n\t\t\tgetDayRight: getDayRight,\n\t\t\t//\n\t\t\tgetMonthLeft: getMonthLeft,\n\t\t\tgetMonthRight: getMonthRight,\n\t\t\t//\n\t\t\tgetWeekLeft: getWeekLeft,\n\t\t\tgetWeekRight: getWeekRight,\n\t\t\t//\n\t\t\tgetYearLeft: getYearLeft,\n\t\t\tgetYearRight: getYearRight,\n\t\t\t//\n\t\t\tdateToKey: dateToKey,\n\t\t\t//\n\t\t\tdayDiff: dayDiff,\n\t\t\tdayLeft: dayLeft,\n\t\t\tdayRight: dayRight,\n\t\t\t//\n\t\t\tgetDate: getDate,\n\t\t\tgetFullDate: getFullDate,\n\t\t\tgetDay: getDay,\n\t\t\tgetFullDay: getFullDay,\n\t\t\tgetWeek: getWeek,\n\t\t\tgetDayByKey: getDayByKey,\n\t\t\tgetDayByDate: getDayByDate,\n\t\t\thourToTime: hourToTime,\n\t\t\tkeyToDate: keyToDate,\n\t\t\t//\n\t\t\tmonthDiff: monthDiff,\n\t\t\tmonthLeft: monthLeft,\n\t\t\tmonthRight: monthRight,\n\t\t\t//\n\t\t\ttoday: today,\n\t\t\t//\n\t\t\tweekDiff: weekDiff,\n\t\t\tweekLeft: weekLeft,\n\t\t\tweekRight: weekRight,\n\t\t\t//\n\t\t\tyearDiff: yearDiff,\n\t\t\tyearLeft: yearLeft,\n\t\t\tyearRight: yearRight,\n\t\t\t// conversion\n\t\t\ttimeToHour: timeToHour,\n\t\t\ttimeToQuarterHour: timeToQuarterHour,\n\t\t\t// units\n\t\t\tSECOND: SECOND,\n\t\t\tMINUTE: MINUTE,\n\t\t\tQUARTER: QUARTER,\n\t\t\tHOUR: HOUR,\n\t\t\tDAY: DAY,\n\t\t\tWEEK: WEEK,\n\t\t\tFIRSTDAYOFWEEK: FIRSTDAYOFWEEK,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tfunction datetime(date) {\n\t\t\tdate = date ? new Date(date) : new Date();\n\t\t\treturn date;\n\t\t}\n\n\t\tfunction components(date) {\n\t\t\tdate = datetime(date);\n\t\t\t// console.log($locale.DATETIME_FORMATS.FIRSTDAYOFWEEK);\n\t\t\treturn {\n\t\t\t\tdate: date,\n\t\t\t\tyyyy: date.getFullYear(),\n\t\t\t\tMM: date.getMonth(),\n\t\t\t\tdd: date.getDate(),\n\t\t\t\t// ee: (date.getDay() + $locale.DATETIME_FORMATS.FIRSTDAYOFWEEK) % 7,\n\t\t\t\tee: date.getDay(),\n\t\t\t\tHH: date.getHours(),\n\t\t\t\tmm: date.getMinutes(),\n\t\t\t\tss: date.getSeconds(),\n\t\t\t\tsss: date.getMilliseconds(),\n\t\t\t};\n\t\t}\n\n\t\tfunction dateToKey(date) {\n\t\t\tdate = datetime(date);\n\t\t\tvar offset = date.getTimezoneOffset();\n\t\t\treturn Math.floor((date.valueOf() - offset * MINUTE) / DAY);\n\t\t}\n\n\t\tfunction dayDiff(diff, date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd + diff, c.HH, c.mm, c.ss, c.sss);\n\t\t}\n\n\t\tfunction dayLeft(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd, 0, 0, 0, 0);\n\t\t}\n\n\t\tfunction dayRight(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd, 23, 59, 59, 999);\n\t\t}\n\n\t\tfunction getDate(date) {\n\t\t\tdate = dayLeft(date);\n\t\t\treturn getDayByDate(date);\n\t\t}\n\n\t\tfunction getFullDate(date) {\n\t\t\treturn getFullDay(getDate(date));\n\t\t}\n\n\t\tfunction getDay(date, key) {\n\t\t\treturn {\n\t\t\t\tdate: date,\n\t\t\t\tkey: key,\n\t\t\t};\n\t\t}\n\n\t\tfunction getDayByKey(key) {\n\t\t\treturn getDay(keyToDate(key), key);\n\t\t}\n\n\t\tfunction getDayByDate(date) {\n\t\t\treturn getDay(date, dateToKey(date));\n\t\t}\n\n\t\tfunction getFullDay(day) {\n\t\t\tvar c = components(day.date);\n\t\t\tc.key = day.key;\n\t\t\tc.wKey = dateToKey(weekLeft(day.date));\n\t\t\tc.mKey = dateToKey(monthLeft(day.date));\n\t\t\tc.ww = getWeek(day.date, FIRSTDAYOFWEEK);\n\t\t\treturn c;\n\t\t}\n\n\t\tfunction hourToTime(hour) {\n\t\t\treturn hour * HOUR;\n\t\t}\n\n\t\tfunction keyToDate(key) {\n\t\t\tvar date = new Date();\n\t\t\tvar offset = date.getTimezoneOffset();\n\t\t\treturn new Date(date.setTime(key * DAY + offset * MINUTE));\n\t\t}\n\n\t\tfunction monthDiff(diff, date, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar MM = Math.floor(c.MM / step) * step + diff * step;\n\t\t\treturn new Date(c.yyyy, MM, 1, c.HH, c.mm, c.ss, c.sss);\n\t\t}\n\n\t\tfunction monthLeft(date, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar MM = Math.floor(c.MM / step) * step;\n\t\t\treturn new Date(c.yyyy, MM, 1, 0, 0, 0, 0);\n\t\t}\n\n\t\tfunction monthRight(date, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar MM = Math.floor(c.MM / step) * step;\n\t\t\treturn new Date(c.yyyy, MM + step, 0, 23, 59, 59, 999);\n\t\t}\n\n\t\tfunction timeToHour(time) {\n\t\t\treturn time / HOUR;\n\t\t}\n\n\t\tfunction timeToQuarterHour(time) {\n\t\t\treturn Math.floor(time / QUARTER) * QUARTER / HOUR;\n\t\t}\n\n\t\tfunction weekDiff(diff, date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd + diff * 7, c.HH, c.mm, c.ss, c.sss);\n\t\t}\n\n\t\tfunction weekLeft(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd - c.ee + FIRSTDAYOFWEEK, 0, 0, 0, 0);\n\t\t}\n\n\t\tfunction weekRight(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM, c.dd - c.ee + FIRSTDAYOFWEEK + 6, 23, 59, 59, 999);\n\t\t}\n\n\t\tfunction yearDiff(diff, date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, c.MM + diff * 12, c.dd, c.HH, c.mm, c.ss, c.sss);\n\t\t}\n\n\t\tfunction yearLeft(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, 0, 1, 0, 0, 0, 0);\n\t\t}\n\n\t\tfunction yearRight(date) {\n\t\t\tvar c = components(date);\n\t\t\treturn new Date(c.yyyy, 12, 0, 23, 59, 59, 999);\n\t\t}\n\n\t\tfunction getIndexLeft(diff, size, step) {\n\t\t\tdiff = diff || 0;\n\t\t\tsize = size || 1;\n\t\t\tstep = step || 1;\n\t\t\tvar index = diff * step;\n\t\t\treturn index;\n\t\t}\n\n\t\tfunction getIndexRight(diff, size, step) {\n\t\t\tsize = size || 1;\n\t\t\tstep = step || 1;\n\t\t\tvar index = getIndexLeft(diff, size, step);\n\t\t\tindex += (size * step) - 1;\n\t\t\treturn index;\n\t\t}\n\n\t\tfunction getYearLeft(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar yyyy = Math.floor(c.yyyy / step) * step;\n\t\t\tyyyy += getIndexLeft(diff, size, step);\n\t\t\tdate = new Date(yyyy, c.MM, c.dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn yearLeft(date);\n\t\t}\n\n\t\tfunction getYearRight(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar yyyy = Math.floor(c.yyyy / step) * step;\n\t\t\tyyyy += getIndexRight(diff, size, step);\n\t\t\tdate = new Date(yyyy, c.MM, c.dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn yearRight(date);\n\t\t}\n\n\t\tfunction getMonthLeft(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar MM = Math.floor(c.MM / step) * step;\n\t\t\tMM += getIndexLeft(diff, size, step);\n\t\t\tdate = new Date(c.yyyy, MM, c.dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn monthLeft(date);\n\t\t}\n\n\t\tfunction getMonthRight(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar MM = Math.floor(c.MM / step) * step;\n\t\t\tMM += getIndexRight(diff, size, step);\n\t\t\tdate = new Date(c.yyyy, MM, c.dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn monthRight(date);\n\t\t}\n\n\t\tfunction getWeekLeft(date, diff, size, step) {\n\t\t\tvar c = components(date);\n\t\t\tvar dd = c.dd + getIndexLeft(diff, size, step) * 7;\n\t\t\tdate = new Date(c.yyyy, c.MM, dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn weekLeft(date);\n\t\t}\n\n\t\tfunction getWeekRight(date, diff, size, step) {\n\t\t\tvar c = components(date);\n\t\t\tvar dd = c.dd + getIndexRight(diff, size, step) * 7;\n\t\t\tdate = new Date(c.yyyy, c.MM, dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn weekRight(date);\n\t\t}\n\n\t\tfunction getDayLeft(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar dd = Math.floor(c.dd / step) * step;\n\t\t\tdd += getIndexLeft(diff, size, step);\n\t\t\tdate = new Date(c.yyyy, c.MM, dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn dayLeft(date);\n\t\t}\n\n\t\tfunction getDayRight(date, diff, size, step) {\n\t\t\tstep = step || 1;\n\t\t\tvar c = components(date);\n\t\t\tvar dd = Math.floor(c.dd / step) * step;\n\t\t\tdd += getIndexRight(diff, size, step);\n\t\t\tdate = new Date(c.yyyy, c.MM, dd, c.HH, c.mm, c.ss, c.sss);\n\t\t\treturn dayRight(date);\n\t\t}\n\n\t\tfunction getWeekDay(date, offsetDays) {\n\t\t\toffsetDays = offsetDays || 0; // default offsetDays to zero\n\t\t\tvar ee = date.getDay();\n\t\t\tee -= offsetDays;\n\t\t\tif (ee < 0) {\n\t\t\t\tee += 7;\n\t\t\t}\n\t\t\treturn ee;\n\t\t}\n\n\t\tfunction getWeek(date, offsetDays) {\n\t\t\tvar startingDayOfWeek = 4; // first week of year with thursday;\n\t\t\tvar now = getDayByDate(date);\n\t\t\tvar first = getDayByDate(getYearLeft(date)); // diff, size, step\n\t\t\tvar ee = getWeekDay(first.date, offsetDays);\n\t\t\tvar num = now.key - first.key;\n\t\t\tvar week = Math.floor((num + ee) / 7);\n\t\t\tif (ee < startingDayOfWeek) {\n\t\t\t\tweek++;\n\t\t\t\tif (week > 52) {\n\t\t\t\t\t// next year\n\t\t\t\t\tee = getWeekDay(getYearLeft(date, 1), offsetDays);\n\t\t\t\t\t// if the next year starts before the middle of the week, it is week #1 of that year\n\t\t\t\t\tweek = ee < startingDayOfWeek ? 1 : 53;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn week;\n\t\t}\n\n    }]);\n\n\tapp.filter('isoWeek', ['DateTime', function(DateTime) {\n\t\treturn function(value, offsetDays) {\n\t\t\tif (value) {\n\t\t\t\tvar week = DateTime.getWeek(value, offsetDays);\n\t\t\t\treturn week < 10 ? '0' + week : week; // padded\n\t\t\t} else {\n\t\t\t\treturn '-';\n\t\t\t}\n\t\t};\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tvar it_IT = {\n\t\tlong: {\n\t\t\tRANGE: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tYEAR: 'Anno {from|date:yyyy}',\n\t\t\tSEMESTER: 'Semestre {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tTRIMESTER: 'Quadrimestre {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tQUARTER: 'Trimestre {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tMONTH: '{from|date:MMMM yyyy}',\n\t\t\tWEEK: 'Settimana {to|isoWeek:1}',\n\t\t\tDAY: '{from|date:EEEE dd MMM yyyy}',\n\t\t},\n\t\tshort: {\n\t\t\tRANGE: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tYEAR: '{from|date:yyyy}',\n\t\t\tSEMESTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tTRIMESTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tQUARTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tMONTH: '{from|date:MMMM}',\n\t\t\tWEEK: 'W{to|isoWeek:1}',\n\t\t\tDAY: '{from|date:EEEE}',\n\t\t},\n\t\tweek: 1,\n\t};\n\n\tvar en_US = {\n\t\tlong: {\n\t\t\tRANGE: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tYEAR: 'Year {from|date:yyyy}',\n\t\t\tSEMESTER: 'Semester {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tTRIMESTER: 'Trimester {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tQUARTER: 'Quarter {from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tMONTH: '{from|date:MMMM yyyy}',\n\t\t\tWEEK: 'Week {from|isoWeek:0}',\n\t\t\tDAY: '{from|date:EEEE MM/dd/yyyy}',\n\t\t},\n\t\tshort: {\n\t\t\tRANGE: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tYEAR: '{from|date:yyyy}',\n\t\t\tSEMESTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tTRIMESTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tQUARTER: '{from|date:MMM yyyy} - {to|date:MMM yyyy}',\n\t\t\tMONTH: '{from|date:MMMM}',\n\t\t\tWEEK: 'W{from|isoWeek:0}',\n\t\t\tDAY: '{from|date:EEEE}',\n\t\t},\n\t\tweek: 0,\n\t};\n\n\tvar formats = it_IT;\n\n\tapp.constant('RangeTypes', {\n\t\tRANGE: 10,\n\t\tYEAR: 11,\n\t\tSEMESTER: 12,\n\t\tTRIMESTER: 13,\n\t\tQUARTER: 14,\n\t\tMONTH: 15,\n\t\tWEEK: 16,\n\t\tDAY: 17,\n\t});\n\n\tapp.factory('Range', ['$filter', 'DateTime', 'RangeTypes', function($filter, DateTime, RangeTypes) {\n\n\t\tfunction Range(options) {\n\t\t\tvar range = this;\n\t\t\trange.from = DateTime.dayLeft();\n\t\t\trange.type = RangeTypes.QUARTER;\n\t\t\tif (options) {\n\t\t\t\tangular.extend(range, options);\n\t\t\t}\n\t\t\trange.setDiff();\n\t\t}\n\n\t\tvar publics = {\n\t\t\tsetYear: setYear,\n\t\t\tsetSemester: setSemester,\n\t\t\tsetTrimester: setTrimester,\n\t\t\tsetQuarter: setQuarter,\n\t\t\tsetMonth: setMonth,\n\t\t\tsetWeek: setWeek,\n\t\t\tsetDay: setDay,\n\t\t\tsetKey: setKey,\n\n\t\t\tprev: prev,\n\t\t\tnext: next,\n\n\t\t\tgetDiff: getDiff,\n\t\t\tgetParams: getParams,\n\t\t\tgetDate: getDate,\n\t\t\tsetDate: setDate,\n\t\t\tsetDiff: setDiff,\n\n\t\t\tset: set,\n\t\t\tis: is,\n\t\t\tisInside: isInside,\n\t\t\tisOutside: isOutside,\n\t\t\tisCurrent: isCurrent,\n\t\t\tisBefore: isBefore,\n\t\t\tisAfter: isAfter,\n\t\t\tequals: equals,\n\n\t\t\teachDay: eachDay,\n\t\t\ttotalDays: totalDays,\n\n\t\t\tgetName: getName,\n\t\t\tgetShortName: getShortName,\n\t\t\ttoString: toString,\n\t\t};\n\n\t\tvar statics = {\n\t\t\t//\n\t\t\tcopy: RangeCopy,\n\t\t\texpand: RangeExpand,\n\t\t\tgetMonth: RangeGetMonth,\n\t\t\taddYear: RangeAddYear,\n\t\t\ttypes: RangeTypes,\n\t\t\t//\n\t\t\tYear: RangeYear,\n\t\t\tSemester: RangeSemester,\n\t\t\tTrimester: RangeTrimester,\n\t\t\tQuarter: RangeQuarter,\n\t\t\tMonth: RangeMonth,\n\t\t\tWeek: RangeWeek,\n\t\t\tDay: RangeDay,\n\t\t\t//\n\t\t\tgetDate: DateTime.getDate,\n\t\t\tgetFullDate: DateTime.getFullDate,\n\t\t\tdateToKey: DateTime.dateToKey,\n\t\t\tkeyToDate: DateTime.keyToDate,\n\t\t\tgetDay: DateTime.getDay,\n\t\t\tgetFullDay: DateTime.getFullDay,\n\t\t\tgetDayByKey: DateTime.getDayByKey,\n\t\t\tgetDayByDate: DateTime.getDayByDate,\n\t\t\ttoday: DateTime.today,\n\t\t\tDateTime: DateTime,\n\t\t};\n\n\t\tangular.extend(Range.prototype, publics);\n\t\tangular.extend(Range, statics);\n\n\t\treturn Range;\n\n\t\t// public methods\n\t\tfunction isInside(date) {\n\t\t\tvar range = this;\n\t\t\treturn !range.isOutside(date);\n\t\t}\n\n\t\tfunction isOutside(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar range = this;\n\t\t\tvar outside = date < range.from || date > range.to;\n\t\t\t// console.log('isOutside', date, range.from, range.to);\n\t\t\treturn outside;\n\t\t}\n\n\t\tfunction isCurrent(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar range = this;\n\t\t\treturn !range.isOutside(date);\n\t\t}\n\n\t\tfunction isBefore(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar range = this;\n\t\t\tvar before = range.to < date;\n\t\t\t// console.log('isBefore', before, range.to, date);\n\t\t\treturn before;\n\t\t}\n\n\t\tfunction isAfter(date) {\n\t\t\tdate = date || new Date();\n\t\t\tvar range = this;\n\t\t\tvar after = range.from > date;\n\t\t\t// console.log('isAfter', after);\n\t\t\treturn after;\n\t\t}\n\n\t\tfunction setDate(date, diff) {\n\t\t\tvar range = this;\n\t\t\tswitch (range.type) {\n\t\t\t\tcase RangeTypes.YEAR:\n\t\t\t\t\trange.setYear(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.SEMESTER:\n\t\t\t\t\trange.setSemester(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.TRIMESTER:\n\t\t\t\t\trange.setTrimester(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.QUARTER:\n\t\t\t\t\trange.setQuarter(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.MONTH:\n\t\t\t\t\trange.setMonth(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.WEEK:\n\t\t\t\t\trange.setWeek(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.DAY:\n\t\t\t\t\trange.setDay(date, diff);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction getDate(diff) {\n\t\t\tdiff = diff || 0;\n\t\t\tvar range = this;\n\t\t\tvar date = new Date(range.from);\n\t\t\tswitch (range.type) {\n\t\t\t\tcase RangeTypes.YEAR:\n\t\t\t\t\tdate = new Date(date.setFullYear(date.getFullYear() + diff));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.SEMESTER:\n\t\t\t\t\tdate = new Date(date.setMonth(date.getMonth() + diff * 6));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.TRIMESTER:\n\t\t\t\t\tdate = new Date(date.setMonth(date.getMonth() + diff * 4));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.QUARTER:\n\t\t\t\t\tdate = new Date(date.setMonth(date.getMonth() + diff * 3));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.MONTH:\n\t\t\t\t\tdate = new Date(date.setMonth(date.getMonth() + diff));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.WEEK:\n\t\t\t\t\tdate = new Date(date.setDate(date.getDate() + diff * 7));\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.DAY:\n\t\t\t\t\tdate = new Date(date.setDate(date.getDate() + diff));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn date;\n\t\t}\n\n\t\tfunction getDiff(diff) {\n\t\t\tvar range = this;\n\t\t\treturn new Range({\n\t\t\t\ttype: range.type,\n\t\t\t}).setDate(range.from).setDiff(diff);\n\t\t}\n\n\t\tfunction getParams() {\n\t\t\treturn {\n\t\t\t\tdateFrom: new Date(this.from),\n\t\t\t\tdateTo: new Date(this.to),\n\t\t\t};\n\t\t}\n\n\t\tfunction setYear(date, diff, size, step) {\n\t\t\tvar range = this;\n\t\t\trange.from = DateTime.getYearLeft(date, diff, size, step);\n\t\t\trange.to = DateTime.getYearRight(date, diff, size, step);\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction setSemester(date, diff, size) {\n\t\t\treturn this.setMonth(date, diff, size, 6);\n\t\t}\n\n\t\tfunction setTrimester(date, diff, size) {\n\t\t\treturn this.setMonth(date, diff, size, 4);\n\t\t}\n\n\t\tfunction setQuarter(date, diff, size) {\n\t\t\treturn this.setMonth(date, diff, size, 3);\n\t\t}\n\n\t\tfunction setMonth(date, diff, size, step) {\n\t\t\tvar range = this;\n\t\t\trange.from = DateTime.getMonthLeft(date, diff, size, step);\n\t\t\trange.to = DateTime.getMonthRight(date, diff, size, step);\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction setWeek(date, diff, size, step) {\n\t\t\tvar range = this;\n\t\t\trange.from = DateTime.getWeekLeft(date, diff, size, step);\n\t\t\trange.to = DateTime.getWeekRight(date, diff, size, step);\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction setDay(date, diff, size, step) {\n\t\t\tvar range = this;\n\t\t\trange.from = DateTime.getDayLeft(date, diff, size, step);\n\t\t\trange.to = DateTime.getDayRight(date, diff, size, step);\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction setKey(key, diff, size, step) {\n\t\t\treturn this.setDay(DateTime.keyToDate(key), diff, size, step);\n\t\t}\n\n\t\tfunction prev() {\n\t\t\treturn this.setDiff(-1);\n\t\t}\n\n\t\tfunction next() {\n\t\t\treturn this.setDiff(1);\n\t\t}\n\n\t\tfunction setDiff(diff) {\n\t\t\tvar range = this;\n\t\t\tswitch (range.type) {\n\t\t\t\tcase RangeTypes.YEAR:\n\t\t\t\t\trange.setYear(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.SEMESTER:\n\t\t\t\t\trange.setSemester(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.TRIMESTER:\n\t\t\t\t\trange.setTrimester(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.QUARTER:\n\t\t\t\t\trange.setQuarter(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.MONTH:\n\t\t\t\t\trange.setMonth(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.WEEK:\n\t\t\t\t\trange.setWeek(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t\tcase RangeTypes.DAY:\n\t\t\t\t\trange.setDay(range.from, diff);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction set(filters, source) {\n\t\t\tvar range = this;\n\t\t\tfilters.dateFrom = range.from;\n\t\t\tfilters.dateTo = range.to;\n\t\t\tif (source) {\n\t\t\t\tsource.setDates(filters.dateFrom, filters.dateTo);\n\t\t\t}\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction is(filters) {\n\t\t\tvar range = this,\n\t\t\t\tflag = false;\n\t\t\tif (filters.dateFrom && filters.dateTo) {\n\t\t\t\tflag = filters.dateFrom.getTime() == range.from.getTime() && filters.dateTo.getTime() == range.to.getTime();\n\t\t\t}\n\t\t\treturn flag;\n\t\t}\n\n\t\tfunction equals(r) {\n\t\t\tvar range = this;\n\t\t\treturn r && DateTime.dateToKey(r.from) === DateTime.dateToKey(range.from) && DateTime.dateToKey(r.to) === DateTime.dateToKey(range.to);\n\t\t}\n\n\t\tfunction eachDay(callback) {\n\t\t\tvar range = this;\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\treturn range;\n\t\t\t}\n\t\t\tvar fromKey = DateTime.dateToKey(range.from);\n\t\t\tvar toKey = DateTime.dateToKey(range.to);\n\t\t\twhile (fromKey <= toKey) {\n\t\t\t\tcallback(DateTime.getDayByKey(fromKey, formats.week));\n\t\t\t\tfromKey++;\n\t\t\t}\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction totalDays() {\n\t\t\tvar range = this;\n\t\t\tvar fromKey = DateTime.dateToKey(range.from);\n\t\t\tvar toKey = DateTime.dateToKey(range.to);\n\t\t\treturn toKey - fromKey + 1;\n\t\t}\n\n\t\tfunction getName() {\n\t\t\tvar range = this;\n\t\t\tvar key = RangeExtract(RangeTypes, range.type);\n\t\t\treturn RangeFormat(range, formats.long[key]);\n\t\t}\n\n\t\tfunction getShortName() {\n\t\t\tvar range = this;\n\t\t\tvar key = RangeExtract(RangeTypes, range.type);\n\t\t\treturn RangeFormat(range, formats.short[key]);\n\t\t}\n\n\t\tfunction toString() {\n\t\t\tvar range = this;\n\t\t\treturn '[' +\n\t\t\t\t$filter('date')(range.from, 'MMM dd yyyy HH:mm:ss.sss') + ', ' +\n\t\t\t\t$filter('date')(range.to, 'MMM dd yyyy HH:mm:ss.sss') +\n\t\t\t\t'] \\'' + range.getName() + '\\'';\n\t\t}\n\n\t\t// static methods\n\t\tfunction RangeCopy($range) {\n\t\t\tvar range = new Range($range);\n\t\t\trange.from = new Date($range.from);\n\t\t\trange.to = new Date($range.to);\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction RangeExpand(range, time) {\n\t\t\trange = RangeCopy(range);\n\t\t\trange.from = new Date(range.from.getTime() - time);\n\t\t\trange.to = new Date(range.to.getTime() + time);\n\t\t\t// console.log('RangeExpand', range.toString());\n\t\t\treturn range;\n\t\t}\n\n\t\tfunction RangeGetMonth(date) {\n\t\t\tif (!date) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tdate = new Date(date);\n\t\t\tdate.setDate(1);\n\t\t\tdate.setHours(0, 0, 0, 0);\n\t\t\treturn date.getTime();\n\t\t}\n\n\t\tfunction RangeAddYear(date, years) {\n\t\t\tif (!date) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tdate = new Date(date);\n\t\t\treturn new Date(date.setFullYear(date.getFullYear() + years));\n\t\t}\n\n\t\tfunction RangeYear() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.YEAR\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeSemester() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.SEMESTER\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeTrimester() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.TRIMESTER\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeQuarter() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.QUARTER\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeMonth() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.MONTH\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeWeek() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.WEEK\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeDay() {\n\t\t\treturn new Range({\n\t\t\t\ttype: RangeTypes.DAY\n\t\t\t});\n\t\t}\n\n\t\tfunction RangeFormat(range, format) {\n\t\t\tvar name = format;\n\t\t\tname = name.replace(/{(.*?)}/g, function(replaced, token) {\n\t\t\t\tvar a = token.split('|');\n\t\t\t\tvar p = a.shift();\n\t\t\t\tvar f = a.join(''),\n\t\t\t\t\tj;\n\t\t\t\tif (f.indexOf(':') !== -1) {\n\t\t\t\t\tf = f.split(':');\n\t\t\t\t\tj = f.length ? f.pop() : null;\n\t\t\t\t\tf = f.join('');\n\t\t\t\t}\n\t\t\t\t// console.log(token, f, p, j);\n\t\t\t\treturn f.length ? $filter(f)(range[p], j) : range[p];\n\t\t\t});\n\t\t\t// console.log(name);\n\t\t\treturn name;\n\t\t}\n\n\t\tfunction RangeExtract(obj, value) {\n\t\t\treturn Object.keys(obj)[Object.values(obj).indexOf(value)];\n\t\t}\n\n    }]);\n\n\t(function() {\n\t\t// POLYFILL Object.values\n\t\tif (typeof Object.values !== 'function') {\n\t\t\tObject.defineProperty(Object, 'values', {\n\t\t\t\tvalue: function(obj) {\n\t\t\t\t\tvar vals = [];\n\t\t\t\t\tfor (var key in obj) {\n\t\t\t\t\t\tif (has(obj, key) && isEnumerable(obj, key)) {\n\t\t\t\t\t\t\tvals.push(obj[key]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn vals;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}());\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\t/*\n\tapp.value('now', null);\n\t*/\n\n\tapp.value('$formats', {\n\t\tjust_now: 'just now',\n\t\tseconds_ago: '{{num}} seconds ago',\n\t\ta_minute_ago: 'a minute ago',\n\t\tminutes_ago: '{{num}} minutes ago',\n\t\tan_hour_ago: 'an hour ago',\n\t\thours_ago: '{{num}} hours ago',\n\t\ta_day_ago: 'yesterday',\n\t\tdays_ago: '{{num}} days ago',\n\t\ta_week_ago: 'a week ago',\n\t\tweeks_ago: '{{num}} weeks ago',\n\t\ta_month_ago: 'a month ago',\n\t\tmonths_ago: '{{num}} months ago',\n\t\ta_year_ago: 'a year ago',\n\t\tyears_ago: '{{num}} years ago',\n\t\tover_a_year_ago: 'over a year ago',\n\t\tseconds_from_now: '{{num}} seconds from now',\n\t\ta_minute_from_now: 'a minute from now',\n\t\tminutes_from_now: '{{num}} minutes from now',\n\t\tan_hour_from_now: 'an hour from now',\n\t\thours_from_now: '{{num}} hours from now',\n\t\ta_day_from_now: 'tomorrow',\n\t\tdays_from_now: '{{num}} days from now',\n\t\ta_week_from_now: 'a week from now',\n\t\tweeks_from_now: '{{num}} weeks from now',\n\t\ta_month_from_now: 'a month from now',\n\t\tmonths_from_now: '{{num}} months from now',\n\t\ta_year_from_now: 'a year from now',\n\t\tyears_from_now: '{{num}} years from now',\n\t\tover_a_year_from_now: 'over a year from now'\n\t});\n\n\tapp.filter('dateRelative', ['$rootScope', '$interval', '$injector', '$formats', function($rootScope, $interval, $injector, $formats) {\n\n\t\tvar minute = 60;\n\t\tvar hour = minute * 60;\n\t\tvar day = hour * 24;\n\t\tvar week = day * 7;\n\t\tvar month = day * 30;\n\t\tvar year = day * 365;\n\n\t\tvar $format = getFormat();\n\n\t\tfunction getFormat() {\n\t\t\tif ($injector.has('$format')) {\n\t\t\t\treturn $injector.get('$format');\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\tinstant: function(id, params) {\n\t\t\t\t\t\treturn $formats[id].replace('{{num}}', params.num);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tfunction getDelta(now, date) {\n\t\t\treturn Math.round(Math.abs(now - date) / 1000);\n\t\t}\n\t\t/*\n        $interval(function () {\n            $rootScope.$now = new Date();\n            console.log($rootScope.$now);\n        }, 3 * 1000);\n\t\t*/\n\t\treturn function(date) {\n\t\t\tif (!(date instanceof Date)) {\n\t\t\t\tdate = new Date(date);\n\t\t\t}\n\n\t\t\t// now = now || new Date();\n\t\t\tvar now = new Date();\n\n\t\t\tvar delta = getDelta(now, date);\n\n\t\t\tif (delta > day && delta < week) {\n\t\t\t\tdate = new Date(date.getFullYear(), date.getMonth(), date.getDate(), 0, 0, 0, 0);\n\t\t\t\tdelta = getDelta(now, date);\n\t\t\t}\n\n\t\t\tvar suffix = now >= date ? '_ago' : '_from_now';\n\n\t\t\tfunction format(key, num) {\n\t\t\t\treturn $format.instant(key + (delta > 30 ? suffix : ''), {\n\t\t\t\t\tnum: num\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconsole.log('delta', delta, now, date);\n\n\t\t\tif (delta < 30) {\n\t\t\t\treturn format('just_now');\n\n\t\t\t} else if (delta < minute) {\n\t\t\t\treturn format('seconds', delta);\n\n\t\t\t} else if (delta < 2 * minute) {\n\t\t\t\treturn format('a_minute');\n\n\t\t\t} else if (delta < hour) {\n\t\t\t\treturn format('minutes', Math.floor(delta / minute));\n\n\t\t\t} else if (delta < hour * 2) {\n\t\t\t\treturn format('an_hour');\n\n\t\t\t} else if (delta < day) {\n\t\t\t\treturn format('hours', Math.floor(delta / hour));\n\n\t\t\t} else if (delta < day * 2) {\n\t\t\t\treturn format('a_day');\n\n\t\t\t} else if (delta < week) {\n\t\t\t\treturn format('days', Math.floor(delta / day));\n\n\t\t\t} else if (Math.floor(delta / week) !== 1) {\n\t\t\t\treturn format('a_week');\n\n\t\t\t} else if (delta < month) {\n\t\t\t\treturn format('weeks', Math.floor(delta / week));\n\n\t\t\t} else if (Math.floor(delta / month) !== 1) {\n\t\t\t\treturn format('a_month');\n\n\t\t\t} else if (delta < year) {\n\t\t\t\treturn format('months', Math.floor(delta / month));\n\n\t\t\t} else if (Math.floor(delta / year) !== 1) {\n\t\t\t\treturn format('a_year');\n\n\t\t\t} else {\n\t\t\t\treturn format('over_a_year');\n\n\t\t\t}\n\n\t\t};\n    }]);\n\n\tapp.directive('dateRelative', ['$parse', '$filter', '$interval', function($parse, $filter, $interval) {\n\t\treturn {\n\t\t\tpriority: 1001,\n\t\t\trestrict: 'A',\n\t\t\tlink: function(scope, element, attributes, model) {\n\n\t\t\t\tfunction setDate() {\n\t\t\t\t\tvar date = $parse(attributes.dateRelative)(scope);\n\t\t\t\t\tvar relative = $filter('dateRelative')(date);\n\t\t\t\t\telement[0].innerHTML = relative;\n\t\t\t\t\t// console.log('dateRelative.setDate', relative);\n\t\t\t\t}\n\n\t\t\t\tsetDate();\n\n\t\t\t\tvar i = setInterval(setDate, 60 * 1000);\n\n\t\t\t\tscope.$on('$destroy', function() {\n\t\t\t\t\tcancelInterval(i);\n\t\t\t\t});\n\n\t\t\t}\n\t\t};\n\t}]);\n\n\t// directive dateRelative -> apply filter every timeout\n\n\t/*\n\tmyApp.config(function ($translateProvider) {\n\t    $translateProvider.translations('en', {\n\t        just_now: 'just now',\n\t        seconds_ago: '{{time}} seconds ago',\n\t    });\n\n\t    $translateProvider.translations('de', {\n\t        just_now: 'soeben',\n\t        seconds_ago: 'vor {{time}} stunden',\n\t    });\n\n\t    $translateProvider.preferredLanguage('en');\n\t});\n\t*/\n\n}());\n\n/*\n// handle transition on resizing\nvar resizingTimeout;\n$(window).on('resize', function () {\n    clearTimeout(resizingTimeout);\n    $('body').addClass('resizing');\n    resizingTimeout = setTimeout(function () {\n        $('body').removeClass('resizing');\n    }, 100);\n})\n*/\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Dom', ['Point', 'Rect', function(Point, Rect) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tgetBoundRect: getBoundRect,\n\t\t\tgetClosest: getClosest,\n\t\t\tgetClosestNode: getClosestNode,\n\t\t\tgetDelta: getDelta,\n\t\t\tgetDocumentNode: getDocumentNode,\n\t\t\tgetElement: getElement,\n\t\t\tgetNode: getNode,\n\t\t\tgetNodeOffset: getNodeOffset,\n\t\t\tgetPageScroll: getPageScroll,\n\t\t\tgetParents: getParents,\n\t\t\tgetView: getView,\n\t\t\tgetPointInView: getPointInView,\n\t\t\tcompileController: compileController,\n\t\t\tdownloadFile: downloadFile,\n\t\t\tua: getUA(),\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// return node element BoundingClientRect\n\t\tfunction getBoundRect(node) {\n\t\t\tnode = getNode(node);\n\t\t\tif (node === window) {\n\t\t\t\tnode = getDocumentNode();\n\t\t\t}\n\t\t\tvar rect = node.getBoundingClientRect();\n\t\t\treturn rect;\n\t\t}\n\n\t\t// return closest parent node that match a selector\n\t\tfunction getClosest(node, selector) {\n\t\t\tvar matchesFn, parent;\n            ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'].some(function(fn) {\n\t\t\t\tif (typeof document.body[fn] == 'function') {\n\t\t\t\t\tmatchesFn = fn;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\tif (node[matchesFn](selector)) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t\twhile (node !== null) {\n\t\t\t\tparent = node.parentElement;\n\t\t\t\tif (parent !== null && parent[matchesFn](selector)) {\n\t\t\t\t\treturn parent;\n\t\t\t\t}\n\t\t\t\tnode = parent;\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\t// return closest parent node that math a target node\n\t\tfunction getClosestNode(node, target) {\n\t\t\tvar parent = null;\n\t\t\tif (node === target) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t\twhile (node !== null) {\n\t\t\t\tparent = node.parentElement;\n\t\t\t\tif (parent !== null && parent === target) {\n\t\t\t\t\treturn parent;\n\t\t\t\t}\n\t\t\t\tnode = parent;\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\t// return wheel delta\n\t\tfunction getDelta(event) {\n\t\t\tvar original = event.originalEvent ? event.originalEvent : event;\n\t\t\tvar type = original.type;\n\t\t\tvar delta = null;\n\t\t\tif (type === 'wheel' || type === 'mousewheel' || type === 'DOMMouseScroll') {\n\t\t\t\tvar deltaX = original.deltaX || original.wheelDeltaX;\n\t\t\t\tvar deltaY = original.deltaY || original.wheelDeltaY;\n\t\t\t\tdelta = new Point(deltaX, deltaY);\n\t\t\t\tif (Math.abs(deltaX) > Math.abs(deltaY)) {\n\t\t\t\t\tdelta.dir = deltaX < 0 ? 1 : -1;\n\t\t\t\t} else {\n\t\t\t\t\tdelta.dir = deltaY < 0 ? 1 : -1;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn delta;\n\t\t}\n\n\t\t// return document element node\n\t\tfunction getDocumentNode() {\n\t\t\tvar documentNode = (document.documentElement || document.body.parentNode || document.body);\n\t\t\treturn documentNode;\n\t\t}\n\n\t\t// return an angular element\n\t\tfunction getElement(element) {\n\t\t\treturn angular.isArray(element) ? element : angular.element(element);\n\t\t}\n\n\t\t// return a native html node\n\t\tfunction getNode(element) {\n\t\t\treturn angular.isArray(element) ? element[0] : element;\n\t\t}\n\n\t\t// return a node offset point\n\t\tfunction getNodeOffset(node) {\n\t\t\tvar offset = new Point();\n\t\t\tnode = getNode(node);\n\t\t\tif (node && node.nodeType === 1) {\n\t\t\t\toffset.x = node.offsetLeft;\n\t\t\t\toffset.y = node.offsetTop;\n\t\t\t}\n\t\t\treturn offset;\n\t\t}\n\n\t\t// return the current page scroll\n\t\tfunction getPageScroll() {\n\t\t\tvar scroll = new Point();\n\t\t\tvar documentNode = getDocumentNode();\n\t\t\tscroll.x = window.pageXOffset || documentNode.scrollLeft;\n\t\t\tscroll.y = window.pageYOffset || documentNode.scrollTop;\n\t\t\treturn scroll;\n\t\t}\n\n\t\t// return an array of node parants\n\t\tfunction getParents(node, topParentNode) {\n\t\t\t// if no topParentNode defined will bubble up all the way to *document*\n\t\t\ttopParentNode = topParentNode || getDocumentNode();\n\t\t\tvar parents = [];\n\t\t\tif (node) {\n\t\t\t\tparents.push(node);\n\t\t\t\tvar parentNode = node.parentNode;\n\t\t\t\twhile (parentNode && parentNode !== topParentNode) {\n\t\t\t\t\tparents.push(parentNode);\n\t\t\t\t\tparentNode = parentNode.parentNode;\n\t\t\t\t}\n\t\t\t\tparents.push(topParentNode); // push that topParentNode you wanted to stop at\n\t\t\t}\n\t\t\tparents.each = function(callback) {\n\t\t\t\tthis.filter(function(node) {\n\t\t\t\t\tif (callback) {\n\t\t\t\t\t\tcallback(angular.element(node), node);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn parents;\n\t\t}\n\n\t\t// return the view rect\n\t\tfunction getView() {\n\t\t\tvar view = new Rect();\n\t\t\tif (window.innerWidth !== undefined) {\n\t\t\t\tview.width = window.innerWidth;\n\t\t\t\tview.height = window.innerHeight;\n\t\t\t} else {\n\t\t\t\tvar documentNode = getDocumentNode();\n\t\t\t\tview.width = documentNode.clientWidth;\n\t\t\t\tview.height = documentNode.clientHeight;\n\t\t\t}\n\t\t\treturn view;\n\t\t}\n\n\t\t// add to constant\n\t\tvar MOUSE_EVENTS = ['click', 'mousedown', 'mouseup', 'mousemove', 'mouseover', 'mouseout', 'mouseenter', 'mouseleave', 'contextmenu'];\n\t\tvar TOUCH_EVENTS = ['touchstart', 'touchmove', 'touchend', 'touchcancel'];\n\n\t\tfunction getPointInView(event) {\n\t\t\tvar original = event.originalEvent ? event.originalEvent : event;\n\t\t\tvar type = original.type;\n\t\t\tvar point = null;\n\t\t\tif (TOUCH_EVENTS.indexOf(type) !== -1) {\n\t\t\t\tvar touch = null;\n\t\t\t\tvar touches = original.touches.length ? original.touches : original.changedTouches;\n\t\t\t\tif (touches && touches.length) {\n\t\t\t\t\ttouch = touches[0];\n\t\t\t\t}\n\t\t\t\tif (touch) {\n\t\t\t\t\tpoint = new Point();\n\t\t\t\t\tpoint.x = touch.pageX;\n\t\t\t\t\tpoint.y = touch.pageY;\n\t\t\t\t}\n\t\t\t} else if (MOUSE_EVENTS.indexOf(type) !== -1) {\n\t\t\t\tpoint = new Point();\n\t\t\t\tpoint.x = original.pageX;\n\t\t\t\tpoint.y = original.pageY;\n\t\t\t}\n\t\t\treturn point;\n\t\t}\n\n\t\tfunction getUA() {\n\t\t\tvar agent = window.navigator.userAgent.toLowerCase();\n\t\t\tvar safari = agent.indexOf('safari') !== -1 && agent.indexOf('chrome') === -1;\n\t\t\tvar msie = agent.indexOf('trident') !== -1 || agent.indexOf('edge') !== -1 || agent.indexOf('msie') !== -1;\n\t\t\tvar chrome = !safari && !msie && agent.indexOf('chrome') !== -1;\n\t\t\tvar mobile = agent.indexOf('mobile') !== -1;\n\t\t\tvar mac = agent.indexOf('macintosh') !== -1;\n\t\t\tvar ua = {\n\t\t\t\tagent: agent,\n\t\t\t\tsafari: safari,\n\t\t\t\tmsie: msie,\n\t\t\t\tchrome: chrome,\n\t\t\t\tmobile: mobile,\n\t\t\t\tmac: mac,\n\t\t\t};\n\t\t\tangular.forEach(ua, function(value, key) {\n\t\t\t\tif (value) {\n\t\t\t\t\tangular.element(document.getElementsByTagName('body')).addClass(key);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn ua;\n\t\t}\n\n\t\t/*\n    function mobilecheck() {\n        var check = false;\n        (function(a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || window.opera);\n        return check;\n    }\n\n    // For those wishing to include tablets in this test (though arguably, you shouldn't), you can use the following function:\n    function mobileAndTabletcheck() {\n        var check = false;\n        (function(a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || window.opera);\n        return check;\n    }\n\n    var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n    var isMobile = mobilecheck();\n    var isMobileAndTabled = mobileAndTabletcheck();\n\t\t*/\n\n\t\tfunction compileController(scope, element, html, data) {\n\t\t\t// console.log('Dom.compileController', element);\n\t\t\telement = getElement(element);\n\t\t\telement.html(html);\n\t\t\tvar link = $compile(element.contents());\n\t\t\tif (data.controller) {\n\t\t\t\tvar $scope = scope.$new();\n\t\t\t\tangular.extend($scope, data);\n\t\t\t\tvar controller = $controller(data.controller, {\n\t\t\t\t\t$scope: $scope\n\t\t\t\t});\n\t\t\t\tif (data.controllerAs) {\n\t\t\t\t\tscope[data.controllerAs] = controller;\n\t\t\t\t}\n\t\t\t\telement.data('$ngControllerController', controller);\n\t\t\t\telement.children().data('$ngControllerController', controller);\n\t\t\t\tscope = $scope;\n\t\t\t}\n\t\t\tlink(scope);\n\t\t}\n\n\t\tfunction downloadFile(content, name, type) {\n\t\t\ttype = type || 'application/octet-stream';\n\t\t\tvar base64 = null;\n\t\t\tvar blob = new Blob([content], {\n\t\t\t\ttype: type\n\t\t\t});\n\t\t\tvar reader = new window.FileReader();\n\t\t\treader.readAsDataURL(blob);\n\t\t\treader.onloadend = function() {\n\t\t\t\tbase64 = reader.result;\n\t\t\t\tdownload();\n\t\t\t};\n\n\t\t\tfunction download() {\n\t\t\t\tif (document.createEvent) {\n\t\t\t\t\tvar anchor = document.createElement('a');\n\t\t\t\t\tanchor.href = base64;\n\t\t\t\t\tif (anchor.download !== undefined) {\n\t\t\t\t\t\tvar downloadName = name || base64.substring(base64.lastIndexOf('/') + 1, base64.length);\n\t\t\t\t\t\tanchor.download = downloadName;\n\t\t\t\t\t}\n\t\t\t\t\tvar event = document.createEvent('MouseEvents');\n\t\t\t\t\tevent.initEvent('click', true, true);\n\t\t\t\t\tanchor.dispatchEvent(event);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tvar query = '?download';\n\t\t\t\twindow.open(base64.indexOf('?') > -1 ? base64 : base64 + query, '_self');\n\t\t\t}\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Event', ['EventsService', 'Dom', 'Point', 'Rect', function(EventsService, Dom, Point, Rect) {\n\n\t\tfunction Event(event, element) {\n\t\t\ttry {\n\t\t\t\tevent = event || window.event;\n\t\t\t\tvar type = event.type;\n\t\t\t\tvar originalEvent = event.originalEvent ? event.originalEvent : event;\n\t\t\t\tvar node = element[0]; // Dom.getNode(element);\n\t\t\t\tvar offset = Dom.getNodeOffset(node);\n\t\t\t\tvar rect = Dom.getBoundRect(node);\n\t\t\t\tvar view = Dom.getView();\n\t\t\t\tvar scroll = Dom.getPageScroll();\n\t\t\t\tvar point = Dom.getPointInView(event);\n\t\t\t\tif (point) {\n\t\t\t\t\tvar absolute = new Point(point.x - scroll.x, point.y - scroll.y);\n\t\t\t\t\tvar relative = new Point(absolute.x - rect.left, absolute.y - rect.top);\n\t\t\t\t\tthis.point = point;\n\t\t\t\t\tthis.absolute = absolute;\n\t\t\t\t\tthis.relative = relative;\n\t\t\t\t}\n\t\t\t\tvar delta = Dom.getDelta(event);\n\t\t\t\tif (delta) {\n\t\t\t\t\tthis.delta = delta;\n\t\t\t\t\tthis.dir = delta.dir;\n\t\t\t\t}\n\t\t\t\tthis.event = event;\n\t\t\t\tthis.type = type;\n\t\t\t\tthis.originalEvent = originalEvent;\n\t\t\t\tthis.element = element;\n\t\t\t\tthis.node = node;\n\t\t\t\tthis.offset = offset;\n\t\t\t\tthis.rect = rect;\n\t\t\t\tthis.view = view;\n\t\t\t\tthis.scroll = scroll;\n\t\t\t\tthis.timestamp = new Date().getTime();\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log('Event.error', error);\n\t\t\t}\n\t\t}\n\n\t\tvar statics = {};\n\n\t\tvar publics = {\n\t\t\tstop: stop,\n\t\t};\n\n\t\tangular.extend(Event, statics);\n\t\tangular.extend(Event.prototype, publics);\n\t\treturn Event;\n\n\t\t// prototype methods\n\n\t\tfunction stop() {\n\t\t\tthis.event.stopPropagation();\n\t\t\tthis.event.preventDefault();\n\t\t}\n\n\t}]);\n\n\tapp.factory('Events', ['EventsService', 'Event', 'Dom', function(EventsService, Event, Dom) {\n\n\t\tfunction Events(element) {\n\t\t\tvar events = this;\n\n\t\t\tthis.element = Dom.getElement(element);\n\t\t\tthis.listeners = {};\n\t\t\tthis.standardEvents = {\n\t\t\t\tclick: {\n\t\t\t\t\tkey: 'click',\n\t\t\t\t\tcallback: onClick\n\t\t\t\t},\n\t\t\t\tdown: {\n\t\t\t\t\tkey: 'mousedown',\n\t\t\t\t\tcallback: onMouseDown\n\t\t\t\t},\n\t\t\t\tmove: {\n\t\t\t\t\tkey: 'mousemove',\n\t\t\t\t\tcallback: onMouseMove\n\t\t\t\t},\n\t\t\t\tup: {\n\t\t\t\t\tkey: 'mouseup',\n\t\t\t\t\tcallback: onMouseUp\n\t\t\t\t},\n\t\t\t\tresize: {\n\t\t\t\t\tkey: 'resize',\n\t\t\t\t\tcallback: onResize\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.touchEvents = {\n\t\t\t\tdown: {\n\t\t\t\t\tkey: 'touchstart',\n\t\t\t\t\tcallback: onTouchStart\n\t\t\t\t},\n\t\t\t\tmove: {\n\t\t\t\t\tkey: 'touchmove',\n\t\t\t\t\tcallback: onTouchMove\n\t\t\t\t},\n\t\t\t\tup: {\n\t\t\t\t\tkey: 'touchend',\n\t\t\t\t\tcallback: onTouchEnd\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.wheelEvents = {\n\t\t\t\twheel: {\n\t\t\t\t\tkey: 'mousewheel',\n\t\t\t\t\tcallback: onMouseWheel\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.scrollEvents = {\n\t\t\t\twheel: {\n\t\t\t\t\tkey: 'DOMMouseScroll',\n\t\t\t\t\tcallback: onMouseScroll\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.timestamp = new Date().getTime();\n\t\t\tthis.setTimestamp = setTimestamp;\n\n\t\t\tfunction setTimestamp(event) {\n\t\t\t\tif (event) {\n\t\t\t\t\tevent.interval = Math.min(250, event.timestamp - events.timestamp);\n\t\t\t\t\t// console.log(event.interval, event.timestamp, events.timestamp);\n\t\t\t\t}\n\t\t\t\tevents.timestamp = new Date().getTime();\n\t\t\t}\n\n\t\t\tfunction onClick(e) {\n\t\t\t\t// console.log('onClick', e, events);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.click.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onMouseDown(e) {\n\t\t\t\t// console.log('onMouseDown', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.down.apply(this, [event]);\n\t\t\t\tevents.removeTouchEvents();\n\t\t\t}\n\n\t\t\tfunction onMouseMove(e) {\n\t\t\t\t// console.log('onMouseMove', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.move.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onMouseUp(e) {\n\t\t\t\t// console.log('onMouseUp', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.up.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onMouseWheel(e) {\n\t\t\t\t// console.log('onMouseWheel', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.wheel.apply(this, [event]);\n\t\t\t\tevents.removeScrollEvents();\n\t\t\t}\n\n\t\t\tfunction onMouseScroll(e) {\n\t\t\t\t// console.log('onMouseScroll', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.wheel.apply(this, [event]);\n\t\t\t\tevents.removeWheelEvents();\n\t\t\t}\n\n\t\t\tfunction onResize(e) {\n\t\t\t\t// console.log('onResize', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.resize.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onTouchStart(e) {\n\t\t\t\t// console.log('onTouchStart', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.down.apply(this, [event]);\n\t\t\t\tevents.removeStandardEvents();\n\t\t\t}\n\n\t\t\tfunction onTouchMove(e) {\n\t\t\t\t// console.log('onTouchMove', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.move.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onTouchEnd(e) {\n\t\t\t\t// console.log('onTouchEnd', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.up.apply(this, [event]);\n\t\t\t}\n\t\t}\n\n\t\tvar statics = {\n\t\t\tgetTouch: getTouch,\n\t\t\tgetRelativeTouch: getRelativeTouch,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tadd: add,\n\t\t\tremove: remove,\n\t\t\tremoveStandardEvents: removeStandardEvents,\n\t\t\tremoveTouchEvents: removeTouchEvents,\n\t\t\tremoveWheelEvents: removeWheelEvents,\n\t\t\tremoveScrollEvents: removeScrollEvents,\n\t\t};\n\n\t\tangular.extend(Events, statics);\n\t\tangular.extend(Events.prototype, publics);\n\t\treturn Events;\n\n\t\t// prototype methods\n\n\t\tfunction add(listeners, scope) {\n\t\t\tvar events = this,\n\t\t\t\tstandard = this.standardEvents,\n\t\t\t\ttouch = this.touchEvents,\n\t\t\t\twheel = this.wheelEvents,\n\t\t\t\tscroll = this.scrollEvents;\n\t\t\tvar element = this.element,\n\t\t\t\twindowElement = angular.element(window);\n\n\t\t\tangular.forEach(listeners, function(callback, key) {\n\t\t\t\tif (events.listeners[key]) {\n\t\t\t\t\tvar listener = {};\n\t\t\t\t\tlistener[key] = events.listeners[key];\n\t\t\t\t\tremove(listener);\n\t\t\t\t}\n\t\t\t\tevents.listeners[key] = callback;\n\t\t\t\tif (standard[key]) {\n\t\t\t\t\tif (key === 'resize') {\n\t\t\t\t\t\twindowElement.on(standard[key].key, standard[key].callback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.on(standard[key].key, standard[key].callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (touch[key]) {\n\t\t\t\t\telement.on(touch[key].key, touch[key].callback);\n\t\t\t\t}\n\t\t\t\tif (wheel[key]) {\n\t\t\t\t\telement.on(wheel[key].key, wheel[key].callback);\n\t\t\t\t}\n\t\t\t\tif (scroll[key]) {\n\t\t\t\t\telement.on(scroll[key].key, scroll[key].callback);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (scope) {\n\t\t\t\tscope.$on('$destroy', function() {\n\t\t\t\t\tevents.remove(listeners);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn events;\n\t\t}\n\n\t\tfunction remove(listeners) {\n\t\t\tvar events = this,\n\t\t\t\tstandard = this.standardEvents,\n\t\t\t\ttouch = this.touchEvents,\n\t\t\t\twheel = this.wheelEvents,\n\t\t\t\tscroll = this.scrollEvents;\n\t\t\tvar element = this.element,\n\t\t\t\twindowElement = angular.element(window);\n\t\t\tangular.forEach(listeners, function(callback, key) {\n\t\t\t\tif (standard[key]) {\n\t\t\t\t\tif (key === 'resize') {\n\t\t\t\t\t\twindowElement.off(standard[key].key, standard[key].callback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.off(standard[key].key, standard[key].callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (touch[key]) {\n\t\t\t\t\telement.off(touch[key].key, touch[key].callback);\n\t\t\t\t}\n\t\t\t\tif (wheel[key]) {\n\t\t\t\t\telement.off(wheel[key].key, wheel[key].callback);\n\t\t\t\t}\n\t\t\t\tif (scroll[key]) {\n\t\t\t\t\telement.off(scroll[key].key, scroll[key].callback);\n\t\t\t\t}\n\t\t\t\tevents.listeners[key] = null;\n\t\t\t});\n\t\t\treturn events;\n\t\t}\n\n\t\tfunction removeStandardEvents() {\n\t\t\tvar events = this,\n\t\t\t\tstandard = events.standardEvents,\n\t\t\t\ttouch = events.touchEvents;\n\t\t\tvar element = events.element;\n\t\t\telement.off('mousedown', standard.down.callback);\n\t\t\telement.off('mousemove', standard.move.callback);\n\t\t\telement.off('mouseup', standard.up.callback);\n\t\t}\n\n\t\tfunction removeTouchEvents() {\n\t\t\tvar events = this,\n\t\t\t\tstandard = events.standardEvents,\n\t\t\t\ttouch = events.touchEvents;\n\t\t\tvar element = events.element;\n\t\t\telement.off('touchstart', touch.down.callback);\n\t\t\telement.off('touchmove', touch.move.callback);\n\t\t\telement.off('touchend', touch.up.callback);\n\t\t}\n\n\t\tfunction removeWheelEvents() {\n\t\t\tvar events = this;\n\t\t\tvar element = events.element;\n\t\t\telement.off('mousewheel', events.mouseEvents.wheel.callback);\n\t\t}\n\n\t\tfunction removeScrollEvents() {\n\t\t\tvar events = this;\n\t\t\tvar element = events.element;\n\t\t\telement.off('DOMMouseScroll', events.scrollEvents.wheel.callback);\n\t\t}\n\n\t\t// statics methods\n\n\t\tfunction getTouch(e, previous) {\n\t\t\tvar point = new Point();\n\t\t\tif (e.type === 'touchstart' || e.type === 'touchmove' || e.type === 'touchend' || e.type === 'touchcancel') {\n\t\t\t\tvar touch = null;\n\t\t\t\tvar event = e.originalEvent ? e.originalEvent : e;\n\t\t\t\tvar touches = event.touches.length ? event.touches : event.changedTouches;\n\t\t\t\tif (touches && touches.length) {\n\t\t\t\t\ttouch = touches[0];\n\t\t\t\t}\n\t\t\t\tif (touch) {\n\t\t\t\t\tpoint.x = touch.pageX;\n\t\t\t\t\tpoint.y = touch.pageY;\n\t\t\t\t}\n\t\t\t} else if (e.type === 'click' || e.type === 'mousedown' || e.type === 'mouseup' || e.type === 'mousemove' || e.type === 'mouseover' || e.type === 'mouseout' || e.type === 'mouseenter' || e.type === 'mouseleave' || e.type === 'contextmenu') {\n\t\t\t\tpoint.x = e.pageX;\n\t\t\t\tpoint.y = e.pageY;\n\t\t\t}\n\t\t\tif (previous) {\n\t\t\t\tpoint.s = Point.difference(t, previous);\n\t\t\t}\n\t\t\tpoint.type = e.type;\n\t\t\treturn point;\n\t\t}\n\n\t\tfunction getRelativeTouch(node, point) {\n\t\t\tnode = angular.isArray(node) ? node[0] : node;\n\t\t\treturn Point.difference(point, {\n\t\t\t\tx: node.offsetLeft,\n\t\t\t\ty: node.offsetTop\n\t\t\t});\n\t\t}\n\n    }]);\n\n\tapp.service('EventsService', ['Dom', function(Dom) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\thasPassiveEvents: hasPassiveEvents,\n\t\t\taddEventListener: getAddEventListener(),\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// prevent history back on mac os\n\n\t\tpreventHistoryNavigation();\n\n\t\t// static methods\n\n\t\tfunction hasPassiveEvents() {\n\t\t\tvar supported = false;\n\t\t\tif (window.addEventListener) {\n\t\t\t\ttry {\n\t\t\t\t\tvar options = Object.defineProperty({}, 'passive', {\n\t\t\t\t\t\tget: function() {\n\t\t\t\t\t\t\tsupported = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\twindow.addEventListener('test', null, options);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('getAddEventListener.isSupprted', e);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn supported;\n\t\t}\n\n\t\tfunction getAddEventListener() {\n\t\t\tvar supported = hasPassiveEvents();\n\t\t\tif (!supported) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar defaults = {\n\t\t\t\tpassive: false,\n\t\t\t\tcapture: false,\n\t\t\t};\n\n\t\t\tfunction getModifiedAddEventListener(original) {\n\t\t\t\tfunction addEventListener(type, listener, options) {\n\t\t\t\t\tif (typeof options !== 'object') {\n\t\t\t\t\t\tvar capture = options === true;\n\t\t\t\t\t\toptions = angular.copy(defaults);\n\t\t\t\t\t\toptions.capture = capture;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toptions = angular.extend(angular.copy(defaults), options);\n\t\t\t\t\t}\n\t\t\t\t\toriginal.call(this, type, listener, options);\n\t\t\t\t}\n\t\t\t\treturn addEventListener;\n\t\t\t}\n\n\t\t\tvar original = EventTarget.prototype.addEventListener;\n\t\t\tvar modified = getModifiedAddEventListener(original);\n\t\t\tEventTarget.prototype.addEventListener = modified;\n\t\t\treturn modified;\n\t\t}\n\n\t\tfunction preventHistoryNavigation() {\n\t\t\tif (!Dom.ua.mac) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Dom.ua.chrome || Dom.ua.safari || Dom.ua.firefox) {\n\t\t\t\twindow.addEventListener('mousewheel', onScroll, {\n\t\t\t\t\tpassive: false\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onScroll(e) {\n\t\t\t\tif (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\t(e.deltaX < 0 && (Dom.getParents(e.target).filter(function(node) {\n\t\t\t\t\t\treturn node.scrollLeft > 0;\n\t\t\t\t\t}).length === 0)) ||\n\t\t\t\t\t(e.deltaX > 0 && (Dom.getParents(e.target).filter(function(node) {\n\t\t\t\t\t\treturn node.scrollWidth - node.scrollLeft > node.clientWidth;\n\t\t\t\t\t}).length === 0))\n\t\t\t\t) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular, app, Autolinker */\r\n(function() {\r\n\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.filter('notIn', ['$filter', function($filter) {\r\n\t\treturn function(array, filters, element) {\r\n\t\t\tif (filters) {\r\n\t\t\t\treturn $filter(\"filter\")(array, function(item) {\r\n\t\t\t\t\tfor (var i = 0; i < filters.length; i++) {\r\n\t\t\t\t\t\tif (filters[i][element] === item[element]) return false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('autolink', [function() {\r\n\t\treturn function(value) {\r\n\t\t\treturn Autolinker.link(value, {\r\n\t\t\t\tclassName: \"a-link\"\r\n\t\t\t});\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('shortName', ['$filter', function($filter) {\r\n\t\tfunction toTitleCase(str) {\r\n\t\t\treturn str.replace(/\\w\\S*/g, function(txt) {\r\n\t\t\t\treturn txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn function(value) {\r\n\t\t\tif (!value) {\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\tif (value.indexOf(' .') === value.length - 2) {\r\n\t\t\t\tvalue = value.split(' .').join('');\r\n\t\t\t}\r\n\t\t\t/*\r\n\t\t\tvar splitted;\r\n\t\t\tif (value.indexOf('.') !== -1) {\r\n\t\t\t    splitted = value.split('.');\r\n\t\t\t} else {\r\n\t\t\t    splitted = value.split(' ');\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t\tvar splitted = value.split(' ');\r\n\t\t\tvar firstName = splitted.shift();\r\n\t\t\tif (splitted.length) {\r\n\t\t\t\tvar lastName = splitted.join(' ');\r\n\t\t\t\treturn firstName.substr(0, 1).toUpperCase() + '.' + toTitleCase(lastName);\r\n\t\t\t} else {\r\n\t\t\t\treturn firstName;\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customCurrency', ['$filter', function($filter) {\r\n\t\tvar legacyFilter = $filter('currency');\r\n\t\treturn function(cost, currency) {\r\n\t\t\treturn legacyFilter(cost * currency.ratio, currency.formatting);\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customSize', ['APP', function(APP) {\r\n\t\treturn function(inches) {\r\n\t\t\tif (APP.unit === APP.units.IMPERIAL) {\r\n\t\t\t\tvar feet = Math.floor(inches / 12);\r\n\t\t\t\tinches = inches % 12;\r\n\t\t\t\tinches = Math.round(inches * 10) / 10;\r\n\t\t\t\treturn (feet ? feet + '\\' ' : '') + (inches + '\\'\\'');\r\n\t\t\t} else {\r\n\t\t\t\tvar meters = Math.floor(inches * APP.size.ratio);\r\n\t\t\t\tvar cm = (inches * APP.size.ratio * 100) % 100;\r\n\t\t\t\tcm = Math.round(cm * 10) / 10;\r\n\t\t\t\treturn (meters ? meters + 'm ' : '') + (cm + 'cm');\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customWeight', ['APP', function(APP) {\r\n\t\treturn function(pounds) {\r\n\t\t\tif (APP.unit === APP.units.IMPERIAL) {\r\n\t\t\t\tif (pounds < 1) {\r\n\t\t\t\t\tvar oz = pounds * 16;\r\n\t\t\t\t\toz = Math.round(oz * 10) / 10;\r\n\t\t\t\t\treturn (oz ? oz + 'oz ' : '');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpounds = Math.round(pounds * 100) / 100;\r\n\t\t\t\t\treturn (pounds ? pounds + 'lb ' : '');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar kg = Math.floor(pounds * APP.weight.ratio / 1000);\r\n\t\t\t\tvar grams = (pounds * APP.weight.ratio) % 1000;\r\n\t\t\t\tgrams = Math.round(grams * 10) / 10;\r\n\t\t\t\treturn (kg ? kg + 'kg ' : '') + (grams + 'g');\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customNumber', ['$filter', function($filter) {\r\n\t\treturn function(value, precision, unit) {\r\n\t\t\tunit = unit || '';\r\n\t\t\t// return ((value || value === 0) ? $filter('number')(value, precision) + unit : '-');\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tif (Math.floor(value) === value) {\r\n\t\t\t\t\tprecision = 0;\r\n\t\t\t\t}\r\n\t\t\t\tvalue = $filter('number')(value, precision) + unit;\r\n\t\t\t} else {\r\n\t\t\t\tvalue = '-';\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('reportNumber', ['$filter', function($filter) {\r\n\t\treturn function(value, precision, unit) {\r\n\t\t\tunit = unit || '';\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tvalue = $filter('number')(value, precision) + unit;\r\n\t\t\t} else {\r\n\t\t\t\tvalue = '-';\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customHours', [function() {\r\n\t\treturn function(value) {\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tvar hours = Math.floor(value);\r\n\t\t\t\tvar minutes = Math.floor((value - hours) * 60);\r\n\t\t\t\tvar label = hours ? hours + ' H' : '';\r\n\t\t\t\tlabel += minutes ? ' ' + minutes + ' m' : '';\r\n\t\t\t\treturn label;\r\n\t\t\t} else {\r\n\t\t\t\treturn '-';\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customTimer', [function() {\r\n\t\tvar second = 1000;\r\n\t\tvar minute = second * 60;\r\n\t\tvar hour = minute * 60;\r\n\t\treturn function(value) {\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tvar hours = Math.floor(value / hour);\r\n\t\t\t\tvar minutes = Math.floor((value - hours * hour) / minute);\r\n\t\t\t\tvar seconds = Math.floor((value - hours * hour - minutes * minute) / second);\r\n\t\t\t\tvar label = hours ? hours + ' H' : '';\r\n\t\t\t\tlabel += minutes ? ' ' + minutes + ' m' : '';\r\n\t\t\t\tlabel += seconds ? ' ' + seconds + ' s' : '';\r\n\t\t\t\treturn label;\r\n\t\t\t} else {\r\n\t\t\t\treturn '-';\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customDigitalTimer', [function() {\r\n\t\tvar second = 1000;\r\n\t\tvar minute = second * 60;\r\n\t\tvar hour = minute * 60;\r\n\t\treturn function(value) {\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tvar hours = Math.floor(value / hour);\r\n\t\t\t\tvar minutes = Math.floor((value - hours * hour) / minute);\r\n\t\t\t\tvar seconds = Math.floor((value - hours * hour - minutes * minute) / second);\r\n\t\t\t\t// hours = hours % 24;\r\n\t\t\t\treturn (hours < 10 ? '0' : '') + hours + ':' + (minutes < 10 ? '0' : '') + minutes + ':' + (seconds < 10 ? '0' : '') + seconds;\r\n\t\t\t} else {\r\n\t\t\t\treturn '-';\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customDigitalTime', [function() {\r\n\t\tvar second = 1000;\r\n\t\tvar minute = second * 60;\r\n\t\tvar hour = minute * 60;\r\n\t\treturn function(value) {\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tvar hours = Math.floor(value / hour);\r\n\t\t\t\tvar minutes = Math.floor((value - hours * hour) / minute);\r\n\t\t\t\t// hours = hours % 24;\r\n\t\t\t\treturn (hours < 10 ? '0' : '') + hours + ':' + (minutes < 10 ? '0' : '') + minutes;\r\n\t\t\t} else {\r\n\t\t\t\treturn '-';\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customDate', ['$filter', function($filter) {\r\n\t\tvar filter = $filter('date');\r\n\t\treturn function(value, format, timezone) {\r\n\t\t\treturn value ? filter(value, format, timezone) : '-';\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customTime', ['$filter', function($filter) {\r\n\t\treturn function(value, placeholder) {\r\n\t\t\tif (value) {\r\n\t\t\t\treturn Utils.parseTime(value);\r\n\t\t\t} else {\r\n\t\t\t\treturn (placeholder ? placeholder : '-');\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customDigital', ['$filter', function($filter) {\r\n\t\treturn function(value, placeholder) {\r\n\t\t\tif (value) {\r\n\t\t\t\treturn Utils.parseHour(value);\r\n\t\t\t} else {\r\n\t\t\t\treturn (placeholder ? placeholder : '-');\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customString', ['$filter', function($filter) {\r\n\t\treturn function(value, placeholder) {\r\n\t\t\treturn value ? value : (placeholder ? placeholder : '-');\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('customEnum', function() {\r\n\t\treturn function(val) {\r\n\t\t\tval = val + 1;\r\n\t\t\treturn val < 10 ? '0' + val : val;\r\n\t\t};\r\n\t});\r\n\r\n\tapp.filter('groupBy', ['$parse', 'filterWatcher', function($parse, filterWatcher) {\r\n\t\tfunction _groupBy(collection, getter) {\r\n\t\t\tvar dict = {};\r\n\t\t\tvar key;\r\n\t\t\tangular.forEach(collection, function(item) {\r\n\t\t\t\tkey = getter(item);\r\n\t\t\t\tif (!dict[key]) {\r\n\t\t\t\t\tdict[key] = [];\r\n\t\t\t\t}\r\n\t\t\t\tdict[key].push(item);\r\n\t\t\t});\r\n\t\t\treturn dict;\r\n\t\t}\r\n\t\treturn function(collection, property) {\r\n\t\t\tif (!angular.isObject(collection) || angular.isUndefined(property)) {\r\n\t\t\t\treturn collection;\r\n\t\t\t}\r\n\t\t\treturn filterWatcher.isMemoized('groupBy', arguments) || filterWatcher.memoize('groupBy', arguments, this, _groupBy(collection, $parse(property)));\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.filter('htmlToPlaintext', function() {\r\n\t\tfunction getStyle(n, p) {\r\n\t\t\treturn n.currentStyle ? n.currentStyle[p] : window.getComputedStyle(n, null).getPropertyValue(p);\r\n\t\t}\r\n\r\n\t\tfunction toText(node) {\r\n\t\t\tvar result = '';\r\n\t\t\tif (node.nodeType == document.TEXT_NODE) {\r\n\t\t\t\tvar nodeValue = node.nodeValue;\r\n\t\t\t\tresult = nodeValue;\r\n\t\t\t\tresult = result ? String(result).replace(/</gm, '&lt;') : '';\r\n\t\t\t\tresult = result ? String(result).replace(/>/gm, '&gt;') : '';\r\n\t\t\t} else if (node.nodeType == document.ELEMENT_NODE) {\r\n\t\t\t\tfor (var i = 0, j = node.childNodes.length; i < j; i++) {\r\n\t\t\t\t\tresult += toText(node.childNodes[i]);\r\n\t\t\t\t}\r\n\t\t\t\tvar display = getStyle(node, 'display');\r\n\t\t\t\tif (display.match(/^block/) || display.match(/list/) || display.match(/row/) || node.tagName == 'BR' || node.tagName == 'HR') {\r\n\t\t\t\t\tresult += '\\n<br>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn function(html) {\r\n\t\t\tconsole.log(html);\r\n\t\t\tvar div = document.createElement('div');\r\n\t\t\tdiv.innerHTML = html;\r\n\t\t\treturn toText(div);\r\n\t\t\t// return html ? String(html).replace(/<[^>]+>/gm, '') : '';\r\n\t\t};\r\n\t});\r\n\r\n}());\r\n\n/* global angular, firebase */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Point', [function() {\n\n\t\tfunction Point(x, y) {\n\t\t\tthis.x = x || 0;\n\t\t\tthis.y = y || 0;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tdifference: PointDifference,\n\t\t\tmultiply: PointMultiply,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tclone: clone,\n\t\t\tcopy: copy,\n\t\t\tdifference: difference,\n\t\t\tmult: mult,\n\t\t\toffset: offset,\n\t\t\tsetPos: setPos,\n\t\t\tsetX: setX,\n\t\t\tsetY: setY,\n\t\t\ttoString: toString,\n\t\t};\n\n\t\tangular.extend(Point, statics);\n\t\tangular.extend(Point.prototype, publics);\n\n\t\treturn Point;\n\n\t\t// static methods\n\n\t\tfunction PointDifference(a, b) {\n\t\t\treturn new Point(a.x - b.x, a.y - b.y);\n\t\t}\n\n\t\tfunction PointMultiply(point, value) {\n\t\t\tpoint.x *= value;\n\t\t\tpoint.y *= value;\n\t\t\treturn point;\n\t\t}\n\n\t\t// prototype methods\n\n\t\tfunction clone() {\n\t\t\treturn new Point(this.x, this.y);\n\t\t}\n\n\t\tfunction copy(point) {\n\t\t\tthis.x = point.x;\n\t\t\tthis.y = point.y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction difference(b) {\n\t\t\treturn PointDifference(this, b);\n\t\t}\n\n\t\tfunction mult(value) {\n\t\t\treturn PointMultiply(this, value);\n\t\t}\n\n\t\tfunction offset(x, y) {\n\t\t\tthis.x += x;\n\t\t\tthis.y += y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setPos(x, y) {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setX(x) {\n\t\t\tthis.x = x;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setY(y) {\n\t\t\tthis.y = y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction toString() {\n\t\t\treturn '{' + this.x + ',' + this.y + '}';\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular, firebase */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Rect', [function() {\n\n\t\tfunction Rect(x, y, w, h) {\n\t\t\tthis.x = x || 0;\n\t\t\tthis.y = y || 0;\n\t\t\tthis.w = w || 0;\n\t\t\tthis.h = h || 0;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tmult: RectMultiply,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tbottom: bottom,\n\t\t\tbottomLeft: bottomLeft,\n\t\t\tbottomRight: bottomRight,\n\t\t\tcenter: center,\n\t\t\tclone: clone,\n\t\t\tcopy: copy,\n\t\t\texpand: expand,\n\t\t\texpandRect: expandRect,\n\t\t\tintersect: intersect,\n\t\t\tleft: left,\n\t\t\tmult: mult,\n\t\t\toffset: offset,\n\t\t\treduce: reduce,\n\t\t\treduceRect: reduceRect,\n\t\t\tright: right,\n\t\t\tsetH: setH,\n\t\t\tsetPos: setPos,\n\t\t\tsetSize: setSize,\n\t\t\tsetX: setX,\n\t\t\tsetY: setY,\n\t\t\tsetW: setW,\n\t\t\ttop: top,\n\t\t\ttopLeft: topLeft,\n\t\t\ttopRight: topRight,\n\t\t\ttoString: toString,\n\t\t};\n\n\t\tangular.extend(Rect, statics);\n\t\tangular.extend(Rect.prototype, publics);\n\n\t\treturn Rect;\n\n\t\t// static methods\n\n\t\tfunction RectMultiply(rect, value) {\n\t\t\trect.x *= value;\n\t\t\trect.y *= value;\n\t\t\trect.w *= value;\n\t\t\trect.h *= value;\n\t\t\treturn rect;\n\t\t}\n\n\t\t// prototype methods\n\n\t\tfunction bottom() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w / 2,\n\t\t\t\ty: y + h\n\t\t\t};\n\t\t}\n\n\t\tfunction bottomLeft() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x,\n\t\t\t\ty: y + h\n\t\t\t};\n\t\t}\n\n\t\tfunction bottomRight() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w,\n\t\t\t\ty: y + h\n\t\t\t};\n\t\t}\n\n\t\tfunction center() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w / 2,\n\t\t\t\ty: y + h / 2\n\t\t\t};\n\t\t}\n\n\t\tfunction clone() {\n\t\t\treturn new Rect(this.x, this.y, this.w, this.h);\n\t\t}\n\n\t\tfunction copy(rect) {\n\t\t\tthis.x = rect.x;\n\t\t\tthis.y = rect.y;\n\t\t\tthis.w = rect.w;\n\t\t\tthis.h = rect.h;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction expand(size) {\n\t\t\treturn this.expandRect({\n\t\t\t\tx: size,\n\t\t\t\ty: size,\n\t\t\t\tw: size * 2,\n\t\t\t\th: size * 2\n\t\t\t});\n\t\t}\n\n\t\tfunction expandRect(rect) {\n\t\t\tthis.x -= rect.x || 0;\n\t\t\tthis.y -= rect.y || 0;\n\t\t\tthis.w += rect.w || 0;\n\t\t\tthis.h += rect.h || 0;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction intersect(rect) {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn !(rect.x > x + w || rect.x + rect.w < x || rect.y > y + h || rect.y + rect.h < y);\n\t\t}\n\n\t\tfunction left() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x,\n\t\t\t\ty: y + h / 2\n\t\t\t};\n\t\t}\n\n\t\tfunction mult(value) {\n\t\t\treturn RectMultiply(this, value);\n\t\t}\n\n\t\tfunction offset(x, y) {\n\t\t\tthis.x += x;\n\t\t\tthis.y += y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction reduce(size) {\n\t\t\treturn this.offset(-size);\n\t\t}\n\n\t\tfunction reduceRect(rect) {\n\t\t\treturn this.offsetRect(RectMultiply(rect, -1));\n\t\t}\n\n\t\tfunction right() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w,\n\t\t\t\ty: y + h / 2\n\t\t\t};\n\t\t}\n\n\t\tfunction setH(h) {\n\t\t\tthis.h = h;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setPos(x, y) {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setSize(w, h) {\n\t\t\tthis.w = w;\n\t\t\tthis.h = h;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setX(x) {\n\t\t\tthis.x = x;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setY(y) {\n\t\t\tthis.y = y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setW(w) {\n\t\t\tthis.w = w;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction top() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w / 2,\n\t\t\t\ty: y\n\t\t\t};\n\t\t}\n\n\t\tfunction topLeft() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x,\n\t\t\t\ty: y\n\t\t\t};\n\t\t}\n\n\t\tfunction topRight() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w,\n\t\t\t\ty: y\n\t\t\t};\n\t\t}\n\n\t\tfunction toString() {\n\t\t\treturn '{' + this.x + ',' + this.y + ',' + this.w + ',' + this.h + '}';\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular, firebase */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Vector', function() {\n\t\tfunction Vector(x, y) {\n\t\t\tthis.x = x || 0;\n\t\t\tthis.y = y || 0;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tcross: VectorCross,\n\t\t\tdifference: VectorDifference,\n\t\t\tdistance: VectorDistance,\n\t\t\tincidence: VectorIncidence,\n\t\t\tmake: VectorMake,\n\t\t\tnormalize: VectorNormalize,\n\t\t\tpower: VectorPower,\n\t\t\tsize: VectorSize,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tadd: add,\n\t\t\tcopy: copy,\n\t\t\tcross: cross,\n\t\t\tdifference: difference,\n\t\t\tdistance: distance,\n\t\t\tfriction: friction,\n\t\t\tincidence: incidence,\n\t\t\tnormalize: normalize,\n\t\t\tpower: power,\n\t\t\tsize: size,\n\t\t\ttowards: towards,\n\t\t\ttoString: toString,\n\t\t};\n\n\t\tangular.extend(Vector, statics);\n\t\tangular.extend(Vector.prototype, publics);\n\n\t\treturn Vector;\n\n\t\t// statics methods\n\n\t\tfunction VectorCross(a, b) {\n\t\t\treturn (a.x * b.y) - (a.y * b.x);\n\t\t}\n\n\t\tfunction VectorDifference(a, b) {\n\t\t\treturn new Vector(a.x - b.x, a.y - b.y);\n\t\t}\n\n\t\tfunction VectorDistance(a, b) {\n\t\t\treturn Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));\n\t\t}\n\n\t\tfunction VectorIncidence(a, b) {\n\t\t\tvar angle = Math.atan2(b.y, b.x) - Math.atan2(a.y, a.x);\n\t\t\treturn angle;\n\t\t}\n\n\t\tfunction VectorMake(a, b) {\n\t\t\treturn new Vector(b.x - a.x, b.y - a.y);\n\t\t}\n\n\t\tfunction VectorNormalize(a) {\n\t\t\tvar l = Vector.size(a);\n\t\t\ta.x /= l;\n\t\t\ta.y /= l;\n\t\t\treturn a;\n\t\t}\n\n\t\tfunction VectorPower(a, b) {\n\t\t\tvar x = Math.abs(b.x - a.x);\n\t\t\tvar y = Math.abs(b.y - a.y);\n\t\t\treturn (x + y) / 2;\n\t\t}\n\n\t\tfunction VectorSize(a) {\n\t\t\treturn Math.sqrt(a.x * a.x + a.y * a.y);\n\t\t}\n\n\t\t// prototype methods\n\n\t\tfunction add(b) {\n\t\t\tthis.x += b.x;\n\t\t\tthis.y += b.y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction copy(b) {\n\t\t\treturn new Vector(this.x, this.y);\n\t\t}\n\n\t\tfunction cross(b) {\n\t\t\treturn VectorCross(this, b);\n\t\t}\n\n\t\tfunction difference(b) {\n\t\t\treturn VectorDifference(this, b);\n\t\t}\n\n\t\tfunction distance(b) {\n\t\t\treturn VectorDistance(this, b);\n\t\t}\n\n\t\tfunction friction(b) {\n\t\t\tthis.x *= b;\n\t\t\tthis.y *= b;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction incidence(b) {\n\t\t\treturn VectorIncidence(this, b);\n\t\t}\n\n\t\tfunction normalize() {\n\t\t\treturn VectorNormalize(this);\n\t\t}\n\n\t\tfunction power() {\n\t\t\treturn (Math.abs(this.x) + Math.abs(this.y)) / 2;\n\t\t}\n\n\t\tfunction size() {\n\t\t\treturn VectorSize(this);\n\t\t}\n\n\t\tfunction towards(b, friction) {\n\t\t\tfriction = friction || 0.125;\n\t\t\tthis.x += (b.x - this.x) * friction;\n\t\t\tthis.y += (b.y - this.y) * friction;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction toString() {\n\t\t\treturn '{' + this.x + ',' + this.y + '}';\n\t\t}\n\n\t});\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Hash', [function() {\n\t\tvar pools = {};\n\n\t\tfunction Hash(key, pool) {\n\t\t\tkey = key || 'id';\n\t\t\tpool = pool ? HashGet(pool) : {};\n\t\t\tObject.defineProperties(this, {\n\t\t\t\tkey: {\n\t\t\t\t\tvalue: key,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\twritable: false\n\t\t\t\t},\n\t\t\t\tpool: {\n\t\t\t\t\tvalue: pool,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\twritable: false\n\t\t\t\t},\n\t\t\t\tlength: {\n\t\t\t\t\tvalue: 0,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\twritable: true\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tvar publics = {\n\t\t\thas: has,\n\t\t\tget: get,\n\t\t\tgetItem: getItem,\n\t\t\tset: set,\n\t\t\tadd: add,\n\t\t\tonce: once,\n\t\t\tremove: remove,\n\t\t\teach: each,\n\t\t\taddMany: addMany,\n\t\t\tremoveMany: removeMany,\n\t\t\tremoveAll: removeAll,\n\t\t\tforward: forward,\n\t\t\tbackward: backward,\n\t\t\tdiffers: differs,\n\t\t\tupdatePool: updatePool,\n\t\t};\n\n\t\tvar statics = {\n\t\t\tget: HashGet,\n\t\t};\n\n\t\tHash.prototype = new Array;\n\t\tangular.extend(Hash.prototype, publics);\n\t\tangular.extend(Hash, statics);\n\n\t\treturn Hash;\n\n\t\t// publics\n\t\tfunction has(id) {\n\t\t\treturn this.pool[id] !== undefined;\n\t\t}\n\n\t\tfunction get(id) {\n\t\t\treturn this.pool[id];\n\t\t}\n\n\t\tfunction getItem(item) {\n\t\t\tvar hash = this,\n\t\t\t\tkey = this.key;\n\t\t\treturn item ? hash.get(item[key]) : null;\n\t\t}\n\n\t\tfunction set(item) {\n\t\t\tvar hash = this,\n\t\t\t\tpool = this.pool,\n\t\t\t\tkey = this.key;\n\t\t\tpool[item[key]] = item;\n\t\t\thash.push(item);\n\t\t\treturn item;\n\t\t}\n\n\t\tfunction add(newItem) {\n\t\t\tvar hash = this;\n\t\t\tvar item = hash.getItem(newItem);\n\t\t\tif (item) {\n\t\t\t\tfor (var i = 0, keys = Object.keys(newItem), p; i < keys.length; i++) {\n\t\t\t\t\tp = keys[i];\n\t\t\t\t\titem[p] = newItem[p];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem = hash.set(newItem);\n\t\t\t}\n\t\t\treturn item;\n\t\t}\n\n\t\tfunction once(newItem, callback) {\n\t\t\tvar hash = this;\n\t\t\tvar item = hash.getItem(newItem);\n\t\t\tif (!item) {\n\t\t\t\titem = hash.set(newItem);\n\t\t\t}\n\t\t\tif (typeof callback == 'function') {\n\t\t\t\tcallback(item);\n\t\t\t}\n\t\t\treturn item;\n\t\t}\n\n\t\tfunction remove(oldItem) {\n\t\t\tvar hash = this,\n\t\t\t\tpool = this.pool,\n\t\t\t\tkey = this.key;\n\t\t\tvar item = hash.getItem(oldItem);\n\t\t\tif (item) {\n\t\t\t\tvar index = hash.indexOf(item);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\thash.splice(index, 1);\n\t\t\t\t}\n\t\t\t\tdelete pool[item[key]];\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction addMany(items) {\n\t\t\tvar hash = this;\n\t\t\tif (!items) {\n\t\t\t\treturn hash;\n\t\t\t}\n\t\t\tvar i = 0;\n\t\t\twhile (i < items.length) {\n\t\t\t\thash.add(items[i]);\n\t\t\t\ti++;\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction removeMany(items) {\n\t\t\tvar hash = this;\n\t\t\tif (!items) {\n\t\t\t\treturn hash;\n\t\t\t}\n\t\t\tvar i = 0;\n\t\t\twhile (i < items.length) {\n\t\t\t\thash.remove(items[i]);\n\t\t\t\ti++;\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction removeAll() {\n\t\t\tvar hash = this,\n\t\t\t\tkey = hash.key,\n\t\t\t\tpool = hash.pool;\n\t\t\tvar i = 0,\n\t\t\t\tt = hash.length,\n\t\t\t\titem;\n\t\t\twhile (hash.length) {\n\t\t\t\titem = hash.shift();\n\t\t\t\tdelete pool[item[key]];\n\t\t\t\ti++;\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction each(callback) {\n\t\t\tvar hash = this;\n\t\t\tif (callback) {\n\t\t\t\tvar i = 0;\n\t\t\t\twhile (i < hash.length) {\n\t\t\t\t\tcallback(hash[i], i);\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction forward(key, reverse) {\n\t\t\tvar hash = this,\n\t\t\t\tkey = (key || this.key);\n\t\t\thash.sort(function(c, d) {\n\t\t\t\tvar a = reverse ? d : c;\n\t\t\t\tvar b = reverse ? c : d;\n\t\t\t\treturn a[key] - b[key];\n\t\t\t});\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction backward(key) {\n\t\t\treturn this.forward(key, true);\n\t\t}\n\n\t\tfunction differs(hash) {\n\t\t\tif (hash.key !== this.key || hash.length !== this.length) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tvar differs = false,\n\t\t\t\t\ti = 0,\n\t\t\t\t\tt = this.length,\n\t\t\t\t\tkey = this.key;\n\t\t\t\twhile (differs && i < t) {\n\t\t\t\t\tdiffers = this[i][key] !== hash[i][key];\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction updatePool() {\n\t\t\tvar hash = this,\n\t\t\t\tpool = this.pool,\n\t\t\t\tkey = this.key;\n\t\t\tObject.keys(pool).forEach(function(key) {\n\t\t\t\tdelete pool[key];\n\t\t\t});\n\t\t\tangular.forEach(hash, function(item) {\n\t\t\t\tpool[item[key]] = item;\n\t\t\t});\n\t\t}\n\n\t\t// statics\n\t\tfunction HashGet(pool) {\n\t\t\treturn pools[pool] = (pools[pool] || {});\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('$promise', ['$q', function($q) {\n\n\t\tfunction $promise(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\tthrow ('promise resolve callback missing');\n\t\t\t}\n\t\t\tvar deferred = $q.defer();\n\t\t\tcallback(deferred);\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tall: $promiseAll,\n\t\t};\n\n\t\tvar publics = {};\n\n\t\tangular.extend($promise, statics);\n\t\tangular.extend($promise.prototype, publics);\n\n\t\treturn $promise;\n\n\t\tfunction $promiseAll(promises) {\n\t\t\treturn $q.all(promises);\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('State', ['$timeout', '$rootScope', function($timeout, $rootScope) {\n\n\t\tfunction State() {\n\t\t\tthis.idle();\n\t\t}\n\n\t\tvar DELAY = 2000;\n\n\t\tvar statics = {};\n\n\t\tvar publics = {\n\t\t\tbusy: busy,\n\t\t\tclasses: classes,\n\t\t\tenabled: enabled,\n\t\t\terror: error,\n\t\t\terrorMessage: errorMessage,\n\t\t\terrors: [],\n\t\t\tidle: idle,\n\t\t\tlabels: labels,\n\t\t\tready: ready,\n\t\t\tsubmitClass: submitClass,\n\t\t\tsuccess: success,\n\t\t};\n\n\t\tangular.extend(State, statics);\n\t\tangular.extend(State.prototype, publics);\n\n\t\treturn State;\n\n\t\t// static methods\n\n\t\t// publics methods\n\n\t\tfunction busy() {\n\t\t\tvar state = this;\n\t\t\tif (!state.isBusy) {\n\t\t\t\tstate.isBusy = true;\n\t\t\t\tstate.isError = false;\n\t\t\t\tstate.isErroring = false;\n\t\t\t\tstate.isSuccess = false;\n\t\t\t\tstate.isSuccessing = false;\n\t\t\t\tstate.errors = [];\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfunction classes(addons) {\n\t\t\tvar state = this,\n\t\t\t\tclasses = null;\n\t\t\tclasses = {\n\t\t\t\tready: state.isReady,\n\t\t\t\tbusy: state.isBusy,\n\t\t\t\tsuccessing: state.isSuccessing,\n\t\t\t\tsuccess: state.isSuccess,\n\t\t\t\terrorring: state.isErroring,\n\t\t\t\terror: state.isError,\n\t\t\t};\n\t\t\tif (addons) {\n\t\t\t\tangular.forEach(addons, function(value, key) {\n\t\t\t\t\tclasses[value] = classes[key];\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn classes;\n\t\t}\n\n\t\tfunction enabled() {\n\t\t\tvar state = this;\n\t\t\treturn !state.isBusy && !state.isErroring && !state.isSuccessing;\n\t\t}\n\n\t\tfunction error(error) {\n\t\t\tconsole.log('State.error', error);\n\t\t\tvar state = this;\n\t\t\tstate.isBusy = false;\n\t\t\tstate.isError = true;\n\t\t\tstate.isErroring = true;\n\t\t\tstate.isSuccess = false;\n\t\t\tstate.isSuccessing = false;\n\t\t\tstate.errors.push(error);\n\t\t\t$timeout(function() {\n\t\t\t\tstate.isErroring = false;\n\t\t\t}, DELAY);\n\t\t}\n\n\t\tfunction errorMessage() {\n\t\t\tvar state = this;\n\t\t\treturn state.isError ? state.errors[state.errors.length - 1] : null;\n\t\t}\n\n\t\tfunction idle() {\n\t\t\tvar state = this;\n\t\t\tstate.isBusy = false;\n\t\t\tstate.isError = false;\n\t\t\tstate.isErroring = false;\n\t\t\tstate.isSuccess = false;\n\t\t\tstate.isSuccessing = false;\n\t\t\tstate.button = null;\n\t\t\tstate.errors = [];\n\t\t}\n\n\t\tfunction labels(addons) {\n\t\t\tvar state = this;\n\t\t\tvar defaults = {\n\t\t\t\tready: 'submit',\n\t\t\t\tbusy: 'sending',\n\t\t\t\terror: 'error',\n\t\t\t\tsuccess: 'success',\n\t\t\t};\n\t\t\tif (addons) {\n\t\t\t\tangular.extend(defaults, addons);\n\t\t\t}\n\t\t\tvar label = defaults.ready;\n\t\t\tif (state.isBusy) {\n\t\t\t\tlabel = defaults.busy;\n\t\t\t} else if (state.isSuccess) {\n\t\t\t\tlabel = defaults.success;\n\t\t\t} else if (state.isError) {\n\t\t\t\tlabel = defaults.error;\n\t\t\t}\n\t\t\treturn label;\n\t\t}\n\n\t\tfunction ready() {\n\t\t\tvar state = this;\n\t\t\tstate.idle();\n\t\t\tstate.isReady = true;\n\t\t\t$rootScope.$broadcast('$stateReady', state);\n\t\t}\n\n\t\tfunction submitClass() {\n\t\t\tvar state = this;\n\t\t\treturn {\n\t\t\t\tbusy: state.isBusy,\n\t\t\t\tready: state.isReady,\n\t\t\t\tsuccessing: state.isSuccessing,\n\t\t\t\tsuccess: state.isSuccess,\n\t\t\t\terrorring: state.isErroring,\n\t\t\t\terror: state.isError,\n\t\t\t};\n\t\t}\n\n\t\tfunction success() {\n\t\t\tvar state = this;\n\t\t\tstate.isBusy = false;\n\t\t\tstate.isError = false;\n\t\t\tstate.isErroring = false;\n\t\t\tstate.isSuccess = true;\n\t\t\tstate.isSuccessing = true;\n\t\t\tstate.errors = [];\n\t\t\t$timeout(function() {\n\t\t\t\tstate.isSuccessing = false;\n\t\t\t}, DELAY);\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar transformProperty = detectTransformProperty();\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Style', [function() {\n\n\t\tfunction Style() {\n\t\t\tthis.props = {\n\t\t\t\tscale: 1,\n\t\t\t\thoverScale: 1,\n\t\t\t\tcurrentScale: 1,\n\t\t\t};\n\t\t}\n\n\t\tvar statics = {};\n\n\t\tvar publics = {\n\t\t\tset: set,\n\t\t\ttransform: transform,\n\t\t\ttransformOrigin: transformOrigin,\n\t\t};\n\n\t\tangular.extend(Style, statics);\n\t\tangular.extend(Style.prototype, publics);\n\n\t\treturn Style;\n\n\t\t// static methods\n\n\t\t// prototype methods\n\n\t\tfunction set(element) {\n\t\t\tvar styles = [];\n\t\t\tfor (var key in this) {\n\t\t\t\tif (key !== 'props') {\n\t\t\t\t\tstyles.push(key + ':' + this[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telement.style.cssText = styles.join(';') + ';';\n\t\t}\n\n\t\tfunction transform(transform) {\n\t\t\tthis[transformProperty] = transform;\n\t\t}\n\n\t\tfunction transformOrigin(x, y) {\n\t\t\tthis[transformProperty + '-origin-x'] = (Math.round(x * 1000) / 1000) + '%';\n\t\t\tthis[transformProperty + '-origin-y'] = (Math.round(y * 1000) / 1000) + '%';\n\t\t}\n\n    }]);\n\n\tfunction detectTransformProperty() {\n\t\tvar transformProperty = 'transform',\n\t\t\tsafariPropertyHack = 'webkitTransform';\n\t\tvar div = document.createElement(\"DIV\");\n\t\tif (typeof div.style[transformProperty] !== 'undefined') {\n            ['webkit', 'moz', 'o', 'ms'].every(function(prefix) {\n\t\t\t\tvar e = '-' + prefix + '-transform';\n\t\t\t\tif (typeof div.style[e] !== 'undefined') {\n\t\t\t\t\ttransformProperty = e;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t});\n\t\t} else if (typeof div.style[safariPropertyHack] !== 'undefined') {\n\t\t\ttransformProperty = '-webkit-transform';\n\t\t} else {\n\t\t\ttransformProperty = undefined;\n\t\t}\n\t\treturn transformProperty;\n\t}\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Utils', ['$compile', '$controller', 'Vector', function($compile, $controller, Vector) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tcompileController: compileController,\n\t\t\textract: extract,\n\t\t\tformat: format,\n\t\t\tindexOf: indexOf,\n\t\t\treducer: reducer,\n\t\t\treducerAdder: reducerAdder,\n\t\t\treducerSetter: reducerSetter,\n\t\t\tremoveValue: removeValue,\n\t\t\treverseSortOn: reverseSortOn,\n\t\t\tthrottle: throttle,\n\t\t\ttoMd5: toMd5,\n\t\t\twhere: where,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tvar getNow = Date.now || function() {\n\t\t\treturn new Date().getTime();\n\t\t};\n\n\t\tfunction compileController(scope, element, html, data) {\n\t\t\t// console.log('Utils.compileController', element);\n\t\t\telement.html(html);\n\t\t\tvar link = $compile(element.contents());\n\t\t\tif (data.controller) {\n\t\t\t\tvar $scope = scope.$new();\n\t\t\t\tangular.extend($scope, data);\n\t\t\t\tvar controller = $controller(data.controller, {\n\t\t\t\t\t$scope: $scope\n\t\t\t\t});\n\t\t\t\tif (data.controllerAs) {\n\t\t\t\t\tscope[data.controllerAs] = controller;\n\t\t\t\t}\n\t\t\t\telement.data('$ngControllerController', controller);\n\t\t\t\telement.children().data('$ngControllerController', controller);\n\t\t\t\tscope = $scope;\n\t\t\t}\n\t\t\tlink(scope);\n\t\t}\n\n\t\tfunction extract(obj, value) {\n\t\t\treturn Object.keys(obj)[Object.values(obj).indexOf(value)];\n\t\t}\n\n\t\tfunction format(string, prepend, expression) {\n\t\t\tstring = string || '';\n\t\t\tprepend = prepend || '';\n\t\t\tvar splitted = string.split(',');\n\t\t\tif (splitted.length > 1) {\n\t\t\t\tvar formatted = splitted.shift();\n\t\t\t\tangular.forEach(splitted, function(value, index) {\n\t\t\t\t\tif (expression) {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join(prepend + value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (expression) {\n\t\t\t\t\treturn '\\'' + formatted + '\\'';\n\t\t\t\t} else {\n\t\t\t\t\treturn formatted;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn prepend + string;\n\t\t\t}\n\t\t}\n\n\t\tfunction indexOf(array, object, key) {\n\t\t\tkey = key || 'id';\n\t\t\tvar index = -1;\n\t\t\tif (array) {\n\t\t\t\tvar i = 0,\n\t\t\t\t\tt = array.length;\n\t\t\t\twhile (i < t) {\n\t\t\t\t\tif (array[i] && array[i][key] === object[key]) {\n\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn index;\n\t\t}\n\n\t\tfunction reducer(o, key) {\n\t\t\treturn o[key];\n\t\t}\n\n\t\tfunction reducerAdder(o, key, value) {\n\t\t\tif (typeof key == 'string') {\n\t\t\t\treturn reducerAdder(o, key.split('.'), value);\n\t\t\t} else if (key.length == 1 && value !== undefined) {\n\t\t\t\treturn (o[key[0]] += value);\n\t\t\t} else if (key.length === 0) {\n\t\t\t\treturn o;\n\t\t\t} else {\n\t\t\t\treturn reducerAdder(o[key[0]], key.slice(1), value);\n\t\t\t}\n\t\t}\n\n\t\tfunction reducerSetter(o, key, value) {\n\t\t\tif (typeof key == 'string') {\n\t\t\t\treturn reducerSetter(o, key.split('.'), value);\n\t\t\t} else if (key.length == 1 && value !== undefined) {\n\t\t\t\treturn (o[key[0]] = value);\n\t\t\t} else if (key.length === 0) {\n\t\t\t\treturn o;\n\t\t\t} else {\n\t\t\t\treturn reducerSetter(o[key[0]], key.slice(1), value);\n\t\t\t}\n\t\t}\n\n\t\tfunction removeValue(array, value) {\n\t\t\tvar index = -1;\n\t\t\tif (array) {\n\t\t\t\tvar i = 0,\n\t\t\t\t\tt = array.length;\n\t\t\t\twhile (i < t) {\n\t\t\t\t\tif (array[i] === value) {\n\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (index !== -1) {\n\t\t\t\tarray.splice(index, 1);\n\t\t\t\treturn value;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tfunction reverseSortOn(key) {\n\t\t\treturn function(a, b) {\n\t\t\t\tif (a[key] < b[key]) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t\tif (a[key] > b[key]) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\t// a must be equal to b\n\t\t\t\treturn 0;\n\t\t\t};\n\t\t}\n\n\t\tfunction throttle(func, wait, options) {\n\t\t\t// Returns a function, that, when invoked, will only be triggered at most once\n\t\t\t// during a given window of time. Normally, the throttled function will run\n\t\t\t// as much as it can, without ever going more than once per `wait` duration;\n\t\t\t// but if you'd like to disable the execution on the leading edge, pass\n\t\t\t// `{leading: false}`. To disable execution on the trailing edge, ditto.\n\t\t\tvar context, args, result;\n\t\t\tvar timeout = null;\n\t\t\tvar previous = 0;\n\t\t\tif (!options) options = {};\n\t\t\tvar later = function() {\n\t\t\t\tprevious = options.leading === false ? 0 : getNow();\n\t\t\t\ttimeout = null;\n\t\t\t\tresult = func.apply(context, args);\n\t\t\t\tif (!timeout) context = args = null;\n\t\t\t};\n\t\t\treturn function() {\n\t\t\t\tvar now = getNow();\n\t\t\t\tif (!previous && options.leading === false) previous = now;\n\t\t\t\tvar remaining = wait - (now - previous);\n\t\t\t\tcontext = this;\n\t\t\t\targs = arguments;\n\t\t\t\tif (remaining <= 0 || remaining > wait) {\n\t\t\t\t\tif (timeout) {\n\t\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\t\ttimeout = null;\n\t\t\t\t\t}\n\t\t\t\t\tprevious = now;\n\t\t\t\t\tresult = func.apply(context, args);\n\t\t\t\t\tif (!timeout) context = args = null;\n\t\t\t\t} else if (!timeout && options.trailing !== false) {\n\t\t\t\t\ttimeout = setTimeout(later, remaining);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t};\n\t\t}\n\n\t\tfunction toMd5(string) {\n\t\t\t// return Md5.encode(string);\n\t\t}\n\n\t\tfunction where(array, query) {\n\t\t\tvar found = null;\n\t\t\tif (array) {\n\t\t\t\tangular.forEach(array, function(item) {\n\t\t\t\t\tvar has = true;\n\t\t\t\t\tangular.forEach(query, function(value, key) {\n\t\t\t\t\t\thas = has && item[key] === value;\n\t\t\t\t\t});\n\t\t\t\t\tif (has) {\n\t\t\t\t\t\tfound = item;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn found;\n\t\t}\n\n    }]);\n\n\t(function() {\n\t\t// POLYFILL Array.prototype.reduce\n\t\t// Production steps of ECMA-262, Edition 5, 15.4.4.21\n\t\t// Reference: http://es5.github.io/#x15.4.4.21\n\t\t// https://tc39.github.io/ecma262/#sec-array.prototype.reduce\n\t\tif (typeof Array.prototype.reduce !== 'function') {\n\t\t\tObject.defineProperty(Array.prototype, 'reduce', {\n\t\t\t\tvalue: function(callback) { // , initialvalue\n\t\t\t\t\tif (this === null) {\n\t\t\t\t\t\tthrow new TypeError('Array.prototype.reduce called on null or undefined');\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof callback !== 'function') {\n\t\t\t\t\t\tthrow new TypeError(callback + ' is not a function');\n\t\t\t\t\t}\n\t\t\t\t\tvar o = Object(this);\n\t\t\t\t\tvar len = o.length >>> 0;\n\t\t\t\t\tvar k = 0;\n\t\t\t\t\tvar value;\n\t\t\t\t\tif (arguments.length == 2) {\n\t\t\t\t\t\tvalue = arguments[1];\n\t\t\t\t\t} else {\n\t\t\t\t\t\twhile (k < len && !(k in o)) {\n\t\t\t\t\t\t\tk++;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (k >= len) {\n\t\t\t\t\t\t\tthrow new TypeError('Reduce of empty array with no initial value');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvalue = o[k++];\n\t\t\t\t\t}\n\t\t\t\t\twhile (k < len) {\n\t\t\t\t\t\tif (k in o) {\n\t\t\t\t\t\t\tvalue = callback(value, o[k], k, o);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tk++;\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}());\n\n\t(function() {\n\t\t// POLYFILL Object.values\n\t\tif (typeof Object.values !== 'function') {\n\t\t\tObject.defineProperty(Object, 'values', {\n\t\t\t\tvalue: function(obj) {\n\t\t\t\t\tvar vals = [];\n\t\t\t\t\tfor (var key in obj) {\n\t\t\t\t\t\tif (has(obj, key) && isEnumerable(obj, key)) {\n\t\t\t\t\t\t\tvals.push(obj[key]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn vals;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}());\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.provider('environment', ['$locationProvider', '$httpProvider', function($locationProvider, $httpProvider) {\n\n\t\tvar provider = this;\n\n\t\tvar statics = {\n\t\t\tadd: EnvironmentAdd,\n\t\t\tuse: EnvironmentUse,\n\t\t};\n\n\t\tangular.extend(provider, statics);\n\n\t\tvar defaults = {\n\t\t\tplugins: {\n\t\t\t\tfacebook: {\n\t\t\t\t\tfields: 'id,name,first_name,last_name,email,gender,picture,cover,link',\n\t\t\t\t\tscope: 'public_profile, email', // publish_stream\n\t\t\t\t\tversion: 'v2.10',\n\t\t\t\t},\n\t\t\t\tgoogle: {},\n\t\t\t\tgooglemaps: {\n\t\t\t\t\tclusterer: true,\n\t\t\t\t\tstyles: '/googlemaps/applemapesque.json',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tcenter: {\n\t\t\t\t\t\t\tlat: 43.9023386,\n\t\t\t\t\t\t\tlng: 12.8505094\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdisableDefaultUI: true,\n\t\t\t\t\t\tmapTypeId: 'roadmap', // \"hybrid\", \"roadmap\", \"satellite\", \"terrain\"\n\t\t\t\t\t\tscrollwheel: true,\n\t\t\t\t\t\t// tilt: 0, // 45\n\t\t\t\t\t\tzoom: 4.0,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmapbox: {\n\t\t\t\t\tclusterer: true,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tbearing: 0.0,\n\t\t\t\t\t\tcenter: [\n                            12.8505094,\n                            43.9023386\n                        ],\n\t\t\t\t\t\tcurve: 1,\n\t\t\t\t\t\tpitch: 0.0,\n\t\t\t\t\t\tspeed: 1.5,\n\t\t\t\t\t\tzoom: 4.0,\n\t\t\t\t\t},\n\t\t\t\t\tversion: 'v0.42.0',\n\t\t\t\t}\n\t\t\t},\n\t\t\thttp: {\n\t\t\t\tinterceptors: [], // ['AuthService'],\n\t\t\t\twithCredentials: false,\n\t\t\t},\n\t\t\tlanguage: {\n\t\t\t\tcode: 'en',\n\t\t\t\tculture: 'en_US',\n\t\t\t\tiso: 'ENU',\n\t\t\t\tname: 'English',\n\t\t\t},\n\t\t\tlocation: {\n\t\t\t\thash: '!',\n\t\t\t\thtml5: false,\n\t\t\t},\n\t\t\tpaths: {},\n\t\t};\n\n\t\tvar global = {};\n\n\t\tif (window.environment) {\n\t\t\tangular.merge(global, window.environment);\n\t\t}\n\n\t\tvar config = {};\n\n\t\tvar environment = angular.copy(defaults);\n\t\tangular.merge(environment, global);\n\n\t\tfunction EnvironmentSetHttp() {\n\t\t\t$httpProvider.defaults.headers.common[\"Accept-Language\"] = environment.language.code;\n\t\t\t$httpProvider.defaults.withCredentials = environment.http.withCredentials;\n\t\t\t$httpProvider.interceptors.push.apply($httpProvider.interceptors, environment.http.interceptors);\n\t\t}\n\n\t\tfunction EnvironmentSetLocation() {\n\t\t\t$locationProvider.html5Mode(environment.location.html5);\n\t\t\t$locationProvider.hashPrefix(environment.location.hash);\n\t\t}\n\n\t\tfunction EnvironmentAdd(key, data) {\n\t\t\tconfig[key] = config[key] ? angular.merge(config[key], data) : data;\n\t\t\tEnvironmentSet();\n\t\t}\n\n\t\tfunction EnvironmentSet() {\n\t\t\tenvironment = angular.copy(defaults);\n\t\t\tif (config.environment) {\n\t\t\t\tangular.merge(environment, config.environment);\n\t\t\t}\n\t\t\tvar value = EnvironmentGet();\n\t\t\tif (value) {\n\t\t\t\tangular.merge(environment, value);\n\t\t\t}\n\t\t\tangular.merge(environment, global);\n\t\t\tEnvironmentSetHttp();\n\t\t\tEnvironmentSetLocation();\n\t\t}\n\n\t\tfunction EnvironmentUse(key) {\n\t\t\tif (config[key]) {\n\t\t\t\tenvironment = angular.copy(defaults);\n\t\t\t\tangular.merge(environment, config[key]);\n\t\t\t\tangular.merge(environment, global);\n\t\t\t\tEnvironmentSetHttp();\n\t\t\t\tEnvironmentSetLocation();\n\t\t\t}\n\t\t}\n\n\t\tfunction EnvironmentGet() {\n\t\t\tfor (var key in config) {\n\t\t\t\tvar value = config[key];\n\t\t\t\tif (value.paths && window.location.href.indexOf(value.paths.app) !== -1) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprovider.$get = function() {\n\t\t\treturn environment;\n\t\t};\n\n    }]);\n\n}());\n\n/* global angular */\r\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.factory('Doc', ['Api', '$promise', function(Api, $promise) {\r\n\r\n\t\tfunction Doc(item) {\r\n\t\t\tif (item) {\r\n\t\t\t\tangular.extend(this, item);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar statics = {};\r\n\r\n\t\tvar publics = {};\r\n\r\n\t\tangular.extend(Doc, statics);\r\n\t\tangular.extend(Doc.prototype, publics);\r\n\r\n\t\treturn Doc;\r\n\r\n\t\t// static methods\r\n\r\n\t\t// prototype methods\r\n\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Route', ['$promise', '$location', '$route', '$routeParams', 'Router', function($promise, $location, $route, $routeParams, Router) {\n\n\t\tfunction Route(current) {\n\n\t\t\tvar route = {\n\t\t\t\tcontroller: current.$$route.controller,\n\t\t\t\tparams: current.params,\n\t\t\t\tpath: $location.path(),\n\t\t\t\tpathParams: current.pathParams,\n\t\t\t\toriginalPath: current.$$route.originalPath,\n\t\t\t\ttemplateUrl: current.loadedTemplateUrl,\n\t\t\t};\n\t\t\tangular.extend(this, route);\n\t\t}\n\n\t\tvar statics = {\n\t\t\tcurrent: RouteCurrent,\n\t\t};\n\n\t\tvar publics = {};\n\n\t\tangular.extend(Route, statics);\n\t\tangular.extend(Route.prototype, publics);\n\n\t\treturn Route;\n\n\t\t// static methods\n\n\t\tfunction RouteCurrent() {\n\t\t\treturn new Route($route.current);\n\t\t}\n\n\t\t// prototype methods\n\n    }]);\n\n}());\n\n/* global angular */\r\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.factory('View', ['Api', '$promise', 'environment', 'Doc', 'Route', function(Api, $promise, environment, Doc, Route) {\r\n\r\n\t\tfunction View(doc, route) {\r\n\t\t\tvar view = {\r\n\t\t\t\tdoc: doc,\r\n\t\t\t\tenvironment: environment,\r\n\t\t\t\troute: route,\r\n\t\t\t};\r\n\t\t\tangular.extend(this, view);\r\n\t\t}\r\n\r\n\t\tvar statics = {\r\n\t\t\tcurrent: ViewCurrent, // ViewCurrentSimple\r\n\t\t};\r\n\r\n\t\tvar publics = {};\r\n\r\n\t\tangular.extend(View, statics);\r\n\t\tangular.extend(View.prototype, publics);\r\n\r\n\t\treturn View;\r\n\r\n\t\t// static methods\r\n\r\n\t\tfunction ViewCurrent() {\r\n\t\t\treturn $promise(function(promise) {\r\n\t\t\t\tvar route = Route.current();\r\n\t\t\t\tvar path = route.path;\r\n\t\t\t\tconsole.log('ViewCurrent', path);\r\n\t\t\t\tApi.docs.path(path).then(function(response) {\r\n\t\t\t\t\tvar doc = new Doc(response);\r\n\t\t\t\t\tvar view = new View(doc, route);\r\n\t\t\t\t\tpromise.resolve(view);\r\n\r\n\t\t\t\t}, function(error) {\r\n\t\t\t\t\tpromise.reject(error);\r\n\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction ViewCurrentSimple() {\r\n\t\t\treturn $promise(function(promise) {\r\n\t\t\t\tconsole.log('ViewCurrentSimple');\r\n\t\t\t\tvar route = Route.current();\r\n\t\t\t\tvar path = route.path;\r\n\t\t\t\tApi.navs.main().then(function(items) {\r\n\t\t\t\t\tvar doc = null,\r\n\t\t\t\t\t\tview = null,\r\n\t\t\t\t\t\tpath = path,\r\n\t\t\t\t\t\tpool = ViewPool(items);\r\n\t\t\t\t\tvar item = pool[path];\r\n\t\t\t\t\tif (item) {\r\n\t\t\t\t\t\tdoc = new Doc(item);\r\n\t\t\t\t\t\tview = new View(doc, route);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpromise.resolve(view);\r\n\r\n\t\t\t\t}, function(error) {\r\n\t\t\t\t\tpromise.reject(error);\r\n\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction ViewPool(items) {\r\n\t\t\tvar pool = {};\r\n\r\n\t\t\tfunction _getPool(items) {\r\n\t\t\t\tif (items) {\r\n\t\t\t\t\tangular.forEach(items, function(item) {\r\n\t\t\t\t\t\tpool[item.path] = item;\r\n\t\t\t\t\t\t_getPool(item.items);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t_getPool(items);\r\n\t\t\treturn pool;\r\n\t\t}\r\n\r\n\t\t// prototype methods\r\n\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\t// todo\n\n\tapp.service('AuthService', ['$q', '$rootScope', '$location', 'LocalStorage', 'environment', function($q, $rootScope, $location, LocalStorage, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tisAuthorizedOrGoTo: isAuthorizedOrGoTo,\n\t\t\tisAuthorized: isAuthorized,\n\t\t\trequest: request,\n\t\t\tresponse: response,\n\t\t\tresponseError: responseError,\n\t\t\tsignOut: signOut,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t/* * * * * * * * * * * * * * * * *\n\t\t *  detect current auth storage  *\n\t\t * * * * * * * * * * * * * * * * */\n\n\t\tconsole.log(environment.plugins);\n\n\t\t// statics methods\n\n\t\tfunction isAuthorizedOrGoTo(redirect) {\n\t\t\tvar deferred = $q.defer();\n\t\t\tvar auth = LocalStorage.get('authorization');\n\t\t\tif (auth && auth.created_at + auth.expires_in < new Date().getTime()) {\n\t\t\t\tdeferred.resolve(auth);\n\t\t\t} else {\n\t\t\t\tdeferred.reject({\n\t\t\t\t\tstatus: 'unauthorized'\n\t\t\t\t});\n\t\t\t\t$location.path(redirect);\n\t\t\t}\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tfunction isAuthorized() {\n\t\t\tvar auth = LocalStorage.get('authorization');\n\t\t\treturn (auth && auth.created_at + auth.expires_in < new Date().getTime());\n\t\t}\n\n\t\tfunction request(config) {\n\t\t\tvar auth = LocalStorage.get('authorization');\n\t\t\tif (auth && auth.created_at + auth.expires_in < new Date().getTime()) {\n\t\t\t\tconfig.headers = config.headers || {};\n\t\t\t\tconfig.headers.Authorization = 'Bearer ' + auth.access_token; // add your token from your service or whatever\n\t\t\t}\n\t\t\treturn config;\n\t\t}\n\n\t\tfunction response(response) {\n\t\t\treturn response || $q.when(response);\n\t\t}\n\n\t\tfunction responseError(error) {\n\t\t\tconsole.log('AuthService.responseError', error);\n\t\t\t// your error handler\n\t\t\tswitch (error.status) {\n\t\t\t\tcase 400:\n\t\t\t\t\tvar errors = [];\n\t\t\t\t\tif (error.data) {\n\t\t\t\t\t\terrors.push(error.data.Message);\n\t\t\t\t\t\tfor (var key in error.data.ModelState) {\n\t\t\t\t\t\t\tfor (var i = 0; i < error.data.ModelState[key].length; i++) {\n\t\t\t\t\t\t\t\terrors.push(error.data.ModelState[key][i]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\terrors.push('Server error');\n\t\t\t\t\t}\n\t\t\t\t\terror.Message = errors.join(' ');\n\t\t\t\t\t// warning !!\n\t\t\t\t\t$rootScope.httpError = error;\n\t\t\t\t\t$rootScope.$broadcast('onHttpInterceptorError', error);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 404:\n\t\t\t\t\terror.Message = \"Not found\";\n\t\t\t\t\t$rootScope.httpError = error;\n\t\t\t\t\t$rootScope.$broadcast('onHttpInterceptorError', error);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 500:\n\t\t\t\t\t// console.log('500',error);\n\t\t\t\t\t$rootScope.httpError = error;\n\t\t\t\t\t$rootScope.$broadcast('onHttpInterceptorError', error);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 401:\n\t\t\t\t\tLocalStorage.delete('authorization');\n\t\t\t\t\tLocalStorage.delete('user');\n\t\t\t\t\t$location.path('/signin');\n\t\t\t\t\tbreak;\n\t\t\t\tcase -1:\n\t\t\t\t\twindow.open(error.config.path, '_blank');\n\t\t\t\t\t// status == 0 you lost connection\n\t\t\t}\n\t\t\treturn $q.reject(error);\n\t\t}\n\n\t\tfunction signOut() {\n\t\t\tLocalStorage.delete('authorization');\n\t\t\tLocalStorage.delete('user');\n\t\t\tLocalStorage.delete('CampagnoloToken');\n\t\t\tLocalStorage.delete('GoogleToken');\n\t\t\tLocalStorage.delete('StravaToken');\n\t\t\tLocalStorage.delete('FacebookToken');\n\t\t\tLocalStorage.delete('GarminToken');\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Bearer', ['$http', '$promise', 'SessionStorage', 'LocalStorage', 'environment', function($http, $promise, SessionStorage, LocalStorage, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\t'delete': BearerDelete,\n\t\t\texist: BearerExists,\n\t\t\tget: BearerGet,\n\t\t\tset: BearerSet,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// statics methods\n\n\t\tfunction BearerDelete(accessToken, remember) {\n\t\t\tSessionStorage.delete('accessToken');\n\t\t\tLocalStorage.delete('accessToken');\n\t\t\tdelete $http.defaults.headers.common['Authorization'];\n\t\t}\n\n\t\tfunction BearerExists(accessToken, remember) {\n\t\t\treturn SessionStorage.exist('accessToken') || LocalStorage.exist('accessToken');\n\t\t}\n\n\t\tfunction BearerGet(accessToken, remember) {\n\t\t\tvar accessToken = null;\n\t\t\tif (SessionStorage.exist('accessToken')) {\n\t\t\t\taccessToken = SessionStorage.get('accessToken');\n\t\t\t\tBearerSet(accessToken);\n\t\t\t} else if (LocalStorage.exist('accessToken')) {\n\t\t\t\taccessToken = LocalStorage.get('accessToken');\n\t\t\t\tBearerSet(accessToken);\n\t\t\t}\n\t\t\treturn accessToken;\n\t\t}\n\n\t\tfunction BearerSet(accessToken, remember) {\n\t\t\tvar header = 'Bearer ' + accessToken;\n\t\t\tdelete $http.defaults.headers.common['Authorization'];\n\t\t\t$http.defaults.headers.common['Authorization'] = header;\n\t\t\tSessionStorage.set('accessToken', accessToken);\n\t\t\tif (remember) {\n\t\t\t\tLocalStorage.set('accessToken', accessToken);\n\t\t\t}\n\t\t\treturn header;\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\r\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.service('Http', ['$http', '$promise', '$timeout', 'environment', function($http, $promise, $timeout, environment) {\r\n\r\n\t\tvar service = this;\r\n\r\n\t\tvar statics = {\r\n\t\t\tget: HttpGet,\r\n\t\t\tpost: HttpPost,\r\n\t\t\tput: HttpPut,\r\n\t\t\tpatch: HttpPatch,\r\n\t\t\t'delete': HttpDelete,\r\n\t\t\t'static': HttpStatic,\r\n\t\t\tfake: HttpFake,\r\n\t\t};\r\n\r\n\t\tangular.extend(service, statics);\r\n\r\n\t\t// statics methods\r\n\r\n\t\tfunction HttpPath(path) {\r\n\t\t\treturn environment.paths.api + path;\r\n\t\t}\r\n\r\n\t\tfunction HttpPromise(method, path, data) {\r\n\t\t\treturn $promise(function(promise) {\r\n\t\t\t\t$http[method](path, data).then(function(response) {\r\n\t\t\t\t\tpromise.resolve(response.data);\r\n\r\n\t\t\t\t}, function(e, status) {\r\n\t\t\t\t\tvar error = (e && e.data) ? e.data : {};\r\n\t\t\t\t\terror.status = e.status;\r\n\t\t\t\t\tpromise.reject(error);\r\n\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction HttpGet(path) {\r\n\t\t\treturn HttpPromise('get', HttpPath(path));\r\n\t\t}\r\n\r\n\t\tfunction HttpPost(path, data) {\r\n\t\t\treturn HttpPromise('post', HttpPath(path), data);\r\n\t\t}\r\n\r\n\t\tfunction HttpPut(path, data) {\r\n\t\t\treturn HttpPromise('put', HttpPath(path), data);\r\n\t\t}\r\n\r\n\t\tfunction HttpPatch(path, data) {\r\n\t\t\treturn HttpPromise('patch', HttpPath(path), data);\r\n\t\t}\r\n\r\n\t\tfunction HttpDelete(path) {\r\n\t\t\treturn HttpPromise('delete', HttpPath(path));\r\n\t\t}\r\n\r\n\t\tfunction HttpStatic(path) {\r\n\t\t\treturn HttpPromise('get', path);\r\n\t\t}\r\n\r\n\t\tfunction HttpFake(data, msec) {\r\n\t\t\tmsec = msec || 1000;\r\n\t\t\treturn $promise(function(promise) {\r\n\t\t\t\t$timeout(function() {\r\n\t\t\t\t\tpromise.resolve({\r\n\t\t\t\t\t\tdata: data\r\n\t\t\t\t\t});\r\n\t\t\t\t}, msec);\r\n\t\t\t});\r\n\t\t}\r\n\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Preload', ['$promise', function($promise) {\n\n\t\tfunction Preload(path) {\n\t\t\tvar preload = this;\n\t\t\tpreload.path = path;\n\t\t\tpreload.loaded = 0;\n\t\t\tpreload.total = 0;\n\t\t\tpreload.progress = 0;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tall: PreloadAll,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tstart: PreloadStart,\n\t\t\timage: PreloadImage,\n\t\t};\n\n\t\tangular.extend(Preload, statics);\n\t\tangular.extend(Preload.prototype, publics);\n\n\t\treturn Preload;\n\n\t\t// statics methods\n\n\t\tfunction PreloadAll(paths, callback) {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tvar preloads = paths.map(function(path) {\n\t\t\t\t\treturn new Preload(path);\n\t\t\t\t});\n\t\t\t\tvar progress = {\n\t\t\t\t\tloaded: 0,\n\t\t\t\t\ttotal: 0,\n\t\t\t\t\tprogress: 0,\n\t\t\t\t\tpreloads: preloads\n\t\t\t\t};\n\t\t\t\tvar i = setInterval(update, 1000 / 10);\n\t\t\t\t$promise.all(\n\t\t\t\t\tpreloads.map(function(preload) {\n\t\t\t\t\t\treturn preload.start();\n\t\t\t\t\t})\n\t\t\t\t).then(function() {\n\t\t\t\t\tclearInterval(i);\n\t\t\t\t\tupdate();\n\t\t\t\t\tpromise.resolve(preloads.slice());\n\t\t\t\t\t// destroy();\n\t\t\t\t}, function(error) {\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t// destroy();\n\t\t\t\t});\n\n\t\t\t\tfunction update() {\n\t\t\t\t\tprogress.loaded = 0;\n\t\t\t\t\tprogress.total = 0;\n\t\t\t\t\tangular.forEach(preloads, function(preload) {\n\t\t\t\t\t\tprogress.loaded += preload.loaded;\n\t\t\t\t\t\tprogress.total += preload.total;\n\t\t\t\t\t});\n\t\t\t\t\tvar percent = progress.total ? progress.loaded / progress.total : 0;\n\t\t\t\t\tif (percent > progress.progress) {\n\t\t\t\t\t\tprogress.progress = percent;\n\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\tcallback(progress);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction destroy() {\n\t\t\t\t\tangular.forEach(preloads, function(preload) {\n\t\t\t\t\t\tpreload.buffer = null;\n\t\t\t\t\t\tpreload.xhr = null;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// instance methods\n\n\t\tfunction PreloadStart() {\n\t\t\tvar preload = this;\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\t\txhr.open(\"GET\", preload.path, true);\n\t\t\t\txhr.responseType = \"arraybuffer\"; // should be after open for ie11\n\t\t\t\txhr.onloadstart = function(e) {\n\t\t\t\t\t/*\n\t\t\t\t\tpreload.loaded = 0;\n\t\t\t\t\tpreload.total = 1;\n\t\t\t\t\tpreload.progress = 0;\n\t\t\t\t\t*/\n\t\t\t\t};\n\t\t\t\txhr.onprogress = function(e) {\n\t\t\t\t\tpreload.loaded = e.loaded;\n\t\t\t\t\tpreload.total = e.total;\n\t\t\t\t\tpreload.progress = e.total ? e.loaded / e.total : 0;\n\t\t\t\t};\n\t\t\t\txhr.onloadend = function(e) {\n\t\t\t\t\tpreload.loaded = preload.total;\n\t\t\t\t\tpreload.progress = 1;\n\t\t\t\t};\n\t\t\t\txhr.onload = function() {\n\t\t\t\t\tpreload.buffer = xhr.response;\n\t\t\t\t\tpromise.resolve(preload);\n\t\t\t\t};\n\t\t\t\txhr.onerror = function(error) {\n\t\t\t\t\tconsole.log('Preload.xhr.onerror', error);\n\t\t\t\t\tpreload.loaded = preload.total;\n\t\t\t\t\tpreload.progress = 1;\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t};\n\t\t\t\txhr.send();\n\t\t\t\tpreload.xhr = xhr;\n\t\t\t});\n\t\t}\n\n\t\tfunction PreloadImage() {\n\t\t\tvar preload = this;\n\t\t\tvar blob = new Blob([preload.buffer]);\n\t\t\tvar image = new Image();\n\t\t\timage.src = window.URL.createObjectURL(blob);\n\t\t\treturn image;\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('$once', ['$promise', function($promise) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tload: OnceLoad,\n\t\t\tscript: OnceScript,\n\t\t\tlink: OnceLink,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tvar paths = {},\n\t\t\tuid = 0;\n\n\t\tfunction OnceLoad(path, callback) {\n\t\t\tif (path.indexOf('.js')) {\n\t\t\t\treturn OnceScript(path, callback);\n\n\t\t\t} else if (path.indexOf('.css')) {\n\t\t\t\treturn OnceLink(path);\n\n\t\t\t}\n\t\t}\n\n\t\tfunction OnceScript(path, callback) {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\ttry {\n\t\t\t\t\tvar id = (paths[path] = paths[path] || ++uid);\n\t\t\t\t\tid = 'OnceScript' + id;\n\t\t\t\t\tif (document.getElementById(id)) {\n\t\t\t\t\t\tpromise.reject();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar scripts = document.getElementsByTagName('script');\n\t\t\t\t\t\tvar script = scripts[scripts.length - 1];\n\t\t\t\t\t\tvar node = document.createElement('script');\n\t\t\t\t\t\tnode.id = id;\n\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\tif (callback === true) {\n\t\t\t\t\t\t\t\tcallback = id;\n\t\t\t\t\t\t\t\tpath = path.split('{{callback}}').join(callback);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\twindow[callback] = function(data) {\n\t\t\t\t\t\t\t\tpromise.resolve(data);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.addEventListener('load', promise.resolve);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnode.addEventListener('error', promise.reject);\n\t\t\t\t\t\tnode.src = path;\n\t\t\t\t\t\tscript.parentNode.insertBefore(node, script.nextSibling);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction OnceLink(path) {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\ttry {\n\t\t\t\t\tvar id = (paths[path] = paths[path] || ++uid);\n\t\t\t\t\tid = 'OnceStyle' + id;\n\t\t\t\t\tif (document.getElementById(id)) {\n\t\t\t\t\t\tpromise.resolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar links = document.getElementsByTagName('link');\n\t\t\t\t\t\tvar link = links[links.length - 1];\n\t\t\t\t\t\tvar node = document.createElement('link');\n\t\t\t\t\t\tnode.id = id;\n\t\t\t\t\t\tnode.rel = 'stylesheet';\n\t\t\t\t\t\tnode.href = path;\n\t\t\t\t\t\tnode.addEventListener('load', promise.resolve);\n\t\t\t\t\t\tnode.addEventListener('error', promise.reject);\n\t\t\t\t\t\tlink.parentNode.insertBefore(node, link.nextSibling);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Router', ['$rootScope', '$location', '$route', '$timeout', function($rootScope, $location, $route, $timeout) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tisController: RouterIsController,\n\t\t\tredirect: RouterRedirect,\n\t\t\tpath: RouterPath,\n\t\t\tapply: RouterApply,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t$rootScope.$on('$routeChangeStart', RouterOnChangeStart);\n\t\t$rootScope.$on('$routeChangeSuccess', RouterOnChangeSuccess);\n\t\t$rootScope.$on('$routeChangeError', RouterOnChangeError);\n\t\t$rootScope.$on('$routeUpdate', RouterOnUpdate);\n\t\t$rootScope.$on('$stateReady', RouterOnStateReady);\n\n\t\tvar $previous, $current, $next;\n\t\tvar $previousController, $currentController, $nextController;\n\n\t\tfunction RouterSetControllers() {\n\t\t\t$previousController = $previous ? $previous.controller : null;\n\t\t\t$currentController = $current ? $current.controller : null;\n\t\t\t$nextController = $next ? $next.controller : null;\n\t\t}\n\n\t\t/*\n\t\t$routeChangeStart\n\t\tBroadcasted before a route change. At this point the route services starts resolving all of the dependencies needed for the route change to occur. Typically this involves fetching the view template as well as any dependencies defined in resolve route property. Once all of the dependencies are resolved $routeChangeSuccess is fired.\n\t\tThe route change (and the $location change that triggered it) can be prevented by calling preventDefault method of the event. See $rootScope.Scope for more details about event object.\n\t\t*/\n\t\tfunction RouterOnChangeStart(event, next, current) {\n\t\t\t$previous = null;\n\t\t\t$current = current ? current.$$route : null;\n\t\t\t$next = next ? next.$$route : null;\n\t\t\tRouterSetControllers();\n\t\t\t// console.log('Router.RouterOnChangeStart', '$previous', $previous, '$current', $current, '$next', $next);\n\t\t\tservice.loading = true;\n\t\t}\n\n\t\t/*\n\t\t$routeChangeSuccess\n\t\tBroadcasted after a route change has happened successfully. The resolve dependencies are now available in the current.locals property.\n\t\t*/\n\t\tfunction RouterOnChangeSuccess(event, current, previous) {\n\t\t\t$previous = previous ? previous.$$route : null;\n\t\t\t$current = current ? current.$$route : null;\n\t\t\t$next = null;\n\t\t\tRouterSetControllers();\n\t\t\t// console.log('Router.RouterOnChangeSuccess', '$previous', $previous, '$current', $current, '$next', $next);\n\t\t}\n\n\t\t/*\n\t\t$routeChangeError\n\t\tBroadcasted if a redirection function fails or any redirection or resolve promises are rejected.\n\t\t*/\n\t\tfunction RouterOnChangeError(event, current, previous, rejection) {\n\t\t\t$previous = null;\n\t\t\t$current = previous.$$route || null;\n\t\t\t$next = null;\n\t\t\tRouterSetControllers();\n\t\t\t// console.log('Router.RouterOnChangeError', '$previous', $previous, '$current', $current, '$next', $next);\n\t\t}\n\n\t\t/*\n\t\t$routeUpdate\n\t\tThe reloadOnSearch property has been set to false, and we are reusing the same instance of the Controller.\n\t\t*/\n\t\tfunction RouterOnUpdate(event, current) {\n\t\t\t$previous = current ? current.$$route : null;\n\t\t\t$current = current ? current.$$route : null;\n\t\t\t$next = null;\n\t\t\tRouterSetControllers();\n\t\t\t// console.log('Router.RouterOnUpdate', '$previous', $previous, '$current', $current, '$next', $next);\n\t\t}\n\n\t\tfunction RouterOnStateReady(scope, state) {\n\t\t\t$timeout(function() {\n\t\t\t\tservice.loading = false;\n\t\t\t}, 1000);\n\t\t}\n\n\t\tfunction RouterIsController(controller) {\n\t\t\treturn $currentController === controller;\n\t\t}\n\n\t\t// navigation\n\n\t\tfunction RouterRedirectTo(path) {\n\t\t\t$location.$$lastRequestedPath = $location.path();\n\t\t\t$location.path(path);\n\t\t}\n\n\t\tfunction RouterRetryLastRequestedPath(path) {\n\t\t\tpath = $location.$$lastRequestedPath || path;\n\t\t\t$location.$$lastRequestedPath = null;\n\t\t\t$location.path(path);\n\t\t}\n\n\t\tfunction RouterRedirect(path, msecs) {\n\t\t\tif (msecs) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tRouterRedirectTo(path);\n\t\t\t\t}, msecs);\n\t\t\t} else {\n\t\t\t\tRouterRedirectTo(path);\n\t\t\t}\n\t\t}\n\n\t\tfunction RouterPath(path, msecs) {\n\t\t\tif (msecs) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\tRouterRetryLastRequestedPath(path);\n\t\t\t\t}, msecs);\n\t\t\t} else {\n\t\t\t\tRouterRetryLastRequestedPath(path);\n\t\t\t}\n\t\t}\n\n\t\tfunction RouterApply(path, msecs) {\n\t\t\tif (msecs) {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\t$location.path(path);\n\t\t\t\t}, msecs);\n\t\t\t} else {\n\t\t\t\t$timeout(function() {\n\t\t\t\t\t$location.path(path);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Silent', ['$rootScope', '$location', function($rootScope, $location) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tsilent: SilentSilent,\n\t\t\tpath: SilentPath,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t$rootScope.$$listeners.$locationChangeSuccess.unshift(SilentListener);\n\t\t// console.log('$rootScope.$$listeners.$locationChangeSuccess', $rootScope.$$listeners.$locationChangeSuccess);\n\n\t\t// private vars\n\n\t\tvar $path;\n\n\t\t// static methods\n\n\t\tfunction SilentGetDomain() {\n\t\t\tvar currentDomain = window.location.protocol + '//' + window.location.hostname + (window.location.port ? ':' + window.location.port : '');\n\t\t\treturn currentDomain;\n\t\t}\n\n\t\tfunction SilentUnlink() {\n\t\t\tvar listeners = $rootScope.$$listeners.$locationChangeSuccess;\n\t\t\tangular.forEach(listeners, function(value, name) {\n\t\t\t\tif (value === listener) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfunction relink() {\n\t\t\t\t\tlisteners[name] = value;\n\t\t\t\t}\n\t\t\t\tlisteners[name] = relink; // temporary unlinking\n\t\t\t});\n\t\t}\n\n\t\tfunction SilentListener(e) {\n\t\t\t// console.log('onLocationChangeSuccess', e);\n\t\t\tif ($path === $location.path()) {\n\t\t\t\tSilentUnlink();\n\t\t\t}\n\t\t\t$path = null;\n\t\t}\n\n\t\tfunction SilentSilent(path, replace) {\n\t\t\t// this.prev = $location.path(); ???\n\t\t\tvar location = $location.url(path);\n\t\t\tif (replace) {\n\t\t\t\tlocation.replace();\n\t\t\t}\n\t\t\t$path = $location.path();\n\t\t}\n\n\t\tfunction SilentPath(path) {\n\t\t\treturn $location.path(path);\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tvar TIMEOUT = 5 * 60 * 1000; // five minutes\n\n\tapp.service('Cookie', ['$promise', function($promise) {\n\n\t\tvar service = {\n\t\t\tTIMEOUT: TIMEOUT,\n\t\t\t'delete': CookieDelete,\n\t\t\texist: CookieExists,\n\t\t\tget: CookieGet,\n\t\t\ton: CookieOn,\n\t\t\tset: CookieSet,\n\t\t};\n\n\t\tangular.extend(this, service);\n\n\t\tfunction CookieDelete(name) {\n\t\t\tCookieSetter(name, \"\", -1);\n\t\t}\n\n\t\tfunction CookieExists(name) {\n\t\t\treturn document.cookie.indexOf(';' + name + '=') !== -1 || document.cookie.indexOf(name + '=') === 0;\n\t\t}\n\n\t\tfunction CookieGet(name) {\n\t\t\tvar cookieName = name + \"=\";\n\t\t\tvar ca = document.cookie.split(';');\n\t\t\tfor (var i = 0; i < ca.length; i++) {\n\t\t\t\tvar c = ca[i];\n\t\t\t\twhile (c.charAt(0) == ' ') {\n\t\t\t\t\tc = c.substring(1, c.length);\n\t\t\t\t}\n\t\t\t\tif (c.indexOf(cookieName) === 0) {\n\t\t\t\t\tvar value = c.substring(cookieName.length, c.length);\n\t\t\t\t\tvar model = null;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tmodel = JSON.parse(decodeURIComponent(atob(value)));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.log('Cookie.get.error parsing', key, e);\n\t\t\t\t\t}\n\t\t\t\t\treturn model;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction CookieOn(name) {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tvar i, interval = 1000,\n\t\t\t\t\telapsed = 0,\n\t\t\t\t\ttimeout = Cookie.TIMEOUT;\n\n\t\t\t\tfunction checkCookie() {\n\t\t\t\t\tif (elapsed > timeout) {\n\t\t\t\t\t\tpromise.reject('timeout');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar c = CookieGet(name);\n\t\t\t\t\t\tif (c) {\n\t\t\t\t\t\t\tpromise.resolve(c);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telapsed += interval;\n\t\t\t\t\t\t\ti = setTimeout(checkCookie, interval);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcheckCookie();\n\t\t\t});\n\t\t}\n\n\t\tfunction CookieSet(name, value, days) {\n\t\t\ttry {\n\t\t\t\tvar cache = [];\n\t\t\t\tvar json = JSON.stringify(value, function(key, value) {\n\t\t\t\t\tif (key === 'pool') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.indexOf(value) !== -1) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.push(value);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\tcache = null;\n\t\t\t\tCookieSetter(name, btoa(encodeURIComponent(json)), days);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('CookieSet.error serializing', name, value, e);\n\t\t\t}\n\t\t}\n\n\t\tfunction CookieSetter(name, value, days) {\n\t\t\tvar expires;\n\t\t\tif (days) {\n\t\t\t\tvar date = new Date();\n\t\t\t\tdate.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n\t\t\t\texpires = '; expires=' + date.toGMTString();\n\t\t\t} else {\n\t\t\t\texpires = '';\n\t\t\t}\n\t\t\tdocument.cookie = name + '=' + value + expires + '; path=/';\n\t\t}\n\n    }]);\n\n\tapp.service('LocalStorage', ['$promise', 'Cookie', function($promise, Cookie) {\n\n\t\tvar service = {\n\t\t\tTIMEOUT: TIMEOUT,\n\t\t\t'delete': LocalDelete,\n\t\t\texist: LocalExists,\n\t\t\tget: LocalGet,\n\t\t\ton: LocalOn,\n\t\t\tset: LocalSet,\n\t\t};\n\n\t\tvar supported = LocalSupported();\n\n\t\tif (supported) {\n\t\t\tangular.extend(this, service);\n\t\t} else {\n\t\t\tangular.extend(this, Cookie);\n\t\t}\n\n\t\tthis.supported = supported;\n\n\t\tfunction LocalSupported() {\n\t\t\tvar supported = false;\n\t\t\ttry {\n\t\t\t\tsupported = 'localStorage' in window && window.localStorage !== null;\n\t\t\t\tif (supported) {\n\t\t\t\t\twindow.localStorage.setItem('test', '1');\n\t\t\t\t\twindow.localStorage.removeItem('test');\n\t\t\t\t} else {\n\t\t\t\t\tsupported = false;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tsupported = false;\n\t\t\t}\n\t\t\treturn supported;\n\t\t}\n\n\t\tfunction LocalExists(name) {\n\t\t\treturn window.localStorage[name] !== undefined;\n\t\t}\n\n\t\tfunction LocalGet(name) {\n\t\t\tvar value = null;\n\t\t\tif (window.localStorage[name] !== undefined) {\n\t\t\t\ttry {\n\t\t\t\t\tvalue = JSON.parse(window.localStorage[name]);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('LocalStorage.get.error parsing', name, e);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction LocalSet(name, value) {\n\t\t\ttry {\n\t\t\t\tvar cache = [];\n\t\t\t\tvar json = JSON.stringify(value, function(key, value) {\n\t\t\t\t\tif (key === 'pool') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.indexOf(value) !== -1) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.push(value);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\tcache = null;\n\t\t\t\twindow.localStorage.setItem(name, json);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('LocalStorage.set.error serializing', name, value, e);\n\t\t\t}\n\t\t}\n\n\t\tfunction LocalDelete(name) {\n\t\t\twindow.localStorage.removeItem(name);\n\t\t}\n\n\t\tfunction LocalOn(name) {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tvar i, timeout = Cookie.TIMEOUT;\n\n\t\t\t\tfunction storageEvent(e) {\n\t\t\t\t\t// console.log('LocalStorage.on', name, e);\n\t\t\t\t\tif (i) {\n\t\t\t\t\t\tclearTimeout(i);\n\t\t\t\t\t}\n\t\t\t\t\tif (e.originalEvent.key == name) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n\t\t\t\t\t\t\tpromise.resolve(value);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.log('LocalStorage.on.error parsing', name, error);\n\t\t\t\t\t\t\tpromise.reject('error parsing ' + name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tangular.element(window).on('storage', storageEvent);\n\t\t\t\ti = setTimeout(function() {\n\t\t\t\t\tpromise.reject('timeout');\n\t\t\t\t}, timeout);\n\t\t\t});\n\t\t}\n\n    }]);\n\n\tapp.service('SessionStorage', ['$promise', 'Cookie', function($promise, Cookie) {\n\n\t\tvar service = {\n\t\t\tTIMEOUT: TIMEOUT,\n\t\t\t'delete': SessionDelete,\n\t\t\texist: SessionExists,\n\t\t\tget: SessionGet,\n\t\t\ton: SessionOn,\n\t\t\tset: SessionSet,\n\t\t};\n\n\t\tvar supported = SessionSupported();\n\n\t\tif (supported) {\n\t\t\tangular.extend(this, service);\n\t\t} else {\n\t\t\tangular.extend(this, Cookie);\n\t\t}\n\n\t\tthis.supported = supported;\n\n\t\tfunction SessionSupported() {\n\t\t\tvar supported = false;\n\t\t\ttry {\n\t\t\t\tsupported = 'sessionStorage' in window && window.sessionStorage !== undefined;\n\t\t\t\tif (supported) {\n\t\t\t\t\twindow.sessionStorage.setItem('test', '1');\n\t\t\t\t\twindow.sessionStorage.removeItem('test');\n\t\t\t\t} else {\n\t\t\t\t\tsupported = false;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tsupported = false;\n\t\t\t}\n\t\t\treturn supported;\n\t\t}\n\n\t\tfunction SessionExists(name) {\n\t\t\treturn window.sessionStorage[name] !== undefined;\n\t\t}\n\n\t\tfunction SessionGet(name) {\n\t\t\tvar value = null;\n\t\t\tif (window.sessionStorage[name] !== undefined) {\n\t\t\t\ttry {\n\t\t\t\t\tvalue = JSON.parse(window.sessionStorage[name]);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('SessionStorage.get.error parsing', name, e);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction SessionSet(name, value) {\n\t\t\ttry {\n\t\t\t\tvar cache = [];\n\t\t\t\tvar json = JSON.stringify(value, function(key, value) {\n\t\t\t\t\tif (key === 'pool') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.indexOf(value) !== -1) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.push(value);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\tcache = null;\n\t\t\t\twindow.sessionStorage.setItem(name, json);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('SessionStorage.set.error serializing', name, value, e);\n\t\t\t}\n\t\t}\n\n\t\tfunction SessionDelete(name) {\n\t\t\twindow.sessionStorage.removeItem(name);\n\t\t}\n\n\t\tfunction SessionOn(name) {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tvar i, timeout = Cookie.TIMEOUT;\n\n\t\t\t\tfunction storageEvent(e) {\n\t\t\t\t\t// console.log('SessionStorage.on', name, e);\n\t\t\t\t\tif (i) {\n\t\t\t\t\t\tclearTimeout(i);\n\t\t\t\t\t}\n\t\t\t\t\tif (e.originalEvent.key === name) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n\t\t\t\t\t\t\tpromise.resolve(value);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.log('SessionStorage.on.error parsing', name, error);\n\t\t\t\t\t\t\tpromise.reject('error parsing ' + name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tangular.element(window).on('storage', storageEvent);\n\t\t\t\ti = setTimeout(function() {\n\t\t\t\t\tpromise.reject('timeout');\n\t\t\t\t}, timeout);\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Trust', ['$sce', function($sce) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\thtml: TrustHtml,\n\t\t\tresource: TrustResource,\n\t\t\turl: TrustUrl,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// private vars\n\n\t\tvar values = [],\n\t\t\ttrustedValues = [];\n\n\t\tfunction TrustGetValue(value) {\n\t\t\tvar index = values.indexOf(value);\n\t\t\tif (index !== -1) {\n\t\t\t\treturn trustedValues[index];\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tfunction TrustSetValue(value, trustedValue) {\n\t\t\tvalues.push(value);\n\t\t\tvalues.push(trustedValue);\n\t\t}\n\n\t\tfunction TrustGetOrSet(value, callback) {\n\t\t\tvar trustedValue = TrustGetValue(value);\n\t\t\tif (!trustedValue) {\n\t\t\t\ttrustedValue = callback();\n\t\t\t\tTrustSetValue(value, trustedValue);\n\t\t\t}\n\t\t\treturn trustedValue;\n\t\t}\n\n\t\tfunction TrustHtml(value) {\n\t\t\treturn TrustGetOrSet(value, function() {\n\t\t\t\treturn $sce.trustAsHtml(value);\n\t\t\t});\n\t\t}\n\n\t\tfunction TrustResource(value) {\n\t\t\treturn TrustGetOrSet(value, function() {\n\t\t\t\treturn $sce.trustAsResourceUrl(value);\n\t\t\t});\n\t\t}\n\n\t\tfunction TrustUrl(value) {\n\t\t\treturn TrustGetOrSet(value, function() {\n\t\t\t\treturn 'url(\\'' + value + '\\')';\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('FacebookService', ['$promise', '$once', 'LocalStorage', 'environment', function($promise, $once, storage, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\trequire: FacebookRequire,\n\t\t\tlogin: FacebookLogin,\n\t\t\tlogout: FacebookLogout,\n\t\t\tstatus: FacebookStatus,\n\t\t\tgetMe: FacebookGetMe,\n\t\t\tgetMyPicture: FacebookGetMyPicture,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// private vars\n\n\t\tif (!environment.plugins.facebook) {\n\t\t\ttrhow('FacebookService.error missing config object in environment.plugins.facebook');\n\t\t}\n\n\t\tvar config = environment.plugins.facebook;\n\n\t\t// statics methods\n\n\t\t/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\n\t\t *  calling facebook initializer on page load to avoid popup blockers via asyncronous loading  *\n\t\t * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n\t\tvar authResponse = storage.get('facebook');\n\t\t/*\n\t\tauthResponse = {\n\t\t    accessToken: \"accessTokenXXXXX\",\n\t\t    expiresIn: 4962,\n\t\t    signedRequest: \"signedRequestXXXXX\",\n\t\t    userID: \"10214671620773661\",\n\t\t}\n\t\t*/\n\t\tconsole.log('facebook.storage', authResponse);\n\n\t\tfunction FacebookRequire() {\n\t\t\treturn Facebook();\n\t\t}\n\n\t\tfunction Facebook() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tif (window.FB !== undefined) {\n\t\t\t\t\tpromise.resolve(window.FB);\n\t\t\t\t} else {\n\t\t\t\t\tFacebookOnce().then(function(success) {\n\t\t\t\t\t\tpromise.resolve(window.FB);\n\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookOnce() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\t$once.script('//connect.facebook.net/' + environment.language.culture + '/sdk.js', 'fbAsyncInit').then(function() {\n\t\t\t\t\t// console.log('FacebookOnce.fbAsyncInit', window.FB);\n\t\t\t\t\twindow.FB.init({\n\t\t\t\t\t\tappId: config.appId,\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\tcookie: true,\n\t\t\t\t\t\txfbml: true,\n\t\t\t\t\t\tversion: config.version,\n\t\t\t\t\t});\n\t\t\t\t\tpromise.resolve(window.FB);\n\t\t\t\t\t// window.fbAsyncInit = null;\n\t\t\t\t}, function(error) {\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookStatus(response, promise, init) {\n\t\t\tservice.authResponse = null;\n\t\t\tif (response.status === 'connected') {\n\t\t\t\tservice.authResponse = response.authResponse;\n\t\t\t\tstorage.set('facebook', response.authResponse);\n\t\t\t\tpromise.resolve(response);\n\t\t\t} else if (response.status === 'not_authorized') {\n\t\t\t\tstorage.delete('facebook');\n\t\t\t\tif (init) {\n\t\t\t\t\tpromise.resolve(response);\n\t\t\t\t} else {\n\t\t\t\t\tpromise.reject(response);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpromise.reject(response);\n\t\t\t}\n\t\t}\n\n\t\tfunction FacebookGetMe(fields) {\n\t\t\tfields = fields || config.fields;\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tFacebookLogin().then(function(response) {\n\t\t\t\t\twindow.FB.api('/me', {\n\t\t\t\t\t\tfields: fields\n\t\t\t\t\t}, function(response) {\n\t\t\t\t\t\tif (!response || response.error) {\n\t\t\t\t\t\t\tvar error = response ? response.error : 'error';\n\t\t\t\t\t\t\tconsole.log('FacebookGetMe.error', error);\n\t\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('FacebookGetMe.success', response);\n\t\t\t\t\t\t\tpromise.resolve(response);\n\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookGetMyPicture(size) {\n\t\t\tsize = size || 300;\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tFacebookLogin().then(function(facebook) {\n\t\t\t\t\twindow.FB.api('/me/picture', {\n\t\t\t\t\t\twidth: size,\n\t\t\t\t\t\theight: size,\n\t\t\t\t\t\ttype: 'square'\n\t\t\t\t\t}, function(response) {\n\t\t\t\t\t\tif (!response || response.error) {\n\t\t\t\t\t\t\tvar error = response ? response.error : 'error';\n\t\t\t\t\t\t\tconsole.log('FacebookGetMyPicture.error', error);\n\t\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('FacebookGetMyPicture.success', response);\n\t\t\t\t\t\t\tpromise.resolve(response);\n\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookLogin() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tFacebook().then(function(facebook) {\n\t\t\t\t\tconsole.log('FacebookLogin', facebook);\n\t\t\t\t\tfacebook.login(function(response) {\n\t\t\t\t\t\tFacebookStatus(response, promise);\n\t\t\t\t\t}, {\n\t\t\t\t\t\tscope: config.scope\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookLogout() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tFacebook().then(function(facebook) {\n\t\t\t\t\tfacebook.logout(function(response) {\n\t\t\t\t\t\tpromise.resolve(response);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\t// todo !!!\n\n\tapp.service('GoogleService', ['$timeout', '$promise', '$once', 'LocalStorage', 'environment', function($timeout, $promise, $once, storage, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\trequire: GoogleRequire,\n\t\t\tlogin: GoogleLogin,\n\t\t\tlogout: GoogleLogout,\n\t\t\tgetMe: GoogleGetMe,\n\t\t\t// status: GoogleStatus,\n\t\t\t// getMyPicture: GoogleGetMyPicture,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// private vars\n\n\t\tif (!environment.plugins.google) {\n\t\t\ttrhow('GoogleService.error missing config object in environment.plugins.google');\n\t\t}\n\n\t\tvar config = environment.plugins.google;\n\n\t\tvar auth2 = null;\n\n\t\tvar instance = null;\n\n\t\t// statics methods\n\n\t\t/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\n\t\t *  calling google initializer on page load to avoid popup blockers via asyncronous loading  *\n\t\t * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n\t\tvar authResponse = storage.get('google');\n\t\t/*\n\t\tauthResponse = {\n\t\t    access_token: \"accessTokenXXXXX\",\n\t\t    expires_at: 1511992065944,\n\t\t    expires_in: 3600,\n\t\t    first_issued_at: 1511988465944,\n\t\t    id_token: \"idTokenXXXXX\",\n\t\t    idpId: \"google\",\n\t\t    login_hint: \"loginHintXXXXXX\",\n\t\t    scope: \"https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/plus.me openid email profile\"\n\t\t    session_state: {\n\t\t        extraQueryParams: { … }\n\t\t    },\n\t\t    token_type: \"Bearer\"\n\t\t}\n\t\t*/\n\t\tconsole.log('google.storage', authResponse);\n\n\t\tfunction GoogleRequire() {\n\t\t\treturn Auth2Init();\n\t\t}\n\n\t\tfunction Google() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tif (window.gapi !== undefined) {\n\t\t\t\t\tpromise.resolve(window.gapi);\n\t\t\t\t} else {\n\t\t\t\t\tGoogleOnce().then(function(response) {\n\t\t\t\t\t\tpromise.resolve(window.gapi);\n\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleOnce() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\t$once.script('https://apis.google.com/js/api:client.js?onload={{callback}}', true).then(function(data) {\n\t\t\t\t\tpromise.resolve(data);\n\t\t\t\t}, function(error) {\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction Auth2Init() {\n\t\t\treturn $promise(function(promise) {\n\n\t\t\t\tif (auth2) {\n\t\t\t\t\tpromise.resolve(auth2);\n\t\t\t\t} else {\n\t\t\t\t\tGoogle().then(function() {\n\t\t\t\t\t\tfunction onLoaded() {\n\t\t\t\t\t\t\tvar result = window.gapi.auth2.init({\n\t\t\t\t\t\t\t\tclient_id: environment.plugins.google.clientId,\n\t\t\t\t\t\t\t\tcookiepolicy: 'single_host_origin',\n\t\t\t\t\t\t\t\tscope: 'profile email',\n\t\t\t\t\t\t\t\tfetch_basic_profile: true,\n\t\t\t\t\t\t\t\tux_mode: 'popup',\n\n\t\t\t\t\t\t\t}).then(function() {\n\t\t\t\t\t\t\t\tauth2 = window.gapi.auth2;\n\t\t\t\t\t\t\t\tconsole.log('Auth2Init.success', auth2);\n\t\t\t\t\t\t\t\tpromise.resolve(auth2);\n\n\t\t\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\t\t\tconsole.log('Auth2Init.error', error);\n\t\t\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (window.gapi.auth2) {\n\t\t\t\t\t\t\tonLoaded();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.gapi.load('auth2', function() {\n\t\t\t\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\t\t\t\tonLoaded();\n\t\t\t\t\t\t\t\t}, 200);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\tconsole.log('Auth2Init.error', error);\n\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction Auth2Instance() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tif (instance) {\n\t\t\t\t\tpromise.resolve();\n\t\t\t\t} else {\n\t\t\t\t\tAuth2Init().then(function(auth2) {\n\t\t\t\t\t\tinstance = auth2.getAuthInstance();\n\t\t\t\t\t\tconsole.log('GoogleService.Auth2Instance.success', instance);\n\t\t\t\t\t\tpromise.resolve();\n\n\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\tconsole.log('GoogleService.Auth2Instance.error', error);\n\t\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleGetMe() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tGoogleLogin().then(function(response) {\n\t\t\t\t\tvar profile = instance.currentUser.get().getBasicProfile();\n\t\t\t\t\tvar user = {\n\t\t\t\t\t\tid: profile.getId(),\n\t\t\t\t\t\tname: profile.getName(),\n\t\t\t\t\t\tfirstName: profile.getGivenName(),\n\t\t\t\t\t\tlastName: profile.getFamilyName(),\n\t\t\t\t\t\tpicture: profile.getImageUrl(),\n\t\t\t\t\t\temail: profile.getEmail(),\n\t\t\t\t\t};\n\t\t\t\t\tconsole.log('GoogleGetMe.success', user);\n\t\t\t\t\tpromise.resolve(user);\n\n\t\t\t\t}, function(error) {\n\t\t\t\t\tconsole.log('GoogleGetMe.error', error);\n\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleLogin() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tAuth2Instance().then(function() {\n\t\t\t\t\tif (instance.isSignedIn && instance.isSignedIn.get()) {\n\t\t\t\t\t\t// Auth2Instance.isSignedIn.listen(onStatus);\n\t\t\t\t\t\treadAccessToken();\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('GoogleLogin.signIn');\n\t\t\t\t\t\tinstance.signIn({\n\t\t\t\t\t\t\tscope: 'profile email',\n\n\t\t\t\t\t\t}).then(function(signed) {\n\t\t\t\t\t\t\treadAccessToken();\n\n\t\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\t\tconsole.log('GoogleLogin.error', error);\n\t\t\t\t\t\t\tstorage.delete('google');\n\t\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction readAccessToken() {\n\t\t\t\t\t\tconsole.log('GoogleLogin.readAccessToken');\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar response = instance.currentUser.get().getAuthResponse(true);\n\t\t\t\t\t\t\tconsole.log('GoogleLogin.readAccessToken.success', response);\n\t\t\t\t\t\t\tstorage.set('google', response);\n\t\t\t\t\t\t\tpromise.resolve({\n\t\t\t\t\t\t\t\tcode: response.access_token,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.log('GoogleLogin.readAccessToken.error', error);\n\t\t\t\t\t\t\tstorage.delete('google');\n\t\t\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction onStatus(signed) {\n\t\t\t\t\t\tconsole.log('GoogleLogin.onStatus', signed);\n\t\t\t\t\t\tif (signed) {\n\t\t\t\t\t\t\treadAccessToken();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, function(error) {\n\t\t\t\t\tconsole.log('GoogleLogin.error', error);\n\t\t\t\t\t// promise.reject(error);\n\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleLogout() {\n\t\t\treturn $promise(function(promise) {\n\n\t\t\t\tAuth2Instance().then(function() {\n\t\t\t\t\tif (instance.isSignedIn && instance.isSignedIn.get()) {\n\t\t\t\t\t\tinstance.signOut().then(function(signed) {\n\t\t\t\t\t\t\tpromise.resolve();\n\n\t\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\t\tconsole.log('GoogleService.signOut.error', error);\n\t\t\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpromise.resolve();\n\t\t\t\t\t}\n\n\t\t\t\t}, function(error) {\n\t\t\t\t\tconsole.log('GoogleService.signOut.error', error);\n\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    // todo !!!\n\n    app.directive('googlemaps', ['$timeout', '$compile', '$promise', 'Http', 'GoogleMaps', 'environment', function($timeout, $compile, $promise, Http, GoogleMaps, environment) {\n\n        var directive = {\n            restrict: 'A',\n            scope: {\n                connector: '=googlemaps',\n            },\n            link: GooglemapsLink,\n        };\n\n        if (!environment.plugins.googlemaps) {\n            trhow('googlemaps.error missing config object in environment.plugins.googlemaps');\n        }\n\n        var config = environment.plugins.googlemaps;\n\n        return directive;\n\n        function GooglemapsLink(scope, element, attributes) {\n            console.log('GooglemapsLink', arguments);\n\n            var map, options, info, bounds, clusterer;\n            var filters = {};\n            var markers = [];\n\n            var publics = {\n                // methods available for controllers\n                /*\n                fly: MapboxFly,\n                flyPosition: MapboxFlyPosition,\n                jump: MapboxJump,\n                jumpPosition: MapboxJumpPosition,\n                */\n                setMarkers: GooglemapsMarkersSet,\n                setType: GooglemapsSetType,\n            };\n\n            if (scope.connector) {\n                angular.extend(scope.connector, publics);\n            }\n\n            Googlemaps();\n\n            function Googlemaps() {\n                return $promise(function(promise) {\n                    GoogleMaps.maps().then(function() {\n                        GooglemapsOptions().then(function(options) {\n                            map = new google.maps.Map(element[0], options);\n                            info = GooglemapsInfo();\n                            promise.resolve(map);\n                        });\n                    });\n                });\n            }\n\n            function GooglemapsOptions() {\n                return $promise(function(promise) {\n                    var options = angular.copy(config.options);\n                    if (config.styles) {\n                        Http.get(config.styles).then(function(styles) {\n                            options.styles = styles;\n                            promise.resolve(options);\n\n                        }, function(error) {\n                            console.log('GooglemapsOptions.error', 'unable to load styles', config.styles);\n                            promise.resolve(options);\n\n                        });\n\n                    } else {\n                        promise.resolve(options);\n                    }\n                });\n            }\n\n            function GooglemapsMarkersRemove() {\n                angular.forEach(markers, function(marker) {\n                    marker.setMap(null);\n                });\n            }\n\n            function GooglemapsMarkersSet(items) {\n                Googlemaps().then(function(map) {\n                    GooglemapsMarkersRemove();\n                    bounds = new google.maps.LatLngBounds();\n\n                    markers = items.filter(function(item) {\n                        var has = true;\n                        if (filters.month) {\n                            has = has && filters.month.items.has(item.id);\n                        }\n                        if (filters.category) {\n                            has = has && item.categories.indexOf(filters.category.key) !== -1;\n                        }\n                        return has;\n\n                    }).map(function(item) {\n                        return GooglemapsMarker(item);\n\n                    });\n\n                    if (config.clusterer) {\n                        clusterer = GooglemapsClusterer(markers);\n                    }\n\n                });\n            }\n\n            function GooglemapsBoundsFit() {\n                if (!bounds.isEmpty()) {\n                    map.fitBounds(bounds);\n                }\n            }\n\n            function GooglemapsSetType(typeId) {\n                var types = ['hybrid', 'roadmap', 'satellite', 'terrain'];\n                if (types.indexOf(typeId) !== -1) {\n                    map.setMapTypeId(typeId);\n                }\n            }\n\n            function GooglemapsInfo() {\n\n                var info = new google.maps.InfoWindow({\n                    maxWidth: 350,\n                    pixelOffset: new google.maps.Size(0, 15),\n                });\n\n                google.maps.event.addListener(info, 'domready', function() {\n                    var outer = $('.gm-style-iw');\n                    var background = outer.prev();\n                    background.children(':nth-child(2)').css({\n                        'display': 'none'\n                    });\n                    background.children(':nth-child(4)').css({\n                        'display': 'none'\n                    });\n                    outer.parent().parent().css({\n                        left: '115px'\n                    });\n                    background.children(':nth-child(1)').attr('style', function(i, s) {\n                        return s + 'display: none!important';\n                    });\n                    background.children(':nth-child(3)').attr('style', function(i, s) {\n                        return s + 'display: none!important';\n                    });\n                    background.children(':nth-child(3)').find('div').children().attr('style', function(i, s) {\n                        return s + 'opacity: 0!important;';\n                    });\n                    var close = outer.next();\n                    close.css({\n                        'width': '13px',\n                        'height': '13px',\n                        'overflow': 'hidden',\n                        'position': 'absolute',\n                        'right': '56px',\n                        'top': '17px',\n                        'z-index': '10000',\n                        'cursor': 'pointer',\n                        'opacity': 1,\n                        'transform': 'scale(0.8)'\n                    });\n                    close.mouseout(function() {\n                        $(this).css({\n                            opacity: '1'\n                        });\n                    });\n                });\n\n                return info;\n            }\n\n            function GooglemapsMarker(item) {\n\n                var latLng = new google.maps.LatLng(\n                    item.position.latitude,\n                    item.position.longitude\n                );\n\n                var marker = new google.maps.Marker({\n                    position: latLng,\n                    item: item,\n                    icon: {\n                        url: 'img/maps/marker.png',\n                        scaledSize: new google.maps.Size(25, 25),\n                        origin: new google.maps.Point(0, 0),\n                        anchor: new google.maps.Point(0, 0)\n                    },\n                    map: map,\n                    contentString: '<div id=\"iw-container\">' +\n                        '<div class=\"iw-image\" ng-style=\"{ \\'background-image\\': cssUrl(selectedBlog.image.url) }\"></div>' +\n                        '<div class=\"iw-title\" ng-bind=\"selectedBlog.title\"></div>' +\n                        '<div class=\"iw-cta\"><button type=\"button\" class=\"iw-link\" ng-click=\"openBlog(selectedBlog)\">Details</button></div>' +\n                        '</div>'\n                });\n\n                marker.onClick = function() {\n                    var marker = this;\n                    $timeout(function() {\n                        scope.selectedBlog = marker.item;\n                        var html = $compile(marker.contentString)(scope);\n                        info.setContent(html[0]);\n                        info.open(map, marker);\n                    });\n                };\n\n                marker.addListener('click', marker.onClick);\n\n                bounds.extend(latLng);\n\n                return marker;\n            }\n\n            function GooglemapsClusterer(markers) {\n\n                var clusterer = new MarkerClusterer(map, markers, {\n                    cssClass: 'cluster',\n                    imagePath: '/img/gmap/m'\n                });\n\n                return clusterer;\n\n            }\n\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('GoogleMaps', ['$promise', '$once', 'environment', function($promise, $once, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tmaps: GoogleMaps,\n\t\t\tgeocoder: GoogleMapsGeocoder,\n\t\t\tparse: GoogleMapsParse,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tif (!environment.plugins.googlemaps) {\n\t\t\ttrhow('GoogleMaps.error missing config object in environment.plugins.googlemaps');\n\t\t}\n\n\t\tfunction GoogleMaps() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tvar apiKey = environment.plugins.googlemaps.apiKey;\n\t\t\t\t$once.script('https://maps.googleapis.com/maps/api/js?key=' + apiKey + '&callback={{callback}}', true).then(function(data) {\n\t\t\t\t\tpromise.resolve(window.google.maps);\n\t\t\t\t}, function(error) {\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleMapsGeocoder() {\n\t\t\tvar service = this;\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tGoogleMaps().then(function(maps) {\n\t\t\t\t\tvar geocoder = new maps.Geocoder();\n\t\t\t\t\tpromise.resolve(geocoder);\n\n\t\t\t\t}, function(error) {\n\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleMapsType(type, item) {\n\t\t\tvar types = {\n\t\t\t\tstreet: 'route',\n\t\t\t\tnumber: 'street_number',\n\t\t\t\tlocality: 'locality',\n\t\t\t\tpostalCode: 'postal_code',\n\t\t\t\tcity: 'administrative_area_level_3',\n\t\t\t\tprovince: 'administrative_area_level_2',\n\t\t\t\tregion: 'administrative_area_level_1',\n\t\t\t\tcountry: 'country',\n\t\t\t};\n\t\t\tvar label = null;\n\t\t\tangular.forEach(item.address_components, function(c) {\n\t\t\t\tangular.forEach(c.types, function(t) {\n\t\t\t\t\tif (t === types[type]) {\n\t\t\t\t\t\tlabel = c.long_name;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\t// console.log('GoogleMapsType', type, item, label);\n\t\t\treturn label;\n\t\t}\n\n\t\tfunction GoogleMapsParse(results) {\n\t\t\tvar items = null;\n\t\t\tif (results.length) {\n\t\t\t\titems = results.filter(function(item) {\n\t\t\t\t\treturn true; // item.geometry.location_type === 'ROOFTOP' ||\n\t\t\t\t\t// item.geometry.location_type === 'RANGE_INTERPOLATED' ||\n\t\t\t\t\t// item.geometry.location_type === 'GEOMETRIC_CENTER';\n\t\t\t\t}).map(function(item) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: item.formatted_address,\n\t\t\t\t\t\tstreet: GoogleMapsType('street', item),\n\t\t\t\t\t\tnumber: GoogleMapsType('number', item),\n\t\t\t\t\t\tlocality: GoogleMapsType('locality', item),\n\t\t\t\t\t\tpostalCode: GoogleMapsType('postalCode', item),\n\t\t\t\t\t\tcity: GoogleMapsType('city', item),\n\t\t\t\t\t\tprovince: GoogleMapsType('province', item),\n\t\t\t\t\t\tregion: GoogleMapsType('region', item),\n\t\t\t\t\t\tcountry: GoogleMapsType('country', item),\n\t\t\t\t\t\tposition: {\n\t\t\t\t\t\t\tlng: item.geometry.location.lng(),\n\t\t\t\t\t\t\tlat: item.geometry.location.lat(),\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\t/*\n\t\t\t\tvar first = response.data.results[0];\n\t\t\t\tscope.model.position = first.geometry.location;\n\t\t\t\tconsole.log(scope.model);\n\t\t\t\tsetLocation();\n\t\t\t\t*/\n\t\t\t}\n\t\t\tconsole.log('GoogleMapsParse', results, items);\n\t\t\treturn items;\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('mapbox', ['$http', '$timeout', '$compile', '$promise', 'MapBox', 'environment', function($http, $timeout, $compile, $promise, MapBox, environment) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\tscope: {\n\t\t\t\tconnector: '=mapbox',\n\t\t\t},\n\t\t\tlink: MapboxLink,\n\t\t};\n\n\t\tif (!environment.plugins.mapbox) {\n\t\t\ttrhow('mapbox.error missing config object in environment.plugins.mapbox');\n\t\t}\n\n\t\tvar config = environment.plugins.mapbox;\n\n\t\treturn directive;\n\n\t\tfunction MapboxLink(scope, element, attributes, model) {\n\t\t\tvar map, markers, marker, geocoder, bounds, canvas, dragging, overing;\n\n\t\t\tvar publics = {\n\t\t\t\t// methods available for controllers\n\t\t\t\tfly: MapboxFly,\n\t\t\t\tflyPosition: MapboxFlyPosition,\n\t\t\t\tjump: MapboxJump,\n\t\t\t\tjumpPosition: MapboxJumpPosition,\n\t\t\t\tsetMarkers: MapboxMarkersSet,\n\t\t\t\tfitBounds: MapboxBoundsFit,\n\t\t\t};\n\n\t\t\tif (scope.connector) {\n\t\t\t\tangular.extend(scope.connector, publics);\n\t\t\t}\n\n\t\t\tfunction MapboxMap() {\n\t\t\t\treturn $promise(function(promise) {\n\n\t\t\t\t\tMapBox.get().then(function(mapboxgl) {\n\t\t\t\t\t\tmap = new mapboxgl.Map({\n\t\t\t\t\t\t\tcontainer: element[0],\n\t\t\t\t\t\t\tstyle: config.style,\n\t\t\t\t\t\t\tinteractive: true,\n\t\t\t\t\t\t\tlogoPosition: 'bottom-right',\n\t\t\t\t\t\t\t// center: config.options.center,\n\t\t\t\t\t\t\t// zoom: config.options.zoom,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tcanvas = map.getCanvasContainer();\n\t\t\t\t\t\t/*\n\t\t\t\t\t\tscope.map.setAddress = function (item) {\n\t\t\t\t\t\t\t// console.log('setAddress', item);\n\t\t\t\t\t\t\tscope.map.results = null;\n\t\t\t\t\t\t\tflyTo(item.position);\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.map.search = function () {\n\t\t\t\t\t\t\t// console.log('address', scope.map.address);\n\t\t\t\t\t\t\tscope.map.results = null;\n\t\t\t\t\t\t\tgeocodeAddress(scope.map.address);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.map.styles = {\n\t\t\t\t\t\t\tFICO: 1,\n\t\t\t\t\t\t\tSATELLITE: 2,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.map.style = scope.map.styles.FICO;\n\t\t\t\t\t\tscope.map.styleToggle = function () {\n\t\t\t\t\t\t\tif (scope.map.style === scope.map.styles.FICO) {\n\t\t\t\t\t\t\t\tscope.map.style = scope.map.styles.SATELLITE;\n\t\t\t\t\t\t\t\tmap.setStyle('mapbox://styles/mapbox/satellite-v9');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tscope.map.style = scope.map.styles.FICO;\n\t\t\t\t\t\t\t\tmap.setStyle('mapbox://styles/mapbox/streets-v9');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.map.setStyle = function (style) {\n\t\t\t\t\t\t\tscope.map.style = style;\n\t\t\t\t\t\t\tif (scope.map.style === scope.map.styles.FICO) {\n\t\t\t\t\t\t\t\tmap.setStyle('mapbox://styles/mapbox/streets-v9');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tmap.setStyle('mapbox://styles/mapbox/satellite-v9');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\t*/\n\t\t\t\t\t\tif (config.options) {\n\t\t\t\t\t\t\tmap.jumpTo(config.options);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpromise.resolve(map);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction MapboxFly(options) {\n\t\t\t\tmap.flyTo(options);\n\t\t\t}\n\n\t\t\tfunction MapboxFlyPosition(position) {\n\t\t\t\tvar options = getOptions({\n\t\t\t\t\tcenter: [position.lng, position.lat],\n\t\t\t\t\tzoom: 20,\n\t\t\t\t});\n\t\t\t\tMapboxFly(options);\n\t\t\t}\n\n\t\t\tfunction MapboxJump(options) {\n\t\t\t\tmap.jumpTo(options);\n\t\t\t}\n\n\t\t\tfunction MapboxJumpPosition(position) {\n\t\t\t\tvar options = getOptions({\n\t\t\t\t\tcenter: [position.lng, position.lat],\n\t\t\t\t\tzoom: 20,\n\t\t\t\t});\n\t\t\t\tmap.MapboxJump(options);\n\t\t\t}\n\n\t\t\t/*\n\t\t\tgoogleMaps.geocoder().then(function (response) {\n\t\t\t    geocoder = response;\n\t\t\t    init();\n\t\t\t});\n\t\t\t*/\n\n\t\t\tfunction getOptions(options) {\n\t\t\t\treturn angular.extend(angular.copy(config.options), options);\n\t\t\t}\n\n\t\t\tfunction MapboxMarkersRemove() {\n\t\t\t\tif (markers) {\n\t\t\t\t\tangular.forEach(markers, function(item) {\n\t\t\t\t\t\titem.remove();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction MapboxMarkersSet(items) {\n\t\t\t\tMapboxMap().then(function() {\n\t\t\t\t\tMapboxMarkersRemove();\n\t\t\t\t\tmarkers = [];\n\t\t\t\t\tif (config.clusterer) {\n\t\t\t\t\t\tMapboxClusterer(items);\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (items) {\n\t\t\t\t\t\t\tangular.forEach(items, function(item) {\n\t\t\t\t\t\t\t\tvar marker = MapboxMarkerAdd(item);\n\t\t\t\t\t\t\t\tmarkers.push(marker);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction MapboxMarkerAdd(item) {\n\t\t\t\tvar $scope = scope.$new(true);\n\t\t\t\t$scope.item = item;\n\t\t\t\tvar node = document.createElement('div');\n\t\t\t\tnode.id = 'point';\n\t\t\t\tnode.className = 'marker ' + item.area.code;\n\t\t\t\tnode.className += item.type;\n\t\t\t\tnode.setAttribute('marker', 'item');\n\t\t\t\tvar marker = new mapboxgl.Marker(node, {\n\t\t\t\t\t\toffset: [-10, -10]\n\t\t\t\t\t})\n\t\t\t\t\t.setLngLat([item.position.lng, item.position.lat])\n\t\t\t\t\t.addTo(map);\n\t\t\t\tvar markerElement = angular.element(node);\n\t\t\t\tmarkerElement.on('click', function(e) {\n\t\t\t\t\t// console.log('marker.click', item);\n\t\t\t\t\tscope.$emit('onMarkerClicked', item);\n\t\t\t\t});\n\t\t\t\t$compile(markerElement)($scope); // Compiling marker\n\t\t\t\treturn marker;\n\t\t\t}\n\n\t\t\tfunction MapboxCoordinatesGet(item) {\n\t\t\t\tvar coordinates = null;\n\t\t\t\tif (item.position) {\n\t\t\t\t\tcoordinates = [\n                        item.position.longitude,\n                        item.position.latitude,\n                        item.position.altitude || 0.0,\n                    ];\n\t\t\t\t}\n\t\t\t\t// [0, 1, 2]; longitude, latitude, altitude\n\t\t\t\treturn coordinates;\n\t\t\t}\n\n\t\t\tfunction MapboxFeaturesGet(items) {\n\t\t\t\tvar collection = null;\n\t\t\t\tif (items) {\n\t\t\t\t\tvar features = items.map(function(item) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttype: 'Feature',\n\t\t\t\t\t\t\tproperties: angular.extend({}, item),\n\t\t\t\t\t\t\tgeometry: {\n\t\t\t\t\t\t\t\ttype: 'Point',\n\t\t\t\t\t\t\t\tcoordinates: MapboxCoordinatesGet(item),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\t\t\t\t\tcollection = {\n\t\t\t\t\t\ttype: 'FeatureCollection',\n\t\t\t\t\t\tcrs: {\n\t\t\t\t\t\t\ttype: 'name',\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tname: 'urn:ogc:def:crs:OGC:1.3:CRS84'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfeatures: features,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn collection;\n\t\t\t}\n\n\t\t\tfunction MapboxClusterer(items) {\n\n\t\t\t\tvar collection = MapboxFeaturesGet(items);\n\n\t\t\t\tmap.on('load', function() {\n\t\t\t\t\t// Add a new source from our GeoJSON data and set the\n\t\t\t\t\t// 'cluster' option to true. GL-JS will add the point_count property to your source data.\n\t\t\t\t\tmap.addSource('earthquakes', {\n\t\t\t\t\t\ttype: 'geojson',\n\t\t\t\t\t\t// Point to GeoJSON data. This example visualizes all M1.0+ earthquakes\n\t\t\t\t\t\t// from 12/22/15 to 1/21/16 as logged by USGS' Earthquake hazards program.\n\t\t\t\t\t\t// data: '/api/mapbox/earthquakes.geo.json',\n\t\t\t\t\t\tdata: collection,\n\t\t\t\t\t\tcluster: true,\n\t\t\t\t\t\tclusterMaxZoom: 14, // Max zoom to cluster points on\n\t\t\t\t\t\tclusterRadius: 50 // Radius of each cluster when clustering points (defaults to 50)\n\t\t\t\t\t});\n\n\t\t\t\t\tmap.addLayer({\n\t\t\t\t\t\tid: 'clusters',\n\t\t\t\t\t\ttype: 'circle',\n\t\t\t\t\t\tsource: 'earthquakes',\n\t\t\t\t\t\tfilter: ['has', 'point_count'],\n\t\t\t\t\t\tpaint: {\n\t\t\t\t\t\t\t'circle-color': {\n\t\t\t\t\t\t\t\tproperty: 'point_count',\n\t\t\t\t\t\t\t\ttype: 'interval',\n\t\t\t\t\t\t\t\tstops: [\n                                    [0, '#51bbd6'],\n                                    [100, '#f1f075'],\n                                    [750, '#f28cb1'],\n                                ]\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t'circle-radius': {\n\t\t\t\t\t\t\t\tproperty: 'point_count',\n\t\t\t\t\t\t\t\ttype: 'interval',\n\t\t\t\t\t\t\t\tstops: [\n                                    [0, 20],\n                                    [100, 30],\n                                    [750, 40]\n                                ]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tmap.addLayer({\n\t\t\t\t\t\tid: 'cluster-count',\n\t\t\t\t\t\ttype: 'symbol',\n\t\t\t\t\t\tsource: 'earthquakes',\n\t\t\t\t\t\tfilter: ['has', 'point_count'],\n\t\t\t\t\t\tlayout: {\n\t\t\t\t\t\t\t'text-field': '{point_count_abbreviated}',\n\t\t\t\t\t\t\t'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],\n\t\t\t\t\t\t\t'text-size': 12\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tmap.addLayer({\n\t\t\t\t\t\tid: 'unclustered-point',\n\t\t\t\t\t\ttype: 'circle',\n\t\t\t\t\t\tsource: 'earthquakes',\n\t\t\t\t\t\tfilter: ['!has', 'point_count'],\n\t\t\t\t\t\tpaint: {\n\t\t\t\t\t\t\t'circle-color': '#11b4da',\n\t\t\t\t\t\t\t'circle-radius': 4,\n\t\t\t\t\t\t\t'circle-stroke-width': 1,\n\t\t\t\t\t\t\t'circle-stroke-color': '#fff'\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction MapboxBoundsFit() {\n\t\t\t\tif (bounds) {\n\t\t\t\t\tmap.fitBounds(bounds, {\n\t\t\t\t\t\tspeed: 1.5,\n\t\t\t\t\t\tcurve: 1,\n\t\t\t\t\t\tpadding: 30,\n\t\t\t\t\t\tlinear: false,\n\t\t\t\t\t\tmaxZoom: 8,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction geocodeAddress(address) {\n\t\t\t\tgeocoder.geocode({\n\t\t\t\t\t'address': address\n\t\t\t\t}, function(results, status) {\n\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\tif (status === 'OK') {\n\t\t\t\t\t\t\tconnector.results = googleMaps.parse(results);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\talert('Geocode was not successful for the following reason: ' + status);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction reverseGeocode(position) {\n\t\t\t\t// console.log('reverseGeocode', position);\n\t\t\t\tgeocoder.geocode({\n\t\t\t\t\t'location': position\n\t\t\t\t}, function(results, status) {\n\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\tif (status === 'OK') {\n\t\t\t\t\t\t\tconnector.results = googleMaps.parse(results);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Geocoder failed due to: ' + status);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction geolocalize() {\n\t\t\t\tif (navigator.geolocation) {\n\t\t\t\t\tnavigator.geolocation.getCurrentPosition(function(p) {\n\t\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\t\tvar position = {\n\t\t\t\t\t\t\t\tlat: p.coords.latitude,\n\t\t\t\t\t\t\t\tlng: p.coords.longitude\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tflyTo(position);\n\t\t\t\t\t\t\treverseGeocode(position);\n\t\t\t\t\t\t});\n\t\t\t\t\t}, function(e) {\n\t\t\t\t\t\tconsole.log('error', e);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('error', 'Browser doesn\\'t support Geolocation');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/*\n\t\t\tfunction flyTo(position) {\n\t\t\t    map.flyTo({\n\t\t\t        center: [\n\t\t\t            parseFloat(position.lng),\n\t\t\t            parseFloat(position.lat)\n\t\t\t        ],\n\t\t\t        zoom: 15,\n\t\t\t        speed: 1.5,\n\t\t\t        curve: 1,\n\t\t\t    });\n\t\t\t}\n\t\t\t*/\n\n\t\t}\n    }]);\n\n\tapp.directive('marker', ['$http', '$timeout', function($http, $timeout) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\tscope: {\n\t\t\t\titem: '=marker',\n\t\t\t},\n\t\t\ttemplate: '<div class=\"inner\">' +\n\t\t\t\t'   <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"40\" height=\"40\" viewBox=\"0 0 24 24\">' +\n\t\t\t\t'       <path d=\"M12 0c-5.522 0-10 4.395-10 9.815 0 5.505 4.375 9.268 10 14.185 5.625-4.917 10-8.68 10-14.185 0-5.42-4.478-9.815-10-9.815zm0 18c-4.419 0-8-3.582-8-8s3.581-8 8-8 8 3.582 8 8-3.581 8-8 8z\"/>' +\n\t\t\t\t'   </svg>' +\n\t\t\t\t'   <span ng-bind=\"item.code\"></span>' +\n\t\t\t\t'</div>',\n\t\t\tlink: link,\n\t\t};\n\n\t\tfunction link(scope, element, attributes, model) {\n\t\t\t// console.log('marker', scope.item);\n\t\t}\n\n    }]);\n\n\t/*\n\tapp.service('GoogleMaps', ['$q', '$http', function ($q, $http) {\n\t\tvar _key = 'AIzaSyAYuhIEO-41YT_GdYU6c1N7DyylT_OcMSY';\n\t\tvar _init = false;\n\n\t\tthis.maps = maps;\n\t\tthis.geocoder = geocoder;\n\t\tthis.parse = parse;\n\n\t\tfunction maps() {\n\t\t\tvar deferred = $q.defer();\n\t\t\tif (_init) {\n\t\t\t\tdeferred.resolve(window.google.maps);\n\t\t\t} else {\n\t\t\t\twindow.googleMapsInit = function () {\n\t\t\t\t\tdeferred.resolve(window.google.maps);\n\t\t\t\t\twindow.googleMapsInit = null;\n\t\t\t\t\t_init = true;\n\t\t\t\t};\n\t\t\t\tvar script = document.createElement('script');\n\t\t\t\tscript.setAttribute('async', null);\n\t\t\t\tscript.setAttribute('defer', null);\n\t\t\t\tscript.setAttribute('src', 'https://maps.googleapis.com/maps/api/js?key=' + _key + '&callback=googleMapsInit');\n\t\t\t\tdocument.body.appendChild(script);\n\t\t\t}\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tfunction geocoder() {\n\t\t\tvar service = this;\n\t\t\tvar deferred = $q.defer();\n\t\t\tmaps().then(function (maps) {\n\t\t\t\tvar _geocoder = new maps.Geocoder();\n\t\t\t\tdeferred.resolve(_geocoder);\n\t\t\t}, function (error) {\n\t\t\t\tdeferred.reject(error);\n\t\t\t});\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tfunction getType(type, item) {\n\t\t\tvar types = {\n\t\t\t\tstreet: 'route',\n\t\t\t\tnumber: 'street_number',\n\t\t\t\tlocality: 'locality',\n\t\t\t\tpostalCode: 'postal_code',\n\t\t\t\tcity: 'administrative_area_level_3',\n\t\t\t\tprovince: 'administrative_area_level_2',\n\t\t\t\tregion: 'administrative_area_level_1',\n\t\t\t\tcountry: 'country',\n\t\t\t};\n\t\t\tvar label = null;\n\t\t\tangular.forEach(item.address_components, function (c) {\n\t\t\t\tangular.forEach(c.types, function (t) {\n\t\t\t\t\tif (t === types[type]) {\n\t\t\t\t\t\tlabel = c.long_name;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\t// console.log('googleMaps.getType', type, item, label);\n\t\t\treturn label;\n\t\t}\n\n\t\tfunction parse(results) {\n\t\t\tvar items = null;\n\t\t\tif (results.length) {\n\t\t\t\titems = results.filter(function (item) {\n\t\t\t\t\treturn true; // item.geometry.location_type === 'ROOFTOP' ||\n\t\t\t\t\t// item.geometry.location_type === 'RANGE_INTERPOLATED' ||\n\t\t\t\t\t// item.geometry.location_type === 'GEOMETRIC_CENTER';\n\t\t\t\t}).map(function (item) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: item.formatted_address,\n\t\t\t\t\t\tstreet: getType('street', item),\n\t\t\t\t\t\tnumber: getType('number', item),\n\t\t\t\t\t\tlocality: getType('locality', item),\n\t\t\t\t\t\tpostalCode: getType('postalCode', item),\n\t\t\t\t\t\tcity: getType('city', item),\n\t\t\t\t\t\tprovince: getType('province', item),\n\t\t\t\t\t\tregion: getType('region', item),\n\t\t\t\t\t\tcountry: getType('country', item),\n\t\t\t\t\t\tposition: {\n\t\t\t\t\t\t\tlng: item.geometry.location.lng(),\n\t\t\t\t\t\t\tlat: item.geometry.location.lat(),\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\t\t\tconsole.log('googleMaps.parse', results, items);\n\t\t\treturn items;\n\t\t}\n\n    }]);\n    */\n\n}());\n\n/* global angular */\n\n(function() {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('MapBox', ['$q', '$http', '$promise', '$once', 'environment', function($q, $http, $promise, $once, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tget: MapBoxGet,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tif (!environment.plugins.mapbox) {\n\t\t\ttrhow('MapBox.error missing config object in environment.plugins.mapbox');\n\t\t}\n\n\t\tvar config = environment.plugins.mapbox;\n\n\t\tfunction MapBoxGet() {\n\t\t\treturn $promise(function(promise) {\n\t\t\t\tif (window.mapboxgl) {\n\t\t\t\t\tpromise.resolve(window.mapboxgl);\n\t\t\t\t} else {\n\t\t\t\t\t$promise.all([\n                        $once.script('//api.tiles.mapbox.com/mapbox-gl-js/' + config.version + '/mapbox-gl.js'),\n                        $once.link('//api.tiles.mapbox.com/mapbox-gl-js/' + config.version + '/mapbox-gl.css'),\n                    ]).then(function() {\n\t\t\t\t\t\twindow.mapboxgl.accessToken = config.accessToken;\n\t\t\t\t\t\tpromise.resolve(window.mapboxgl);\n\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n"]}