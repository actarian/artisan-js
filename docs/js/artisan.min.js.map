{"version":3,"sources":["docs/js/artisan.js"],"names":["angular","module","service","$promise","environment","Facebook","promise","undefined","window","FB","resolve","FacebookInit","then","success","error","reject","FacebookStatus","response","init","authResponse","status","FacebookGetMe","fields","config","FacebookLogin","facebook","console","log","api","FacebookGetMyPicture","size","width","height","type","login","scope","FacebookLogout","logout","fbAsyncInit","appId","app_id","cookie","xfbml","version","d","s","id","js","fjs","getElementsByTagName","getElementById","createElement","src","language","culture","parentNode","insertBefore","document","this","statics","getMe","getMyPicture","extend","addons","trhow","directive","$timeout","$compile","Http","GoogleMaps","GooglemapsLink","element","attributes","Googlemaps","maps","GooglemapsOptions","options","map","google","Map","info","GooglemapsInfo","copy","styles","get","GooglemapsMarkersRemove","forEach","markers","marker","setMap","GooglemapsMarkersSet","items","bounds","LatLngBounds","filter","item","has","filters","month","category","categories","indexOf","key","GooglemapsMarker","clusterer","GooglemapsClusterer","GooglemapsSetType","typeId","setMapTypeId","InfoWindow","maxWidth","pixelOffset","Size","event","addListener","outer","$","background","prev","children","css","display","parent","left","attr","i","find","close","next","overflow","position","right","top","z-index","cursor","opacity","transform","mouseout","latLng","LatLng","latitude","longitude","Marker","icon","url","scaledSize","origin","Point","anchor","contentString","onClick","selectedBlog","html","setContent","open","MarkerClusterer","cssClass","imagePath","arguments","publics","setMarkers","setType","connector","restrict","link","googlemaps","googleMapsAsyncInit","apiKey","script","setAttribute","body","appendChild","GoogleMapsGeocoder","geocoder","Geocoder","GoogleMapsType","types","street","number","locality","postalCode","city","province","region","country","label","address_components","c","t","long_name","GoogleMapsParse","results","length","name","formatted_address","lng","geometry","location","lat","parse","app","$http","MapBox","MapboxLink","model","MapboxMap","mapboxgl","container","style","interactive","logoPosition","canvas","getCanvasContainer","jumpTo","MapboxFly","flyTo","MapboxFlyPosition","getOptions","center","zoom","MapboxJump","MapboxJumpPosition","MapboxMarkersRemove","remove","MapboxMarkersSet","MapboxClusterer","MapboxMarkerAdd","push","$scope","$new","node","className","area","code","offset","setLngLat","addTo","markerElement","on","e","$emit","MapboxCoordinatesGet","coordinates","altitude","MapboxFeaturesGet","collection","crs","properties","features","addSource","data","cluster","clusterMaxZoom","clusterRadius","addLayer","source","paint","circle-color","property","stops","circle-radius","layout","text-field","text-font","text-size","circle-stroke-width","circle-stroke-color","MapboxBoundsFit","fitBounds","speed","curve","padding","linear","maxZoom","fly","flyPosition","jump","jumpPosition","mapbox","template","$q","MapBoxGet","all","MapBoxScript","MapBoxLink","accessToken","addEventListener","rel","href","_init","__googleMapsInit","_key","deferred","defer","_geocoder","getType","provider","$locationProvider","$httpProvider","EnvironmentSetHttp","defaults","headers","common","withCredentials","http","interceptors","apply","EnvironmentSetLocation","html5Mode","html5","hashPrefix","hash","EnvironmentAdd","merge","EnvironmentSet","value","EnvironmentGet","global","EnvironmentUse","paths","add","use","disableDefaultUI","mapTypeId","scrollwheel","bearing","pitch","iso","$get","factory","Animate","callback","ticks","pause","animate","cancelAnimationFrame","play","loop","time","requestAnimationFrame","toggle","prototype","lastTime","vendors","x","currTime","Date","getTime","timeToCall","Math","max","setTimeout","clearTimeout","Rect","getBoundRect","getNode","getDocumentNode","getBoundingClientRect","getClosest","selector","matchesFn","some","fn","parentElement","getClosestNode","target","getDelta","original","originalEvent","delta","deltaX","wheelDeltaX","deltaY","wheelDeltaY","abs","dir","documentElement","getElement","isArray","getNodeOffset","nodeType","offsetLeft","y","offsetTop","getPageScroll","scroll","documentNode","pageXOffset","scrollLeft","pageYOffset","scrollTop","getParents","topParentNode","parents","getView","view","innerWidth","innerHeight","clientWidth","clientHeight","getPointInView","point","TOUCH_EVENTS","touch","touches","changedTouches","pageX","pageY","MOUSE_EVENTS","compileController","contents","controller","$controller","controllerAs","downloadFile","content","download","createEvent","base64","downloadName","substring","lastIndexOf","initEvent","dispatchEvent","blob","Blob","reader","FileReader","readAsDataURL","onloadend","result","ua","agent","navigator","userAgent","toLowerCase","safari","msie","chrome","mobile","mac","addClass","EventsService","Dom","Event","rect","absolute","relative","timestamp","stop","stopPropagation","preventDefault","Events","setTimestamp","interval","min","events","listeners","click","onMouseDown","down","removeTouchEvents","onMouseMove","move","onMouseUp","up","onMouseWheel","wheel","removeScrollEvents","onMouseScroll","removeWheelEvents","onResize","resize","onTouchStart","removeStandardEvents","onTouchMove","onTouchEnd","standardEvents","touchEvents","wheelEvents","scrollEvents","standard","windowElement","listener","$on","off","mouseEvents","getTouch","previous","difference","getRelativeTouch","hasPassiveEvents","supported","Object","defineProperty","passive","capture","EventTarget","modified","call","onScroll","scrollWidth","firefox","$filter","array","PointDifference","a","b","PointMultiply","clone","mult","setPos","setX","setY","toString","multiply","w","h","RectMultiply","bottom","bottomLeft","bottomRight","expand","expandRect","intersect","reduce","reduceRect","offsetRect","setH","setSize","setW","topLeft","topRight","Vector","VectorCross","VectorDifference","VectorDistance","sqrt","VectorIncidence","atan2","VectorMake","VectorNormalize","l","VectorPower","VectorSize","cross","distance","friction","incidence","normalize","power","towards","make","Hash","pool","HashGet","defineProperties","enumerable","writable","pools","getId","set","newItem","p","keys","oldItem","index","splice","addMany","removeMany","removeAll","shift","each","forward","reverse","sort","backward","differs","updatePool","Array","$promiseAll","promises","State","errors","isReady","idle","busy","state","isBusy","isError","isErroring","isSuccess","isSuccessing","classes","ready","successing","errorring","enabled","DELAY","errorMessage","button","labels","submitClass","transformProperty","div","every","prefix","Style","props","scale","hoverScale","currentScale","cssText","join","transformOrigin","round","format","string","prepend","expression","splitted","split","formatted","object","reducer","o","reducerAdder","slice","reducerSetter","removeValue","reverseSortOn","throttle","func","wait","context","args","timeout","later","leading","getNow","now","remaining","trailing","toMd5","where","query","found","TypeError","len","k","Api","Doc","$location","$route","$routeParams","Router","Route","current","route","$$route","params","path","pathParams","originalPath","templateUrl","loadedTemplateUrl","RouteCurrent","View","doc","ViewCurrent","docs","HttpUrl","HttpPromise","method","HttpGet","HttpPost","HttpPut","HttpPatch","HttpDelete","HttpFake","msec","post","put","patch","delete","fake","Preload","preload","loaded","total","progress","PreloadAll","update","preloads","percent","setInterval","start","clearInterval","PreloadStart","xhr","XMLHttpRequest","responseType","onloadstart","onprogress","onload","buffer","onerror","send","PreloadImage","image","Image","URL","createObjectURL","$rootScope","RouterSetControllers","$previousController","$previous","$currentController","$current","$nextController","$next","RouterOnChangeStart","RouterOnChangeSuccess","RouterOnChangeError","rejection","RouterOnUpdate","RouterIsController","RouterRedirectTo","$$lastRequestedPath","RouterRetryLastRequestedPath","RouterRedirect","msecs","RouterPath","RouterApply","isController","redirect","SilentUnlink","$$listeners","$locationChangeSuccess","relink","SilentListener","$path","SilentSilent","replace","SilentPath","silent","unshift","CookieDelete","CookieSetter","CookieExists","CookieGet","cookieName","ca","charAt","JSON","decodeURIComponent","atob","CookieOn","checkCookie","elapsed","Cookie","TIMEOUT","CookieSet","days","cache","json","stringify","btoa","encodeURIComponent","expires","date","setTime","toGMTString","exist","LocalExists","localStorage","LocalGet","LocalSet","setItem","LocalDelete","removeItem","LocalOn","storageEvent","newValue","sessionStorage","$sce","TrustGetValue","values","trustedValues","TrustSetValue","trustedValue","TrustGetOrSet","TrustHtml","trustAsHtml","TrustResource","trustAsResourceUrl","TrustUrl","resource","Color","r","g","uint","parseInt","componentToHex","hex","luma","color","dot","contrast","darker","pow","floor","lighter","toUint","toHex","toRgba","toFixed","alpha","makeSet","foreground","border","light","Shape","shapeCircle","cx","cy","sa","ea","PI","ctx","arc","shapeStar","or","ir","steps","angle","step","moveTo","cos","sin","lineTo","shapeRoundRect","tl","tr","br","bl","defaultRadius","quadraticCurveTo","circle","beginPath","closePath","star","roundRect","constant","black","white","blue","red","lightBlue","lightYellow","greyLighter","greyLight","greyMedium","grey","Painter","Palette","painter","rows","getRect","row","setCanvas","drawImage","palette","isString","img","addShape","save","clip","translate","restore","draw","pre","drawRect","tint","setFill","fillRect","globalCompositeOperation","pattern","drawPattern","fillStyle","createPattern","toDataURL","PainterColors","drawingRect","setColors","colors","offsetWidth","offsetHeight","getContext","lineCap","clear","setText","font","align","verticalAlign","textAlign","textBaseline","setStroke","strokeStyle","lineWidth","fillText","text","maxLength","substr","trim","strokeRect","fill","stroke","begin","rotate","xy","flip","ExpandableLink","getStyle","getComputedStyle","styleObj","getPropertyValue","margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left","background-color","getTextStyle","styleText","placeholderNode","removeClass","removeChild","fromRect","toRect","dynamics","spring","frequency","duration","complete","contract","expanded","onDown","transclude","message","$parse","formatLabel","uniqueId","control","ngModel","required","form","title","placeholder","require","optionLabel","field","precision","validate","minLength","Number","POSITIVE_INFINITY","focus","visible","onChange","$parent","onFilter","getClasses","control-focus","control-success","$valid","control-error","$invalid","$submitted","$touched","control-empty","$viewValue","getMessages","$error","toggleVisibility","$templateCache","compile","onRemove","getter","numberPicker","setter","assign","onAdd","removeListeners","nodeRemove","nodeAdd","querySelectorAll","onFocus","$modelValue","$setViewValue","doBlur","onBlur","$formatters","$parsers","valid","String","$setValidity","$templateRequest","priority","modal","modalView","when","routes","modals","popModal","m","active","closeModal","addModal","back","Nav","NavLink","$watch","onLink","onNav","nav","setItems","NavItemLink","itemOpen","immediate","$nav","closed","closing","opening","opened","itemClose","itemToggle","trigger","output","resolved","rejected","navItem","querySelector","NavToLink","navTo","Silent","setNav","NavSilent","NavPath","setNavs","level","addItems","getLink","itemOrItems","addItem","ondragstart","Scrollable","Utils","render","scrollable","setContainer","containerNode","contentNode","setEnabled","isEnabled","renderX","getCurrent","contentStyle","dragStart","dragOn","onMove","dragMove","drag","getDrag","onUp","dragEnd","dragOff","_onScrollX","wheelX","onWheel","wheelXCheck","onScrollX","scrollableWhen","windowEvents","onLeft","onRight","showIndicatorFor","scrollableX","getItems","scrollableItem","scrollPrev","scrollNext","reset","doReset","oldValue","renderY","_onScrollY","wheelY","wheelYCheck","onScrollY","onTop","onBottom","scrollableY","flag","getIndicator","indicator","getIndex","currentIndex","scrollToIndex","getItemAtIndex","end","wheeling","dragging","doLeft","finally","scrollToX","doRight","animating","extendX","snapToNearestX","extending","snappable","doTop","scrollToY","doBottom","extendY","snapToNearestY","methods","VideoSourceLink","canplay","_onCanPlay","video","playing","onPlaying","onPause","onEnded","onProgress","infos","buffered","onTimeUpdate","currentTime","progressTime","videoElement","native","tap","ngBind"],"mappings":"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","file":"artisan.min.js","sourcesContent":["/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan', ['ng', 'ngRoute', 'ngMessages']);\r\n\r\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('FacebookService', ['$promise', 'environment', function ($promise, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tlogin: FacebookLogin,\n\t\t\tlogout: FacebookLogout,\n\t\t\tstatus: FacebookStatus,\n\t\t\tgetMe: FacebookGetMe,\n\t\t\tgetMyPicture: FacebookGetMyPicture,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// private vars\n\n\t\tif (!environment.addons.facebook) {\n\t\t\ttrhow('FacebookService.error missing config object in environment.addons.facebook');\n\t\t}\n\n\t\tvar config = environment.addons.facebook;\n\n\t\t// statics methods\n\n\t\t/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\n\t\t *  calling facebook initializer on page load to avoid popup blockers via asyncronous loading  *\n\t\t * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n\t\tFacebook();\n\n\t\tfunction Facebook() {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tif (window.FB !== undefined) {\n\t\t\t\t\tpromise.resolve(window.FB);\n\t\t\t\t} else {\n\t\t\t\t\tFacebookInit().then(function (success) {\n\t\t\t\t\t\tpromise.resolve(window.FB);\n\t\t\t\t\t}, function (error) {\n\t\t\t\t\t\tpromise.reject(error);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookStatus(response, promise, init) {\n\t\t\tservice.authResponse = null;\n\t\t\tif (response.status === 'connected') {\n\t\t\t\tservice.authResponse = response.authResponse;\n\t\t\t\tpromise.resolve(response);\n\t\t\t} else if (response.status === 'not_authorized') {\n\t\t\t\tif (init) {\n\t\t\t\t\tpromise.resolve(response);\n\t\t\t\t} else {\n\t\t\t\t\tpromise.reject(response);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpromise.reject(response);\n\t\t\t}\n\t\t}\n\n\t\tfunction FacebookGetMe(fields) {\n\t\t\tfields = fields || config.fields;\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tFacebookLogin().then(function (facebook) {\n\t\t\t\t\tconsole.log('FacebookGetMe', facebook);\n\t\t\t\t\tfacebook.api('/me', {\n\t\t\t\t\t\tfields: fields\n\t\t\t\t\t}, function (response) {\n\t\t\t\t\t\tif (!response || response.error) {\n\t\t\t\t\t\t\tpromise.reject('Error occured');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpromise.resolve(response);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookGetMyPicture(size) {\n\t\t\tsize = size || 300;\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tFacebookLogin().then(function (facebook) {\n\t\t\t\t\tfacebook.api('/me/picture', {\n\t\t\t\t\t\twidth: size,\n\t\t\t\t\t\theight: size,\n\t\t\t\t\t\ttype: 'square'\n\t\t\t\t\t}, function (response) {\n\t\t\t\t\t\tif (!response || response.error) {\n\t\t\t\t\t\t\tpromise.reject('Error occured');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpromise.resolve(response);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookLogin() {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tFacebook().then(function (facebook) {\n\t\t\t\t\tconsole.log('FacebookLogin', facebook);\n\t\t\t\t\tfacebook.login(function (response) {\n\t\t\t\t\t\tFacebookStatus(response, promise);\n\t\t\t\t\t}, {\n\t\t\t\t\t\tscope: config.scope\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookLogout() {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tFacebook().then(function (facebook) {\n\t\t\t\t\tfacebook.logout(function (response) {\n\t\t\t\t\t\tpromise.resolve(response);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction FacebookInit() {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\twindow.fbAsyncInit = function () {\n\t\t\t\t\tconsole.log('FacebookInit.fbAsyncInit', window.FB);\n\t\t\t\t\twindow.FB.init({\n\t\t\t\t\t\tappId: config.app_id,\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\tcookie: true,\n\t\t\t\t\t\txfbml: true,\n\t\t\t\t\t\tversion: config.version,\n\t\t\t\t\t});\n\t\t\t\t\tpromise.resolve(window.FB);\n\t\t\t\t\t// window.fbAsyncInit = null;\n\t\t\t\t};\n\t\t\t\ttry {\n\t\t\t\t\t(function (d, s, id) {\n\t\t\t\t\t\tvar js, fjs = d.getElementsByTagName(s)[0];\n\t\t\t\t\t\tif (d.getElementById(id)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tjs = d.createElement(s);\n\t\t\t\t\t\tjs.id = id;\n\t\t\t\t\t\tjs.src = '//connect.facebook.net/' + environment.language.culture + '/sdk.js';\n\t\t\t\t\t\tfjs.parentNode.insertBefore(js, fjs);\n\t\t\t\t\t}(document, 'script', 'facebook-jssdk'));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tpromise.reject(error);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\t// todo !!!\n\n\tapp.directive('googlemaps', ['$timeout', '$compile', '$promise', 'Http', 'GoogleMaps', 'environment', function ($timeout, $compile, $promise, Http, GoogleMaps, environment) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\tscope: {\n\t\t\t\tconnector: '=googlemaps',\n\t\t\t},\n\t\t\tlink: GooglemapsLink,\n\t\t};\n\n\t\tif (!environment.addons.googlemaps) {\n\t\t\ttrhow('googlemaps.error missing config object in environment.addons.googlemaps');\n\t\t}\n\n\t\tvar config = environment.addons.googlemaps;\n\n\t\treturn directive;\n\n\t\tfunction GooglemapsLink(scope, element, attributes) {\n\t\t\tconsole.log('GooglemapsLink', arguments);\n\n\t\t\tvar map, options, info, bounds, clusterer;\n\t\t\tvar filters = {};\n\t\t\tvar markers = [];\n\n\t\t\tvar publics = {\n\t\t\t\t// methods available for controllers\n\t\t\t\t/*\n\t\t\t\tfly: MapboxFly,\n\t\t\t\tflyPosition: MapboxFlyPosition,\n\t\t\t\tjump: MapboxJump,\n\t\t\t\tjumpPosition: MapboxJumpPosition,\n\t\t\t\t*/\n\t\t\t\tsetMarkers: GooglemapsMarkersSet,\n\t\t\t\tsetType: GooglemapsSetType,\n\t\t\t};\n\n\t\t\tif (scope.connector) {\n\t\t\t\tangular.extend(scope.connector, publics);\n\t\t\t}\n\n\t\t\tGooglemaps();\n\n\t\t\tfunction Googlemaps() {\n\t\t\t\treturn $promise(function (promise) {\n\t\t\t\t\tGoogleMaps.maps().then(function (maps) {\n\t\t\t\t\t\tGooglemapsOptions().then(function (options) {\n\t\t\t\t\t\t\tmap = new google.maps.Map(element[0], options);\n\t\t\t\t\t\t\tinfo = GooglemapsInfo();\n\t\t\t\t\t\t\tpromise.resolve(map);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction GooglemapsOptions() {\n\t\t\t\treturn $promise(function (promise) {\n\t\t\t\t\tvar options = angular.copy(config.options);\n\t\t\t\t\tif (config.styles) {\n\t\t\t\t\t\tHttp.get(config.styles).then(function (styles) {\n\t\t\t\t\t\t\toptions.styles = styles;\n\t\t\t\t\t\t\tpromise.resolve(options);\n\n\t\t\t\t\t\t}, function (error) {\n\t\t\t\t\t\t\tconsole.log('GooglemapsOptions.error', 'unable to load styles', config.styles);\n\t\t\t\t\t\t\tpromise.resolve(options);\n\n\t\t\t\t\t\t});\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpromise.resolve(options);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction GooglemapsMarkersRemove() {\n\t\t\t\tangular.forEach(markers, function (marker) {\n\t\t\t\t\tmarker.setMap(null);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction GooglemapsMarkersSet(items) {\n\t\t\t\tGooglemaps().then(function (map) {\n\t\t\t\t\tGooglemapsMarkersRemove();\n\t\t\t\t\tbounds = new google.maps.LatLngBounds();\n\n\t\t\t\t\tmarkers = items.filter(function (item) {\n\t\t\t\t\t\tvar has = true;\n\t\t\t\t\t\tif (filters.month) {\n\t\t\t\t\t\t\thas = has && filters.month.items.has(item.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (filters.category) {\n\t\t\t\t\t\t\thas = has && item.categories.indexOf(filters.category.key) !== -1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn has;\n\n\t\t\t\t\t}).map(function (item) {\n\t\t\t\t\t\treturn GooglemapsMarker(item);\n\n\t\t\t\t\t});\n\n\t\t\t\t\tif (config.clusterer) {\n\t\t\t\t\t\tclusterer = GooglemapsClusterer(markers);\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction GooglemapsBoundsFit() {\n\t\t\t\tif (!bounds.isEmpty()) {\n\t\t\t\t\tmap.fitBounds(bounds);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction GooglemapsSetType(typeId) {\n\t\t\t\tvar types = ['hybrid', 'roadmap', 'satellite', 'terrain'];\n\t\t\t\tif (types.indexOf(typeId) !== -1) {\n\t\t\t\t\tmap.setMapTypeId(typeId);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction GooglemapsInfo() {\n\n\t\t\t\tvar info = new google.maps.InfoWindow({\n\t\t\t\t\tmaxWidth: 350,\n\t\t\t\t\tpixelOffset: new google.maps.Size(0, 15),\n\t\t\t\t});\n\n\t\t\t\tgoogle.maps.event.addListener(info, 'domready', function () {\n\t\t\t\t\tvar outer = $('.gm-style-iw');\n\t\t\t\t\tvar background = outer.prev();\n\t\t\t\t\tbackground.children(':nth-child(2)').css({\n\t\t\t\t\t\t'display': 'none'\n\t\t\t\t\t});\n\t\t\t\t\tbackground.children(':nth-child(4)').css({\n\t\t\t\t\t\t'display': 'none'\n\t\t\t\t\t});\n\t\t\t\t\touter.parent().parent().css({\n\t\t\t\t\t\tleft: '115px'\n\t\t\t\t\t});\n\t\t\t\t\tbackground.children(':nth-child(1)').attr('style', function (i, s) {\n\t\t\t\t\t\treturn s + 'display: none!important';\n\t\t\t\t\t});\n\t\t\t\t\tbackground.children(':nth-child(3)').attr('style', function (i, s) {\n\t\t\t\t\t\treturn s + 'display: none!important';\n\t\t\t\t\t});\n\t\t\t\t\tbackground.children(':nth-child(3)').find('div').children().attr('style', function (i, s) {\n\t\t\t\t\t\treturn s + 'opacity: 0!important;';\n\t\t\t\t\t});\n\t\t\t\t\tvar close = outer.next();\n\t\t\t\t\tclose.css({\n\t\t\t\t\t\t'width': '13px',\n\t\t\t\t\t\t'height': '13px',\n\t\t\t\t\t\t'overflow': 'hidden',\n\t\t\t\t\t\t'position': 'absolute',\n\t\t\t\t\t\t'right': '56px',\n\t\t\t\t\t\t'top': '17px',\n\t\t\t\t\t\t'z-index': '10000',\n\t\t\t\t\t\t'cursor': 'pointer',\n\t\t\t\t\t\t'opacity': 1,\n\t\t\t\t\t\t'transform': 'scale(0.8)'\n\t\t\t\t\t});\n\t\t\t\t\tclose.mouseout(function () {\n\t\t\t\t\t\t$(this).css({\n\t\t\t\t\t\t\topacity: '1'\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\treturn info;\n\t\t\t}\n\n\t\t\tfunction GooglemapsMarker(item) {\n\n\t\t\t\tvar latLng = new google.maps.LatLng(\n\t\t\t\t\titem.position.latitude,\n\t\t\t\t\titem.position.longitude\n\t\t\t\t);\n\n\t\t\t\tvar marker = new google.maps.Marker({\n\t\t\t\t\tposition: latLng,\n\t\t\t\t\titem: item,\n\t\t\t\t\ticon: {\n\t\t\t\t\t\turl: 'img/maps/marker.png',\n\t\t\t\t\t\tscaledSize: new google.maps.Size(25, 25),\n\t\t\t\t\t\torigin: new google.maps.Point(0, 0),\n\t\t\t\t\t\tanchor: new google.maps.Point(0, 0)\n\t\t\t\t\t},\n\t\t\t\t\tmap: map,\n\t\t\t\t\tcontentString: '<div id=\"iw-container\">' +\n\t\t\t\t\t\t'<div class=\"iw-image\" ng-style=\"{ \\'background-image\\': cssUrl(selectedBlog.image.url) }\"></div>' +\n\t\t\t\t\t\t'<div class=\"iw-title\" ng-bind=\"selectedBlog.title\"></div>' +\n\t\t\t\t\t\t'<div class=\"iw-cta\"><button type=\"button\" class=\"iw-link\" ng-click=\"openBlog(selectedBlog)\">Details</button></div>' +\n\t\t\t\t\t\t'</div>'\n\t\t\t\t});\n\n\t\t\t\tmarker.onClick = function () {\n\t\t\t\t\tvar marker = this;\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\tscope.selectedBlog = marker.item;\n\t\t\t\t\t\tvar html = $compile(marker.contentString)(scope);\n\t\t\t\t\t\tinfo.setContent(html[0]);\n\t\t\t\t\t\tinfo.open(map, marker);\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tmarker.addListener('click', marker.onClick);\n\n\t\t\t\tbounds.extend(latLng);\n\n\t\t\t\treturn marker;\n\t\t\t}\n\n\t\t\tfunction GooglemapsClusterer(markers) {\n\n\t\t\t\tvar clusterer = new MarkerClusterer(map, markers, {\n\t\t\t\t\tcssClass: 'cluster',\n\t\t\t\t\timagePath: '/img/gmap/m'\n\t\t\t\t});\n\n\t\t\t\treturn clusterer;\n\n\t\t\t}\n\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('GoogleMaps', ['$promise', 'environment', function ($promise, environment) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tmaps: GoogleMaps,\n\t\t\tgeocoder: GoogleMapsGeocoder,\n\t\t\tparse: GoogleMapsParse,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tif (!environment.addons.googlemaps) {\n\t\t\ttrhow('GoogleMaps.error missing config object in environment.addons.googlemaps');\n\t\t}\n\n\t\tfunction GoogleMaps() {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tif (window.google && window.google.maps) {\n\t\t\t\t\tpromise.resolve(window.google.maps);\n\n\t\t\t\t} else {\n\t\t\t\t\twindow.googleMapsAsyncInit = function () {\n\t\t\t\t\t\tpromise.resolve(window.google.maps);\n\t\t\t\t\t\twindow.googleMapsAsyncInit = null;\n\t\t\t\t\t};\n\t\t\t\t\tvar apiKey = environment.addons.googlemaps.apiKey;\n\t\t\t\t\tvar script = document.createElement('script');\n\t\t\t\t\tscript.setAttribute('async', null);\n\t\t\t\t\tscript.setAttribute('defer', null);\n\t\t\t\t\tscript.setAttribute('src', 'https://maps.googleapis.com/maps/api/js?key=' + apiKey + '&callback=googleMapsAsyncInit');\n\t\t\t\t\tdocument.body.appendChild(script);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleMapsGeocoder() {\n\t\t\tvar service = this;\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tGoogleMaps().then(function (maps) {\n\t\t\t\t\tvar geocoder = new maps.Geocoder();\n\t\t\t\t\tpromise.resolve(geocoder);\n\n\t\t\t\t}, function (error) {\n\t\t\t\t\tpromise.reject(error);\n\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction GoogleMapsType(type, item) {\n\t\t\tvar types = {\n\t\t\t\tstreet: 'route',\n\t\t\t\tnumber: 'street_number',\n\t\t\t\tlocality: 'locality',\n\t\t\t\tpostalCode: 'postal_code',\n\t\t\t\tcity: 'administrative_area_level_3',\n\t\t\t\tprovince: 'administrative_area_level_2',\n\t\t\t\tregion: 'administrative_area_level_1',\n\t\t\t\tcountry: 'country',\n\t\t\t};\n\t\t\tvar label = null;\n\t\t\tangular.forEach(item.address_components, function (c) {\n\t\t\t\tangular.forEach(c.types, function (t) {\n\t\t\t\t\tif (t === types[type]) {\n\t\t\t\t\t\tlabel = c.long_name;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\t// console.log('GoogleMapsType', type, item, label);\n\t\t\treturn label;\n\t\t}\n\n\t\tfunction GoogleMapsParse(results) {\n\t\t\tvar items = null;\n\t\t\tif (results.length) {\n\t\t\t\titems = results.filter(function (item) {\n\t\t\t\t\treturn true; // item.geometry.location_type === 'ROOFTOP' ||\n\t\t\t\t\t// item.geometry.location_type === 'RANGE_INTERPOLATED' ||\n\t\t\t\t\t// item.geometry.location_type === 'GEOMETRIC_CENTER';\n\t\t\t\t}).map(function (item) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: item.formatted_address,\n\t\t\t\t\t\tstreet: GoogleMapsType('street', item),\n\t\t\t\t\t\tnumber: GoogleMapsType('number', item),\n\t\t\t\t\t\tlocality: GoogleMapsType('locality', item),\n\t\t\t\t\t\tpostalCode: GoogleMapsType('postalCode', item),\n\t\t\t\t\t\tcity: GoogleMapsType('city', item),\n\t\t\t\t\t\tprovince: GoogleMapsType('province', item),\n\t\t\t\t\t\tregion: GoogleMapsType('region', item),\n\t\t\t\t\t\tcountry: GoogleMapsType('country', item),\n\t\t\t\t\t\tposition: {\n\t\t\t\t\t\t\tlng: item.geometry.location.lng(),\n\t\t\t\t\t\t\tlat: item.geometry.location.lat(),\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\t/*\n\t\t\t\tvar first = response.data.results[0];\n\t\t\t\tscope.model.position = first.geometry.location;\n\t\t\t\tconsole.log(scope.model);\n\t\t\t\tsetLocation();\n\t\t\t\t*/\n\t\t\t}\n\t\t\tconsole.log('GoogleMapsParse', results, items);\n\t\t\treturn items;\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('mapbox', ['$http', '$timeout', '$compile', '$promise', 'MapBox', 'environment', function ($http, $timeout, $compile, $promise, MapBox, environment) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\tscope: {\n\t\t\t\tconnector: '=mapbox',\n\t\t\t},\n\t\t\tlink: MapboxLink,\n\t\t};\n\n\t\tif (!environment.addons.mapbox) {\n\t\t\ttrhow('mapbox.error missing config object in environment.addons.mapbox');\n\t\t}\n\n\t\tvar config = environment.addons.mapbox;\n\n\t\treturn directive;\n\n\t\tfunction MapboxLink(scope, element, attributes, model) {\n\t\t\tvar map, markers, marker, geocoder, bounds, canvas, dragging, overing;\n\n\t\t\tvar publics = {\n\t\t\t\t// methods available for controllers\n\t\t\t\tfly: MapboxFly,\n\t\t\t\tflyPosition: MapboxFlyPosition,\n\t\t\t\tjump: MapboxJump,\n\t\t\t\tjumpPosition: MapboxJumpPosition,\n\t\t\t\tsetMarkers: MapboxMarkersSet,\n\t\t\t\tfitBounds: MapboxBoundsFit,\n\t\t\t};\n\n\t\t\tif (scope.connector) {\n\t\t\t\tangular.extend(scope.connector, publics);\n\t\t\t}\n\n\t\t\tfunction MapboxMap() {\n\t\t\t\treturn $promise(function (promise) {\n\n\t\t\t\t\tMapBox.get().then(function (mapboxgl) {\n\t\t\t\t\t\tmap = new mapboxgl.Map({\n\t\t\t\t\t\t\tcontainer: element[0],\n\t\t\t\t\t\t\tstyle: config.style,\n\t\t\t\t\t\t\tinteractive: true,\n\t\t\t\t\t\t\tlogoPosition: 'bottom-right',\n\t\t\t\t\t\t\t// center: config.options.center,\n\t\t\t\t\t\t\t// zoom: config.options.zoom,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tcanvas = map.getCanvasContainer();\n\t\t\t\t\t\t/*\n\t\t\t\t\t\tscope.map.setAddress = function (item) {\n\t\t\t\t\t\t\t// console.log('setAddress', item);\n\t\t\t\t\t\t\tscope.map.results = null;\n\t\t\t\t\t\t\tflyTo(item.position);\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.map.search = function () {\n\t\t\t\t\t\t\t// console.log('address', scope.map.address);\n\t\t\t\t\t\t\tscope.map.results = null;\n\t\t\t\t\t\t\tgeocodeAddress(scope.map.address);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.map.styles = {\n\t\t\t\t\t\t\tFICO: 1,\n\t\t\t\t\t\t\tSATELLITE: 2,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.map.style = scope.map.styles.FICO;\n\t\t\t\t\t\tscope.map.styleToggle = function () {\n\t\t\t\t\t\t\tif (scope.map.style === scope.map.styles.FICO) {\n\t\t\t\t\t\t\t\tscope.map.style = scope.map.styles.SATELLITE;\n\t\t\t\t\t\t\t\tmap.setStyle('mapbox://styles/mapbox/satellite-v9');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tscope.map.style = scope.map.styles.FICO;\n\t\t\t\t\t\t\t\tmap.setStyle('mapbox://styles/mapbox/streets-v9');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.map.setStyle = function (style) {\n\t\t\t\t\t\t\tscope.map.style = style;\n\t\t\t\t\t\t\tif (scope.map.style === scope.map.styles.FICO) {\n\t\t\t\t\t\t\t\tmap.setStyle('mapbox://styles/mapbox/streets-v9');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tmap.setStyle('mapbox://styles/mapbox/satellite-v9');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};                \n\t\t\t\t\t\t*/\n\t\t\t\t\t\tif (config.options) {\n\t\t\t\t\t\t\tmap.jumpTo(config.options);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpromise.resolve(map);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction MapboxFly(options) {\n\t\t\t\tmap.flyTo(options);\n\t\t\t}\n\n\t\t\tfunction MapboxFlyPosition(position) {\n\t\t\t\tvar options = getOptions({\n\t\t\t\t\tcenter: [position.lng, position.lat],\n\t\t\t\t\tzoom: 20,\n\t\t\t\t});\n\t\t\t\tMapboxFly(options);\n\t\t\t}\n\n\t\t\tfunction MapboxJump(options) {\n\t\t\t\tmap.jumpTo(options);\n\t\t\t}\n\n\t\t\tfunction MapboxJumpPosition(position) {\n\t\t\t\tvar options = getOptions({\n\t\t\t\t\tcenter: [position.lng, position.lat],\n\t\t\t\t\tzoom: 20,\n\t\t\t\t});\n\t\t\t\tmap.MapboxJump(options);\n\t\t\t}\n\n\t\t\t/*\n\t\t\tgoogleMaps.geocoder().then(function (response) {\n\t\t\t    geocoder = response;\n\t\t\t    init();\n\t\t\t});\n\t\t\t*/\n\n\t\t\tfunction getOptions(options) {\n\t\t\t\treturn angular.extend(angular.copy(config.options), options);\n\t\t\t}\n\n\t\t\tfunction MapboxMarkersRemove() {\n\t\t\t\tif (markers) {\n\t\t\t\t\tangular.forEach(markers, function (item) {\n\t\t\t\t\t\titem.remove();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction MapboxMarkersSet(items) {\n\t\t\t\tMapboxMap().then(function () {\n\t\t\t\t\tMapboxMarkersRemove();\n\t\t\t\t\tmarkers = [];\n\t\t\t\t\tif (config.clusterer) {\n\t\t\t\t\t\tMapboxClusterer(items);\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (items) {\n\t\t\t\t\t\t\tangular.forEach(items, function (item) {\n\t\t\t\t\t\t\t\tvar marker = MapboxMarkerAdd(item);\n\t\t\t\t\t\t\t\tmarkers.push(marker);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction MapboxMarkerAdd(item) {\n\t\t\t\tvar $scope = scope.$new(true);\n\t\t\t\t$scope.item = item;\n\t\t\t\tvar node = document.createElement('div');\n\t\t\t\tnode.id = 'point';\n\t\t\t\tnode.className = 'marker ' + item.area.code;\n\t\t\t\tnode.className += item.type;\n\t\t\t\tnode.setAttribute('marker', 'item');\n\t\t\t\tvar marker = new mapboxgl.Marker(node, {\n\t\t\t\t\t\toffset: [-10, -10]\n\t\t\t\t\t})\n\t\t\t\t\t.setLngLat([item.position.lng, item.position.lat])\n\t\t\t\t\t.addTo(map);\n\t\t\t\tvar markerElement = angular.element(node);\n\t\t\t\tmarkerElement.on('click', function (e) {\n\t\t\t\t\t// console.log('marker.click', item);\n\t\t\t\t\tscope.$emit('onMarkerClicked', item);\n\t\t\t\t});\n\t\t\t\t$compile(markerElement)($scope); // Compiling marker\n\t\t\t\treturn marker;\n\t\t\t}\n\n\t\t\tfunction MapboxCoordinatesGet(item) {\n\t\t\t\tvar coordinates = null;\n\t\t\t\tif (item.position) {\n\t\t\t\t\tcoordinates = [\n\t\t\t\t\t\titem.position.longitude,\n\t\t\t\t\t\titem.position.latitude,\n\t\t\t\t\t\titem.position.altitude || 0.0,\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t\t// [0, 1, 2]; longitude, latitude, altitude\n\t\t\t\treturn coordinates;\n\t\t\t}\n\n\t\t\tfunction MapboxFeaturesGet(items) {\n\t\t\t\tvar collection = null;\n\t\t\t\tif (items) {\n\t\t\t\t\tvar features = items.map(function (item) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttype: 'Feature',\n\t\t\t\t\t\t\tproperties: angular.extend({}, item),\n\t\t\t\t\t\t\tgeometry: {\n\t\t\t\t\t\t\t\ttype: 'Point',\n\t\t\t\t\t\t\t\tcoordinates: MapboxCoordinatesGet(item),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\t\t\t\t\tcollection = {\n\t\t\t\t\t\ttype: 'FeatureCollection',\n\t\t\t\t\t\tcrs: {\n\t\t\t\t\t\t\ttype: 'name',\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tname: 'urn:ogc:def:crs:OGC:1.3:CRS84'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfeatures: features,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn collection;\n\t\t\t}\n\n\t\t\tfunction MapboxClusterer(items) {\n\n\t\t\t\tvar collection = MapboxFeaturesGet(items);\n\n\t\t\t\tmap.on('load', function () {\n\t\t\t\t\t// Add a new source from our GeoJSON data and set the\n\t\t\t\t\t// 'cluster' option to true. GL-JS will add the point_count property to your source data.\n\t\t\t\t\tmap.addSource('earthquakes', {\n\t\t\t\t\t\ttype: 'geojson',\n\t\t\t\t\t\t// Point to GeoJSON data. This example visualizes all M1.0+ earthquakes\n\t\t\t\t\t\t// from 12/22/15 to 1/21/16 as logged by USGS' Earthquake hazards program.\n\t\t\t\t\t\t// data: '/api/mapbox/earthquakes.geo.json',\n\t\t\t\t\t\tdata: collection,\n\t\t\t\t\t\tcluster: true,\n\t\t\t\t\t\tclusterMaxZoom: 14, // Max zoom to cluster points on\n\t\t\t\t\t\tclusterRadius: 50 // Radius of each cluster when clustering points (defaults to 50)\n\t\t\t\t\t});\n\n\t\t\t\t\tmap.addLayer({\n\t\t\t\t\t\tid: 'clusters',\n\t\t\t\t\t\ttype: 'circle',\n\t\t\t\t\t\tsource: 'earthquakes',\n\t\t\t\t\t\tfilter: ['has', 'point_count'],\n\t\t\t\t\t\tpaint: {\n\t\t\t\t\t\t\t'circle-color': {\n\t\t\t\t\t\t\t\tproperty: 'point_count',\n\t\t\t\t\t\t\t\ttype: 'interval',\n\t\t\t\t\t\t\t\tstops: [\n                                    [0, '#51bbd6'],\n                                    [100, '#f1f075'],\n                                    [750, '#f28cb1'],\n                                ]\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t'circle-radius': {\n\t\t\t\t\t\t\t\tproperty: 'point_count',\n\t\t\t\t\t\t\t\ttype: 'interval',\n\t\t\t\t\t\t\t\tstops: [\n                                    [0, 20],\n                                    [100, 30],\n                                    [750, 40]\n                                ]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tmap.addLayer({\n\t\t\t\t\t\tid: 'cluster-count',\n\t\t\t\t\t\ttype: 'symbol',\n\t\t\t\t\t\tsource: 'earthquakes',\n\t\t\t\t\t\tfilter: ['has', 'point_count'],\n\t\t\t\t\t\tlayout: {\n\t\t\t\t\t\t\t'text-field': '{point_count_abbreviated}',\n\t\t\t\t\t\t\t'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],\n\t\t\t\t\t\t\t'text-size': 12\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tmap.addLayer({\n\t\t\t\t\t\tid: 'unclustered-point',\n\t\t\t\t\t\ttype: 'circle',\n\t\t\t\t\t\tsource: 'earthquakes',\n\t\t\t\t\t\tfilter: ['!has', 'point_count'],\n\t\t\t\t\t\tpaint: {\n\t\t\t\t\t\t\t'circle-color': '#11b4da',\n\t\t\t\t\t\t\t'circle-radius': 4,\n\t\t\t\t\t\t\t'circle-stroke-width': 1,\n\t\t\t\t\t\t\t'circle-stroke-color': '#fff'\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction MapboxBoundsFit() {\n\t\t\t\tif (bounds) {\n\t\t\t\t\tmap.fitBounds(bounds, {\n\t\t\t\t\t\tspeed: 1.5,\n\t\t\t\t\t\tcurve: 1,\n\t\t\t\t\t\tpadding: 30,\n\t\t\t\t\t\tlinear: false,\n\t\t\t\t\t\tmaxZoom: 8,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction geocodeAddress(address) {\n\t\t\t\tgeocoder.geocode({\n\t\t\t\t\t'address': address\n\t\t\t\t}, function (results, status) {\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\tif (status === 'OK') {\n\t\t\t\t\t\t\tconnector.results = googleMaps.parse(results);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\talert('Geocode was not successful for the following reason: ' + status);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction reverseGeocode(position) {\n\t\t\t\t// console.log('reverseGeocode', position);\n\t\t\t\tgeocoder.geocode({\n\t\t\t\t\t'location': position\n\t\t\t\t}, function (results, status) {\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\tif (status === 'OK') {\n\t\t\t\t\t\t\tconnector.results = googleMaps.parse(results);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Geocoder failed due to: ' + status);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction geolocalize() {\n\t\t\t\tif (navigator.geolocation) {\n\t\t\t\t\tnavigator.geolocation.getCurrentPosition(function (p) {\n\t\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t\tvar position = {\n\t\t\t\t\t\t\t\tlat: p.coords.latitude,\n\t\t\t\t\t\t\t\tlng: p.coords.longitude\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tflyTo(position);\n\t\t\t\t\t\t\treverseGeocode(position);\n\t\t\t\t\t\t});\n\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\tconsole.log('error', e);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('error', 'Browser doesn\\'t support Geolocation');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/*\n\t\t\tfunction flyTo(position) {\n\t\t\t    map.flyTo({\n\t\t\t        center: [\n\t\t\t            parseFloat(position.lng),\n\t\t\t            parseFloat(position.lat)\n\t\t\t        ],\n\t\t\t        zoom: 15,\n\t\t\t        speed: 1.5,\n\t\t\t        curve: 1,\n\t\t\t    });\n\t\t\t}\n\t\t\t*/\n\n\t\t}\n    }]);\n\n\tapp.directive('marker', ['$http', '$timeout', function ($http, $timeout) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\tscope: {\n\t\t\t\titem: '=marker',\n\t\t\t},\n\t\t\ttemplate: '<div class=\"inner\">' +\n\t\t\t\t'   <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"40\" height=\"40\" viewBox=\"0 0 24 24\">' +\n\t\t\t\t'       <path d=\"M12 0c-5.522 0-10 4.395-10 9.815 0 5.505 4.375 9.268 10 14.185 5.625-4.917 10-8.68 10-14.185 0-5.42-4.478-9.815-10-9.815zm0 18c-4.419 0-8-3.582-8-8s3.581-8 8-8 8 3.582 8 8-3.581 8-8 8z\"/>' +\n\t\t\t\t'   </svg>' +\n\t\t\t\t'   <span ng-bind=\"item.code\"></span>' +\n\t\t\t\t'</div>',\n\t\t\tlink: link,\n\t\t};\n\n\t\tfunction link(scope, element, attributes, model) {\n\t\t\t// console.log('marker', scope.item);\n\t\t}\n\n    }]);\n\n\t/*\n\tapp.service('GoogleMaps', ['$q', '$http', function ($q, $http) {\n\t\tvar _key = 'AIzaSyAYuhIEO-41YT_GdYU6c1N7DyylT_OcMSY';\n\t\tvar _init = false;\n\n\t\tthis.maps = maps;\n\t\tthis.geocoder = geocoder;\n\t\tthis.parse = parse;\n\n\t\tfunction maps() {\n\t\t\tvar deferred = $q.defer();\n\t\t\tif (_init) {\n\t\t\t\tdeferred.resolve(window.google.maps);\n\t\t\t} else {\n\t\t\t\twindow.googleMapsInit = function () {\n\t\t\t\t\tdeferred.resolve(window.google.maps);\n\t\t\t\t\twindow.googleMapsInit = null;\n\t\t\t\t\t_init = true;\n\t\t\t\t};\n\t\t\t\tvar script = document.createElement('script');\n\t\t\t\tscript.setAttribute('async', null);\n\t\t\t\tscript.setAttribute('defer', null);\n\t\t\t\tscript.setAttribute('src', 'https://maps.googleapis.com/maps/api/js?key=' + _key + '&callback=googleMapsInit');\n\t\t\t\tdocument.body.appendChild(script);\n\t\t\t}\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tfunction geocoder() {\n\t\t\tvar service = this;\n\t\t\tvar deferred = $q.defer();\n\t\t\tmaps().then(function (maps) {\n\t\t\t\tvar _geocoder = new maps.Geocoder();\n\t\t\t\tdeferred.resolve(_geocoder);\n\t\t\t}, function (error) {\n\t\t\t\tdeferred.reject(error);\n\t\t\t});\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tfunction getType(type, item) {\n\t\t\tvar types = {\n\t\t\t\tstreet: 'route',\n\t\t\t\tnumber: 'street_number',\n\t\t\t\tlocality: 'locality',\n\t\t\t\tpostalCode: 'postal_code',\n\t\t\t\tcity: 'administrative_area_level_3',\n\t\t\t\tprovince: 'administrative_area_level_2',\n\t\t\t\tregion: 'administrative_area_level_1',\n\t\t\t\tcountry: 'country',\n\t\t\t};\n\t\t\tvar label = null;\n\t\t\tangular.forEach(item.address_components, function (c) {\n\t\t\t\tangular.forEach(c.types, function (t) {\n\t\t\t\t\tif (t === types[type]) {\n\t\t\t\t\t\tlabel = c.long_name;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\t// console.log('googleMaps.getType', type, item, label);\n\t\t\treturn label;\n\t\t}\n\n\t\tfunction parse(results) {\n\t\t\tvar items = null;\n\t\t\tif (results.length) {\n\t\t\t\titems = results.filter(function (item) {\n\t\t\t\t\treturn true; // item.geometry.location_type === 'ROOFTOP' ||\n\t\t\t\t\t// item.geometry.location_type === 'RANGE_INTERPOLATED' ||\n\t\t\t\t\t// item.geometry.location_type === 'GEOMETRIC_CENTER';\n\t\t\t\t}).map(function (item) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: item.formatted_address,\n\t\t\t\t\t\tstreet: getType('street', item),\n\t\t\t\t\t\tnumber: getType('number', item),\n\t\t\t\t\t\tlocality: getType('locality', item),\n\t\t\t\t\t\tpostalCode: getType('postalCode', item),\n\t\t\t\t\t\tcity: getType('city', item),\n\t\t\t\t\t\tprovince: getType('province', item),\n\t\t\t\t\t\tregion: getType('region', item),\n\t\t\t\t\t\tcountry: getType('country', item),\n\t\t\t\t\t\tposition: {\n\t\t\t\t\t\t\tlng: item.geometry.location.lng(),\n\t\t\t\t\t\t\tlat: item.geometry.location.lat(),\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\t\t\tconsole.log('googleMaps.parse', results, items);\n\t\t\treturn items;\n\t\t}\n\n    }]);\n    */\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.service('MapBox', ['$q', '$http', '$promise', 'environment', function($q, $http, $promise, environment) {\n\n        var service = this;\n\n        var statics = {\n            get: MapBoxGet,\n        };\n\n        angular.extend(service, statics);\n\n        if (!environment.addons.mapbox) {\n            trhow('MapBox.error missing config object in environment.addons.mapbox');\n        }\n\n        var config = environment.addons.mapbox;\n\n        function MapBoxGet() {\n            return $promise(function(promise) {\n                if (window.mapboxgl) {\n                    promise.resolve(window.mapboxgl);\n                } else {\n                    $promise.all([\n                        MapBoxScript('//api.tiles.mapbox.com/mapbox-gl-js/' + config.version + '/mapbox-gl.js'),\n                        MapBoxLink('//api.tiles.mapbox.com/mapbox-gl-js/' + config.version + '/mapbox-gl.css'),\n                    ]).then(function() {\n                        window.mapboxgl.accessToken = config.accessToken;\n                        promise.resolve(window.mapboxgl);\n                    }, function(error) {\n                        promise.reject(error);\n                    });\n                }\n            });\n        }\n\n        function MapBoxScript(url) {\n            return $promise(function(promise) {\n                try {\n                    var id = 'mapboxscript';\n                    var script = document.getElementsByTagName('script')[0];\n                    if (document.getElementById(id)) {\n                        promise.resolve();\n                    }\n                    var node = document.createElement('script');\n                    node.id = id;\n                    node.src = url;\n                    node.addEventListener('load', promise.resolve);\n                    node.addEventListener('error', promise.reject);\n                    script.parentNode.insertBefore(node, script);\n                } catch (error) {\n                    promise.reject(error);\n                }\n                /*\n                var node = document.createElement('script');\n                node.src = url;\n                node.addEventListener('load', promise.resolve);\n                node.addEventListener('error', promise.reject);\n                document.body.appendChild(node);\n                */\n            });\n        }\n\n        function MapBoxLink(url) {\n            return $promise(function(promise) {\n                try {\n                    var id = 'mapboxstyle';\n                    var link = document.getElementsByTagName('link')[0];\n                    if (document.getElementById(id)) {\n                        promise.resolve();\n                    }\n                    var node = document.createElement('link');\n                    node.id = id;\n                    node.rel = 'stylesheet';\n                    node.href = url;\n                    node.addEventListener('load', promise.resolve);\n                    node.addEventListener('error', promise.reject);\n                    link.parentNode.insertBefore(node, link);\n                } catch (error) {\n                    promise.reject(error);\n                }\n                /*\n                var node = document.createElement('link');\n                node.rel = 'stylesheet';\n                node.href = url;\n                node.addEventListener('load', promise.resolve);\n                node.addEventListener('error', promise.reject);\n                document.body.appendChild(node);\n                */\n            });\n        }\n\n    }]);\n\n    app.service('___GoogleMaps', ['$q', '$http', '$promise', function($q, $http, $promise) {\n\n        var _key = 'AIzaSyBlgTatREkeIDKEKYL_dtaaDx1yYxmx_iM';\n        var _init = false;\n\n        this.maps = maps;\n        this.geocoder = geocoder;\n        this.parse = parse;\n\n        function maps() {\n            return $promise(function(promise) {\n                if (_init) {\n                    promise.resolve(window.google.maps);\n                } else {\n                    window.__googleMapsInit = function() {\n                        promise.resolve(window.google.maps);\n                        window.__googleMapsInit = null;\n                        _init = true;\n                    };\n                    var script = document.createElement('script');\n                    script.setAttribute('async', null);\n                    script.setAttribute('defer', null);\n                    script.setAttribute('src', 'https://maps.googleapis.com/maps/api/js?key=' + _key + '&callback=__googleMapsInit');\n                    document.body.appendChild(script);\n                }\n            });\n        }\n\n        function geocoder() {\n            var service = this;\n            var deferred = $q.defer();\n            maps().then(function(maps) {\n                var _geocoder = new maps.Geocoder();\n                deferred.resolve(_geocoder);\n            }, function(error) {\n                deferred.reject(error);\n            });\n            return deferred.promise;\n        }\n\n        function getType(type, item) {\n            var types = {\n                street: 'route',\n                number: 'street_number',\n                locality: 'locality',\n                postalCode: 'postal_code',\n                city: 'administrative_area_level_3',\n                province: 'administrative_area_level_2',\n                region: 'administrative_area_level_1',\n                country: 'country',\n            };\n            var label = null;\n            angular.forEach(item.address_components, function(c) {\n                angular.forEach(c.types, function(t) {\n                    if (t === types[type]) {\n                        label = c.long_name;\n                    }\n                });\n            });\n            // console.log('googleMaps.getType', type, item, label);\n            return label;\n        }\n\n        function parse(results) {\n            var items = null;\n            if (results.length) {\n                items = results.filter(function(item) {\n                    return true; // item.geometry.location_type === 'ROOFTOP' ||\n                    // item.geometry.location_type === 'RANGE_INTERPOLATED' ||\n                    // item.geometry.location_type === 'GEOMETRIC_CENTER';\n                }).map(function(item) {\n                    return {\n                        name: item.formatted_address,\n                        street: getType('street', item),\n                        number: getType('number', item),\n                        locality: getType('locality', item),\n                        postalCode: getType('postalCode', item),\n                        city: getType('city', item),\n                        province: getType('province', item),\n                        region: getType('region', item),\n                        country: getType('country', item),\n                        position: {\n                            lng: item.geometry.location.lng(),\n                            lat: item.geometry.location.lat(),\n                        }\n                    };\n                });\n                /*\n                var first = response.data.results[0];\n                scope.model.position = first.geometry.location;\n                console.log(scope.model);\n                setLocation();\n                */\n            }\n            console.log('googleMaps.parse', results, items);\n            return items;\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.provider('environment', ['$locationProvider', '$httpProvider', function ($locationProvider, $httpProvider) {\n\n\t\tvar provider = this;\n\n\t\tvar statics = {\n\t\t\tadd: EnvironmentAdd,\n\t\t\tuse: EnvironmentUse,\n\t\t};\n\n\t\tangular.extend(provider, statics);\n\n\t\tvar defaults = {\n\t\t\taddons: {\n\t\t\t\tfacebook: {\n\t\t\t\t\tfields: 'id,name,first_name,last_name,email,gender,picture,cover,link',\n\t\t\t\t\tscope: 'public_profile, email', // publish_stream\n\t\t\t\t\tversion: 'v2.10',\n\t\t\t\t},\n\t\t\t\tgooglemaps: {\n\t\t\t\t\tclusterer: true,\n\t\t\t\t\tstyles: '/googlemaps/applemapesque.json',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tcenter: {\n\t\t\t\t\t\t\tlat: 43.9023386,\n\t\t\t\t\t\t\tlng: 12.8505094\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdisableDefaultUI: true,\n\t\t\t\t\t\tmapTypeId: 'roadmap', // \"hybrid\", \"roadmap\", \"satellite\", \"terrain\"\n\t\t\t\t\t\tscrollwheel: true,\n\t\t\t\t\t\t// tilt: 0, // 45\n\t\t\t\t\t\tzoom: 4.0,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmapbox: {\n\t\t\t\t\tclusterer: true,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tbearing: 0.0,\n\t\t\t\t\t\tcenter: [\n\t\t\t\t\t\t\t12.8505094,\n\t\t\t\t\t\t\t43.9023386\n\t\t\t\t\t\t],\n\t\t\t\t\t\tcurve: 1,\n\t\t\t\t\t\tpitch: 0.0,\n\t\t\t\t\t\tspeed: 1.5,\n\t\t\t\t\t\tzoom: 4.0,\n\t\t\t\t\t},\n\t\t\t\t\tversion: 'v0.42.0',\n\t\t\t\t}\n\t\t\t},\n\t\t\thttp: {\n\t\t\t\tinterceptors: [], // ['AuthInterceptorService'],\n\t\t\t\twithCredentials: false,\n\t\t\t},\n\t\t\tlanguage: {\n\t\t\t\tcode: 'en',\n\t\t\t\tculture: 'en_US',\n\t\t\t\tiso: 'ENU',\n\t\t\t\tname: 'English',\n\t\t\t},\n\t\t\tlocation: {\n\t\t\t\thash: '!',\n\t\t\t\thtml5: false,\n\t\t\t},\n\t\t\tpaths: {},\n\t\t};\n\n\t\tvar global = {};\n\n\t\tif (window.environment) {\n\t\t\tangular.merge(global, window.environment);\n\t\t}\n\n\t\tvar config = {};\n\n\t\tvar environment = angular.copy(defaults);\n\t\tangular.merge(environment, global);\n\n\t\tfunction EnvironmentSetHttp() {\n\t\t\t$httpProvider.defaults.headers.common[\"Accept-Language\"] = environment.language.code;\n\t\t\t$httpProvider.defaults.withCredentials = environment.http.withCredentials;\n\t\t\t$httpProvider.interceptors.push.apply($httpProvider.interceptors, environment.http.interceptors);\n\t\t}\n\n\t\tfunction EnvironmentSetLocation() {\n\t\t\t$locationProvider.html5Mode(environment.location.html5);\n\t\t\t$locationProvider.hashPrefix(environment.location.hash);\n\t\t}\n\n\t\tfunction EnvironmentAdd(key, data) {\n\t\t\tconfig[key] = config[key] ? angular.merge(config[key], data) : data;\n\t\t\tEnvironmentSet();\n\t\t}\n\n\t\tfunction EnvironmentSet() {\n\t\t\tenvironment = angular.copy(defaults);\n\t\t\tif (config.environment) {\n\t\t\t\tangular.merge(environment, config.environment);\n\t\t\t}\n\t\t\tvar value = EnvironmentGet();\n\t\t\tif (value) {\n\t\t\t\tangular.merge(environment, value);\n\t\t\t}\n\t\t\tangular.merge(environment, global);\n\t\t\tEnvironmentSetHttp();\n\t\t\tEnvironmentSetLocation();\n\t\t}\n\n\t\tfunction EnvironmentUse(key) {\n\t\t\tif (config[key]) {\n\t\t\t\tenvironment = angular.copy(defaults);\n\t\t\t\tangular.merge(environment, config[key]);\n\t\t\t\tangular.merge(environment, global);\n\t\t\t\tEnvironmentSetHttp();\n\t\t\t\tEnvironmentSetLocation();\n\t\t\t}\n\t\t}\n\n\t\tfunction EnvironmentGet() {\n\t\t\tfor (var key in config) {\n\t\t\t\tvar value = config[key];\n\t\t\t\tif (value.paths && window.location.href.indexOf(value.paths.app) !== -1) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprovider.$get = function () {\n\t\t\treturn environment;\n\t\t};\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Animate', [function () {\n\n\t\tfunction Animate(callback) {\n\t\t\tthis.callback = callback;\n\t\t\tthis.key = null;\n\t\t\tthis.ticks = 0;\n\t\t}\n\n\t\tvar statics = {};\n\n\t\tvar publics = {\n\t\t\tpause: pause,\n\t\t\tplay: play,\n\t\t\ttoggle: toggle,\n\t\t};\n\n\t\tangular.extend(Animate, statics);\n\t\tangular.extend(Animate.prototype, publics);\n\n\t\treturn Animate;\n\n\t\t// static methods\n\n\t\t// prototype methods\n\n\t\tfunction pause() {\n\t\t\tvar animate = this;\n\t\t\tif (animate.key) {\n\t\t\t\twindow.cancelAnimationFrame(animate.key);\n\t\t\t\tanimate.key = null;\n\t\t\t}\n\t\t}\n\n\t\tfunction play() {\n\t\t\tvar animate = this;\n\n\t\t\tfunction loop(time) {\n\t\t\t\tanimate.ticks++;\n\t\t\t\tanimate.callback(time, animate.ticks);\n\t\t\t\tanimate.key = window.requestAnimationFrame(loop);\n\t\t\t}\n\t\t\tif (!animate.key) {\n\t\t\t\tloop();\n\t\t\t}\n\t\t}\n\n\t\tfunction toggle() {\n\t\t\tvar animate = this;\n\t\t\tif (animate.key) {\n\t\t\t\tanimate.pause();\n\t\t\t} else {\n\t\t\t\tanimate.play();\n\t\t\t}\n\t\t}\n\n    }]);\n\n\t(function () {\n\t\tvar lastTime = 0;\n\t\tvar vendors = ['ms', 'moz', 'webkit', 'o'];\n\t\tfor (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n\t\t\twindow.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n\t\t\twindow.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||\n\t\t\t\twindow[vendors[x] + 'CancelRequestAnimationFrame'];\n\t\t}\n\t\tif (!window.requestAnimationFrame) {\n\t\t\twindow.requestAnimationFrame = function (callback, element) {\n\t\t\t\tvar currTime = new Date().getTime();\n\t\t\t\tvar timeToCall = Math.max(0, 16 - (currTime - lastTime));\n\t\t\t\tvar id = window.setTimeout(function () {\n\t\t\t\t\tcallback(currTime + timeToCall);\n\t\t\t\t}, timeToCall);\n\t\t\t\tlastTime = currTime + timeToCall;\n\t\t\t\treturn id;\n\t\t\t};\n\t\t}\n\t\tif (!window.cancelAnimationFrame) {\n\t\t\twindow.cancelAnimationFrame = function (id) {\n\t\t\t\tclearTimeout(id);\n\t\t\t};\n\t\t}\n\t}());\n\n}());\n/*\n// handle transition on resizing\nvar resizingTimeout;\n$(window).on('resize', function () {\n    clearTimeout(resizingTimeout);\n    $('body').addClass('resizing');\n    resizingTimeout = setTimeout(function () {\n        $('body').removeClass('resizing');\n    }, 100);\n})\n*/\n\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.service('Dom', ['Point', 'Rect', function(Point, Rect) {\n\n        var service = this;\n\n        var statics = {\n            getBoundRect: getBoundRect,\n            getClosest: getClosest,\n            getClosestNode: getClosestNode,\n            getDelta: getDelta,\n            getDocumentNode: getDocumentNode,\n            getElement: getElement,\n            getNode: getNode,\n            getNodeOffset: getNodeOffset,\n            getPageScroll: getPageScroll,\n            getParents: getParents,\n            getView: getView,\n            getPointInView: getPointInView,\n            compileController: compileController,\n            downloadFile: downloadFile,\n            ua: getUA(),\n        };\n\n        angular.extend(service, statics);\n\n        // return node element BoundingClientRect\n        function getBoundRect(node) {\n            node = getNode(node);\n            if (node === window) {\n                node = getDocumentNode();\n            }\n            var rect = node.getBoundingClientRect();\n            return rect;\n        }\n\n        // return closest parent node that match a selector\n        function getClosest(node, selector) {\n            var matchesFn, parent;\n            ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'].some(function(fn) {\n                if (typeof document.body[fn] == 'function') {\n                    matchesFn = fn;\n                    return true;\n                }\n                return false;\n            });\n            if (node[matchesFn](selector)) {\n                return node;\n            }\n            while (node !== null) {\n                parent = node.parentElement;\n                if (parent !== null && parent[matchesFn](selector)) {\n                    return parent;\n                }\n                node = parent;\n            }\n            return null;\n        }\n\n        // return closest parent node that math a target node\n        function getClosestNode(node, target) {\n            var parent = null;\n            if (node === target) {\n                return node;\n            }\n            while (node !== null) {\n                parent = node.parentElement;\n                if (parent !== null && parent === target) {\n                    return parent;\n                }\n                node = parent;\n            }\n            return null;\n        }\n\n        // return wheel delta\n        function getDelta(event) {\n            var original = event.originalEvent ? event.originalEvent : event;\n            var type = original.type;\n            var delta = null;\n            if (type === 'wheel' || type === 'mousewheel' || type === 'DOMMouseScroll') {\n                var deltaX = original.deltaX || original.wheelDeltaX;\n                var deltaY = original.deltaY || original.wheelDeltaY;\n                delta = new Point(deltaX, deltaY);\n                if (Math.abs(deltaX) > Math.abs(deltaY)) {\n                    delta.dir = deltaX < 0 ? 1 : -1;\n                } else {\n                    delta.dir = deltaY < 0 ? 1 : -1;\n                }\n            }\n            return delta;\n        }\n\n        // return document element node\n        function getDocumentNode() {\n            var documentNode = (document.documentElement || document.body.parentNode || document.body);\n            return documentNode;\n        }\n\n        // return an angular element\n        function getElement(element) {\n            return angular.isArray(element) ? element : angular.element(element);\n        }\n\n        // return a native html node\n        function getNode(element) {\n            return angular.isArray(element) ? element[0] : element;\n        }\n\n        // return a node offset point\n        function getNodeOffset(node) {\n            var offset = new Point();\n            node = getNode(node);\n            if (node && node.nodeType === 1) {\n                offset.x = node.offsetLeft;\n                offset.y = node.offsetTop;\n            }\n            return offset;\n        }\n\n        // return the current page scroll\n        function getPageScroll() {\n            var scroll = new Point();\n            var documentNode = getDocumentNode();\n            scroll.x = window.pageXOffset || documentNode.scrollLeft;\n            scroll.y = window.pageYOffset || documentNode.scrollTop;\n            return scroll;\n        }\n\n        // return an array of node parants\n        function getParents(node, topParentNode) {\n            // if no topParentNode defined will bubble up all the way to *document*\n            topParentNode = topParentNode || getDocumentNode();\n            var parents = [];\n            if (node) {\n                parents.push(node);\n                var parentNode = node.parentNode;\n                while (parentNode && parentNode !== topParentNode) {\n                    parents.push(parentNode);\n                    parentNode = parentNode.parentNode;\n                }\n                parents.push(topParentNode); // push that topParentNode you wanted to stop at\n            }\n            return parents;\n        }\n\n        // return the view rect\n        function getView() {\n            var view = new Rect();\n            if (window.innerWidth !== undefined) {\n                view.width = window.innerWidth;\n                view.height = window.innerHeight;\n            } else {\n                var documentNode = getDocumentNode();\n                view.width = documentNode.clientWidth;\n                view.height = documentNode.clientHeight;\n            }\n            return view;\n        }\n\n        // add to constant\n        var MOUSE_EVENTS = ['click', 'mousedown', 'mouseup', 'mousemove', 'mouseover', 'mouseout', 'mouseenter', 'mouseleave', 'contextmenu'];\n        var TOUCH_EVENTS = ['touchstart', 'touchmove', 'touchend', 'touchcancel'];\n\n        function getPointInView(event) {\n            var original = event.originalEvent ? event.originalEvent : event;\n            var type = original.type;\n            var point = null;\n            if (TOUCH_EVENTS.indexOf(type) !== -1) {\n                var touch = null;\n                var touches = original.touches.length ? original.touches : original.changedTouches;\n                if (touches && touches.length) {\n                    touch = touches[0];\n                }\n                if (touch) {\n                    point = new Point();\n                    point.x = touch.pageX;\n                    point.y = touch.pageY;\n                }\n            } else if (MOUSE_EVENTS.indexOf(type) !== -1) {\n                point = new Point();\n                point.x = original.pageX;\n                point.y = original.pageY;\n            }\n            return point;\n        }\n\n        function getUA() {\n            var agent = window.navigator.userAgent.toLowerCase();\n            var safari = agent.indexOf('safari') !== -1 && agent.indexOf('chrome') === -1;\n            var msie = agent.indexOf('trident') !== -1 || agent.indexOf('edge') !== -1 || agent.indexOf('msie') !== -1;\n            var chrome = !safari && !msie && agent.indexOf('chrome') !== -1;\n            var mobile = agent.indexOf('mobile') !== -1;\n            var mac = agent.indexOf('macintosh') !== -1;\n            var ua = {\n                agent: agent,\n                safari: safari,\n                msie: msie,\n                chrome: chrome,\n                mobile: mobile,\n                mac: mac,\n            };\n            angular.forEach(ua, function(value, key) {\n                if (value) {\n                    angular.element(document.getElementsByTagName('body')).addClass(key);\n                }\n            });\n            return ua;\n        }\n\n        /*\n    function mobilecheck() {\n        var check = false;\n        (function(a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || window.opera);\n        return check;\n    }\n\n    // For those wishing to include tablets in this test (though arguably, you shouldn't), you can use the following function:\n    function mobileAndTabletcheck() {\n        var check = false;\n        (function(a) { if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || window.opera);\n        return check;\n    }\n\n    var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n    var isMobile = mobilecheck();\n    var isMobileAndTabled = mobileAndTabletcheck();\n\t\t*/\n\n        function compileController(scope, element, html, data) {\n            // console.log('Dom.compileController', element);\n            element = getElement(element);\n            element.html(html);\n            var link = $compile(element.contents());\n            if (data.controller) {\n                var $scope = scope.$new();\n                angular.extend($scope, data);\n                var controller = $controller(data.controller, {\n                    $scope: $scope\n                });\n                if (data.controllerAs) {\n                    scope[data.controllerAs] = controller;\n                }\n                element.data('$ngControllerController', controller);\n                element.children().data('$ngControllerController', controller);\n                scope = $scope;\n            }\n            link(scope);\n        }\n\n        function downloadFile(content, name, type) {\n            type = type || 'application/octet-stream';\n            var base64 = null;\n            var blob = new Blob([content], {\n                type: type\n            });\n            var reader = new window.FileReader();\n            reader.readAsDataURL(blob);\n            reader.onloadend = function() {\n                base64 = reader.result;\n                download();\n            };\n\n            function download() {\n                if (document.createEvent) {\n                    var anchor = document.createElement('a');\n                    anchor.href = base64;\n                    if (anchor.download !== undefined) {\n                        var downloadName = name || base64.substring(base64.lastIndexOf('/') + 1, base64.length);\n                        anchor.download = downloadName;\n                    }\n                    var event = document.createEvent('MouseEvents');\n                    event.initEvent('click', true, true);\n                    anchor.dispatchEvent(event);\n                    return true;\n                }\n                var query = '?download';\n                window.open(base64.indexOf('?') > -1 ? base64 : base64 + query, '_self');\n            }\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Event', ['EventsService', 'Dom', 'Point', 'Rect', function (EventsService, Dom, Point, Rect) {\n\n\t\tfunction Event(event, element) {\n\t\t\ttry {\n\t\t\t\tevent = event || window.event;\n\t\t\t\tvar type = event.type;\n\t\t\t\tvar originalEvent = event.originalEvent ? event.originalEvent : event;\n\t\t\t\tvar node = element[0]; // Dom.getNode(element);\n\t\t\t\tvar offset = Dom.getNodeOffset(node);\n\t\t\t\tvar rect = Dom.getBoundRect(node);\n\t\t\t\tvar view = Dom.getView();\n\t\t\t\tvar scroll = Dom.getPageScroll();\n\t\t\t\tvar point = Dom.getPointInView(event);\n\t\t\t\tif (point) {\n\t\t\t\t\tvar absolute = new Point(point.x - scroll.x, point.y - scroll.y);\n\t\t\t\t\tvar relative = new Point(absolute.x - rect.left, absolute.y - rect.top);\n\t\t\t\t\tthis.point = point;\n\t\t\t\t\tthis.absolute = absolute;\n\t\t\t\t\tthis.relative = relative;\n\t\t\t\t}\n\t\t\t\tvar delta = Dom.getDelta(event);\n\t\t\t\tif (delta) {\n\t\t\t\t\tthis.delta = delta;\n\t\t\t\t\tthis.dir = delta.dir;\n\t\t\t\t}\n\t\t\t\tthis.event = event;\n\t\t\t\tthis.type = type;\n\t\t\t\tthis.originalEvent = originalEvent;\n\t\t\t\tthis.element = element;\n\t\t\t\tthis.node = node;\n\t\t\t\tthis.offset = offset;\n\t\t\t\tthis.rect = rect;\n\t\t\t\tthis.view = view;\n\t\t\t\tthis.scroll = scroll;\n\t\t\t\tthis.timestamp = new Date().getTime();\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log('Event.error', error);\n\t\t\t}\n\t\t}\n\n\t\tvar statics = {};\n\n\t\tvar publics = {\n\t\t\tstop: stop,\n\t\t};\n\n\t\tangular.extend(Event, statics);\n\t\tangular.extend(Event.prototype, publics);\n\t\treturn Event;\n\n\t\t// prototype methods\n\n\t\tfunction stop() {\n\t\t\tthis.event.stopPropagation();\n\t\t\tthis.event.preventDefault();\n\t\t}\n\n\t}]);\n\n\tapp.factory('Events', ['EventsService', 'Event', 'Dom', function (EventsService, Event, Dom) {\n\n\t\tfunction Events(element) {\n\t\t\tvar events = this;\n\n\t\t\tthis.element = Dom.getElement(element);\n\t\t\tthis.listeners = {};\n\t\t\tthis.standardEvents = {\n\t\t\t\tclick: {\n\t\t\t\t\tkey: 'click',\n\t\t\t\t\tcallback: onClick\n\t\t\t\t},\n\t\t\t\tdown: {\n\t\t\t\t\tkey: 'mousedown',\n\t\t\t\t\tcallback: onMouseDown\n\t\t\t\t},\n\t\t\t\tmove: {\n\t\t\t\t\tkey: 'mousemove',\n\t\t\t\t\tcallback: onMouseMove\n\t\t\t\t},\n\t\t\t\tup: {\n\t\t\t\t\tkey: 'mouseup',\n\t\t\t\t\tcallback: onMouseUp\n\t\t\t\t},\n\t\t\t\tresize: {\n\t\t\t\t\tkey: 'resize',\n\t\t\t\t\tcallback: onResize\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.touchEvents = {\n\t\t\t\tdown: {\n\t\t\t\t\tkey: 'touchstart',\n\t\t\t\t\tcallback: onTouchStart\n\t\t\t\t},\n\t\t\t\tmove: {\n\t\t\t\t\tkey: 'touchmove',\n\t\t\t\t\tcallback: onTouchMove\n\t\t\t\t},\n\t\t\t\tup: {\n\t\t\t\t\tkey: 'touchend',\n\t\t\t\t\tcallback: onTouchEnd\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.wheelEvents = {\n\t\t\t\twheel: {\n\t\t\t\t\tkey: 'mousewheel',\n\t\t\t\t\tcallback: onMouseWheel\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.scrollEvents = {\n\t\t\t\twheel: {\n\t\t\t\t\tkey: 'DOMMouseScroll',\n\t\t\t\t\tcallback: onMouseScroll\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.timestamp = new Date().getTime();\n\t\t\tthis.setTimestamp = setTimestamp;\n\n\t\t\tfunction setTimestamp(event) {\n\t\t\t\tif (event) {\n\t\t\t\t\tevent.interval = Math.min(250, event.timestamp - events.timestamp);\n\t\t\t\t\t// console.log(event.interval, event.timestamp, events.timestamp);\n\t\t\t\t}\n\t\t\t\tevents.timestamp = new Date().getTime();\n\t\t\t}\n\n\t\t\tfunction onClick(e) {\n\t\t\t\t// console.log('onClick', e, events);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.click.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onMouseDown(e) {\n\t\t\t\t// console.log('onMouseDown', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.down.apply(this, [event]);\n\t\t\t\tevents.removeTouchEvents();\n\t\t\t}\n\n\t\t\tfunction onMouseMove(e) {\n\t\t\t\t// console.log('onMouseMove', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.move.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onMouseUp(e) {\n\t\t\t\t// console.log('onMouseUp', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.up.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onMouseWheel(e) {\n\t\t\t\t// console.log('onMouseWheel', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.wheel.apply(this, [event]);\n\t\t\t\tevents.removeScrollEvents();\n\t\t\t}\n\n\t\t\tfunction onMouseScroll(e) {\n\t\t\t\t// console.log('onMouseScroll', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.wheel.apply(this, [event]);\n\t\t\t\tevents.removeWheelEvents();\n\t\t\t}\n\n\t\t\tfunction onResize(e) {\n\t\t\t\t// console.log('onResize', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.resize.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onTouchStart(e) {\n\t\t\t\t// console.log('onTouchStart', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.down.apply(this, [event]);\n\t\t\t\tevents.removeStandardEvents();\n\t\t\t}\n\n\t\t\tfunction onTouchMove(e) {\n\t\t\t\t// console.log('onTouchMove', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.move.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onTouchEnd(e) {\n\t\t\t\t// console.log('onTouchEnd', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.setTimestamp(event);\n\t\t\t\tevents.listeners.up.apply(this, [event]);\n\t\t\t}\n\t\t}\n\n\t\tvar statics = {\n\t\t\tgetTouch: getTouch,\n\t\t\tgetRelativeTouch: getRelativeTouch,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tadd: add,\n\t\t\tremove: remove,\n\t\t\tremoveStandardEvents: removeStandardEvents,\n\t\t\tremoveTouchEvents: removeTouchEvents,\n\t\t\tremoveWheelEvents: removeWheelEvents,\n\t\t\tremoveScrollEvents: removeScrollEvents,\n\t\t};\n\n\t\tangular.extend(Events, statics);\n\t\tangular.extend(Events.prototype, publics);\n\t\treturn Events;\n\n\t\t// prototype methods\n\n\t\tfunction add(listeners, scope) {\n\t\t\tvar events = this,\n\t\t\t\tstandard = this.standardEvents,\n\t\t\t\ttouch = this.touchEvents,\n\t\t\t\twheel = this.wheelEvents,\n\t\t\t\tscroll = this.scrollEvents;\n\t\t\tvar element = this.element,\n\t\t\t\twindowElement = angular.element(window);\n\n\t\t\tangular.forEach(listeners, function (callback, key) {\n\t\t\t\tif (events.listeners[key]) {\n\t\t\t\t\tvar listener = {};\n\t\t\t\t\tlistener[key] = events.listeners[key];\n\t\t\t\t\tremove(listener);\n\t\t\t\t}\n\t\t\t\tevents.listeners[key] = callback;\n\t\t\t\tif (standard[key]) {\n\t\t\t\t\tif (key === 'resize') {\n\t\t\t\t\t\twindowElement.on(standard[key].key, standard[key].callback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.on(standard[key].key, standard[key].callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (touch[key]) {\n\t\t\t\t\telement.on(touch[key].key, touch[key].callback);\n\t\t\t\t}\n\t\t\t\tif (wheel[key]) {\n\t\t\t\t\telement.on(wheel[key].key, wheel[key].callback);\n\t\t\t\t}\n\t\t\t\tif (scroll[key]) {\n\t\t\t\t\telement.on(scroll[key].key, scroll[key].callback);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (scope) {\n\t\t\t\tscope.$on('$destroy', function () {\n\t\t\t\t\tevents.remove(listeners);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn events;\n\t\t}\n\n\t\tfunction remove(listeners) {\n\t\t\tvar events = this,\n\t\t\t\tstandard = this.standardEvents,\n\t\t\t\ttouch = this.touchEvents,\n\t\t\t\twheel = this.wheelEvents,\n\t\t\t\tscroll = this.scrollEvents;\n\t\t\tvar element = this.element,\n\t\t\t\twindowElement = angular.element(window);\n\t\t\tangular.forEach(listeners, function (callback, key) {\n\t\t\t\tif (standard[key]) {\n\t\t\t\t\tif (key === 'resize') {\n\t\t\t\t\t\twindowElement.off(standard[key].key, standard[key].callback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.off(standard[key].key, standard[key].callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (touch[key]) {\n\t\t\t\t\telement.off(touch[key].key, touch[key].callback);\n\t\t\t\t}\n\t\t\t\tif (wheel[key]) {\n\t\t\t\t\telement.off(wheel[key].key, wheel[key].callback);\n\t\t\t\t}\n\t\t\t\tif (scroll[key]) {\n\t\t\t\t\telement.off(scroll[key].key, scroll[key].callback);\n\t\t\t\t}\n\t\t\t\tevents.listeners[key] = null;\n\t\t\t});\n\t\t\treturn events;\n\t\t}\n\n\t\tfunction removeStandardEvents() {\n\t\t\tvar events = this,\n\t\t\t\tstandard = events.standardEvents,\n\t\t\t\ttouch = events.touchEvents;\n\t\t\tvar element = events.element;\n\t\t\telement.off('mousedown', standard.down.callback);\n\t\t\telement.off('mousemove', standard.move.callback);\n\t\t\telement.off('mouseup', standard.up.callback);\n\t\t}\n\n\t\tfunction removeTouchEvents() {\n\t\t\tvar events = this,\n\t\t\t\tstandard = events.standardEvents,\n\t\t\t\ttouch = events.touchEvents;\n\t\t\tvar element = events.element;\n\t\t\telement.off('touchstart', touch.down.callback);\n\t\t\telement.off('touchmove', touch.move.callback);\n\t\t\telement.off('touchend', touch.up.callback);\n\t\t}\n\n\t\tfunction removeWheelEvents() {\n\t\t\tvar events = this;\n\t\t\tvar element = events.element;\n\t\t\telement.off('mousewheel', events.mouseEvents.wheel.callback);\n\t\t}\n\n\t\tfunction removeScrollEvents() {\n\t\t\tvar events = this;\n\t\t\tvar element = events.element;\n\t\t\telement.off('DOMMouseScroll', events.scrollEvents.wheel.callback);\n\t\t}\n\n\t\t// statics methods\n\n\t\tfunction getTouch(e, previous) {\n\t\t\tvar point = new Point();\n\t\t\tif (e.type === 'touchstart' || e.type === 'touchmove' || e.type === 'touchend' || e.type === 'touchcancel') {\n\t\t\t\tvar touch = null;\n\t\t\t\tvar event = e.originalEvent ? e.originalEvent : e;\n\t\t\t\tvar touches = event.touches.length ? event.touches : event.changedTouches;\n\t\t\t\tif (touches && touches.length) {\n\t\t\t\t\ttouch = touches[0];\n\t\t\t\t}\n\t\t\t\tif (touch) {\n\t\t\t\t\tpoint.x = touch.pageX;\n\t\t\t\t\tpoint.y = touch.pageY;\n\t\t\t\t}\n\t\t\t} else if (e.type === 'click' || e.type === 'mousedown' || e.type === 'mouseup' || e.type === 'mousemove' || e.type === 'mouseover' || e.type === 'mouseout' || e.type === 'mouseenter' || e.type === 'mouseleave' || e.type === 'contextmenu') {\n\t\t\t\tpoint.x = e.pageX;\n\t\t\t\tpoint.y = e.pageY;\n\t\t\t}\n\t\t\tif (previous) {\n\t\t\t\tpoint.s = Point.difference(t, previous);\n\t\t\t}\n\t\t\tpoint.type = e.type;\n\t\t\treturn point;\n\t\t}\n\n\t\tfunction getRelativeTouch(node, point) {\n\t\t\tnode = angular.isArray(node) ? node[0] : node;\n\t\t\treturn Point.difference(point, {\n\t\t\t\tx: node.offsetLeft,\n\t\t\t\ty: node.offsetTop\n\t\t\t});\n\t\t}\n\n    }]);\n\n\tapp.service('EventsService', ['Dom', function (Dom) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\thasPassiveEvents: hasPassiveEvents,\n\t\t\taddEventListener: getAddEventListener(),\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// prevent history back on mac os\n\n\t\tpreventHistoryNavigation();\n\n\t\t// static methods\n\n\t\tfunction hasPassiveEvents() {\n\t\t\tvar supported = false;\n\t\t\tif (window.addEventListener) {\n\t\t\t\ttry {\n\t\t\t\t\tvar options = Object.defineProperty({}, 'passive', {\n\t\t\t\t\t\tget: function () {\n\t\t\t\t\t\t\tsupported = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\twindow.addEventListener('test', null, options);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('getAddEventListener.isSupprted', e);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn supported;\n\t\t}\n\n\t\tfunction getAddEventListener() {\n\t\t\tvar supported = hasPassiveEvents();\n\t\t\tif (!supported) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar defaults = {\n\t\t\t\tpassive: false,\n\t\t\t\tcapture: false,\n\t\t\t};\n\n\t\t\tfunction getModifiedAddEventListener(original) {\n\t\t\t\tfunction addEventListener(type, listener, options) {\n\t\t\t\t\tif (typeof options !== 'object') {\n\t\t\t\t\t\tvar capture = options === true;\n\t\t\t\t\t\toptions = angular.copy(defaults);\n\t\t\t\t\t\toptions.capture = capture;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toptions = angular.extend(angular.copy(defaults), options);\n\t\t\t\t\t}\n\t\t\t\t\toriginal.call(this, type, listener, options);\n\t\t\t\t}\n\t\t\t\treturn addEventListener;\n\t\t\t}\n\n\t\t\tvar original = EventTarget.prototype.addEventListener;\n\t\t\tvar modified = getModifiedAddEventListener(original);\n\t\t\tEventTarget.prototype.addEventListener = modified;\n\t\t\treturn modified;\n\t\t}\n\n\t\tfunction preventHistoryNavigation() {\n\t\t\tif (!Dom.ua.mac) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Dom.ua.chrome || Dom.ua.safari || Dom.ua.firefox) {\n\t\t\t\twindow.addEventListener('mousewheel', onScroll, {\n\t\t\t\t\tpassive: false\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onScroll(e) {\n\t\t\t\tif (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\t(e.deltaX < 0 && (Dom.getParents(e.target).filter(function (node) {\n\t\t\t\t\t\treturn node.scrollLeft > 0;\n\t\t\t\t\t}).length === 0)) ||\n\t\t\t\t\t(e.deltaX > 0 && (Dom.getParents(e.target).filter(function (node) {\n\t\t\t\t\t\treturn node.scrollWidth - node.scrollLeft > node.clientWidth;\n\t\t\t\t\t}).length === 0))\n\t\t\t\t) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n    }]);\n\n}());\n/* global angular, app, Autolinker */\r\n(function () {\r\n\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.filter('notIn', ['$filter', function ($filter) {\r\n\r\n\t\treturn function (array, filters, element) {\r\n\t\t\tif (filters) {\r\n\t\t\t\treturn $filter(\"filter\")(array, function (item) {\r\n\t\t\t\t\tfor (var i = 0; i < filters.length; i++) {\r\n\t\t\t\t\t\tif (filters[i][element] === item[element]) return false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n    }]);\r\n\r\n}());\n/* global angular, firebase */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Point', [function () {\n\n\t\tfunction Point(x, y) {\n\t\t\tthis.x = x || 0;\n\t\t\tthis.y = y || 0;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tdifference: PointDifference,\n\t\t\tmultiply: PointMultiply,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tclone: clone,\n\t\t\tcopy: copy,\n\t\t\tdifference: difference,\n\t\t\tmult: mult,\n\t\t\toffset: offset,\n\t\t\tsetPos: setPos,\n\t\t\tsetX: setX,\n\t\t\tsetY: setY,\n\t\t\ttoString: toString,\n\t\t};\n\n\t\tangular.extend(Point, statics);\n\t\tangular.extend(Point.prototype, publics);\n\n\t\treturn Point;\n\n\t\t// static methods\n\n\t\tfunction PointDifference(a, b) {\n\t\t\treturn new Point(a.x - b.x, a.y - b.y);\n\t\t}\n\n\t\tfunction PointMultiply(point, value) {\n\t\t\tpoint.x *= value;\n\t\t\tpoint.y *= value;\n\t\t\treturn point;\n\t\t}\n\n\t\t// prototype methods\n\n\t\tfunction clone() {\n\t\t\treturn new Point(this.x, this.y);\n\t\t}\n\n\t\tfunction copy(point) {\n\t\t\tthis.x = point.x;\n\t\t\tthis.y = point.y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction difference(b) {\n\t\t\treturn PointDifference(this, b);\n\t\t}\n\n\t\tfunction mult(value) {\n\t\t\treturn PointMultiply(this, value);\n\t\t}\n\n\t\tfunction offset(x, y) {\n\t\t\tthis.x += x;\n\t\t\tthis.y += y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setPos(x, y) {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setX(x) {\n\t\t\tthis.x = x;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setY(y) {\n\t\t\tthis.y = y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction toString() {\n\t\t\treturn '{' + this.x + ',' + this.y + '}';\n\t\t}\n\n    }]);\n\n}());\n/* global angular, firebase */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Rect', [function () {\n\n\t\tfunction Rect(x, y, w, h) {\n\t\t\tthis.x = x || 0;\n\t\t\tthis.y = y || 0;\n\t\t\tthis.w = w || 0;\n\t\t\tthis.h = h || 0;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tmult: RectMultiply,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tbottom: bottom,\n\t\t\tbottomLeft: bottomLeft,\n\t\t\tbottomRight: bottomRight,\n\t\t\tcenter: center,\n\t\t\tclone: clone,\n\t\t\tcopy: copy,\n\t\t\texpand: expand,\n\t\t\texpandRect: expandRect,\n\t\t\tintersect: intersect,\n\t\t\tleft: left,\n\t\t\tmult: mult,\n\t\t\toffset: offset,\n\t\t\treduce: reduce,\n\t\t\treduceRect: reduceRect,\n\t\t\tright: right,\n\t\t\tsetH: setH,\n\t\t\tsetPos: setPos,\n\t\t\tsetSize: setSize,\n\t\t\tsetX: setX,\n\t\t\tsetY: setY,\n\t\t\tsetW: setW,\n\t\t\ttop: top,\n\t\t\ttopLeft: topLeft,\n\t\t\ttopRight: topRight,\n\t\t\ttoString: toString,\n\t\t};\n\n\t\tangular.extend(Rect, statics);\n\t\tangular.extend(Rect.prototype, publics);\n\n\t\treturn Rect;\n\n\t\t// static methods\n\n\t\tfunction RectMultiply(rect, value) {\n\t\t\trect.x *= value;\n\t\t\trect.y *= value;\n\t\t\trect.w *= value;\n\t\t\trect.h *= value;\n\t\t\treturn rect;\n\t\t}\n\n\t\t// prototype methods\n\n\t\tfunction bottom() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w / 2,\n\t\t\t\ty: y + h\n\t\t\t};\n\t\t}\n\n\t\tfunction bottomLeft() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x,\n\t\t\t\ty: y + h\n\t\t\t};\n\t\t}\n\n\t\tfunction bottomRight() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w,\n\t\t\t\ty: y + h\n\t\t\t};\n\t\t}\n\n\t\tfunction center() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w / 2,\n\t\t\t\ty: y + h / 2\n\t\t\t};\n\t\t}\n\n\t\tfunction clone() {\n\t\t\treturn new Rect(this.x, this.y, this.w, this.h);\n\t\t}\n\n\t\tfunction copy(rect) {\n\t\t\tthis.x = rect.x;\n\t\t\tthis.y = rect.y;\n\t\t\tthis.w = rect.w;\n\t\t\tthis.h = rect.h;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction expand(size) {\n\t\t\treturn this.expandRect({\n\t\t\t\tx: size,\n\t\t\t\ty: size,\n\t\t\t\tw: size * 2,\n\t\t\t\th: size * 2\n\t\t\t});\n\t\t}\n\n\t\tfunction expandRect(rect) {\n\t\t\tthis.x -= rect.x || 0;\n\t\t\tthis.y -= rect.y || 0;\n\t\t\tthis.w += rect.w || 0;\n\t\t\tthis.h += rect.h || 0;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction intersect(rect) {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn !(rect.x > x + w || rect.x + rect.w < x || rect.y > y + h || rect.y + rect.h < y);\n\t\t}\n\n\t\tfunction left() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x,\n\t\t\t\ty: y + h / 2\n\t\t\t};\n\t\t}\n\n\t\tfunction mult(value) {\n\t\t\treturn RectMultiply(this, value);\n\t\t}\n\n\t\tfunction offset(x, y) {\n\t\t\tthis.x += x;\n\t\t\tthis.y += y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction reduce(size) {\n\t\t\treturn this.offset(-size);\n\t\t}\n\n\t\tfunction reduceRect(rect) {\n\t\t\treturn this.offsetRect(RectMultiply(rect, -1));\n\t\t}\n\n\t\tfunction right() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w,\n\t\t\t\ty: y + h / 2\n\t\t\t};\n\t\t}\n\n\t\tfunction setH(h) {\n\t\t\tthis.h = h;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setPos(x, y) {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setSize(w, h) {\n\t\t\tthis.w = w;\n\t\t\tthis.h = h;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setX(x) {\n\t\t\tthis.x = x;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setY(y) {\n\t\t\tthis.y = y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction setW(w) {\n\t\t\tthis.w = w;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction top() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w / 2,\n\t\t\t\ty: y\n\t\t\t};\n\t\t}\n\n\t\tfunction topLeft() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x,\n\t\t\t\ty: y\n\t\t\t};\n\t\t}\n\n\t\tfunction topRight() {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y,\n\t\t\t\tw = this.w,\n\t\t\t\th = this.h;\n\t\t\treturn {\n\t\t\t\tx: x + w,\n\t\t\t\ty: y\n\t\t\t};\n\t\t}\n\n\t\tfunction toString() {\n\t\t\treturn '{' + this.x + ',' + this.y + ',' + this.w + ',' + this.h + '}';\n\t\t}\n\n    }]);\n\n}());\n/* global angular, firebase */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Vector', function () {\n\t\tfunction Vector(x, y) {\n\t\t\tthis.x = x || 0;\n\t\t\tthis.y = y || 0;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tcross: VectorCross,\n\t\t\tdifference: VectorDifference,\n\t\t\tdistance: VectorDistance,\n\t\t\tincidence: VectorIncidence,\n\t\t\tmake: VectorMake,\n\t\t\tnormalize: VectorNormalize,\n\t\t\tpower: VectorPower,\n\t\t\tsize: VectorSize,\n\t\t};\n\n\t\tvar publics = {\n\t\t\tadd: add,\n\t\t\tcopy: copy,\n\t\t\tcross: cross,\n\t\t\tdifference: difference,\n\t\t\tdistance: distance,\n\t\t\tfriction: friction,\n\t\t\tincidence: incidence,\n\t\t\tnormalize: normalize,\n\t\t\tpower: power,\n\t\t\tsize: size,\n\t\t\ttowards: towards,\n\t\t\ttoString: toString,\n\t\t};\n\n\t\tangular.extend(Vector, statics);\n\t\tangular.extend(Vector.prototype, publics);\n\n\t\treturn Vector;\n\n\t\t// statics methods\n\n\t\tfunction VectorCross(a, b) {\n\t\t\treturn (a.x * b.y) - (a.y * b.x);\n\t\t}\n\n\t\tfunction VectorDifference(a, b) {\n\t\t\treturn new Vector(a.x - b.x, a.y - b.y);\n\t\t}\n\n\t\tfunction VectorDistance(a, b) {\n\t\t\treturn Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));\n\t\t}\n\n\t\tfunction VectorIncidence(a, b) {\n\t\t\tvar angle = Math.atan2(b.y, b.x) - Math.atan2(a.y, a.x);\n\t\t\treturn angle;\n\t\t}\n\n\t\tfunction VectorMake(a, b) {\n\t\t\treturn new Vector(b.x - a.x, b.y - a.y);\n\t\t}\n\n\t\tfunction VectorNormalize(a) {\n\t\t\tvar l = Vector.size(a);\n\t\t\ta.x /= l;\n\t\t\ta.y /= l;\n\t\t\treturn a;\n\t\t}\n\n\t\tfunction VectorPower(a, b) {\n\t\t\tvar x = Math.abs(b.x - a.x);\n\t\t\tvar y = Math.abs(b.y - a.y);\n\t\t\treturn (x + y) / 2;\n\t\t}\n\n\t\tfunction VectorSize(a) {\n\t\t\treturn Math.sqrt(a.x * a.x + a.y * a.y);\n\t\t}\n\n\t\t// prototype methods\n\n\t\tfunction add(b) {\n\t\t\tthis.x += b.x;\n\t\t\tthis.y += b.y;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction copy(b) {\n\t\t\treturn new Vector(this.x, this.y);\n\t\t}\n\n\t\tfunction cross(b) {\n\t\t\treturn VectorCross(this, b);\n\t\t}\n\n\t\tfunction difference(b) {\n\t\t\treturn VectorDifference(this, b);\n\t\t}\n\n\t\tfunction distance(b) {\n\t\t\treturn VectorDistance(this, b);\n\t\t}\n\n\t\tfunction friction(b) {\n\t\t\tthis.x *= b;\n\t\t\tthis.y *= b;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction incidence(b) {\n\t\t\treturn VectorIncidence(this, b);\n\t\t}\n\n\t\tfunction normalize() {\n\t\t\treturn VectorNormalize(this);\n\t\t}\n\n\t\tfunction power() {\n\t\t\treturn (Math.abs(this.x) + Math.abs(this.y)) / 2;\n\t\t}\n\n\t\tfunction size() {\n\t\t\treturn VectorSize(this);\n\t\t}\n\n\t\tfunction towards(b, friction) {\n\t\t\tfriction = friction || 0.125;\n\t\t\tthis.x += (b.x - this.x) * friction;\n\t\t\tthis.y += (b.y - this.y) * friction;\n\t\t\treturn this;\n\t\t}\n\n\t\tfunction toString() {\n\t\t\treturn '{' + this.x + ',' + this.y + '}';\n\t\t}\n\n\t});\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Hash', [function () {\n\n\t\tfunction Hash(key, pool) {\n\t\t\tkey = key || 'id';\n\t\t\tpool = pool ? HashGet(pool) : {};\n\t\t\tObject.defineProperties(this, {\n\t\t\t\tkey: {\n\t\t\t\t\tvalue: key,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\twritable: false\n\t\t\t\t},\n\t\t\t\tpool: {\n\t\t\t\t\tvalue: pool,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\twritable: false\n\t\t\t\t},\n\t\t\t\tlength: {\n\t\t\t\t\tvalue: 0,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\twritable: true\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tvar pools = {};\n\n\t\tvar statics = {\n\t\t\tget: HashGet,\n\t\t};\n\n\t\tvar publics = {\n\t\t\thas: has,\n\t\t\tgetId: getId,\n\t\t\tget: get,\n\t\t\tset: set,\n\t\t\tadd: add,\n\t\t\tremove: remove,\n\t\t\teach: each,\n\t\t\taddMany: addMany,\n\t\t\tremoveMany: removeMany,\n\t\t\tremoveAll: removeAll,\n\t\t\tforward: forward,\n\t\t\tbackward: backward,\n\t\t\tdiffers: differs,\n\t\t\tupdatePool: updatePool,\n\t\t};\n\n\t\tHash.prototype = new Array;\n\n\t\tangular.extend(Hash, statics);\n\t\tangular.extend(Hash.prototype, publics);\n\n\t\treturn Hash;\n\n\t\t// static methods\n\n\t\tfunction HashGet(pool) {\n\t\t\treturn (pools[pool] = pools[pool] || {});\n\t\t}\n\n\t\tfunction has(id) {\n\t\t\treturn this.pool[id] !== undefined;\n\t\t}\n\n\t\tfunction getId(id) {\n\t\t\treturn this.pool[id];\n\t\t}\n\n\t\tfunction get(item) {\n\t\t\tvar hash = this,\n\t\t\t\tkey = this.key;\n\t\t\treturn item ? hash.getId(item[key]) : null;\n\t\t}\n\n\t\tfunction set(item) {\n\t\t\tvar hash = this,\n\t\t\t\tpool = this.pool,\n\t\t\t\tkey = this.key;\n\t\t\tpool[item[key]] = item;\n\t\t\thash.push(item);\n\t\t\treturn item;\n\t\t}\n\n\t\tfunction add(newItem) {\n\t\t\tvar hash = this;\n\t\t\tvar item = hash.get(newItem);\n\t\t\tif (item) {\n\t\t\t\tfor (var i = 0, keys = Object.keys(newItem), p; i < keys.length; i++) {\n\t\t\t\t\tp = keys[i];\n\t\t\t\t\titem[p] = newItem[p];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem = hash.set(newItem);\n\t\t\t}\n\t\t\treturn item;\n\t\t}\n\n\t\tfunction remove(oldItem) {\n\t\t\tvar hash = this,\n\t\t\t\tpool = this.pool,\n\t\t\t\tkey = this.key;\n\t\t\tvar item = hash.get(oldItem);\n\t\t\tif (item) {\n\t\t\t\tvar index = hash.indexOf(item);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\thash.splice(index, 1);\n\t\t\t\t}\n\t\t\t\tdelete pool[item[key]];\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction addMany(items) {\n\t\t\tvar hash = this;\n\t\t\tif (!items) {\n\t\t\t\treturn hash;\n\t\t\t}\n\t\t\tvar i = 0;\n\t\t\twhile (i < items.length) {\n\t\t\t\thash.add(items[i]);\n\t\t\t\ti++;\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction removeMany(items) {\n\t\t\tvar hash = this;\n\t\t\tif (!items) {\n\t\t\t\treturn hash;\n\t\t\t}\n\t\t\tvar i = 0;\n\t\t\twhile (i < items.length) {\n\t\t\t\thash.remove(items[i]);\n\t\t\t\ti++;\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction removeAll() {\n\t\t\tvar hash = this,\n\t\t\t\tkey = hash.key,\n\t\t\t\tpool = hash.pool;\n\t\t\tvar i = 0,\n\t\t\t\tt = hash.length,\n\t\t\t\titem;\n\t\t\twhile (hash.length) {\n\t\t\t\titem = hash.shift();\n\t\t\t\tdelete pool[item[key]];\n\t\t\t\ti++;\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction each(callback) {\n\t\t\tvar hash = this;\n\t\t\tif (callback) {\n\t\t\t\tvar i = 0;\n\t\t\t\twhile (i < hash.length) {\n\t\t\t\t\tcallback(hash[i], i);\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction forward(key, reverse) {\n\t\t\tvar hash = this;\n\t\t\tkey = (key || this.key);\n\t\t\thash.sort(function (c, d) {\n\t\t\t\tvar a = reverse ? d : c;\n\t\t\t\tvar b = reverse ? c : d;\n\t\t\t\treturn a[key] - b[key];\n\t\t\t});\n\t\t\treturn hash;\n\t\t}\n\n\t\tfunction backward(key) {\n\t\t\treturn this.forward(key, true);\n\t\t}\n\n\t\tfunction differs(hash) {\n\t\t\tif (hash.key !== this.key || hash.length !== this.length) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tvar differs = false,\n\t\t\t\t\ti = 0,\n\t\t\t\t\tt = this.length,\n\t\t\t\t\tkey = this.key;\n\t\t\t\twhile (differs && i < t) {\n\t\t\t\t\tdiffers = this[i][key] !== hash[i][key];\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction updatePool() {\n\t\t\tvar hash = this,\n\t\t\t\tpool = this.pool,\n\t\t\t\tkey = this.key;\n\t\t\tObject.keys(pool).forEach(function (key) {\n\t\t\t\tdelete pool[key];\n\t\t\t});\n\t\t\tangular.forEach(hash, function (item) {\n\t\t\t\tpool[item[key]] = item;\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('$promise', ['$q', function ($q) {\n\n\t\tfunction $promise(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\tthrow ('promise resolve callback missing');\n\t\t\t}\n\t\t\tvar deferred = $q.defer();\n\t\t\tcallback(deferred);\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tvar statics = {\n\t\t\tall: $promiseAll,\n\t\t};\n\n\t\tvar publics = {};\n\n\t\tangular.extend($promise, statics);\n\t\tangular.extend($promise.prototype, publics);\n\n\t\treturn $promise;\n\n\t\tfunction $promiseAll(promises) {\n\t\t\treturn $q.all(promises);\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('State', ['$timeout', function ($timeout) {\n\n\t\tfunction State() {\n\t\t\tthis.errors = [];\n\t\t\tthis.isReady = false;\n\t\t\tthis.idle();\n\t\t}\n\n\t\tvar DELAY = 2000;\n\n\t\tvar statics = {};\n\n\t\tvar publics = {\n\t\t\tbusy: busy,\n\t\t\tclasses: classes,\n\t\t\tenabled: enabled,\n\t\t\terror: error,\n\t\t\terrorMessage: errorMessage,\n\t\t\tidle: idle,\n\t\t\tlabels: labels,\n\t\t\tready: ready,\n\t\t\tsubmitClass: submitClass,\n\t\t\tsuccess: success,\n\t\t};\n\n\t\tangular.extend(State, statics);\n\t\tangular.extend(State.prototype, publics);\n\n\t\treturn State;\n\n\t\t// static methods\n\n\t\t// prototype methods\n\n\t\tfunction busy() {\n\t\t\tvar state = this;\n\t\t\tif (!state.isBusy) {\n\t\t\t\tstate.isBusy = true;\n\t\t\t\tstate.isError = false;\n\t\t\t\tstate.isErroring = false;\n\t\t\t\tstate.isSuccess = false;\n\t\t\t\tstate.isSuccessing = false;\n\t\t\t\tstate.errors = [];\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfunction classes(addons) {\n\t\t\tvar state = this,\n\t\t\t\tclasses = null;\n\t\t\tclasses = {\n\t\t\t\tready: state.isReady,\n\t\t\t\tbusy: state.isBusy,\n\t\t\t\tsuccessing: state.isSuccessing,\n\t\t\t\tsuccess: state.isSuccess,\n\t\t\t\terrorring: state.isErroring,\n\t\t\t\terror: state.isError,\n\t\t\t};\n\t\t\tif (addons) {\n\t\t\t\tangular.forEach(addons, function (value, key) {\n\t\t\t\t\tclasses[value] = classes[key];\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn classes;\n\t\t}\n\n\t\tfunction enabled() {\n\t\t\tvar state = this;\n\t\t\treturn !state.isBusy && !state.isErroring && !state.isSuccessing;\n\t\t}\n\n\t\tfunction error(error) {\n\t\t\tconsole.log('State.error', error);\n\t\t\tvar state = this;\n\t\t\tstate.isBusy = false;\n\t\t\tstate.isError = true;\n\t\t\tstate.isErroring = true;\n\t\t\tstate.isSuccess = false;\n\t\t\tstate.isSuccessing = false;\n\t\t\tstate.errors.push(error);\n\t\t\t$timeout(function () {\n\t\t\t\tstate.isErroring = false;\n\t\t\t}, DELAY);\n\t\t}\n\n\t\tfunction errorMessage() {\n\t\t\tvar state = this;\n\t\t\treturn state.isError ? state.errors[state.errors.length - 1] : null;\n\t\t}\n\n\t\tfunction idle() {\n\t\t\tvar state = this;\n\t\t\tstate.isBusy = false;\n\t\t\tstate.isError = false;\n\t\t\tstate.isErroring = false;\n\t\t\tstate.isSuccess = false;\n\t\t\tstate.isSuccessing = false;\n\t\t\tstate.button = null;\n\t\t\tstate.errors = [];\n\t\t}\n\n\t\tfunction labels(addons) {\n\t\t\tvar state = this;\n\t\t\tvar defaults = {\n\t\t\t\tready: 'submit',\n\t\t\t\tbusy: 'sending',\n\t\t\t\terror: 'error',\n\t\t\t\tsuccess: 'success',\n\t\t\t};\n\t\t\tif (addons) {\n\t\t\t\tangular.extend(defaults, addons);\n\t\t\t}\n\t\t\tvar label = defaults.ready;\n\t\t\tif (state.isBusy) {\n\t\t\t\tlabel = defaults.busy;\n\t\t\t} else if (state.isSuccess) {\n\t\t\t\tlabel = defaults.success;\n\t\t\t} else if (state.isError) {\n\t\t\t\tlabel = defaults.error;\n\t\t\t}\n\t\t\treturn label;\n\t\t}\n\n\t\tfunction ready() {\n\t\t\tvar state = this;\n\t\t\tstate.idle();\n\t\t\tstate.isReady = true;\n\t\t}\n\n\t\tfunction submitClass() {\n\t\t\tvar state = this;\n\t\t\treturn {\n\t\t\t\tbusy: state.isBusy,\n\t\t\t\tready: state.isReady,\n\t\t\t\tsuccessing: state.isSuccessing,\n\t\t\t\tsuccess: state.isSuccess,\n\t\t\t\terrorring: state.isErroring,\n\t\t\t\terror: state.isError,\n\t\t\t};\n\t\t}\n\n\t\tfunction success() {\n\t\t\tvar state = this;\n\t\t\tstate.isBusy = false;\n\t\t\tstate.isError = false;\n\t\t\tstate.isErroring = false;\n\t\t\tstate.isSuccess = true;\n\t\t\tstate.isSuccessing = true;\n\t\t\tstate.errors = [];\n\t\t\t$timeout(function () {\n\t\t\t\tstate.isSuccessing = false;\n\t\t\t}, DELAY);\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar transformProperty = detectTransformProperty();\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Style', [function () {\n\n\t\tfunction Style() {\n\t\t\tthis.props = {\n\t\t\t\tscale: 1,\n\t\t\t\thoverScale: 1,\n\t\t\t\tcurrentScale: 1,\n\t\t\t};\n\t\t}\n\n\t\tvar statics = {};\n\n\t\tvar publics = {\n\t\t\tset: set,\n\t\t\ttransform: transform,\n\t\t\ttransformOrigin: transformOrigin,\n\t\t};\n\n\t\tangular.extend(Style, statics);\n\t\tangular.extend(Style.prototype, publics);\n\n\t\treturn Style;\n\n\t\t// static methods\n\n\t\t// prototype methods\n\n\t\tfunction set(element) {\n\t\t\tvar styles = [];\n\t\t\tfor (var key in this) {\n\t\t\t\tif (key !== 'props') {\n\t\t\t\t\tstyles.push(key + ':' + this[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telement.style.cssText = styles.join(';') + ';';\n\t\t}\n\n\t\tfunction transform(transform) {\n\t\t\tthis[transformProperty] = transform;\n\t\t}\n\n\t\tfunction transformOrigin(x, y) {\n\t\t\tthis[transformProperty + '-origin-x'] = (Math.round(x * 1000) / 1000) + '%';\n\t\t\tthis[transformProperty + '-origin-y'] = (Math.round(y * 1000) / 1000) + '%';\n\t\t}\n\n    }]);\n\n\tfunction detectTransformProperty() {\n\t\tvar transformProperty = 'transform',\n\t\t\tsafariPropertyHack = 'webkitTransform';\n\t\tvar div = document.createElement(\"DIV\");\n\t\tif (typeof div.style[transformProperty] !== 'undefined') {\n            ['webkit', 'moz', 'o', 'ms'].every(function (prefix) {\n\t\t\t\tvar e = '-' + prefix + '-transform';\n\t\t\t\tif (typeof div.style[e] !== 'undefined') {\n\t\t\t\t\ttransformProperty = e;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t});\n\t\t} else if (typeof div.style[safariPropertyHack] !== 'undefined') {\n\t\t\ttransformProperty = '-webkit-transform';\n\t\t} else {\n\t\t\ttransformProperty = undefined;\n\t\t}\n\t\treturn transformProperty;\n\t}\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Utils', ['$compile', '$controller', 'Vector', function ($compile, $controller, Vector) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tcompileController: compileController,\n\t\t\tformat: format,\n\t\t\tindexOf: indexOf,\n\t\t\treducer: reducer,\n\t\t\treducerAdder: reducerAdder,\n\t\t\treducerSetter: reducerSetter,\n\t\t\tremoveValue: removeValue,\n\t\t\treverseSortOn: reverseSortOn,\n\t\t\tthrottle: throttle,\n\t\t\ttoMd5: toMd5,\n\t\t\twhere: where,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\tvar getNow = Date.now || function () {\n\t\t\treturn new Date().getTime();\n\t\t};\n\n\t\tfunction compileController(scope, element, html, data) {\n\t\t\t// console.log('Utils.compileController', element);\n\t\t\telement.html(html);\n\t\t\tvar link = $compile(element.contents());\n\t\t\tif (data.controller) {\n\t\t\t\tvar $scope = scope.$new();\n\t\t\t\tangular.extend($scope, data);\n\t\t\t\tvar controller = $controller(data.controller, {\n\t\t\t\t\t$scope: $scope\n\t\t\t\t});\n\t\t\t\tif (data.controllerAs) {\n\t\t\t\t\tscope[data.controllerAs] = controller;\n\t\t\t\t}\n\t\t\t\telement.data('$ngControllerController', controller);\n\t\t\t\telement.children().data('$ngControllerController', controller);\n\t\t\t\tscope = $scope;\n\t\t\t}\n\t\t\tlink(scope);\n\t\t}\n\n\t\tfunction format(string, prepend, expression) {\n\t\t\tstring = string || '';\n\t\t\tprepend = prepend || '';\n\t\t\tvar splitted = string.split(',');\n\t\t\tif (splitted.length > 1) {\n\t\t\t\tvar formatted = splitted.shift();\n\t\t\t\tangular.forEach(splitted, function (value, index) {\n\t\t\t\t\tif (expression) {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join(prepend + value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (expression) {\n\t\t\t\t\treturn '\\'' + formatted + '\\'';\n\t\t\t\t} else {\n\t\t\t\t\treturn formatted;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn prepend + string;\n\t\t\t}\n\t\t}\n\n\t\tfunction indexOf(array, object, key) {\n\t\t\tkey = key || 'id';\n\t\t\tvar index = -1;\n\t\t\tif (array) {\n\t\t\t\tvar i = 0,\n\t\t\t\t\tt = array.length;\n\t\t\t\twhile (i < t) {\n\t\t\t\t\tif (array[i] && array[i][key] === object[key]) {\n\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn index;\n\t\t}\n\n\t\tfunction reducer(o, key) {\n\t\t\treturn o[key];\n\t\t}\n\n\t\tfunction reducerAdder(o, key, value) {\n\t\t\tif (typeof key == 'string') {\n\t\t\t\treturn reducerAdder(o, key.split('.'), value);\n\t\t\t} else if (key.length == 1 && value !== undefined) {\n\t\t\t\treturn (o[key[0]] += value);\n\t\t\t} else if (key.length === 0) {\n\t\t\t\treturn o;\n\t\t\t} else {\n\t\t\t\treturn reducerAdder(o[key[0]], key.slice(1), value);\n\t\t\t}\n\t\t}\n\n\t\tfunction reducerSetter(o, key, value) {\n\t\t\tif (typeof key == 'string') {\n\t\t\t\treturn reducerSetter(o, key.split('.'), value);\n\t\t\t} else if (key.length == 1 && value !== undefined) {\n\t\t\t\treturn (o[key[0]] = value);\n\t\t\t} else if (key.length === 0) {\n\t\t\t\treturn o;\n\t\t\t} else {\n\t\t\t\treturn reducerSetter(o[key[0]], key.slice(1), value);\n\t\t\t}\n\t\t}\n\n\t\tfunction removeValue(array, value) {\n\t\t\tvar index = -1;\n\t\t\tif (array) {\n\t\t\t\tvar i = 0,\n\t\t\t\t\tt = array.length;\n\t\t\t\twhile (i < t) {\n\t\t\t\t\tif (array[i] === value) {\n\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (index !== -1) {\n\t\t\t\tarray.splice(index, 1);\n\t\t\t\treturn value;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tfunction reverseSortOn(key) {\n\t\t\treturn function (a, b) {\n\t\t\t\tif (a[key] < b[key]) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t\tif (a[key] > b[key]) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\t// a must be equal to b\n\t\t\t\treturn 0;\n\t\t\t};\n\t\t}\n\n\t\tfunction throttle(func, wait, options) {\n\t\t\t// Returns a function, that, when invoked, will only be triggered at most once\n\t\t\t// during a given window of time. Normally, the throttled function will run\n\t\t\t// as much as it can, without ever going more than once per `wait` duration;\n\t\t\t// but if you'd like to disable the execution on the leading edge, pass\n\t\t\t// `{leading: false}`. To disable execution on the trailing edge, ditto.\n\t\t\tvar context, args, result;\n\t\t\tvar timeout = null;\n\t\t\tvar previous = 0;\n\t\t\tif (!options) options = {};\n\t\t\tvar later = function () {\n\t\t\t\tprevious = options.leading === false ? 0 : getNow();\n\t\t\t\ttimeout = null;\n\t\t\t\tresult = func.apply(context, args);\n\t\t\t\tif (!timeout) context = args = null;\n\t\t\t};\n\t\t\treturn function () {\n\t\t\t\tvar now = getNow();\n\t\t\t\tif (!previous && options.leading === false) previous = now;\n\t\t\t\tvar remaining = wait - (now - previous);\n\t\t\t\tcontext = this;\n\t\t\t\targs = arguments;\n\t\t\t\tif (remaining <= 0 || remaining > wait) {\n\t\t\t\t\tif (timeout) {\n\t\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\t\ttimeout = null;\n\t\t\t\t\t}\n\t\t\t\t\tprevious = now;\n\t\t\t\t\tresult = func.apply(context, args);\n\t\t\t\t\tif (!timeout) context = args = null;\n\t\t\t\t} else if (!timeout && options.trailing !== false) {\n\t\t\t\t\ttimeout = setTimeout(later, remaining);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t};\n\t\t}\n\n\t\tfunction toMd5(string) {\n\t\t\t// return Md5.encode(string);\n\t\t}\n\n\t\tfunction where(array, query) {\n\t\t\tvar found = null;\n\t\t\tif (array) {\n\t\t\t\tangular.forEach(array, function (item) {\n\t\t\t\t\tvar has = true;\n\t\t\t\t\tangular.forEach(query, function (value, key) {\n\t\t\t\t\t\thas = has && item[key] === value;\n\t\t\t\t\t});\n\t\t\t\t\tif (has) {\n\t\t\t\t\t\tfound = item;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn found;\n\t\t}\n\n    }]);\n\n\t(function () {\n\t\t// POLYFILL Array.prototype.reduce\n\t\t// Production steps of ECMA-262, Edition 5, 15.4.4.21\n\t\t// Reference: http://es5.github.io/#x15.4.4.21\n\t\t// https://tc39.github.io/ecma262/#sec-array.prototype.reduce\n\t\tif (!Array.prototype.reduce) {\n\t\t\tObject.defineProperty(Array.prototype, 'reduce', {\n\t\t\t\tvalue: function (callback) { // , initialvalue\n\t\t\t\t\tif (this === null) {\n\t\t\t\t\t\tthrow new TypeError('Array.prototype.reduce called on null or undefined');\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof callback !== 'function') {\n\t\t\t\t\t\tthrow new TypeError(callback + ' is not a function');\n\t\t\t\t\t}\n\t\t\t\t\tvar o = Object(this);\n\t\t\t\t\tvar len = o.length >>> 0;\n\t\t\t\t\tvar k = 0;\n\t\t\t\t\tvar value;\n\t\t\t\t\tif (arguments.length == 2) {\n\t\t\t\t\t\tvalue = arguments[1];\n\t\t\t\t\t} else {\n\t\t\t\t\t\twhile (k < len && !(k in o)) {\n\t\t\t\t\t\t\tk++;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (k >= len) {\n\t\t\t\t\t\t\tthrow new TypeError('Reduce of empty array with no initial value');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvalue = o[k++];\n\t\t\t\t\t}\n\t\t\t\t\twhile (k < len) {\n\t\t\t\t\t\tif (k in o) {\n\t\t\t\t\t\t\tvalue = callback(value, o[k], k, o);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tk++;\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}());\n\n}());\n/* global angular */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.factory('Doc', ['Api', '$promise', function (Api, $promise) {\r\n\r\n\t\tfunction Doc(item) {\r\n\t\t\tif (item) {\r\n\t\t\t\tangular.extend(this, item);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar statics = {};\r\n\r\n\t\tvar publics = {};\r\n\r\n\t\tangular.extend(Doc, statics);\r\n\t\tangular.extend(Doc.prototype, publics);\r\n\r\n\t\treturn Doc;\r\n\r\n\t\t// static methods\r\n\r\n\t\t// prototype methods\r\n\r\n    }]);\r\n\r\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('Route', ['$promise', '$location', '$route', '$routeParams', 'Router', function($promise, $location, $route, $routeParams, Router) {\n\n        function Route(current) {\n\n            var route = {\n                controller: current.$$route.controller,\n                params: current.params,\n                path: $location.path(),\n                pathParams: current.pathParams,\n                originalPath: current.$$route.originalPath,\n                templateUrl: current.loadedTemplateUrl,\n            };\n            angular.extend(this, route);\n        }\n\n        var statics = {\n            current: RouteCurrent,\n        };\n\n        var publics = {};\n\n        angular.extend(Route, statics);\n        angular.extend(Route.prototype, publics);\n\n        return Route;\n\n        // static methods\n\n        function RouteCurrent() {\n            return new Route($route.current);\n        }\n\n        // prototype methods\n\n    }]);\n\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.factory('View', ['Api', '$promise', 'environment', 'Doc', 'Route', function(Api, $promise, environment, Doc, Route) {\r\n\r\n        function View(doc, route) {\r\n            var view = {\r\n                doc: doc,\r\n                environment: environment,\r\n                route: route,\r\n            };\r\n            angular.extend(this, view);\r\n        }\r\n\r\n        var statics = {\r\n            current: ViewCurrent, // ViewCurrentSimple\r\n        };\r\n\r\n        var publics = {};\r\n\r\n        angular.extend(View, statics);\r\n        angular.extend(View.prototype, publics);\r\n\r\n        return View;\r\n\r\n        // static methods\r\n\r\n        function ViewCurrent() {\r\n            return $promise(function(promise) {\r\n                var route = Route.current();\r\n                var path = route.path;\r\n                console.log('ViewCurrent', path);\r\n                Api.docs.url(path).then(function(response) {\r\n                    var doc = new Doc(response);\r\n                    var view = new View(doc, route);\r\n                    promise.resolve(view);\r\n\r\n                }, function(error) {\r\n                    promise.reject(error);\r\n\r\n                });\r\n            });\r\n        }\r\n\r\n        function ViewCurrentSimple() {\r\n            return $promise(function(promise) {\r\n                console.log('ViewCurrentSimple');\r\n                var route = Route.current();\r\n                var path = route.path;\r\n                Api.navs.main().then(function(items) {\r\n                    var doc = null,\r\n                        view = null,\r\n                        path = path,\r\n                        pool = ViewPool(items);\r\n                    var item = pool[path];\r\n                    if (item) {\r\n                        doc = new Doc(item);\r\n                        view = new View(doc, route);\r\n                    }\r\n                    promise.resolve(view);\r\n\r\n                }, function(error) {\r\n                    promise.reject(error);\r\n\r\n                });\r\n            });\r\n        }\r\n\r\n        function ViewPool(items) {\r\n            var pool = {};\r\n\r\n            function _getPool(items) {\r\n                if (items) {\r\n                    angular.forEach(items, function(item) {\r\n                        pool[item.url] = item;\r\n                        _getPool(item.items);\r\n                    });\r\n                }\r\n            }\r\n            _getPool(items);\r\n            return pool;\r\n        }\r\n\r\n        // prototype methods\r\n\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.service('Http', ['$http', '$promise', '$timeout', 'environment', function ($http, $promise, $timeout, environment) {\r\n\r\n\t\tvar service = this;\r\n\r\n\t\tvar statics = {\r\n\t\t\tget: HttpGet,\r\n\t\t\tpost: HttpPost,\r\n\t\t\tput: HttpPut,\r\n\t\t\tpatch: HttpPatch,\r\n\t\t\t'delete': HttpDelete,\r\n\t\t\tfake: HttpFake,\r\n\t\t};\r\n\r\n\t\tangular.extend(service, statics);\r\n\r\n\t\t// statics methods\r\n\r\n\t\tfunction HttpUrl(url) {\r\n\t\t\treturn environment.paths.api + url;\r\n\t\t}\r\n\r\n\t\tfunction HttpPromise(method, url, data) {\r\n\t\t\treturn $promise(function (promise) {\r\n\t\t\t\t$http[method](HttpUrl(url), data).then(function (response) {\r\n\t\t\t\t\tpromise.resolve(response.data);\r\n\r\n\t\t\t\t}, function (e, status) {\r\n\t\t\t\t\tvar error = (e && e.data) ? e.data : {};\r\n\t\t\t\t\terror.status = e.status;\r\n\t\t\t\t\tpromise.reject(error);\r\n\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction HttpGet(url) {\r\n\t\t\treturn HttpPromise('get', url);\r\n\t\t}\r\n\r\n\t\tfunction HttpPost(url, data) {\r\n\t\t\treturn HttpPromise('post', url, data);\r\n\t\t}\r\n\r\n\t\tfunction HttpPut(url, data) {\r\n\t\t\treturn HttpPromise('put', url, data);\r\n\t\t}\r\n\r\n\t\tfunction HttpPatch(url, data) {\r\n\t\t\treturn HttpPromise('patch', url, data);\r\n\t\t}\r\n\r\n\t\tfunction HttpDelete(url) {\r\n\t\t\treturn HttpPromise('delete', url);\r\n\t\t}\r\n\r\n\t\tfunction HttpFake(data, msec) {\r\n\t\t\tmsec = msec || 1000;\r\n\t\t\treturn $promise(function (promise) {\r\n\t\t\t\t$timeout(function () {\r\n\t\t\t\t\tpromise.resolve({\r\n\t\t\t\t\t\tdata: data\r\n\t\t\t\t\t});\r\n\t\t\t\t}, msec);\r\n\t\t\t});\r\n\t\t}\r\n\r\n    }]);\r\n\r\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('Preload', ['$promise', function($promise) {\n\n        function Preload(path) {\n            var preload = this;\n            preload.path = path;\n            preload.loaded = 0;\n            preload.total = 0;\n            preload.progress = 0;\n        }\n\n        var statics = {\n            all: PreloadAll,\n        };\n\n        var publics = {\n            start: PreloadStart,\n            image: PreloadImage,\n        };\n\n        angular.extend(Preload, statics);\n        angular.extend(Preload.prototype, publics);\n\n        return Preload;\n\n        // statics methods\n\n        function PreloadAll(paths, callback) {\n            return $promise(function(promise) {\n                var preloads = paths.map(function(path) {\n                    return new Preload(path);\n                });\n                var progress = {\n                    loaded: 0,\n                    total: 0,\n                    progress: 0,\n                    preloads: preloads\n                };\n                var i = setInterval(update, 1000 / 10);\n                $promise.all(\n                    preloads.map(function(preload) {\n                        return preload.start();\n                    })\n                ).then(function() {\n                    clearInterval(i);\n                    update();\n                    promise.resolve(preloads.slice());\n                    // destroy();\n                }, function(error) {\n                    promise.reject(error);\n                    // destroy();\n                });\n\n                function update() {\n                    progress.loaded = 0;\n                    progress.total = 0;\n                    angular.forEach(preloads, function(preload) {\n                        progress.loaded += preload.loaded;\n                        progress.total += preload.total;\n                    });\n                    var percent = progress.total ? progress.loaded / progress.total : 0;\n                    if (percent > progress.progress) {\n                        progress.progress = percent;\n                        if (callback) {\n                            callback(progress);\n                        }\n                    }\n                }\n\n                function destroy() {\n                    angular.forEach(preloads, function(preload) {\n                        preload.buffer = null;\n                        preload.xhr = null;\n                    });\n                }\n            });\n        }\n\n        // instance methods\n\n        function PreloadStart() {\n            var preload = this;\n            return $promise(function(promise) {\n                var xhr = new XMLHttpRequest();\n                xhr.responseType = \"arraybuffer\";\n                xhr.open(\"GET\", preload.path, true);\n                xhr.onloadstart = function(e) {\n                    /*\n                    preload.loaded = 0;\n                    preload.total = 1;\n                    preload.progress = 0;\n                    */\n                };\n                xhr.onprogress = function(e) {\n                    preload.loaded = e.loaded;\n                    preload.total = e.total;\n                    preload.progress = e.total ? e.loaded / e.total : 0;\n                };\n                xhr.onloadend = function(e) {\n                    preload.loaded = preload.total;\n                    preload.progress = 1;\n                };\n                xhr.onload = function() {\n                    preload.buffer = xhr.response;\n                    promise.resolve(preload);\n                };\n                xhr.onerror = function(error) {\n                    console.log('Preload.xhr.onerror', error);\n                    preload.loaded = preload.total;\n                    preload.progress = 1;\n                    promise.reject(error);\n                };\n                xhr.send();\n                preload.xhr = xhr;\n            });\n        }\n\n        function PreloadImage() {\n            var preload = this;\n            var blob = new Blob([preload.buffer]);\n            var image = new Image();\n            image.src = window.URL.createObjectURL(blob);\n            return image;\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.service('Router', ['$rootScope', '$location', '$route', '$timeout', function($rootScope, $location, $route, $timeout) {\n\n        var service = this;\n\n        var statics = {\n            isController: RouterIsController,\n            redirect: RouterRedirect,\n            path: RouterPath,\n            apply: RouterApply,\n        };\n\n        angular.extend(service, statics);\n\n        $rootScope.$on('$routeChangeStart', RouterOnChangeStart);\n        $rootScope.$on('$routeChangeSuccess', RouterOnChangeSuccess);\n        $rootScope.$on('$routeChangeError', RouterOnChangeError);\n        $rootScope.$on('$routeUpdate', RouterOnUpdate);\n\n        var $previous, $current, $next;\n        var $previousController, $currentController, $nextController;\n\n        function RouterSetControllers() {\n            $previousController = $previous ? $previous.controller : null;\n            $currentController = $current ? $current.controller : null;\n            $nextController = $next ? $next.controller : null;\n        }\n\n        /*\n        $routeChangeStart\n        Broadcasted before a route change. At this point the route services starts resolving all of the dependencies needed for the route change to occur. Typically this involves fetching the view template as well as any dependencies defined in resolve route property. Once all of the dependencies are resolved $routeChangeSuccess is fired.\n        The route change (and the $location change that triggered it) can be prevented by calling preventDefault method of the event. See $rootScope.Scope for more details about event object.\n        */\n        function RouterOnChangeStart(event, next, current) {\n            $previous = null;\n            $current = current ? current.$$route : null;\n            $next = next ? next.$$route : null;\n            RouterSetControllers();\n            // console.log('Router.RouterOnChangeStart', '$previous', $previous, '$current', $current, '$next', $next);\n        }\n\n        /*\n        $routeChangeSuccess\n        Broadcasted after a route change has happened successfully. The resolve dependencies are now available in the current.locals property.\n        */\n        function RouterOnChangeSuccess(event, current, previous) {\n            $previous = previous ? previous.$$route : null;\n            $current = current ? current.$$route : null;\n            $next = null;\n            RouterSetControllers();\n            // console.log('Router.RouterOnChangeSuccess', '$previous', $previous, '$current', $current, '$next', $next);\n        }\n\n        /*\n        $routeChangeError\n        Broadcasted if a redirection function fails or any redirection or resolve promises are rejected.\n        */\n        function RouterOnChangeError(event, current, previous, rejection) {\n            $previous = null;\n            $current = previous.$$route || null;\n            $next = null;\n            RouterSetControllers();\n            // console.log('Router.RouterOnChangeError', '$previous', $previous, '$current', $current, '$next', $next);\n        }\n\n        /*\n        $routeUpdate\n        The reloadOnSearch property has been set to false, and we are reusing the same instance of the Controller.\n        */\n        function RouterOnUpdate(event, current) {\n            $previous = current ? current.$$route : null;\n            $current = current ? current.$$route : null;\n            $next = null;\n            RouterSetControllers();\n            // console.log('Router.RouterOnUpdate', '$previous', $previous, '$current', $current, '$next', $next);\n        }\n\n        function RouterIsController(controller) {\n            return $currentController === controller;\n        }\n\n        // navigation\n\n        function RouterRedirectTo(path) {\n            $location.$$lastRequestedPath = $location.path();\n            $location.path(path);\n        }\n\n        function RouterRetryLastRequestedPath(path) {\n            path = $location.$$lastRequestedPath || path;\n            $location.$$lastRequestedPath = null;\n            $location.path(path);\n        }\n\n        function RouterRedirect(path, msecs) {\n            if (msecs) {\n                $timeout(function() {\n                    RouterRedirectTo(path);\n                }, msecs);\n            } else {\n                RouterRedirectTo(path);\n            }\n        }\n\n        function RouterPath(path, msecs) {\n            if (msecs) {\n                $timeout(function() {\n                    RouterRetryLastRequestedPath(path);\n                }, msecs);\n            } else {\n                RouterRetryLastRequestedPath(path);\n            }\n        }\n\n        function RouterApply(path, msecs) {\n            if (msecs) {\n                $timeout(function() {\n                    $location.path(path);\n                }, msecs);\n            } else {\n                $timeout(function() {\n                    $location.path(path);\n                });\n            }\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Silent', ['$rootScope', '$location', function ($rootScope, $location) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\tsilent: SilentSilent,\n\t\t\tpath: SilentPath,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t$rootScope.$$listeners.$locationChangeSuccess.unshift(SilentListener);\n\t\t// console.log('$rootScope.$$listeners.$locationChangeSuccess', $rootScope.$$listeners.$locationChangeSuccess);\n\n\t\t// private vars\n\n\t\tvar $path;\n\n\t\t// static methods\n\n\t\tfunction SilentGetDomain() {\n\t\t\tvar currentDomain = window.location.protocol + '//' + window.location.hostname + (window.location.port ? ':' + window.location.port : '');\n\t\t\treturn currentDomain;\n\t\t}\n\n\t\tfunction SilentUnlink() {\n\t\t\tvar listeners = $rootScope.$$listeners.$locationChangeSuccess;\n\t\t\tangular.forEach(listeners, function (value, name) {\n\t\t\t\tif (value === listener) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfunction relink() {\n\t\t\t\t\tlisteners[name] = value;\n\t\t\t\t}\n\t\t\t\tlisteners[name] = relink; // temporary unlinking\n\t\t\t});\n\t\t}\n\n\t\tfunction SilentListener(e) {\n\t\t\t// console.log('onLocationChangeSuccess', e);\n\t\t\tif ($path === $location.path()) {\n\t\t\t\tSilentUnlink();\n\t\t\t}\n\t\t\t$path = null;\n\t\t}\n\n\t\tfunction SilentSilent(path, replace) {\n\t\t\t// this.prev = $location.path(); ???\n\t\t\tvar location = $location.url(path);\n\t\t\tif (replace) {\n\t\t\t\tlocation.replace();\n\t\t\t}\n\t\t\t$path = $location.path();\n\t\t}\n\n\t\tfunction SilentPath(path) {\n\t\t\treturn $location.path(path);\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tvar TIMEOUT = 5 * 60 * 1000; // five minutes\n\n\tapp.service('Cookie', ['$promise', function ($promise) {\n\n\t\tvar service = {\n\t\t\tTIMEOUT: TIMEOUT,\n\t\t\tdelete: CookieDelete,\n\t\t\texist: CookieExists,\n\t\t\tget: CookieGet,\n\t\t\ton: CookieOn,\n\t\t\tset: CookieSet,\n\t\t};\n\n\t\tangular.extend(this, service);\n\n\t\tfunction CookieDelete(name) {\n\t\t\tCookieSetter(name, \"\", -1);\n\t\t}\n\n\t\tfunction CookieExists(name) {\n\t\t\treturn document.cookie.indexOf(';' + name + '=') !== -1 || document.cookie.indexOf(name + '=') === 0;\n\t\t}\n\n\t\tfunction CookieGet(name) {\n\t\t\tvar cookieName = name + \"=\";\n\t\t\tvar ca = document.cookie.split(';');\n\t\t\tfor (var i = 0; i < ca.length; i++) {\n\t\t\t\tvar c = ca[i];\n\t\t\t\twhile (c.charAt(0) == ' ') {\n\t\t\t\t\tc = c.substring(1, c.length);\n\t\t\t\t}\n\t\t\t\tif (c.indexOf(cookieName) === 0) {\n\t\t\t\t\tvar value = c.substring(cookieName.length, c.length);\n\t\t\t\t\tvar model = null;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tmodel = JSON.parse(decodeURIComponent(atob(value)));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.log('Cookie.get.error parsing', key, e);\n\t\t\t\t\t}\n\t\t\t\t\treturn model;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\tfunction CookieOn(name) {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tvar i, interval = 1000,\n\t\t\t\t\telapsed = 0,\n\t\t\t\t\ttimeout = Cookie.TIMEOUT;\n\n\t\t\t\tfunction checkCookie() {\n\t\t\t\t\tif (elapsed > timeout) {\n\t\t\t\t\t\tpromise.reject('timeout');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar c = CookieGet(name);\n\t\t\t\t\t\tif (c) {\n\t\t\t\t\t\t\tpromise.resolve(c);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telapsed += interval;\n\t\t\t\t\t\t\ti = setTimeout(checkCookie, interval);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcheckCookie();\n\t\t\t});\n\t\t}\n\n\t\tfunction CookieSet(name, value, days) {\n\t\t\ttry {\n\t\t\t\tvar cache = [];\n\t\t\t\tvar json = JSON.stringify(value, function (key, value) {\n\t\t\t\t\tif (key === 'pool') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.indexOf(value) !== -1) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.push(value);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\tcache = null;\n\t\t\t\tCookieSetter(name, btoa(encodeURIComponent(json)), days);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('CookieSet.error serializing', name, value, e);\n\t\t\t}\n\t\t}\n\n\t\tfunction CookieSetter(name, value, days) {\n\t\t\tvar expires;\n\t\t\tif (days) {\n\t\t\t\tvar date = new Date();\n\t\t\t\tdate.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n\t\t\t\texpires = '; expires=' + date.toGMTString();\n\t\t\t} else {\n\t\t\t\texpires = '';\n\t\t\t}\n\t\t\tdocument.cookie = name + '=' + value + expires + '; path=/';\n\t\t}\n\n    }]);\n\n\tapp.service('LocalStorage', ['$promise', 'Cookie', function ($promise, Cookie) {\n\n\t\tvar service = {\n\t\t\tTIMEOUT: TIMEOUT,\n\t\t\tdelete: LocalDelete,\n\t\t\texist: LocalExists,\n\t\t\tget: LocalGet,\n\t\t\ton: LocalOn,\n\t\t\tset: LocalSet,\n\t\t};\n\n\t\tvar supported = LocalSupported();\n\n\t\tif (supported) {\n\t\t\tangular.extend(this, service);\n\t\t} else {\n\t\t\tangular.extend(this, Cookie);\n\t\t}\n\n\t\tthis.supported = supported;\n\n\t\tfunction LocalSupported() {\n\t\t\tvar supported = false;\n\t\t\ttry {\n\t\t\t\tsupported = 'localStorage' in window && window.localStorage !== null;\n\t\t\t\tif (supported) {\n\t\t\t\t\twindow.localStorage.setItem('test', '1');\n\t\t\t\t\twindow.localStorage.removeItem('test');\n\t\t\t\t} else {\n\t\t\t\t\tsupported = false;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tsupported = false;\n\t\t\t}\n\t\t\treturn supported;\n\t\t}\n\n\t\tfunction LocalExists(name) {\n\t\t\treturn window.localStorage[name] !== undefined;\n\t\t}\n\n\t\tfunction LocalGet(name) {\n\t\t\tvar value = null;\n\t\t\tif (window.localStorage[name] !== undefined) {\n\t\t\t\ttry {\n\t\t\t\t\tvalue = JSON.parse(window.localStorage[name]);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('LocalStorage.get.error parsing', name, e);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction LocalSet(name, value) {\n\t\t\ttry {\n\t\t\t\tvar cache = [];\n\t\t\t\tvar json = JSON.stringify(value, function (key, value) {\n\t\t\t\t\tif (key === 'pool') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.indexOf(value) !== -1) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.push(value);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\tcache = null;\n\t\t\t\twindow.localStorage.setItem(name, json);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('LocalStorage.set.error serializing', name, value, e);\n\t\t\t}\n\t\t}\n\n\t\tfunction LocalDelete(name) {\n\t\t\twindow.localStorage.removeItem(name);\n\t\t}\n\n\t\tfunction LocalOn(name) {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tvar i, timeout = Cookie.TIMEOUT;\n\n\t\t\t\tfunction storageEvent(e) {\n\t\t\t\t\t// console.log('LocalStorage.on', name, e);\n\t\t\t\t\tif (i) {\n\t\t\t\t\t\tclearTimeout(i);\n\t\t\t\t\t}\n\t\t\t\t\tif (e.originalEvent.key == name) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n\t\t\t\t\t\t\tpromise.resolve(value);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.log('LocalStorage.on.error parsing', name, error);\n\t\t\t\t\t\t\tpromise.reject('error parsing ' + name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tangular.element(window).on('storage', storageEvent);\n\t\t\t\ti = setTimeout(function () {\n\t\t\t\t\tpromise.reject('timeout');\n\t\t\t\t}, timeout);\n\t\t\t});\n\t\t}\n\n    }]);\n\n\tapp.factory('SessionStorage', ['$promise', 'Cookie', function ($promise, Cookie) {\n\n\t\tvar service = {\n\t\t\tTIMEOUT: TIMEOUT,\n\t\t\tdelete: LocalDelete,\n\t\t\texist: LocalExists,\n\t\t\tget: LocalGet,\n\t\t\ton: LocalOn,\n\t\t\tset: LocalSet,\n\t\t};\n\n\t\tvar supported = SessionSupported();\n\n\t\tif (supported) {\n\t\t\tangular.extend(this, service);\n\t\t} else {\n\t\t\tangular.extend(this, Cookie);\n\t\t}\n\n\t\tthis.supported = supported;\n\n\t\tfunction SessionSupported() {\n\t\t\tvar supported = false;\n\t\t\ttry {\n\t\t\t\tsupported = 'sessionStorage' in window && window.sessionStorage !== undefined;\n\t\t\t\tif (supported) {\n\t\t\t\t\twindow.sessionStorage.setItem('test', '1');\n\t\t\t\t\twindow.sessionStorage.removeItem('test');\n\t\t\t\t} else {\n\t\t\t\t\tsupported = false;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tsupported = false;\n\t\t\t}\n\t\t\treturn supported;\n\t\t}\n\n\t\tfunction SessionExists(name) {\n\t\t\treturn window.sessionStorage[name] !== undefined;\n\t\t}\n\n\t\tfunction SessionGet(name) {\n\t\t\tvar value = null;\n\t\t\tif (window.sessionStorage[name] !== undefined) {\n\t\t\t\ttry {\n\t\t\t\t\tvalue = JSON.parse(window.sessionStorage[name]);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.log('SessionStorage.get.error parsing', name, e);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction SessionSet(name, value) {\n\t\t\ttry {\n\t\t\t\tvar cache = [];\n\t\t\t\tvar json = JSON.stringify(value, function (key, value) {\n\t\t\t\t\tif (key === 'pool') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.indexOf(value) !== -1) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.push(value);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\tcache = null;\n\t\t\t\twindow.sessionStorage.setItem(name, json);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('SessionStorage.set.error serializing', name, value, e);\n\t\t\t}\n\t\t}\n\n\t\tfunction SessionDelete(name) {\n\t\t\twindow.sessionStorage.removeItem(name);\n\t\t}\n\n\t\tfunction SessionOn(name) {\n\t\t\treturn $promise(function (promise) {\n\t\t\t\tvar i, timeout = Cookie.TIMEOUT;\n\n\t\t\t\tfunction storageEvent(e) {\n\t\t\t\t\t// console.log('SessionStorage.on', name, e);\n\t\t\t\t\tif (i) {\n\t\t\t\t\t\tclearTimeout(i);\n\t\t\t\t\t}\n\t\t\t\t\tif (e.originalEvent.key === name) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n\t\t\t\t\t\t\tpromise.resolve(value);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.log('SessionStorage.on.error parsing', name, error);\n\t\t\t\t\t\t\tpromise.reject('error parsing ' + name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tangular.element(window).on('storage', storageEvent);\n\t\t\t\ti = setTimeout(function () {\n\t\t\t\t\tpromise.reject('timeout');\n\t\t\t\t}, timeout);\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.service('Trust', ['$sce', function ($sce) {\n\n\t\tvar service = this;\n\n\t\tvar statics = {\n\t\t\thtml: TrustHtml,\n\t\t\tresource: TrustResource,\n\t\t\turl: TrustUrl,\n\t\t};\n\n\t\tangular.extend(service, statics);\n\n\t\t// private vars\n\n\t\tvar values = [],\n\t\t\ttrustedValues = [];\n\n\t\tfunction TrustGetValue(value) {\n\t\t\tvar index = values.indexOf(value);\n\t\t\tif (index !== -1) {\n\t\t\t\treturn trustedValues[index];\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tfunction TrustSetValue(value, trustedValue) {\n\t\t\tvalues.push(value);\n\t\t\tvalues.push(trustedValue);\n\t\t}\n\n\t\tfunction TrustGetOrSet(value, callback) {\n\t\t\tvar trustedValue = TrustGetValue(value);\n\t\t\tif (!trustedValue) {\n\t\t\t\ttrustedValue = callback();\n\t\t\t\tTrustSetValue(value, trustedValue);\n\t\t\t}\n\t\t\treturn trustedValue;\n\t\t}\n\n\t\tfunction TrustHtml(value) {\n\t\t\treturn TrustGetOrSet(value, function () {\n\t\t\t\treturn $sce.trustAsHtml(value);\n\t\t\t});\n\t\t}\n\n\t\tfunction TrustResource(value) {\n\t\t\treturn TrustGetOrSet(value, function () {\n\t\t\t\treturn $sce.trustAsResourceUrl(value);\n\t\t\t});\n\t\t}\n\n\t\tfunction TrustUrl(value) {\n\t\t\treturn TrustGetOrSet(value, function () {\n\t\t\t\treturn 'url(\\'' + value + '\\')';\n\t\t\t});\n\t\t}\n\n    }]);\n\n}());\n/* global angular, firebase */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Color', [function () {\n\t\tfunction Color(r, g, b, a) {\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tthis.r = (r || r === 0) ? r : 0;\n\t\t\t\tthis.g = (g || g === 0) ? g : 0;\n\t\t\t\tthis.b = (b || b === 0) ? b : 0;\n\t\t\t\tthis.a = (a || a === 0) ? a : 255;\n\t\t\t} else {\n\t\t\t\tvar uint = r || '0xffffff';\n\t\t\t\tuint = parseInt(uint);\n\t\t\t\tif (r.length > 8) {\n\t\t\t\t\tthis.r = uint >> 24 & 0xff;\n\t\t\t\t\tthis.g = uint >> 16 & 0xff;\n\t\t\t\t\tthis.b = uint >> 8 & 0xff;\n\t\t\t\t\tthis.a = uint >> 0 & 0xff;\n\t\t\t\t} else {\n\t\t\t\t\tthis.r = uint >> 16 & 0xff;\n\t\t\t\t\tthis.g = uint >> 8 & 0xff;\n\t\t\t\t\tthis.b = uint >> 0 & 0xff;\n\t\t\t\t\tthis.a = 255;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tColor.componentToHex = function (c) {\n\t\t\tvar hex = c.toString(16);\n\t\t\treturn hex.length == 1 ? '0' + hex : hex;\n\t\t};\n\t\tColor.luma = function (color) {\n\t\t\t// var luma = color.dot({ r: 54.213, g: 182.376, b: 18.411 });\n\t\t\tvar luma = color.dot({\n\t\t\t\tr: 95,\n\t\t\t\tg: 100,\n\t\t\t\tb: 60\n\t\t\t});\n\t\t\treturn luma;\n\t\t};\n\t\tColor.contrast = function (color) {\n\t\t\tvar luma = Color.luma(color);\n\t\t\tif (luma > 0.6) {\n\t\t\t\treturn new Color('0x000000');\n\t\t\t} else {\n\t\t\t\treturn new Color('0xffffff');\n\t\t\t}\n\t\t};\n\t\tColor.darker = function (color, pow, min) {\n\t\t\tmin = min || 0;\n\t\t\tvar r = Math.max(Math.floor(color.r * min), Math.floor(color.r - 255 * pow));\n\t\t\tvar g = Math.max(Math.floor(color.g * min), Math.floor(color.g - 255 * pow));\n\t\t\tvar b = Math.max(Math.floor(color.b * min), Math.floor(color.b - 255 * pow));\n\t\t\treturn new Color(r, g, b, color.a);\n\t\t};\n\t\tColor.lighter = function (color, pow, max) {\n\t\t\tmax = max || 1;\n\t\t\tvar r = Math.min(color.r + Math.floor((255 - color.r) * max), Math.floor(color.r + 255 * pow));\n\t\t\tvar g = Math.min(color.g + Math.floor((255 - color.g) * max), Math.floor(color.g + 255 * pow));\n\t\t\tvar b = Math.min(color.b + Math.floor((255 - color.b) * max), Math.floor(color.b + 255 * pow));\n\t\t\treturn new Color(r, g, b, color.a);\n\t\t};\n\t\t/*\n\t\tColor.rgbaToHex = function (rgba) {\n\t\t    rgba = rgba.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\n\t\t    return (rgba && rgba.length === 4) ? \"#\" +\n\t\t        (\"0\" + parseInt(rgba[1], 10).toString(16)).slice(-2) +\n\t\t        (\"0\" + parseInt(rgba[2], 10).toString(16)).slice(-2) +\n\t\t        (\"0\" + parseInt(rgba[3], 10).toString(16)).slice(-2) : '';\n\t\t}\n\t\t*/\n\t\tColor.prototype = {\n\t\t\ttoUint: function () {\n\t\t\t\treturn (this.r << 24) + (this.g << 16) + (this.b << 8) + (this.a);\n\t\t\t},\n\t\t\ttoHex: function () {\n\t\t\t\treturn '#' + Color.componentToHex(this.r) + Color.componentToHex(this.g) + Color.componentToHex(this.b) + Color.componentToHex(this.a);\n\t\t\t},\n\t\t\ttoRgba: function () {\n\t\t\t\treturn 'rgba(' + this.r + ',' + this.g + ',' + this.b + ',' + (this.a / 255).toFixed(3) + ')';\n\t\t\t},\n\t\t\tdot: function (color) {\n\t\t\t\treturn ((this.r / 255) * (color.r / 255) + (this.g / 255) * (color.g / 255) + (this.b / 255) * (color.b / 255));\n\t\t\t},\n\t\t\talpha: function (pow, min, max) {\n\t\t\t\tmin = min || 0;\n\t\t\t\tmax = max || 1;\n\t\t\t\tthis.a = Math.floor((min + (pow * (max - min))) * 255);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tmakeSet: function () {\n\t\t\t\tthis.foreground = Color.contrast(this);\n\t\t\t\tthis.border = Color.darker(this, 0.3);\n\t\t\t\tthis.light = Color.lighter(this, 0.3);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t};\n\t\treturn Color;\n    }]);\n\n\tapp.factory('Shape', [function () {\n\t\tfunction Shape() {}\n\t\tShape.shapeCircle = function (p, cx, cy, r, sa, ea) {\n\t\t\tsa = sa || 0;\n\t\t\tea = ea || 2 * Math.PI;\n\t\t\tp.ctx.arc(cx, cy, r, sa, ea, false);\n\t\t};\n\t\tShape.shapeStar = function (p, cx, cy, or, ir, steps) {\n\t\t\tvar x, y;\n\t\t\tvar angle = Math.PI / 2 * 3;\n\t\t\tvar step = Math.PI / steps;\n\t\t\tvar ctx = p.ctx;\n\t\t\tctx.moveTo(cx, cy - or);\n\t\t\tfor (i = 0; i < steps; i++) {\n\t\t\t\tx = cx + Math.cos(angle) * or;\n\t\t\t\ty = cy + Math.sin(angle) * or;\n\t\t\t\tctx.lineTo(x, y);\n\t\t\t\tangle += step;\n\t\t\t\tx = cx + Math.cos(angle) * ir;\n\t\t\t\ty = cy + Math.sin(angle) * ir;\n\t\t\t\tctx.lineTo(x, y);\n\t\t\t\tangle += step;\n\t\t\t}\n\t\t\tctx.lineTo(cx, cy - or);\n\t\t};\n\t\tShape.shapeRoundRect = function (p, rect, r) {\n\t\t\tvar ctx = p.ctx,\n\t\t\t\tx = rect.x,\n\t\t\t\ty = rect.y,\n\t\t\t\tw = rect.w,\n\t\t\t\th = rect.h;\n\t\t\tif (typeof r === undefined) {\n\t\t\t\tr = 4;\n\t\t\t}\n\t\t\tif (typeof r === 'number') {\n\t\t\t\tr = {\n\t\t\t\t\ttl: r,\n\t\t\t\t\ttr: r,\n\t\t\t\t\tbr: r,\n\t\t\t\t\tbl: r\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tvar defaultRadius = {\n\t\t\t\t\ttl: 0,\n\t\t\t\t\ttr: 0,\n\t\t\t\t\tbr: 0,\n\t\t\t\t\tbl: 0\n\t\t\t\t};\n\t\t\t\tfor (var key in defaultRadius) {\n\t\t\t\t\tr[key] = r[key] || defaultRadius[key];\n\t\t\t\t}\n\t\t\t}\n\t\t\tctx.moveTo(x + r.tl, y);\n\t\t\tctx.lineTo(x + w - r.tr, y);\n\t\t\tctx.quadraticCurveTo(x + w, y, x + w, y + r.tr);\n\t\t\tctx.lineTo(x + w, y + h - r.br);\n\t\t\tctx.quadraticCurveTo(x + w, y + h, x + w - r.br, y + h);\n\t\t\tctx.lineTo(x + r.bl, y + h);\n\t\t\tctx.quadraticCurveTo(x, y + h, x, y + h - r.bl);\n\t\t\tctx.lineTo(x, y + r.tl);\n\t\t\tctx.quadraticCurveTo(x, y, x + r.tl, y);\n\t\t};\n\t\tShape.circle = function () {\n\t\t\tvar params = Array.prototype.slice.call(arguments);\n\t\t\tvar ctx = params[0].ctx;\n\t\t\tctx.beginPath();\n\t\t\tShape.shapeCircle.apply(this, params);\n\t\t\tctx.closePath();\n\t\t};\n\t\tShape.star = function () {\n\t\t\tvar params = Array.prototype.slice.call(arguments);\n\t\t\tvar ctx = params[0].ctx;\n\t\t\tctx.beginPath();\n\t\t\tShape.shapeStar.apply(this, params);\n\t\t\tctx.closePath();\n\t\t};\n\t\tShape.roundRect = function () {\n\t\t\tvar params = Array.prototype.slice.call(arguments);\n\t\t\tvar ctx = params[0].ctx;\n\t\t\tctx.beginPath();\n\t\t\tShape.shapeRoundRect.apply(this, params);\n\t\t\tctx.closePath();\n\t\t};\n\t\treturn Shape;\n    }]);\n\n\tapp.constant('PainterColors', {\n\t\t/*\n\t\tblack: new Color('0x111111'),\n\t\twhite: new Color('0xffffff'),\n\t\tred: new Color('0xff0000'),\n\t\tgreen: new Color('0x00ff00'),\n\t\tblue: new Color('0x0000ff'),\n\t\tyellow: new Color('0xffff00'),\n\t\tcyan: new Color('0x00ffff'),\n\t\tpurple: new Color('0xff00ff'),\n\t\t*/\n\t\tblack: '0x14191e',\n\t\twhite: '0xffffff',\n\t\tblue: '0x0023FF',\n\t\tred: '0xF21500',\n\t\tlightBlue: '0x79ccf2',\n\t\tlightYellow: '0xfff79a',\n\t\tgreyLighter: '0xf8f8f8',\n\t\tgreyLight: '0xeeeeee',\n\t\tgreyMedium: '0xcccccc',\n\t\tgrey: '0x90939b',\n\t\tmap: '0x24292e',\n\t});\n\n\tapp.factory('Palette', ['$q', 'Painter', 'Rect', function ($q, Painter, Rect) {\n\t\tfunction Palette() {\n\t\t\tthis.painter = new Painter().setSize(0, 0);\n\t\t\tthis.buffer = new Painter().setSize(0, 0);\n\t\t\tthis.size = {\n\t\t\t\tw: 0,\n\t\t\t\th: 0\n\t\t\t};\n\t\t\tthis.pool = {};\n\t\t\tthis.rows = {};\n\t\t}\n\t\tPalette.prototype = {\n\t\t\tgetRect: function (w, h) {\n\t\t\t\tvar p = this.painter,\n\t\t\t\t\tsize = this.size,\n\t\t\t\t\trows = this.rows,\n\t\t\t\t\tr = new Rect(0, 0, w, h),\n\t\t\t\t\trow = rows[h] || {\n\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\ty: size.h\n\t\t\t\t\t};\n\t\t\t\tsize.w = Math.max(size.w, row.x + w);\n\t\t\t\tsize.h = Math.max(size.h, row.y + h);\n\t\t\t\tif (!p.canvas.width && !p.canvas.height) {\n\t\t\t\t\tp.setSize(size.w, size.h);\n\t\t\t\t} else if (size.w > p.canvas.width || size.h > p.canvas.height) {\n\t\t\t\t\t// var img = new Image();\n\t\t\t\t\t// img.src = p.toDataURL();\n\t\t\t\t\t// document.body.appendChild(canvas);\n\t\t\t\t\t// console.log(p.canvas.width, p.canvas.height);\n\t\t\t\t\t// var data = p.ctx.getImageData(0, 0, p.canvas.width, p.canvas.height);\n\t\t\t\t\tvar canvas = p.canvas;\n\t\t\t\t\tp.setCanvas(document.createElement('canvas'));\n\t\t\t\t\tp.setSize(size.w, size.h);\n\t\t\t\t\tp.ctx.drawImage(canvas, 0, 0);\n\t\t\t\t\t// p.ctx.putImageData(data, 0, 0);\n\t\t\t\t\t// p.ctx.drawImage(img, 0, 0);\n\t\t\t\t\t// document.body.removeChild(canvas);\n\t\t\t\t}\n\t\t\t\tr.x = row.x;\n\t\t\t\tr.y = row.y;\n\t\t\t\trow.x += w;\n\t\t\t\trows[h] = row;\n\t\t\t\treturn r;\n\t\t\t},\n\t\t\tadd: function (key, path) {\n\t\t\t\tvar palette = this;\n\t\t\t\tif (angular.isString(path)) {\n\t\t\t\t\tvar deferred = $q.defer();\n\t\t\t\t\tvar img = new Image();\n\t\t\t\t\timg.onload = function () {\n\t\t\t\t\t\tpalette.addShape(key, img.width, img.height, function (p, rect) {\n\t\t\t\t\t\t\tp.ctx.drawImage(img, 0, 0);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdeferred.resolve(img);\n\t\t\t\t\t};\n\t\t\t\t\timg.onerror = function () {\n\t\t\t\t\t\tdeferred.reject('connot load ' + path);\n\t\t\t\t\t};\n\t\t\t\t\timg.src = path;\n\t\t\t\t\treturn deferred.promise;\n\t\t\t\t} else {\n\t\t\t\t\tvar params = Array.prototype.slice.call(arguments);\n\t\t\t\t\treturn palette.addShape.apply(palette, params);\n\t\t\t\t}\n\t\t\t},\n\t\t\taddShape: function (key, w, h, callback) {\n\t\t\t\tvar p = this.painter,\n\t\t\t\t\tr = this.getRect(w, h);\n\t\t\t\tp.ctx.save();\n\t\t\t\tp.ctx.rect(r.x, r.y, r.w, r.h);\n\t\t\t\t// p.ctx.stroke();\n\t\t\t\tp.ctx.clip();\n\t\t\t\tp.ctx.translate(r.x, r.y);\n\t\t\t\tcallback.call(p, p, r.clone().setPos(0, 0));\n\t\t\t\tp.ctx.restore();\n\t\t\t\tthis.pool[key] = r;\n\t\t\t\t// console.log('Painter.add', r);\n\t\t\t},\n\t\t\tdraw: function (target, key, x, y, pre) {\n\t\t\t\tvar r = this.pool[key];\n\t\t\t\tif (r) {\n\t\t\t\t\t// var ctx = target.ctx;\n\t\t\t\t\t// ctx.save();\n\t\t\t\t\ttarget.drawRect(this.painter.canvas, r, {\n\t\t\t\t\t\tx: x,\n\t\t\t\t\t\ty: y,\n\t\t\t\t\t\tw: r.w,\n\t\t\t\t\t\th: r.h\n\t\t\t\t\t}, pre);\n\t\t\t\t\t// target.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, x - r.w / 2, y - r.h / 2, r.w, r.h);\n\t\t\t\t\t// ctx.restore();\n\t\t\t\t}\n\t\t\t},\n\t\t\ttint: function (target, key, x, y, color, pre) {\n\t\t\t\tvar r = this.pool[key];\n\t\t\t\tif (r) {\n\t\t\t\t\tvar p = this.painter,\n\t\t\t\t\t\tb = this.buffer.setSize(r.w, r.h);\n\t\t\t\t\tb.save();\n\t\t\t\t\tb.setFill(color);\n\t\t\t\t\tb.fillRect();\n\t\t\t\t\tb.ctx.globalCompositeOperation = \"destination-atop\";\n\t\t\t\t\tb.ctx.drawImage(p.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n\t\t\t\t\tb.restore();\n\t\t\t\t\tconsole.log(x, y, b.canvas, target.canvas);\n\t\t\t\t\ttarget.draw(b.canvas, {\n\t\t\t\t\t\tx: x,\n\t\t\t\t\t\ty: y\n\t\t\t\t\t}, pre);\n\t\t\t\t}\n\t\t\t},\n\t\t\tpattern: function (target, key, x, y, w, h, color) {\n\t\t\t\tfunction drawPattern(pattern) {\n\t\t\t\t\tvar ctx = target.ctx;\n\t\t\t\t\tctx.save();\n\t\t\t\t\tctx.translate(x, y);\n\t\t\t\t\t// draw\n\t\t\t\t\t// ctx.beginPath();\n\t\t\t\t\t// ctx.rect(-x, -y, w, h);\n\t\t\t\t\tctx.fillStyle = pattern;\n\t\t\t\t\tctx.fillRect(-x, -y, w, h);\n\t\t\t\t\tctx.translate(-x, -y);\n\t\t\t\t\t// ctx.fill();\n\t\t\t\t\tctx.restore();\n\t\t\t\t}\n\t\t\t\tvar r = this.pool[key];\n\t\t\t\tif (r) {\n\t\t\t\t\tvar img = r.img,\n\t\t\t\t\t\tpattern;\n\t\t\t\t\tif (!img || r.color != color) {\n\t\t\t\t\t\tvar b = this.buffer.setSize(r.w, r.h);\n\t\t\t\t\t\tif (color) {\n\t\t\t\t\t\t\tr.color = color;\n\t\t\t\t\t\t\tb.save();\n\t\t\t\t\t\t\tb.setFill(color);\n\t\t\t\t\t\t\tb.fillRect();\n\t\t\t\t\t\t\tb.ctx.globalCompositeOperation = \"destination-atop\";\n\t\t\t\t\t\t\tb.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n\t\t\t\t\t\t\tb.restore();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tb.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n\t\t\t\t\t\t}\n\t\t\t\t\t\timg = new Image();\n\t\t\t\t\t\timg.onload = function () {\n\t\t\t\t\t\t\tr.img = img;\n\t\t\t\t\t\t\tpattern = target.ctx.createPattern(img, \"repeat\");\n\t\t\t\t\t\t\tdrawPattern(pattern);\n\t\t\t\t\t\t};\n\t\t\t\t\t\timg.src = b.toDataURL();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpattern = target.ctx.createPattern(img, \"repeat\");\n\t\t\t\t\t\tdrawPattern(pattern);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t\treturn Palette;\n    }]);\n\n\tapp.factory('Painter', ['Shape', 'Rect', 'Color', 'PainterColors', function (Shape, Rect, Color, PainterColors) {\n\t\tfunction Painter(canvas) {\n\t\t\tcanvas = canvas || document.createElement('canvas');\n\t\t\tthis.rect = new Rect();\n\t\t\tthis.drawingRect = new Rect();\n\t\t\tthis.setColors();\n\t\t\tthis.setCanvas(canvas);\n\t\t}\n\t\tPainter.colors = {};\n\t\tangular.forEach(PainterColors, function (value, key) {\n\t\t\tPainter.colors[key] = new Color(value).makeSet();\n\t\t});\n\t\tvar colors = Painter.colors;\n\t\tPainter.prototype = {\n\t\t\tcolors: Painter.colors,\n\t\t\tsetColors: function () {\n\t\t\t\tvar colors = this.colors;\n\t\t\t\tangular.forEach(PainterColors, function (value, key) {\n\t\t\t\t\tcolors[key] = new Color(value).makeSet();\n\t\t\t\t});\n\t\t\t},\n\t\t\tsetCanvas: function (canvas) {\n\t\t\t\tthis.canvas = canvas;\n\t\t\t\tthis.setSize(canvas.offsetWidth, canvas.offsetHeight);\n\t\t\t\tvar ctx = canvas.getContext('2d');\n\t\t\t\tctx.lineCap = 'square';\n\t\t\t\tthis.ctx = ctx;\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetSize: function (w, h) {\n\t\t\t\tthis.canvas.width = w;\n\t\t\t\tthis.canvas.height = h;\n\t\t\t\tthis.rect.w = w;\n\t\t\t\tthis.rect.h = h;\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tcopy: function (canvas) {\n\t\t\t\tthis.ctx.drawImage(canvas, 0, 0);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tclear: function () {\n\t\t\t\tthis.resize();\n\t\t\t\t// this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tresize: function () {\n\t\t\t\tthis.setSize(this.canvas.offsetWidth, this.canvas.offsetHeight);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetText: function (font, align, verticalAlign, color) {\n\t\t\t\tfont = font || '11px monospace';\n\t\t\t\talign = align || 'center';\n\t\t\t\tverticalAlign = verticalAlign || 'middle';\n\t\t\t\tcolor = color || this.colors.black;\n\t\t\t\tvar ctx = this.ctx;\n\t\t\t\tctx.font = font;\n\t\t\t\tctx.textAlign = align;\n\t\t\t\tctx.textBaseline = verticalAlign;\n\t\t\t\tctx.fillStyle = color.toRgba();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetFill: function (color) {\n\t\t\t\tcolor = color || this.colors.black;\n\t\t\t\tvar ctx = this.ctx;\n\t\t\t\t/*\n\t\t\t\tvar my_gradient = ctx.createLinearGradient(0, 0, 0, 170);\n\t\t\t\tmy_gradient.addColorStop(0, \"black\");\n\t\t\t\tmy_gradient.addColorStop(1, \"white\");\n\t\t\t\tctx.fillStyle = my_gradient;\n\t\t\t\t*/\n\t\t\t\tctx.fillStyle = color.toRgba();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsetStroke: function (color, size) {\n\t\t\t\tcolor = color || this.colors.black;\n\t\t\t\tvar ctx = this.ctx;\n\t\t\t\tsize = size || 1;\n\t\t\t\t/*\n\t\t\t\tvar gradient=ctx.createLinearGradient(0,0,170,0);\n\t\t\t\tgradient.addColorStop(\"0\",\"magenta\");\n\t\t\t\tgradient.addColorStop(\"0.5\",\"blue\");\n\t\t\t\tgradient.addColorStop(\"1.0\",\"red\");\n\t\t\t\tctx.strokeStyle = gradient;\n\t\t\t\t*/\n\t\t\t\t// Fill with gradient\n\t\t\t\tctx.strokeStyle = color.toRgba();\n\t\t\t\tctx.lineWidth = size;\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\t/*\n\t\t\tdrawRoundRect: function (rect, r) {\n\t\t\t    rect = rect || this.rect;\n\t\t\t    Shape.roundRect(this, rect, r);\n\t\t\t    return this;\n\t\t\t},\n\t\t\t*/\n\t\t\tfillText: function (text, point, width, post, maxLength) {\n\t\t\t\tif (width) {\n\t\t\t\t\tpost = post || '';\n\t\t\t\t\tmaxLength = maxLength || Math.floor(width / 8);\n\t\t\t\t\tif (text.length > maxLength) {\n\t\t\t\t\t\ttext = text.substr(0, Math.min(text.length, maxLength)).trim() + post;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.ctx.fillText(text, point.x, point.y);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tfillRect: function (rect) {\n\t\t\t\trect = rect || this.rect;\n\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\tx = rect.x,\n\t\t\t\t\ty = rect.y,\n\t\t\t\t\tw = rect.w,\n\t\t\t\t\th = rect.h;\n\t\t\t\tctx.fillRect(x, y, w, h);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tstrokeRect: function (rect) {\n\t\t\t\trect = rect || this.rect;\n\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\tx = rect.x,\n\t\t\t\t\ty = rect.y,\n\t\t\t\t\tw = rect.w,\n\t\t\t\t\th = rect.h;\n\t\t\t\tctx.strokeRect(x, y, w, h);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tfill: function () {\n\t\t\t\tthis.ctx.fill();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tstroke: function () {\n\t\t\t\tthis.ctx.stroke();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tbegin: function () {\n\t\t\t\tthis.ctx.beginPath();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tclose: function () {\n\t\t\t\tthis.ctx.closePath();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tsave: function () {\n\t\t\t\tthis.ctx.save();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\trestore: function () {\n\t\t\t\tthis.ctx.restore();\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\trotate: function (angle) {\n\t\t\t\tthis.ctx.rotate(angle * Math.PI / 180);\n\t\t\t},\n\t\t\ttranslate: function (xy) {\n\t\t\t\tthis.ctx.translate(xy.x, xy.y);\n\t\t\t},\n\t\t\ttoDataURL: function () {\n\t\t\t\treturn this.canvas.toDataURL();\n\t\t\t},\n\t\t\tdraw: function (image, t, pre) {\n\t\t\t\tif (image) {\n\t\t\t\t\tt.w = t.w || image.width;\n\t\t\t\t\tt.h = t.h || image.height;\n\t\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\t\trect = this.drawingRect,\n\t\t\t\t\t\tx = rect.x = t.x - t.w / 2,\n\t\t\t\t\t\ty = rect.y = t.y - t.h / 2,\n\t\t\t\t\t\tw = rect.w = t.w,\n\t\t\t\t\t\th = rect.h = t.h;\n\t\t\t\t\tctx.save();\n\t\t\t\t\tctx.translate(x, y);\n\t\t\t\t\tif (pre) {\n\t\t\t\t\t\tpre.call(this);\n\t\t\t\t\t}\n\t\t\t\t\tctx.drawImage(image, 0, 0);\n\t\t\t\t\tctx.restore();\n\t\t\t\t\t// console.log('painter.draw', x, y, w, h);\n\t\t\t\t}\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tdrawRect: function (image, s, t, pre) {\n\t\t\t\tif (image) {\n\t\t\t\t\ts.w = s.w || image.width;\n\t\t\t\t\ts.h = s.h || image.height;\n\t\t\t\t\tt.w = t.w || image.width;\n\t\t\t\t\tt.h = t.h || image.height;\n\t\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\t\trect = this.drawingRect,\n\t\t\t\t\t\tx = rect.x = t.x - s.w / 2,\n\t\t\t\t\t\ty = rect.y = t.y - s.h / 2,\n\t\t\t\t\t\tw = rect.w = t.w,\n\t\t\t\t\t\th = rect.h = t.h;\n\t\t\t\t\tctx.save();\n\t\t\t\t\tctx.translate(x, y);\n\t\t\t\t\tif (pre) {\n\t\t\t\t\t\tpre.call(this);\n\t\t\t\t\t}\n\t\t\t\t\tctx.drawImage(image, s.x, s.y, s.w, s.h, 0, 0, t.w, t.h);\n\t\t\t\t\tctx.restore();\n\t\t\t\t\t// console.log('painter.drawRect', x, y, w, h);\n\t\t\t\t}\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tflip: function (scale) {\n\t\t\t\tscale = scale || {\n\t\t\t\t\tx: 1,\n\t\t\t\t\ty: -1\n\t\t\t\t};\n\t\t\t\tvar ctx = this.ctx,\n\t\t\t\t\trect = this.drawingRect;\n\t\t\t\tctx.translate(scale.x === -1 ? rect.w : 0, scale.y === -1 ? rect.h : 0);\n\t\t\t\tctx.scale(scale.x, scale.y);\n\t\t\t},\n\t\t};\n\t\treturn Painter;\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.directive('expandable', ['State', 'Events', function(State, Events) {\n\n        var directive = {\n            restrict: 'A',\n            // template: '<div ng-transclude></div>',\n            // transclude: true,\n            // replace: true,\n            /*\n\t\t\ttemplateUrl: function (element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/nav/nav';\n            },\n            */\n            link: ExpandableLink,\n        };\n\n        return directive;\n\n        function ExpandableLink(scope, element, attributes, model) {\n\n            var state = new State();\n\n            var node = element[0],\n                placeholderNode = document.createElement('div'),\n                placeholder = angular.element(placeholderNode);\n            placeholder.addClass('expandable-placeholder');\n\n            var fromRect, toRect, cssText;\n\n            var expanded = false;\n\n            function getStyle(node) {\n                var style = window.getComputedStyle(node, null);\n                var styleObj = {\n                    'display': style.getPropertyValue('display'),\n                    'position': style.getPropertyValue('position'),\n                    'width': style.getPropertyValue('width'),\n                    'height': style.getPropertyValue('height'),\n                    'top': style.getPropertyValue('top'),\n                    'right': style.getPropertyValue('right'),\n                    'bottom': style.getPropertyValue('bottom'),\n                    'left': style.getPropertyValue('left'),\n                    'margin-top': style.getPropertyValue('margin-top'),\n                    'margin-right': style.getPropertyValue('margin-right'),\n                    'margin-bottom': style.getPropertyValue('margin-bottom'),\n                    'margin-left': style.getPropertyValue('margin-left'),\n                    'padding-top': style.getPropertyValue('padding-top'),\n                    'padding-right': style.getPropertyValue('padding-right'),\n                    'padding-bottom': style.getPropertyValue('padding-bottom'),\n                    'padding-left': style.getPropertyValue('padding-left'),\n                    'background-color': style.getPropertyValue('background-color'),\n                };\n                console.log(styleObj);\n                return styleObj;\n            }\n\n            function getTextStyle(style) {\n                var text = '';\n                angular.forEach(style, function(value, key) {\n                    text += key + ': ' + value + '; ';\n                });\n                return text;\n            }\n\n            function add() {\n                var styleObj = getStyle(node);\n                var styleText = getTextStyle(styleObj);\n                placeholderNode.style.cssText = styleText;\n                node.parentNode.insertBefore(placeholderNode, node);\n                cssText = node.style.cssText;\n                element.addClass('expandable-expanding');\n            }\n\n            function remove() {\n                node.style.cssText = cssText;\n                element.removeClass('expandable-expanding');\n                placeholderNode.parentNode.removeChild(placeholderNode);\n            }\n\n            function expand() {\n                var rect = node.getBoundingClientRect();\n                fromRect = {\n                    top: rect.top,\n                    left: rect.left,\n                    width: rect.width,\n                    height: rect.height,\n                };\n                toRect = {\n                    top: 10,\n                    left: 10,\n                    width: 100,\n                    height: 100,\n                };\n                console.log('fromRect', fromRect);\n                add();\n                dynamics.css(node, fromRect);\n                dynamics.animate(node, toRect, {\n                    type: dynamics.spring,\n                    frequency: 200,\n                    friction: 200,\n                    duration: 1500,\n                    complete: function() {\n                        state.idle();\n                    }\n                });\n            }\n\n            function contract() {\n                dynamics.animate(node, fromRect, {\n                    type: dynamics.spring,\n                    frequency: 200,\n                    friction: 200,\n                    duration: 1500,\n                    complete: function() {\n                        remove();\n                        state.idle();\n                    }\n                });\n            }\n\n            function toggle() {\n                if (state.busy()) {\n                    expanded = !expanded;\n                    if (expanded) {\n                        expand();\n                    } else {\n                        contract();\n                    }\n                }\n            }\n\n            function onDown(e) {\n                console.log('ExpandableLink', e);\n                toggle();\n            }\n\n            var events = new Events(element).add({\n                down: onDown,\n            }, scope);\n\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.directive('controlMessages', [function() {\n        return {\n            restrict: 'E',\n            templateUrl: 'artisan/forms/messages',\n            transclude: {\n                'message': '?messageItems',\n            },\n            link: function(scope, element, attributes, model) {}\n        };\n    }]);\n\n    app.directive('control', ['$parse', function($parse) {\n        function formatLabel(string, prepend, expression) {\n            string = string || '';\n            prepend = prepend || '';\n            var splitted = string.split(',');\n            if (splitted.length > 1) {\n                var formatted = splitted.shift();\n                angular.forEach(splitted, function(value, index) {\n                    if (expression) {\n                        formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n                    } else {\n                        formatted = formatted.split('{' + index + '}').join(prepend + value);\n                    }\n                });\n                if (expression) {\n                    return '\\'' + formatted + '\\'';\n                } else {\n                    return formatted;\n                }\n            } else {\n                return prepend + string;\n            }\n        }\n        var uniqueId = 0;\n        return {\n            restrict: 'A',\n            templateUrl: function(element, attributes) {\n                var template = 'artisan/forms/text';\n                switch (attributes.control) {\n                    case 'select':\n                        template = 'artisan/forms/select';\n                        break;\n                }\n                return template;\n            },\n            scope: {\n                ngModel: '=',\n                required: '=',\n                form: '@',\n                title: '@',\n                placeholder: '@',\n                source: '=?',\n                key: '@?',\n                label: '@?',\n            },\n            require: 'ngModel',\n            transclude: true,\n            link: {\n                pre: function preLink(scope, element, attributes, controller, transclude) {\n                    var label = scope.label = (scope.label ? scope.label : 'name');\n                    var key = scope.key = (scope.key ? scope.key : 'id');\n                    if (attributes.control === 'select') {\n                        var filter = (attributes.filter ? '| ' + attributes.filter : '');\n                        var optionLabel = formatLabel(label, 'item.', true);\n                        scope.getOptions = function() {\n                            return attributes.number ?\n                                'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in source ' + filter :\n                                optionLabel + ' disable when item.disabled for item in source ' + filter + ' track by item.' + key;\n                        };\n                    }\n                    var type = scope.type = attributes.control;\n                    var form = scope.form = scope.form || 'form';\n                    var title = scope.title = scope.title || 'untitled';\n                    var placeholder = scope.placeholder = scope.placeholder || title;\n                    var field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\n                    scope.format = attributes.format || null;\n                    scope.precision = attributes.precision || null;\n                    scope.validate = attributes.validate || attributes.control;\n                    scope.minLength = attributes.minLength || 0;\n                    scope.maxLength = attributes.maxLength || Number.POSITIVE_INFINITY;\n                    scope.min = attributes.min || null;\n                    scope.max = attributes.max || null;\n                    scope.options = $parse(attributes.options)(scope) || {};\n                    scope.focus = false;\n                    scope.visible = false;\n                    scope.onChange = function(model) {\n                        $parse(attributes.onChange)(scope.$parent);\n                    };\n                    scope.onFilter = function(model) {\n                        $parse(attributes.onFilter)(scope.$parent);\n                    };\n                    scope.getType = function() {\n                        var type = 'text';\n                        switch (attributes.control) {\n                            case 'password':\n                                type = scope.visible ? 'text' : 'password';\n                                break;\n                            default:\n                                type = attributes.control;\n                        }\n                        return type;\n                    };\n                    scope.getClasses = function() {\n                        var form = $parse(scope.form)(scope.$parent);\n                        var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n                        return {\n                            'control-focus': scope.focus,\n                            'control-success': field.$valid,\n                            'control-error': field.$invalid && (form.$submitted || field.$touched),\n                            'control-empty': !field.$viewValue\n                        };\n                    };\n                    scope.getMessages = function() {\n                        var form = $parse(scope.form)(scope.$parent);\n                        var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n                        return (form.$submitted || field.$touched) && field.$error;\n                    };\n                    scope.toggleVisibility = function() {\n                        scope.visible = !scope.visible;\n                    };\n                },\n            },\n        };\n    }]);\n\n    app.directive('_control', ['$http', '$templateCache', '$compile', '$parse', function($http, $templateCache, $compile, $parse) {\n        function formatLabel(string, prepend, expression) {\n            string = string || '';\n            prepend = prepend || '';\n            var splitted = string.split(',');\n            if (splitted.length > 1) {\n                var formatted = splitted.shift();\n                angular.forEach(splitted, function(value, index) {\n                    if (expression) {\n                        formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n                    } else {\n                        formatted = formatted.split('{' + index + '}').join(prepend + value);\n                    }\n                });\n                if (expression) {\n                    return '\\'' + formatted + '\\'';\n                } else {\n                    return formatted;\n                }\n            } else {\n                return prepend + string;\n            }\n        }\n        var uniqueId = 0;\n        return {\n            restrict: 'A',\n            templateUrl: function(element, attributes) {\n                var template = 'artisan/forms/text';\n                switch (attributes.control) {\n                    case 'select':\n                        template = 'artisan/forms/select';\n                        break;\n                }\n                return template;\n            },\n            scope: {\n                ngModel: '=',\n                required: '=',\n                form: '@',\n                title: '@',\n                placeholder: '@',\n            },\n            require: 'ngModel',\n            /*\n            link: function(scope, element, attributes, model) {\n            },\n            */\n            compile: function(element, attributes) {\n                    return {\n                        pre: function(scope, element, attributes) {\n                            if (attributes.control === 'select') {\n                                var label = (attributes.label ? attributes.label : 'name');\n                                var key = (attributes.key ? attributes.key : 'id');\n                                var filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\n                                var optionLabel = formatLabel(label, 'item.', true);\n                                scope.options = attributes.number ?\n                                    'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter :\n                                    optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter + ' track by item.' + key;\n                                console.log('control.compile.pre', scope.options);\n                            }\n                            var type = scope.type = attributes.control;\n                            var form = scope.form = scope.form || 'form';\n                            var title = scope.title = scope.title || 'untitled';\n                            var placeholder = scope.placeholder = scope.placeholder || title;\n                            var field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\n                            scope.validate = attributes.validate || attributes.control;\n                            scope.format = attributes.format || null;\n                            scope.precision = attributes.precision || null;\n                            scope.validate = attributes.validate || attributes.control;\n                            scope.minLength = attributes.min || 0;\n                            scope.maxLength = attributes.max || Number.POSITIVE_INFINITY;\n                            scope.options = $parse(attributes.options)(scope) || {};\n                            scope.focus = false;\n                            scope.visible = false;\n                            scope.getType = function() {\n                                var type = 'text';\n                                switch (attributes.control) {\n                                    case 'password':\n                                        // var form = $parse(scope.form)(scope.$parent);\n                                        // var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n                                        type = scope.visible ? 'text' : 'password';\n                                        break;\n                                    default:\n                                        type = attributes.control;\n                                }\n                                // console.log('control.getType', type);\n                                return type;\n                            };\n                            scope.getClasses = function() {\n                                var form = $parse(scope.form)(scope.$parent);\n                                var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n                                return {\n                                    'control-focus': scope.focus,\n                                    'control-success': field.$valid,\n                                    'control-error': field.$invalid && (form.$submitted || field.$touched),\n                                    'control-empty': !field.$viewValue\n                                };\n                            };\n                            scope.getMessages = function() {\n                                var form = $parse(scope.form)(scope.$parent);\n                                var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n                                return (form.$submitted || field.$touched) && field.$error;\n                            };\n                        },\n                        // post: function (scope, element, attributes) { }\n                    };\n                }\n                /*\n                compile: function(element, attributes) {\n                    element.removeAttr('my-dir'); \n                    element.attr('ng-hide', 'true');\n                    return function(scope) {\n                        $compile(element)(scope);\n                    };\n                },\n                */\n        };\n    }]);\n\n    app.directive('numberPicker', ['$parse', '$timeout', function($parse, $timeout) {\n        return {\n            restrict: 'A',\n            template: '<div class=\"input-group\">' +\n                '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">-</button></span>' +\n                '   <div ng-transclude></div>' +\n                '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">+</button></span>' +\n                '</div>',\n            replace: true,\n            transclude: true,\n            link: function(scope, element, attributes, model) {\n                var node = element[0];\n                var nodeRemove = node.querySelectorAll('.input-group-btn > .btn')[0];\n                var nodeAdd = node.querySelectorAll('.input-group-btn > .btn')[1];\n\n                function onRemove(e) {\n                    var min = $parse(attributes.min)(scope);\n                    var getter = $parse(attributes.numberPicker);\n                    var setter = getter.assign;\n                    $timeout(function() {\n                        setter(scope, Math.max(min, getter(scope) - 1));\n                    });\n                    // console.log('numberPicker.onRemove', min);\n                }\n\n                function onAdd(e) {\n                    var max = $parse(attributes.max)(scope);\n                    var getter = $parse(attributes.numberPicker);\n                    var setter = getter.assign;\n                    $timeout(function() {\n                        setter(scope, Math.min(max, getter(scope) + 1));\n                    });\n                    // console.log('numberPicker.onAdd', max);\n                }\n\n                function addListeners() {\n                    angular.element(nodeRemove).on('touchstart mousedown', onRemove);\n                    angular.element(nodeAdd).on('touchstart mousedown', onAdd);\n                }\n\n                function removeListeners() {\n                    angular.element(nodeRemove).off('touchstart mousedown', onRemove);\n                    angular.element(nodeAdd).off('touchstart mousedown', onAdd);\n                }\n                scope.$on('$destroy', function() {\n                    removeListeners();\n                });\n                addListeners();\n            }\n        };\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.directive('validate', ['$filter', function($filter) {\n        return {\n            require: 'ngModel',\n            link: function(scope, element, attributes, model) {\n                var type = attributes.validate;\n                var format = attributes.format || '';\n                var precision = attributes.precision || 2;\n                var focus = false;\n                // console.log('validate', type);\n                switch (type) {\n                    case 'date':\n                    case 'datetime':\n                    case 'datetime-local':\n                        model.$formatters.push(function(value) {\n                            if (value) {\n                                return $filter('date')(value, format);\n                            } else {\n                                return null;\n                            }\n                        });\n                        break;\n                    case 'number':\n                        model.$parsers.unshift(function(value) {\n                            var valid = false;\n                            if (value !== undefined && value !== \"\") {\n                                valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \n                                value = Number(value);\n                                model.$setValidity('number', valid);\n                                if (valid) {\n                                    model.$setValidity('positive', value >= 0.01);\n                                    if (attributes.min !== undefined) {\n                                        model.$setValidity('range', value >= Number(attributes.min));\n                                    }\n                                    if (attributes.max !== undefined) {\n                                        model.$setValidity('range', value <= Number(attributes.max));\n                                    }\n                                }\n                            } else {\n                                valid = true;\n                                value = Number(value);\n                                model.$setValidity('number', true);\n                                model.$setValidity('positive', true);\n                                if (attributes.min !== undefined) {\n                                    model.$setValidity('range', true);\n                                }\n                                if (attributes.max !== undefined) {\n                                    model.$setValidity('range', true);\n                                }\n                            }\n                            return value;\n                        });\n                        model.$formatters.push(function(value) {\n                            if (value) {\n                                return $filter('number')(value, precision) + ' ' + format;\n                            } else {\n                                return null;\n                            }\n                        });\n                        break;\n                    case 'anynumber':\n                        model.$parsers.unshift(function(value) {\n                            var valid = false;\n                            if (value !== undefined && value !== \"\") {\n                                valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \n                                value = Number(value);\n                                model.$setValidity('number', valid);\n                                if (valid) {\n                                    if (attributes.min !== undefined) {\n                                        model.$setValidity('range', value >= Number(attributes.min));\n                                    }\n                                    if (attributes.max !== undefined) {\n                                        model.$setValidity('range', value <= Number(attributes.max));\n                                    }\n                                }\n                            } else {\n                                valid = true;\n                                value = Number(value);\n                                model.$setValidity('number', true);\n                                if (attributes.min !== undefined) {\n                                    model.$setValidity('range', true);\n                                }\n                                if (attributes.max !== undefined) {\n                                    model.$setValidity('range', true);\n                                }\n                            }\n                            return value;\n                        });\n                        model.$formatters.push(function(value) {\n                            if (value || value === 0) {\n                                return $filter('number')(value, precision) + ' ' + format;\n                            } else {\n                                return null;\n                            }\n                        });\n                        break;\n                }\n\n                function onFocus() {\n                    focus = true;\n                    if (format) {\n                        element[0].value = model.$modelValue || null;\n                        if (!model.$modelValue) {\n                            model.$setViewValue(null);\n                        }\n                    }\n                }\n\n                function doBlur() {\n                    if (format && !model.$invalid) {\n                        switch (type) {\n                            case 'date':\n                            case 'datetime':\n                            case 'datetime-local':\n                                element[0].value = model.$modelValue ? $filter('date')(model.$modelValue, format) : ' ';\n                                break;\n                            default:\n                                element[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\n                                break;\n                        }\n                    }\n                }\n\n                function onBlur() {\n                    focus = false;\n                    doBlur();\n                }\n\n                function addListeners() {\n                    element.on('focus', onFocus);\n                    element.on('blur', onBlur);\n                }\n\n                function removeListeners() {\n                    element.off('focus', onFocus);\n                    element.off('blur', onBlur);\n                }\n                scope.$on('$destroy', function() {\n                    removeListeners();\n                });\n                addListeners();\n            }\n        };\n    }]);\n\n}());\n/* global angular */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.directive('modalView', ['$parse', '$templateRequest', '$compile', '$controller', 'Dom', function ($parse, $templateRequest, $compile, $controller, Dom) {\r\n\r\n\t\tfunction compileController(scope, element, html, data) {\r\n\t\t\t// console.log('modalView.compileController', element);\r\n\t\t\telement.html(html);\r\n\t\t\tvar link = $compile(element.contents());\r\n\t\t\tif (data.controller) {\r\n\t\t\t\tvar $scope = scope.$new();\r\n\t\t\t\tangular.extend($scope, data);\r\n\t\t\t\tvar controller = $controller(data.controller, {\r\n\t\t\t\t\t$scope: $scope\r\n\t\t\t\t});\r\n\t\t\t\tif (data.controllerAs) {\r\n\t\t\t\t\tscope[data.controllerAs] = controller;\r\n\t\t\t\t}\r\n\t\t\t\telement.data('$ngControllerController', controller);\r\n\t\t\t\telement.children().data('$ngControllerController', controller);\r\n\t\t\t\tscope = $scope;\r\n\t\t\t}\r\n\t\t\tlink(scope);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\trestrict: 'A',\r\n\t\t\tpriority: -400,\r\n\t\t\tlink: function (scope, element, attributes, model) {\r\n\t\t\t\tvar modal = $parse(attributes.modalView);\r\n\t\t\t\tmodal = modal(scope);\r\n\t\t\t\tmodal.templateUrl = modal.templateUrl || 'artisan/modals/modal';\r\n\t\t\t\t$templateRequest(modal.templateUrl).then(function (html) {\r\n\t\t\t\t\tcompileController(scope, element, html, modal);\r\n\t\t\t\t});\r\n\t\t\t\t/*\r\n\t\t\t\t// window.scrollTo(0, element[0].offsetTop - 100);\r\n\t\t\t\tfunction onClick(e) {\r\n\t\t\t\t    var closest = Dom.getClosestNode(e.target, element[0]);\r\n\t\t\t\t    if (closest === null) {\r\n\t\t\t\t        modal.reject(null);\r\n\t\t\t\t    }\r\n\t\t\t\t    // console.log('onClick', closest);\r\n\t\t\t\t}\r\n\t\t\t\tfunction addListeners() {\r\n\t\t\t\t    angular.element(window).on('click', onClick);\r\n\t\t\t\t}\r\n\t\t\t\tfunction removeListeners() {\r\n\t\t\t\t    angular.element(window).off('click', onClick);\r\n\t\t\t\t}\r\n\t\t\t\tscope.$on('destroy', function () {\r\n\t\t\t\t    removeListeners();\r\n\t\t\t\t});\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t    addListeners();\r\n\t\t\t\t}, 500);\r\n\t\t\t\t*/\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.provider('$modal', [function $modalProvider() {\r\n\r\n        var modals = [];\r\n        var routes = {};\r\n\r\n        this.modals = modals;\r\n        this.routes = routes;\r\n        this.when = when;\r\n\r\n        function when(path, modal) {\r\n            routes[path] = modal;\r\n            return this;\r\n        }\r\n\r\n        this.$get = ['$q', '$timeout', function modalFactory($q, $timeout) {\r\n\r\n            function popModal(modal) {\r\n                // console.log('modalProvider.popModal', modal);                \r\n                var index = -1;\r\n                angular.forEach(modals, function(m, i) {\r\n                    if (m === modal) {\r\n                        index = i;\r\n                    }\r\n                });\r\n                if (index !== -1) {\r\n                    $timeout(function() {\r\n                        modal.active = false;\r\n                        modals.splice(index, 1);\r\n                        if (modals.length) {\r\n                            modals[modals.length - 1].active = true;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n\r\n            function closeModal(modal) {\r\n                // console.log('modalProvider.closeModal', modal);                \r\n                var index = -1;\r\n                angular.forEach(modals, function(m, i) {\r\n                    if (m === modal) {\r\n                        index = i;\r\n                    }\r\n                });\r\n                if (index !== -1) {\r\n                    modal.active = false;\r\n                    $timeout(function() {\r\n                        while (modals.length) {\r\n                            modals.splice(modals.length - 1, 1);\r\n                        }\r\n                    }, 500);\r\n                }\r\n            }\r\n\r\n            function addModal(path, params) {\r\n                // console.log('modalProvider.addModal', path, params);\r\n                var deferred = $q.defer();\r\n                params = params || null;\r\n                var modal = {\r\n                    title: 'Untitled',\r\n                    controller: null,\r\n                    templateUrl: null,\r\n                    params: params,\r\n                };\r\n                var current = routes[path];\r\n                if (current) {\r\n                    angular.extend(modal, current);\r\n                }\r\n                modal.deferred = deferred;\r\n                modal.back = function(data) {\r\n                    popModal(this);\r\n                    modal.deferred.resolve(data, modal);\r\n                }\r\n                modal.resolve = function(data) {\r\n                    closeModal(this);\r\n                    modal.deferred.resolve(data, modal);\r\n                }\r\n                modal.reject = function() {\r\n                    closeModal(this);\r\n                    modal.deferred.reject(modal);\r\n                }\r\n                modals.push(modal);\r\n                angular.forEach(modals, function(m, i) {\r\n                    m.active = false;\r\n                });\r\n                if (modals.length) {\r\n                    modal.active = true;\r\n                } else {\r\n                    $timeout(function() {\r\n                        modal.active = true;\r\n                        // window.scrollTo(0, 0);\r\n                    }, 500);\r\n                }\r\n                return deferred.promise;\r\n            }\r\n\r\n            return {\r\n                modals: modals,\r\n                addModal: addModal,\r\n            };\r\n        }];\r\n\r\n    }]);\r\n\r\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('nav', ['$parse', 'Nav', function ($parse, Nav) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function (element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/nav/nav';\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\titems: '=nav',\n\t\t\t},\n\t\t\tlink: NavLink,\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction NavLink(scope, element, attributes, model) {\n\t\t\tscope.$watch('items', function (value) {\n\t\t\t\t// console.log(value instanceof Nav, value);\n\t\t\t\tif (value) {\n\t\t\t\t\tif (angular.isArray(value)) {\n\t\t\t\t\t\tvar onLink = $parse(attributes.onLink)(scope.$parent);\n\t\t\t\t\t\tvar onNav = $parse(attributes.onNav)(scope.$parent);\n\t\t\t\t\t\tvar nav = new Nav({\n\t\t\t\t\t\t\tonLink: onLink,\n\t\t\t\t\t\t\tonNav: onNav\n\t\t\t\t\t\t});\n\t\t\t\t\t\tnav.setItems(value);\n\t\t\t\t\t\tscope.item = nav;\n\n\t\t\t\t\t} else if (value instanceof Nav) {\n\t\t\t\t\t\tscope.item = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n    }]);\n\n\tapp.directive('navItem', ['$timeout', 'Events', function ($timeout, Events) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function (element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/nav/nav-item';\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\titem: '=navItem',\n\t\t\t},\n\t\t\tlink: NavItemLink,\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction NavItemLink(scope, element, attributes, model) {\n\t\t\tvar navItem = angular.element(element[0].querySelector('.nav-link'));\n\n\t\t\tvar output;\n\n\t\t\tfunction itemOpen(item, immediate) {\n\t\t\t\tvar state = item.$nav.state;\n\t\t\t\tstate.active = true;\n\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tstate.immediate = immediate;\n\t\t\t\t\tstate.closed = state.closing = false;\n\t\t\t\t\tstate.opening = true;\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\tstate.opening = false;\n\t\t\t\t\t\tstate.opened = true;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction itemClose(item, immediate) {\n\t\t\t\tvar state = item.$nav.state;\n\t\t\t\tstate.active = false;\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tstate.immediate = immediate;\n\t\t\t\t\tstate.opened = state.opening = false;\n\t\t\t\t\tstate.closing = true;\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\tstate.closing = false;\n\t\t\t\t\t\tstate.closed = true;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tif (item.items) {\n\t\t\t\t\tangular.forEach(item.items, function (o) {\n\t\t\t\t\t\titemClose(o, true);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction itemToggle(item) {\n\t\t\t\t// console.log('itemToggle', item);\n\t\t\t\tvar state = item.$nav.state;\n\t\t\t\tstate.active = item.items ? !state.active : true;\n\t\t\t\tif (state.active) {\n\t\t\t\t\tif (item.$nav.parent) {\n\t\t\t\t\t\tangular.forEach(item.$nav.parent.items, function (o) {\n\t\t\t\t\t\t\tif (o !== item) {\n\t\t\t\t\t\t\t\titemClose(o, true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\titemOpen(item);\n\t\t\t\t} else {\n\t\t\t\t\titemClose(item);\n\t\t\t\t}\n\t\t\t\t// console.log(state);\n\t\t\t}\n\n\t\t\tfunction onDown(e) {\n\t\t\t\tvar item = scope.item;\n\t\t\t\t// console.log('Item.onDown', item);\n\t\t\t\tvar state = item.$nav.state;\n\t\t\t\tif (state.active) {\n\t\t\t\t\toutput = false;\n\t\t\t\t\ttrigger();\n\t\t\t\t} else if (item.$nav.onNav) {\n\t\t\t\t\tvar promise = item.$nav.onNav(item, item.$nav);\n\t\t\t\t\tif (promise && typeof promise.then === 'function') {\n\t\t\t\t\t\tpromise.then(function (resolved) {\n\t\t\t\t\t\t\t// go on\n\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t}, function (rejected) {\n\t\t\t\t\t\t\t// do nothing\n\t\t\t\t\t\t});\n\t\t\t\t\t\toutput = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toutput = promise;\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction trigger() {\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\titemToggle(item);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// preventDefault(e);\n\t\t\t}\n\n\t\t\tfunction onClick(e) {\n\t\t\t\t// console.log('Item.onClick', e);\n\t\t\t\treturn preventDefault(e);\n\t\t\t}\n\n\t\t\tfunction preventDefault(e) {\n\t\t\t\tif (output === false) {\n\t\t\t\t\t// console.log('Item.preventDefault', e);\n\t\t\t\t\te.stop();\n\t\t\t\t\t// e.preventDefault();\n\t\t\t\t\t// e.stopPropagation();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar events = new Events(navItem).add({\n\t\t\t\tdown: onDown,\n\t\t\t\tclick: onClick,\n\t\t\t}, scope);\n\t\t}\n\n    }]);\n\n\tapp.directive('navTo', ['$parse', '$timeout', 'Events', function ($parse, $timeout, Events) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\tlink: NavToLink\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction NavToLink(scope, element, attributes) {\n\t\t\tfunction onDown(e) {\n\t\t\t\tconsole.log('navTo.onDown', attributes.navTo);\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tvar callback = $parse(attributes.navTo);\n\t\t\t\t\tcallback(scope);\n\t\t\t\t});\n\t\t\t\te.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar events = new Events(element).add({\n\t\t\t\tdown: onDown,\n\t\t\t}, scope);\n\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Nav', ['Silent', function (Silent) {\n\n\t\tfunction Nav(options) {\n\t\t\tvar nav = this;\n\t\t\tvar defaults = {\n\t\t\t\titems: [],\n\t\t\t}\n\t\t\tangular.extend(nav, defaults);\n\t\t\tif (options) {\n\t\t\t\tangular.extend(nav, options);\n\t\t\t}\n\t\t\tnav.setNav(nav, null);\n\t\t}\n\n\t\tvar statics = {\n\t\t\tsilent: NavSilent,\n\t\t\tpath: NavPath,\n\t\t};\n\n\t\tvar publics = {\n\t\t\taddItem: addItem,\n\t\t\taddItems: addItems,\n\t\t\tgetLink: getLink,\n\t\t\tsetItems: setItems,\n\t\t\tsetNav: setNav,\n\t\t\tsetNavs: setNavs,\n\t\t};\n\n\t\tangular.extend(Nav, statics);\n\t\tangular.extend(Nav.prototype, publics);\n\n\t\treturn Nav;\n\n\t\t// static methods\n\n\t\tfunction NavSilent(path) {\n\t\t\tSilent.silent(path);\n\t\t}\n\n\t\tfunction NavPath(path) {\n\t\t\tSilent.path(path);\n\t\t}\n\n\t\t// prototype methods\n\n\t\tfunction setItems(items) {\n\t\t\tvar nav = this;\n\t\t\tnav.path = Silent.path();\n\t\t\tnav.items = items;\n\t\t\tnav.setNavs(items, nav);\n\t\t}\n\n\t\tfunction setNavs(items, parent) {\n\t\t\tvar nav = this;\n\t\t\tif (items) {\n\t\t\t\tangular.forEach(items, function (item) {\n\t\t\t\t\tnav.setNav(item, parent);\n\t\t\t\t\tnav.setNavs(item.items, item);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction setNav(item, parent) {\n\t\t\tvar nav = this;\n\t\t\tvar $nav = {\n\t\t\t\tparent: parent || null,\n\t\t\t\tlevel: parent ? parent.$nav.level + 1 : 0,\n\t\t\t\tstate: {},\n\t\t\t\taddItems: function (x) {\n\t\t\t\t\tnav.addItems(x, item);\n\t\t\t\t},\n\t\t\t\tonNav: nav.onNav,\n\t\t\t};\n\t\t\titem.$nav = $nav;\n\t\t\t$nav.link = nav.getLink(item);\n\t\t\tif ($nav.link === nav.path) {\n\t\t\t\t$nav.state.active = true;\n\t\t\t\t$nav.state.opened = true;\n\t\t\t\twhile ($nav.parent) {\n\t\t\t\t\t$nav = $nav.parent.$nav;\n\t\t\t\t\t$nav.state.active = true;\n\t\t\t\t\t$nav.state.opened = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction addItems(itemOrItems, parent) {\n\t\t\tvar nav = this;\n\t\t\tif (angular.isArray(itemOrItems)) {\n\t\t\t\tangular.forEach(itemOrItems, function (item) {\n\t\t\t\t\tnav.addItem(item, parent);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tnav.addItem(itemOrItems, parent);\n\t\t\t}\n\t\t}\n\n\t\tfunction addItem(item, parent) {\n\t\t\tvar nav = this,\n\t\t\t\tonLink = nav.onLink,\n\t\t\t\tonNav = nav.onNav;\n\t\t\tnav.setNav(item, parent);\n\t\t\tif (parent) {\n\t\t\t\tparent.items = parent.items || [];\n\t\t\t\tparent.items.push(item);\n\t\t\t}\n\t\t}\n\n\t\tfunction getLink(item) {\n\t\t\tvar link = null;\n\t\t\tif (this.onLink) {\n\t\t\t\tlink = this.onLink(item, item.$nav);\n\t\t\t} else {\n\t\t\t\tlink = item.link;\n\t\t\t}\n\t\t\treturn link;\n\t\t}\n\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\twindow.ondragstart = function () {\n\t\treturn false;\n\t};\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('scrollableX', ['$parse', '$compile', '$timeout', 'Scrollable', 'Animate', 'Style', 'Events', 'Utils', function ($parse, $compile, $timeout, Scrollable, Animate, Style, Events, Utils) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplate: '<div class=\"scrollable-content\" ng-transclude></div>',\n\t\t\ttransclude: true,\n\t\t\tlink: function (scope, element, attributes, model) {\n\n\t\t\t\tvar onLeft, onRight, showIndicatorFor, scrollableWhen;\n\t\t\t\tif (attributes.onLeft) {\n\t\t\t\t\tonLeft = $parse(attributes.onLeft);\n\t\t\t\t}\n\t\t\t\tif (attributes.onRight) {\n\t\t\t\t\tonRight = $parse(attributes.onRight);\n\t\t\t\t}\n\t\t\t\tif (attributes.showIndicatorFor) {\n\t\t\t\t\tshowIndicatorFor = $parse(attributes.showIndicatorFor);\n\t\t\t\t}\n\t\t\t\tif (attributes.scrollableWhen) {\n\t\t\t\t\tscrollableWhen = $parse(attributes.scrollableWhen);\n\t\t\t\t}\n\n\t\t\t\t// ELEMENTS & STYLESHEETS;\n\t\t\t\telement.attr('unselectable', 'on').addClass('unselectable');\n\t\t\t\tvar containerNode = element[0];\n\t\t\t\tvar contentNode = containerNode.querySelector('.scrollable-content');\n\t\t\t\tvar content = angular.element(content);\n\t\t\t\tvar contentStyle = new Style();\n\n\t\t\t\tvar animate = new Animate(render);\n\n\t\t\t\tvar scrollable = attributes.scrollableX ? $parse(attributes.scrollableX)(scope) : new Scrollable();\n\n\t\t\t\tlink(scrollable);\n\n\t\t\t\tfunction link(scrollable) {\n\t\t\t\t\tscrollable.link({\n\t\t\t\t\t\tgetItems: function () {\n\t\t\t\t\t\t\tif (attributes.scrollableItem) {\n\t\t\t\t\t\t\t\tvar items = containerNode.querySelectorAll(attributes.scrollableItem);\n\t\t\t\t\t\t\t\treturn items;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprev: function () {\n\t\t\t\t\t\t\tscrollable.scrollPrev();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tnext: function () {\n\t\t\t\t\t\t\tscrollable.scrollNext();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\treset: function () {\n\t\t\t\t\t\t\tscrollable.doReset();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonLeft: onLeft,\n\t\t\t\t\t\tonRight: onRight,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/*\n\t\t\t\tscope.$watch(attributes.scrollableX, function (newValue) {\n\t\t\t\t\tconsole.log(newValue);\n\t\t\t\t});\n\t\t\t\t*/\n\n\t\t\t\t/*\n\t\t\t\tvar indicator = null,\n\t\t\t\t\tindicatorNode = null,\n\t\t\t\t\tindicatorStyle;\n\t\t\t\tshowIndicatorFor = false;\n\t\t\t\tif (showIndicatorFor) {\n\t\t\t\t\tindicator = angular.element('<div class=\"indicator\"></div>');\n\t\t\t\t\tindicatorNode = indicator[0];\n\t\t\t\t\tindicatorStyle = new Style();\n\t\t\t\t\telement.append(indicator);\n\t\t\t\t\t$compile(indicator.contents())(scope);\n\t\t\t\t\tvar i = scrollbar.getIndicator();\n\t\t\t\t\tindicatorStyle.transform('translate3d(' + i.x.toFixed(2) + 'px,' + i.y.toFixed(2) + 'px,0)');\n\t\t\t\t\tindicatorStyle.set(indicatorNode);\n\t\t\t\t}\n\t\t\t\t*/\n\n\t\t\t\tfunction render(time) {\n\t\t\t\t\tscrollable.setContainer(containerNode);\n\t\t\t\t\tscrollable.setContent(contentNode);\n\t\t\t\t\tscrollable.setEnabled(isEnabled());\n\t\t\t\t\tvar animating = scrollable.renderX();\n\t\t\t\t\tif (!animating) {\n\t\t\t\t\t\t// animate.pause();\n\t\t\t\t\t}\n\t\t\t\t\tvar current = scrollable.getCurrent();\n\t\t\t\t\tcontentStyle.transform('translate3d(' + current.x.toFixed(2) + 'px,0,0)');\n\t\t\t\t\tcontentStyle.set(contentNode);\n\t\t\t\t\t/*\n\t\t\t\t\tif (showIndicatorFor) {\n\t\t\t\t\t\tif (dragging || wheeling || speed) {\n\t\t\t\t\t\t\tvar percent = c.x / (containerNode.offsetWidth - contentNode.offsetWidth);\n\t\t\t\t\t\t\tpercent = Math.max(0, Math.min(1, percent));\n\t\t\t\t\t\t\ti.x = (containerNode.offsetWidth - indicatorNode.offsetWidth) * (percent);\n\t\t\t\t\t\t\ti.y += (0 - i.y) / 4;\n\t\t\t\t\t\t\t// var count = Math.round(contentNode.offsetWidth / 315);\n\t\t\t\t\t\t\tvar index = Math.max(1, Math.round(percent * showIndicatorFor.rows.length));\n\t\t\t\t\t\t\tindicator.html(index + '/' + showIndicatorFor.count);\n\t\t\t\t\t\t\t// indicator.html((percent * 100).toFixed(2).toString());\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ti.y += (45 - i.y) / 4;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tindicatorStyle.transform('translate3d(' + i.x.toFixed(2) + 'px,' + i.y.toFixed(2) + 'px,0)');\n\t\t\t\t\t\tindicatorStyle.set(indicatorNode);\n\t\t\t\t\t}\n\t\t\t\t\t*/\n\t\t\t\t}\n\n\t\t\t\tfunction undrag() {\n\t\t\t\t\tscrollable.off();\n\t\t\t\t\tdragOff();\n\t\t\t\t}\n\n\t\t\t\tfunction onDown(event) {\n\t\t\t\t\tif (scrollable.dragStart(event.absolute)) {\n\t\t\t\t\t\tdragOn();\n\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onMove(event) {\n\t\t\t\t\tscrollable.dragMove(event.absolute);\n\t\t\t\t\tvar drag = scrollable.getDrag();\n\t\t\t\t\tif (Math.abs(drag.y) > Math.abs(drag.x)) {\n\t\t\t\t\t\tonUp(event);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onUp(event) {\n\t\t\t\t\tscrollable.dragEnd(event.absolute);\n\t\t\t\t\tevent.stop();\n\t\t\t\t\tdragOff();\n\t\t\t\t}\n\n\t\t\t\tfunction _onScrollX(dir, interval) {\n\t\t\t\t\treturn scrollable.wheelX(dir, interval);\n\t\t\t\t}\n\n\t\t\t\tvar onScrollX = _onScrollX;\n\t\t\t\t// var onScrollX = Utils.throttle(_onScrollX, 25);\n\n\t\t\t\tfunction onWheel(event) {\n\t\t\t\t\t// console.log('onWheelX', event.dir, scrollable.wheelXCheck(event.dir));\n\t\t\t\t\tif (scrollable.wheelXCheck(event.dir)) {\n\t\t\t\t\t\tonScrollX(event.dir, event.interval);\n\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction off() {\n\t\t\t\t\tdragOff();\n\t\t\t\t\t// animate.pause();\n\t\t\t\t\tscrollable.off();\n\t\t\t\t}\n\n\t\t\t\tfunction isEnabled() {\n\t\t\t\t\tvar enabled = true;\n\t\t\t\t\tif (scrollableWhen) {\n\t\t\t\t\t\tenabled = enabled && scrollableWhen(scope);\n\t\t\t\t\t}\n\t\t\t\t\tenabled = enabled && window.innerWidth >= 1024;\n\t\t\t\t\tenabled = enabled && (containerNode.offsetWidth < contentNode.offsetWidth);\n\t\t\t\t\treturn enabled;\n\t\t\t\t}\n\n\t\t\t\tfunction onResize() {\n\t\t\t\t\tvar enabled = isEnabled();\n\t\t\t\t\tif (!enabled) {\n\t\t\t\t\t\toff();\n\t\t\t\t\t}\n\t\t\t\t\trender();\n\t\t\t\t}\n\n\t\t\t\tscope.$watch(function () {\n\t\t\t\t\treturn contentNode.offsetWidth;\n\t\t\t\t}, function (newValue, oldValue) {\n\t\t\t\t\tonResize();\n\t\t\t\t});\n\n\t\t\t\tvar events = new Events(element).add({\n\t\t\t\t\tdown: onDown,\n\t\t\t\t\twheel: onWheel,\n\t\t\t\t}, scope);\n\n\t\t\t\tvar windowEvents = new Events(window).add({\n\t\t\t\t\tresize: onResize,\n\t\t\t\t}, scope);\n\n\t\t\t\tfunction dragOn() {\n\t\t\t\t\twindowEvents.add({\n\t\t\t\t\t\tmove: onMove,\n\t\t\t\t\t\tup: onUp,\n\t\t\t\t\t}, scope);\n\t\t\t\t}\n\n\t\t\t\tfunction dragOff() {\n\t\t\t\t\twindowEvents.remove({\n\t\t\t\t\t\tmove: onMove,\n\t\t\t\t\t\tup: onUp,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tscope.$on('$destroy', function () {\n\t\t\t\t\tanimate.pause();\n\t\t\t\t});\n\n\t\t\t},\n\t\t};\n    }]);\n\n\tapp.directive('scrollableY', ['$parse', '$compile', '$timeout', 'Scrollable', 'Animate', 'Style', 'Events', 'Utils', function ($parse, $compile, $timeout, Scrollable, Animate, Style, Events, Utils) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplate: '<div class=\"scrollable-content\" ng-transclude></div>',\n\t\t\ttransclude: true,\n\t\t\tlink: function (scope, element, attributes, model) {\n\n\t\t\t\tvar onTop, onBottom, showIndicatorFor, scrollableWhen;\n\t\t\t\tif (attributes.onTop) {\n\t\t\t\t\tonTop = $parse(attributes.onTop);\n\t\t\t\t}\n\t\t\t\tif (attributes.onBottom) {\n\t\t\t\t\tonBottom = $parse(attributes.onBottom);\n\t\t\t\t}\n\t\t\t\tif (attributes.showIndicatorFor) {\n\t\t\t\t\tshowIndicatorFor = $parse(attributes.showIndicatorFor);\n\t\t\t\t}\n\t\t\t\tif (attributes.scrollableWhen) {\n\t\t\t\t\tscrollableWhen = $parse(attributes.scrollableWhen);\n\t\t\t\t}\n\n\t\t\t\t// ELEMENTS & STYLESHEETS;\n\t\t\t\telement.attr('unselectable', 'on').addClass('unselectable');\n\t\t\t\tvar containerNode = element[0];\n\t\t\t\tvar contentNode = containerNode.querySelector('.scrollable-content');\n\t\t\t\tvar content = angular.element(content);\n\t\t\t\tvar contentStyle = new Style();\n\n\t\t\t\tvar animate = new Animate(render);\n\n\t\t\t\tvar scrollable = attributes.scrollableY ? $parse(attributes.scrollableY)(scope) : new Scrollable();\n\t\t\t\tlink(scrollable);\n\n\t\t\t\tfunction link(scrollable) {\n\t\t\t\t\tscrollable.link({\n\t\t\t\t\t\tgetItems: function () {\n\t\t\t\t\t\t\tif (attributes.scrollableItem) {\n\t\t\t\t\t\t\t\tvar items = containerNode.querySelectorAll(attributes.scrollableItem);\n\t\t\t\t\t\t\t\treturn items;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprev: function () {\n\t\t\t\t\t\t\tscrollable.scrollPrev();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tnext: function () {\n\t\t\t\t\t\t\tscrollable.scrollNext();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\treset: function () {\n\t\t\t\t\t\t\tscrollable.doReset();\n\t\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonTop: onTop,\n\t\t\t\t\t\tonBottom: onBottom,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction render(time) {\n\t\t\t\t\tscrollable.setContainer(containerNode);\n\t\t\t\t\tscrollable.setContent(contentNode);\n\t\t\t\t\tscrollable.setEnabled(isEnabled());\n\t\t\t\t\tvar animating = scrollable.renderY();\n\t\t\t\t\tif (!animating) {\n\t\t\t\t\t\t// animate.pause();\n\t\t\t\t\t}\n\t\t\t\t\tvar current = scrollable.getCurrent();\n\t\t\t\t\tcontentStyle.transform('translate3d(0,' + current.y.toFixed(2) + 'px,0)');\n\t\t\t\t\tcontentStyle.set(contentNode);\n\t\t\t\t}\n\n\t\t\t\tfunction undrag() {\n\t\t\t\t\tscrollable.off();\n\t\t\t\t\tdragOff();\n\t\t\t\t}\n\n\t\t\t\tfunction onDown(event) {\n\t\t\t\t\tif (scrollable.dragStart(event.absolute)) {\n\t\t\t\t\t\tdragOn();\n\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onMove(event) {\n\t\t\t\t\tscrollable.dragMove(event.absolute);\n\t\t\t\t\tvar drag = scrollable.getDrag();\n\t\t\t\t\tif (Math.abs(drag.x) > Math.abs(drag.y)) {\n\t\t\t\t\t\tonUp(event);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onUp(event) {\n\t\t\t\t\tscrollable.dragEnd(event.absolute);\n\t\t\t\t\tevent.stop();\n\t\t\t\t\tdragOff();\n\t\t\t\t}\n\n\t\t\t\tfunction _onScrollY(dir, interval) {\n\t\t\t\t\treturn scrollable.wheelY(dir, interval);\n\t\t\t\t}\n\n\t\t\t\tvar onScrollY = _onScrollY;\n\t\t\t\t// var onScrollY = Utils.throttle(_onScrollY, 25);\n\n\t\t\t\tfunction onWheel(event) {\n\t\t\t\t\t// console.log('onWheelY', event.dir, scrollable.wheelYCheck(event.dir));\n\t\t\t\t\tif (scrollable.wheelYCheck(event.dir)) {\n\t\t\t\t\t\tonScrollY(event.dir, event.interval);\n\t\t\t\t\t\tanimate.play();\n\t\t\t\t\t\tevent.stop();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction off() {\n\t\t\t\t\tdragOff();\n\t\t\t\t\t// animate.pause();\n\t\t\t\t\tscrollable.off();\n\t\t\t\t}\n\n\t\t\t\tfunction isEnabled() {\n\t\t\t\t\tvar enabled = true;\n\t\t\t\t\tif (scrollableWhen) {\n\t\t\t\t\t\tenabled = enabled && scrollableWhen(scope);\n\t\t\t\t\t}\n\t\t\t\t\tenabled = enabled && window.innerWidth >= 1024;\n\t\t\t\t\tenabled = enabled && (containerNode.offsetHeight < contentNode.offsetHeight);\n\t\t\t\t\treturn enabled;\n\t\t\t\t}\n\n\t\t\t\tfunction onResize() {\n\t\t\t\t\tvar enabled = isEnabled();\n\t\t\t\t\tif (!enabled) {\n\t\t\t\t\t\toff();\n\t\t\t\t\t}\n\t\t\t\t\trender();\n\t\t\t\t}\n\n\t\t\t\tscope.$watch(function () {\n\t\t\t\t\treturn contentNode.offsetHeight;\n\t\t\t\t}, function (newValue, oldValue) {\n\t\t\t\t\tonResize();\n\t\t\t\t});\n\n\t\t\t\tvar events = new Events(element).add({\n\t\t\t\t\tdown: onDown,\n\t\t\t\t\twheel: onWheel,\n\t\t\t\t}, scope);\n\n\t\t\t\tvar windowEvents = new Events(window).add({\n\t\t\t\t\tresize: onResize,\n\t\t\t\t}, scope);\n\n\t\t\t\tfunction dragOn() {\n\t\t\t\t\twindowEvents.add({\n\t\t\t\t\t\tmove: onMove,\n\t\t\t\t\t\tup: onUp,\n\t\t\t\t\t}, scope);\n\t\t\t\t}\n\n\t\t\t\tfunction dragOff() {\n\t\t\t\t\twindowEvents.remove({\n\t\t\t\t\t\tmove: onMove,\n\t\t\t\t\t\tup: onUp,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tscope.$on('$destroy', function () {\n\t\t\t\t\tanimate.pause();\n\t\t\t\t});\n\n\t\t\t},\n\t\t};\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('Scrollable', ['Utils', 'Point', 'Rect', function(Utils, Point, Rect) {\n\n        function Scrollable() {\n\n            var padding = 150;\n            var enabled, snappable, busy, dragging, wheeling, down, move, prev;\n            var currentIndex = 0;\n\n            snappable = true;\n\n            var start = new Point(),\n                end = new Point(),\n                current = new Point(),\n                drag = new Point(),\n                indicator = new Point(),\n                offset = new Point(),\n                speed = new Point(),\n                container = new Rect(),\n                content = new Rect(),\n                overflow = new Rect();\n\n            var scrollable = {\n                // properties\n                start: start,\n                end: end,\n                current: current,\n                indicator: indicator,\n                speed: speed,\n                overflow: overflow,\n                container: container,\n                content: content,\n                // methods\n                setContainer: setContainer,\n                setContent: setContent,\n                setEnabled: setEnabled,\n                getCurrent: getCurrent,\n                getDrag: getDrag,\n                getIndicator: getIndicator,\n                getIndex: getIndex,\n                scrollToIndex: scrollToIndex,\n                scrollPrev: scrollPrev,\n                scrollNext: scrollNext,\n                dragStart: dragStart,\n                dragMove: dragMove,\n                dragEnd: dragEnd,\n                doReset: doReset,\n                off: off,\n                // x direction\n                doLeft: doLeft,\n                doRight: doRight,\n                renderX: renderX,\n                scrollToX: scrollToX,\n                wheelX: wheelX,\n                wheelXCheck: wheelXCheck,\n                // y direction\n                doTop: doTop,\n                doBottom: doBottom,\n                renderY: renderY,\n                scrollToY: scrollToY,\n                wheelY: wheelY,\n                wheelYCheck: wheelYCheck,\n            };\n\n            angular.extend(this, scrollable);\n\n            scrollable = this;\n\n            function setContainer(node) {\n                container.width = node.offsetWidth;\n                container.height = node.offsetHeight;\n            }\n\n            function setContent(node) {\n                content.width = node.offsetWidth;\n                content.height = node.offsetHeight;\n            }\n\n            function setEnabled(flag) {\n                enabled = flag;\n            }\n\n            function getCurrent() {\n                return current;\n            }\n\n            function getDrag() {\n                return drag;\n            }\n\n            function getIndicator() {\n                return indicator;\n            }\n\n            function getIndex() {\n                return currentIndex;\n            }\n\n            function scrollToIndex(index) {\n                if (index !== currentIndex) {\n                    currentIndex = index;\n                    var item = getItemAtIndex(index);\n                    if (item) {\n                        offset = new Point(\n                            item.offsetLeft,\n                            item.offsetTop\n                        );\n                        // console.log('scrollToIndex', index, offset);\n                    }\n                    return true;\n                }\n            }\n\n            function dragStart(point) {\n                if (!busy) {\n                    start.x = end.x = current.x;\n                    start.y = end.y = current.y;\n                    speed.x = 0;\n                    speed.y = 0;\n                    down = point;\n                    currentIndex = -1;\n                    wheeling = false;\n                    return true;\n                } else {\n                    return false;\n                }\n            }\n\n            function dragMove(point) {\n                prev = move;\n                move = point;\n                drag.x = move.x - down.x;\n                drag.y = move.y - down.y;\n                dragging = true;\n            }\n\n            function dragEnd() {\n                if (move && prev) {\n                    speed.x += (move.x - prev.x) * 4;\n                    speed.y += (move.y - prev.y) * 4;\n                }\n                start.x = end.x = current.x;\n                start.y = end.y = current.y;\n                dragging = false;\n                move = null;\n                down = null;\n                prev = null;\n            }\n\n            function getItemAtIndex(index) {\n                var item = null;\n                var items = scrollable.getItems();\n                if (items) {\n                    if (index >= 0 && index < items.length) {\n                        item = items[index];\n                    }\n                }\n                // console.log('getItemAtIndex', index, items.length, item);\n                return item;\n            }\n\n            function scrollPrev() {\n                var index = Math.max(0, currentIndex - 1);\n                console.log('scrollPrev', index);\n                scrollToIndex(index);\n            }\n\n            function scrollNext() {\n                var items = scrollable.getItems();\n                var index = Math.min(items.length - 1, currentIndex + 1);\n                console.log('scrollNext', index);\n                scrollToIndex(index);\n            }\n\n            function doReset() {\n                end.x = current.x = 0;\n            }\n\n            function off() {\n                dragging = false;\n                wheeling = false;\n                move = null;\n                down = null;\n            }\n\n            // x - direction\n\n            function doLeft(scope) {\n                if (busy) {\n                    return;\n                }\n                if (!scrollable.onLeft) {\n                    return;\n                }\n                busy = true;\n                scrollable.onLeft(scope).then().finally(function() {\n                    scrollToX(0);\n                });\n            }\n\n            function doRight(scope) {\n                if (busy) {\n                    return;\n                }\n                if (!scrollable.onRight) {\n                    return;\n                }\n                busy = true;\n                scrollable.onRight(scope).then().finally(function() {\n                    var right = container.width - content.width;\n                    if (right > overflow.width) {\n                        start.x = end.x = overflow.width;\n                    } else {\n                        start.x = end.x = overflow.width + padding;\n                    }\n                    scrollToX(0);\n                });\n            }\n\n            function renderX() {\n                var animating = true;\n                if (enabled) {\n                    overflow.x = 0;\n                    overflow.width = container.width - content.width;\n                    if (dragging) {\n                        end.x = start.x + move.x - down.x;\n                        if (extendX()) {\n                            start.x = end.x;\n                            down.x = move.x;\n                        }\n                    } else if (speed.x) {\n                        end.x += speed.x;\n                        speed.x *= 0.75;\n                        if (wheeling) {\n                            extendX();\n                        }\n                        if (Math.abs(speed.x) < 2.05) {\n                            speed.x = 0;\n                            scrollable.wheeling = wheeling = false;\n                            snapToNearestX();\n                        }\n                    } else if (offset) {\n                        end.x = -offset.x;\n                        offset = null;\n                    }\n                    end.x = Math.round(end.x * 10000) / 10000;\n                    end.x = Math.min(overflow.x, end.x);\n                    end.x = Math.max(overflow.width, end.x);\n                    current.x += (end.x - current.x) / 4;\n                    if (speed.x === 0 && Math.abs(end.x - current.x) < 0.05) {\n                        current.x = end.x;\n                        if (!snapToNearestX()) {\n                            animating = false;\n                        }\n                    }\n                    // console.log('renderX', current.x, end.x, overflow.x);\n                } else {\n                    current.x = end.x = 0;\n                    animating = false;\n                }\n                return animating;\n            }\n\n            function extendX() {\n                var extending = false;\n                overflow.x += padding;\n                overflow.width -= padding;\n                if (end.x > overflow.x) {\n                    extending = true;\n                    doLeft();\n                } else if (end.x < overflow.width) {\n                    extending = true;\n                    doRight();\n                }\n                return extending;\n            }\n\n            function snapToNearestX() {\n                var items = scrollable.getItems();\n                if (items) {\n                    var index = -1;\n                    var min = Number.POSITIVE_INFINITY;\n                    angular.forEach(items, function(item, i) {\n                        var distance = Math.abs((end.x + speed.x) - (item.offsetLeft * -1));\n                        if (distance < min) {\n                            min = distance;\n                            index = i;\n                        }\n                    });\n                    if (index !== -1) {\n                        if (snappable) {\n                            return scrollToIndex(index);\n                        } else {\n                            currentIndex = index;\n                        }\n                    }\n                }\n            }\n\n            function wheelXCheck(dir) {\n                // console.log('wheelYCheck', dir < 0 ? (end.x - overflow.width) : (end.x - overflow.x));\n                if (!busy && enabled) {\n                    if (dir < 0) {\n                        return end.x - overflow.width;\n                    } else {\n                        return end.x - overflow.x;\n                    }\n                } else {\n                    return false;\n                }\n            }\n\n            function wheelX(dir, interval) {\n                end.x += dir * 100 / 1000 * interval;\n                speed.x += dir * 100 / 1000 * interval;\n                wheeling = true;\n            }\n\n            function scrollToX(value) {\n                start.x = end.x = value;\n                setTimeout(function() {\n                    off();\n                    busy = false;\n                }, 500);\n            }\n\n            // y - direction\n\n            function doTop(scope) {\n                if (busy) {\n                    return;\n                }\n                if (!scrollable.onTop) {\n                    return;\n                }\n                busy = true;\n                scrollable.onTop(scope).then().finally(function() {\n                    scrollToY(0);\n                });\n            }\n\n            function doBottom(scope) {\n                if (busy) {\n                    return;\n                }\n                if (!scrollable.onBottom) {\n                    return;\n                }\n                busy = true;\n                scrollable.onBottom(scope).then().finally(function() {\n                    var bottom = container.height - content.height;\n                    if (bottom > overflow.height) {\n                        start.y = end.y = overflow.height;\n                    } else {\n                        start.y = end.y = overflow.height + padding;\n                    }\n                    scrollToY(0);\n                });\n            }\n\n            function renderY() {\n                var animating = true;\n                if (enabled) {\n                    overflow.y = 0;\n                    overflow.height = container.height - content.height;\n                    if (dragging) {\n                        end.y = start.y + move.y - down.y;\n                        if (extendY()) {\n                            start.y = end.y;\n                            down.y = move.y;\n                        }\n                    } else if (speed.y) {\n                        end.y += speed.y;\n                        speed.y *= 0.75;\n                        if (wheeling) {\n                            extendY();\n                        }\n                        if (Math.abs(speed.y) < 2.05) {\n                            speed.y = 0;\n                            scrollable.wheeling = wheeling = false;\n                            snapToNearestY();\n                        }\n                    } else if (offset) {\n                        end.y = -offset.y;\n                        offset = null;\n                    }\n                    end.y = Math.round(end.y * 10000) / 10000;\n                    end.y = Math.min(overflow.y, end.y);\n                    end.y = Math.max(overflow.height, end.y);\n                    current.y += (end.y - current.y) / 4;\n                    if (speed.y === 0 && Math.abs(end.y - current.y) < 0.05) {\n                        current.y = end.y;\n                        if (!snapToNearestY()) {\n                            animating = false;\n                        }\n                    }\n                    // console.log(parseFloat(current.y.toFixed(6)), end.y, overflow.y);\n                    // console.log(dragging, wheeling, end.y, speed.y, Math.abs(end.y - current.y));\n                } else {\n                    current.y = end.y = 0;\n                    animating = false;\n                }\n                return animating;\n            }\n\n            function extendY() {\n                var extending = false;\n                overflow.y += padding;\n                overflow.height -= padding;\n                if (end.y > overflow.y) {\n                    extending = true;\n                    doTop();\n                } else if (end.y < overflow.height) {\n                    extending = true;\n                    doBottom();\n                }\n                return extending;\n            }\n\n            function snapToNearestY() {\n                var items = scrollable.getItems();\n                if (items) {\n                    var index = -1;\n                    var min = Number.POSITIVE_INFINITY;\n                    angular.forEach(items, function(item, i) {\n                        var distance = Math.abs((end.y + speed.y) - (item.offsetTop * -1));\n                        if (distance < min) {\n                            min = distance;\n                            index = i;\n                        }\n                    });\n                    // console.log('snapToNearestY', index, min);\n                    if (index !== -1) {\n                        if (snappable) {\n                            return scrollToIndex(index);\n                        } else {\n                            currentIndex = index;\n                        }\n                    }\n                }\n            }\n\n            function wheelYCheck(dir) {\n                // console.log('wheelYCheck', dir < 0 ? (end.y - overflow.height) : (end.y - overflow.y));\n                if (!busy && enabled) {\n                    if (dir < 0) {\n                        return end.y - overflow.height;\n                    } else {\n                        return end.y - overflow.y;\n                    }\n                } else {\n                    return false;\n                }\n            }\n\n            function wheelY(dir, interval) {\n                end.y += dir * 100 / 1000 * interval;\n                speed.y += dir * 100 / 1000 * interval;\n                wheeling = true;\n            }\n\n            function scrollToY(value) {\n                start.y = end.y = value;\n                setTimeout(function() {\n                    off();\n                    busy = false;\n                }, 500);\n            }\n\n        }\n\n        function link(methods) {\n            angular.extend(this, methods);\n        }\n\n        Scrollable.prototype = {\n            link: link,\n            getItems: function() {\n                return [content];\n            },\n        };\n        return Scrollable;\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('videoSource', ['$timeout', '$promise', function ($timeout, $promise) {\n\n\t\tvar directive = {\n\t\t\trestrict: 'A',\n\t\t\tscope: {\n\t\t\t\tsource: '=videoSource',\n\t\t\t\timage: '=videoImage',\n\t\t\t},\n\t\t\ttemplateUrl: function (element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/video/video-player';\n\t\t\t},\n\t\t\tlink: VideoSourceLink\n\t\t};\n\n\t\treturn directive;\n\n\t\tfunction VideoSourceLink(scope, element, attributes) {\n\n\t\t\tvar native = element[0];\n\t\t\tvar video = native.querySelector('video');\n\t\t\tvar img = native.querySelector('img');\n\t\t\tvar infos = {};\n\t\t\tscope.canplay = false;\n\t\t\tscope.playing = false;\n\t\t\tscope.busy = false;\n\t\t\tscope.toggle = toggle;\n\t\t\tscope.play = play;\n\t\t\tscope.pause = pause;\n\t\t\tscope.infos = infos;\n\n\t\t\t// loop><source src=\"{{source}}\" type=\"video/mp4\"\n\n\t\t\tfunction canplay() {\n\t\t\t\treturn $promise(function (promise) {\n\n\t\t\t\t\tfunction _onCanPlay(e) {\n\t\t\t\t\t\tscope.canplay = true;\n\t\t\t\t\t\tangular.element(video).off('canplay', _onCanPlay);\n\t\t\t\t\t\t// console.log('videoSource._onCanPlay', e);\n\t\t\t\t\t\tpromise.resolve();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (scope.canplay) {\n\t\t\t\t\t\tpromise.resolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tangular.element(video).on('canplay', _onCanPlay);\n\t\t\t\t\t\tvideo.preload = true;\n\t\t\t\t\t\tvideo.src = scope.source;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction toggle() {\n\t\t\t\tif (!scope.busy) {\n\t\t\t\t\tscope.busy = true;\n\t\t\t\t\tif (scope.playing) {\n\t\t\t\t\t\tvideo.pause();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcanplay().then(function () {\n\t\t\t\t\t\t\tvideo.play();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction play() {\n\t\t\t\tif (!scope.busy) {\n\t\t\t\t\tscope.busy = true;\n\t\t\t\t\tcanplay().then(function () {\n\t\t\t\t\t\tvideo.play();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction pause() {\n\t\t\t\tif (!scope.busy) {\n\t\t\t\t\tscope.busy = true;\n\t\t\t\t\tvideo.pause();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onCanPlay(e) {\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tscope.canplay = true;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onPlaying(e) {\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tscope.playing = true;\n\t\t\t\t\tscope.busy = false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onPause(e) {\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tscope.playing = false;\n\t\t\t\t\tscope.busy = false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onEnded(e) {\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tscope.playing = false;\n\t\t\t\t\tscope.busy = false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onProgress(e) {\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tinfos.buffered = video.buffered; // todo: TimeRanges\n\t\t\t\t\t// console.log('onProgress', infos);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction onTimeUpdate(e) {\n\t\t\t\t$timeout(function () {\n\t\t\t\t\tinfos.duration = video.duration;\n\t\t\t\t\tinfos.currentTime = video.currentTime;\n\t\t\t\t\tinfos.progressTime = infos.currentTime / infos.duration;\n\t\t\t\t\t// console.log('onTimeUpdate', infos);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar videoElement = angular.element(video);\n\n\t\t\tfunction addListeners() {\n\t\t\t\t// videoElement.on('canplay', onCanPlay);\n\t\t\t\tvideoElement.on('playing', onPlaying);\n\t\t\t\tvideoElement.on('pause', onPause);\n\t\t\t\tvideoElement.on('ended', onEnded);\n\t\t\t\tvideoElement.on('progress', onProgress);\n\t\t\t\tvideoElement.on('timeupdate', onTimeUpdate);\n\t\t\t}\n\n\t\t\tfunction removeListeners() {\n\t\t\t\t// videoElement.off('canplay', onCanPlay);\n\t\t\t\tvideoElement.off('playing', onPlaying);\n\t\t\t\tvideoElement.off('pause', onPause);\n\t\t\t\tvideoElement.off('ended', onEnded);\n\t\t\t\tvideoElement.off('progress', onProgress);\n\t\t\t\tvideoElement.off('timeupdate', onTimeUpdate);\n\t\t\t}\n\n\t\t\taddListeners();\n\t\t\tscope.$on('destroy', function () {\n\t\t\t\tremoveListeners();\n\t\t\t});\n\n\t\t}\n\n    }]);\n\n\t/*\n\tObject.defineProperty(HTMLMediaElement.prototype, 'playing', {\n\t    get: function () {\n\t        return !!(this.currentTime > 0 && !this.paused && !this.ended && this.readyState > 2);\n\t    }\n\t});\n\t*/\n\n}());\n/* global angular */\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\t// micro interactions\n\n\tfunction tap(Events) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\tpriority: 0,\n\t\t\tlink: link\n\t\t};\n\n\t\tfunction link(scope, element, attributes, model) {\n\t\t\tif (attributes.ngBind) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t/*\n\t\t\tif (attributes.href === '#' && !attributes.ngHref && !attributes.ngClick) {\n\t\t\t\treturn;\n            }\n            */\n\n\t\t\telement.addClass('interaction-tap');\n\t\t\tvar node = document.createElement('interaction');\n\t\t\telement[0].appendChild(node);\n\n\t\t\tfunction onDown(e) {\n\t\t\t\telement.removeClass('interaction-animate');\n\t\t\t\tvoid element.offsetWidth;\n\t\t\t\t// node.style.animationPlayState = \"paused\";\n\t\t\t\tnode.style.left = e.relative.x + 'px';\n\t\t\t\tnode.style.top = e.relative.y + 'px';\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\telement.addClass('interaction-animate');\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\telement.removeClass('interaction-animate');\n\t\t\t\t\t}, 1000);\n\t\t\t\t}, 10);\n\n\t\t\t\t// console.log('tap.onDown', node, node.parentElement);\n\t\t\t}\n\t\t\tvar listeners = { // down, move, up, click\n\t\t\t\tdown: onDown,\n\t\t\t};\n\t\t\tvar events = new Events(element).add(listeners, scope); // passing scope to add remove listeners automatically on $destroy\n\t\t}\n\t}\n\tapp.directive('ngHref', ['Events', tap]);\n\tapp.directive('ngClick', ['Events', tap]);\n\n}());"]}