{"version":3,"sources":["docs/js/artisan.js"],"names":["angular","module","filter","$filter","array","filters","element","item","i","length","factory","Hash","key","pool","get","Object","defineProperties","this","value","enumerable","writable","has","id","undefined","getId","hash","set","push","add","newItem","p","keys","remove","oldItem","index","indexOf","splice","addMany","items","removeMany","removeAll","shift","each","callback","forward","reverse","sort","c","d","a","b","backward","differs","t","updatePool","forEach","pools","prototype","Array","$q","$promise","deferred","defer","promise","statics","all","promises","extend","app","Vector","x","y","make","size","Math","sqrt","normalize","l","incidence","atan2","distance","cross","difference","power","abs","towards","friction","copy","toString","$compile","$controller","Utils","getTouch","e","previous","type","touch","event","originalEvent","touches","changedTouches","pageX","pageY","s","getRelativeTouch","node","point","rect","getBoundingClientRect","left","top","getClosest","el","selector","matchesFn","parent","some","fn","document","body","parentElement","getClosestElement","target","throttle","func","wait","options","context","args","result","timeout","later","leading","getNow","apply","now","remaining","arguments","clearTimeout","trailing","setTimeout","where","query","found","compileController","scope","html","data","link","contents","controller","$scope","$new","controllerAs","children","reverseSortOn","format","string","prepend","expression","splitted","split","formatted","join","reducer","o","reducerSetter","slice","reducerAdder","downloadFile","content","name","download","createEvent","anchor","createElement","href","base64","downloadName","substring","lastIndexOf","initEvent","dispatchEvent","window","open","blob","Blob","reader","FileReader","readAsDataURL","onloadend","serverDownload","defaults","uri","extension","JSON","stringify","form","input","appendChild","action","method","enctype","submit","removeChild","lastTime","vendors","requestAnimationFrame","cancelAnimationFrame","currTime","Date","getTime","timeToCall","max","reduce","defineProperty","TypeError","len","k","ua","navigator","userAgent","toLowerCase","safari","msie","chrome","mobile","toMd5","Md5","encode","getElementsByTagName","addClass","Api","Doc","$location","$routeParams","environment","View","doc","url","path","params","view","route","current","console","log","docs","then","response","resolve","error","reject","service","$http","$timeout","$httpPromise","api","status","$get","$post","$put","$patch","$delete","$fake","post","put","patch","delete","fake","redirect","msecs","doRedirect","$$lastRequestedPath","doRetry","$rootScope","$silent","unlink","listeners","$$listeners","$locationChangeSuccess","relink","listener","$path","silent","replace","location","unshift","$window","Cookie","TIMEOUT","_set","days","expires","date","setTime","toGMTString","cookie","exists","cookieName","ca","charAt","model","parse","decodeURIComponent","atob","cache","json","btoa","encodeURIComponent","on","checkCookie","elapsed","interval","LocalStorage","isSupported","supported","localStorage","setItem","removeItem","storageEvent","newValue","SessionStorage","sessionStorage","Rect","w","h","mult","offset","reduceRect","offsetRect","expandRect","expand","intersect","right","bottom","center","topLeft","topRight","bottomRight","bottomLeft","setX","setY","setW","setH","setPos","setSize","clone","Color","r","g","uint","parseInt","componentToHex","hex","luma","color","dot","contrast","darker","pow","min","floor","lighter","toUint","toHex","toRgba","toFixed","alpha","makeSet","foreground","border","light","Shape","shapeCircle","cx","cy","sa","ea","PI","ctx","arc","shapeStar","or","ir","steps","angle","step","moveTo","cos","sin","lineTo","shapeRoundRect","tl","tr","br","bl","defaultRadius","quadraticCurveTo","circle","call","beginPath","closePath","star","roundRect","constant","black","white","blue","red","lightBlue","lightYellow","greyLighter","greyLight","greyMedium","grey","map","Painter","Palette","painter","buffer","rows","getRect","row","canvas","width","height","setCanvas","drawImage","palette","isString","img","Image","onload","addShape","onerror","src","save","clip","translate","restore","draw","pre","drawRect","tint","setFill","fillRect","globalCompositeOperation","pattern","drawPattern","fillStyle","createPattern","toDataURL","PainterColors","drawingRect","setColors","colors","offsetWidth","offsetHeight","getContext","lineCap","clear","resize","setText","font","align","verticalAlign","textAlign","textBaseline","setStroke","strokeStyle","lineWidth","fillText","text","maxLength","substr","trim","strokeRect","fill","stroke","begin","close","rotate","xy","image","flip","scale","directive","restrict","templateUrl","transclude","message","attributes","$parse","formatLabel","uniqueId","template","control","ngModel","required","title","placeholder","source","label","require","optionLabel","getOptions","number","field","precision","validate","minLength","Number","POSITIVE_INFINITY","focus","visible","onChange","$parent","onFilter","getType","getClasses","control-focus","control-success","$valid","control-error","$invalid","$submitted","$touched","control-empty","$viewValue","getMessages","$error","toggleVisibility","$templateCache","compile","onRemove","getter","numberPicker","setter","assign","onAdd","removeListeners","nodeRemove","off","nodeAdd","querySelectorAll","$on","onFocus","$modelValue","$setViewValue","doBlur","onBlur","$formatters","$parsers","valid","String","$setValidity","$templateRequest","priority","modal","modalView","provider","when","routes","modals","popModal","m","active","closeModal","addModal","back","Nav","$watch","isArray","onLink","onNav","nav","setItems","itemOpen","immediate","state","$nav","closed","closing","opening","opened","itemClose","itemToggle","onTap","trigger","output","resolved","rejected","onTouchStart","navItem","onMouseDown","onClick","prevent","preventDefault","querySelector","setNav","setNavs","level","addItems","getLink","itemOrItems","addItem","Event","documentNode","documentElement","parentNode","scroll","pageXOffset","scrollLeft","pageYOffset","scrollTop","getWidth","getHeight","getNode","offsetLeft","offsetTop","page","getPage","relative","absolute","self","innerWidth","clientWidth","innerHeight","clientHeight","standardEvents","touchEvents","Events","events","click","down","removeTouchEvents","onMouseMove","move","onMouseUp","up","onResize","removeStandardEvents","onTouchMove","onTouchEnd","getElement","standard","windowElement","tap","onDown","removeClass","style","ngBind","ngHref","ngClick","State","errors","isReady","idle","isBusy","isError","isErroring","isSuccess","isSuccessing","button","busy","ready","success","enabled","errorMessage","submitClass","successing","errorring","labels","addons","classes"],"mappings":"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","file":"artisan.min.js","sourcesContent":["/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan', ['ng', 'ngRoute', 'ngMessages']);\r\n\r\n}());\n/* global angular, app, Autolinker */\r\n(function () {\r\n\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.filter('notIn', ['$filter', function ($filter) {\r\n\t\treturn function (array, filters, element) {\r\n\t\t\tif (filters) {\r\n\t\t\t\treturn $filter(\"filter\")(array, function (item) {\r\n\t\t\t\t\tfor (var i = 0; i < filters.length; i++) {\r\n\t\t\t\t\t\tif (filters[i][element] === item[element]) return false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('Hash', [function() {\n        var pools = {};\n\n        function Hash(key, pool) {\n            key = key || 'id';\n            pool = pool ? Hash.get(pool) : {};\n            Object.defineProperties(this, {\n                key: {\n                    value: key,\n                    enumerable: false,\n                    writable: false\n                },\n                pool: {\n                    value: pool,\n                    enumerable: false,\n                    writable: false\n                },\n                length: {\n                    value: 0,\n                    enumerable: false,\n                    writable: true\n                }\n            });\n        }\n        Hash.get = function(pool) {\n            return (pools[pool] = pools[pool] || {});\n        };\n        Hash.prototype = new Array;\n        Hash.prototype.has = has;\n        Hash.prototype.getId = getId;\n        Hash.prototype.get = get;\n        Hash.prototype.set = set;\n        Hash.prototype.add = add;\n        Hash.prototype.remove = remove;\n        Hash.prototype.each = each;\n        Hash.prototype.addMany = addMany;\n        Hash.prototype.removeMany = removeMany;\n        Hash.prototype.removeAll = removeAll;\n        Hash.prototype.forward = forward;\n        Hash.prototype.backward = backward;\n        Hash.prototype.differs = differs;\n        Hash.prototype.updatePool = updatePool;\n        return Hash;\n\n        function has(id) {\n            return this.pool[id] !== undefined;\n        }\n\n        function getId(id) {\n            return this.pool[id];\n        }\n\n        function get(item) {\n            var hash = this,\n                key = this.key;\n            return item ? hash.getId(item[key]) : null;\n        }\n\n        function set(item) {\n            var hash = this,\n                pool = this.pool,\n                key = this.key;\n            pool[item[key]] = item;\n            hash.push(item);\n            return item;\n        }\n\n        function add(newItem) {\n            var hash = this;\n            var item = hash.get(newItem);\n            if (item) {\n                for (var i = 0, keys = Object.keys(newItem), p; i < keys.length; i++) {\n                    p = keys[i];\n                    item[p] = newItem[p];\n                }\n            } else {\n                item = hash.set(newItem);\n            }\n            return item;\n        }\n\n        function remove(oldItem) {\n            var hash = this,\n                pool = this.pool,\n                key = this.key;\n            var item = hash.get(oldItem);\n            if (item) {\n                var index = hash.indexOf(item);\n                if (index !== -1) {\n                    hash.splice(index, 1);\n                }\n                delete pool[item[key]];\n            }\n            return hash;\n        }\n\n        function addMany(items) {\n            var hash = this;\n            if (!items) {\n                return hash;\n            }\n            var i = 0;\n            while (i < items.length) {\n                hash.add(items[i]);\n                i++;\n            }\n            return hash;\n        }\n\n        function removeMany(items) {\n            var hash = this;\n            if (!items) {\n                return hash;\n            }\n            var i = 0;\n            while (i < items.length) {\n                hash.remove(items[i]);\n                i++;\n            }\n            return hash;\n        }\n\n        function removeAll() {\n            var hash = this,\n                key = hash.key,\n                pool = hash.pool;\n            var i = 0,\n                t = hash.length,\n                item;\n            while (hash.length) {\n                item = hash.shift();\n                delete pool[item[key]];\n                i++;\n            }\n            return hash;\n        }\n\n        function each(callback) {\n            var hash = this;\n            if (callback) {\n                var i = 0;\n                while (i < hash.length) {\n                    callback(hash[i], i);\n                    i++;\n                }\n            }\n            return hash;\n        }\n\n        function forward(key, reverse) {\n            var hash = this;\n            key = (key || this.key);\n            hash.sort(function(c, d) {\n                var a = reverse ? d : c;\n                var b = reverse ? c : d;\n                return a[key] - b[key];\n            });\n            return hash;\n        }\n\n        function backward(key) {\n            return this.forward(key, true);\n        }\n\n        function differs(hash) {\n            if (hash.key !== this.key || hash.length !== this.length) {\n                return true;\n            } else {\n                var differs = false,\n                    i = 0,\n                    t = this.length,\n                    key = this.key;\n                while (differs && i < t) {\n                    differs = this[i][key] !== hash[i][key];\n                    i++;\n                }\n            }\n        }\n\n        function updatePool() {\n            var hash = this,\n                pool = this.pool,\n                key = this.key;\n            Object.keys(pool).forEach(function(key) {\n                delete pool[key];\n            });\n            angular.forEach(hash, function(item) {\n                pool[item[key]] = item;\n            });\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('$promise', ['$q', function($q) {\n        function $promise(callback) {\n            if (typeof callback !== 'function') {\n                throw ('promise resolve callback missing');\n            }\n            var deferred = $q.defer();\n            callback(deferred);\n            return deferred.promise;\n        }\n        var statics = {\n            all: function(promises) {\n                return $q.all(promises);\n            },\n        };\n        angular.extend($promise, statics);\n        return $promise;\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('Vector', function() {\n        function Vector(x, y) {\n            this.x = x || 0;\n            this.y = y || 0;\n        }\n        Vector.make = function(a, b) {\n            return new Vector(b.x - a.x, b.y - a.y);\n        };\n        Vector.size = function(a) {\n            return Math.sqrt(a.x * a.x + a.y * a.y);\n        };\n        Vector.normalize = function(a) {\n            var l = Vector.size(a);\n            a.x /= l;\n            a.y /= l;\n            return a;\n        };\n        Vector.incidence = function(a, b) {\n            var angle = Math.atan2(b.y, b.x) - Math.atan2(a.y, a.x);\n            // if (angle < 0) angle += 2 * Math.PI;\n            // angle = Math.min(angle, (Math.PI * 2 - angle));\n            return angle;\n        };\n        Vector.distance = function(a, b) {\n            return Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));\n        };\n        Vector.cross = function(a, b) {\n            return (a.x * b.y) - (a.y * b.x);\n        };\n        Vector.difference = function(a, b) {\n            return new Vector(a.x - b.x, a.y - b.y);\n        };\n        Vector.power = function(a, b) {\n            var x = Math.abs(b.x - a.x);\n            var y = Math.abs(b.y - a.y);\n            return (x + y) / 2;\n        };\n        Vector.prototype = {\n            size: function() {\n                return Vector.size(this);\n            },\n            normalize: function() {\n                return Vector.normalize(this);\n            },\n            incidence: function(b) {\n                return Vector.incidence(this, b);\n            },\n            cross: function(b) {\n                return Vector.cross(this, b);\n            },\n            distance: function(b) {\n                return Vector.distance(this, b);\n            },\n            difference: function(b) {\n                return Vector.difference(this, b);\n            },\n            power: function() {\n                return (Math.abs(this.x) + Math.abs(this.y)) / 2;\n            },\n            towards: function(b, friction) {\n                friction = friction || 0.125;\n                this.x += (b.x - this.x) * friction;\n                this.y += (b.y - this.y) * friction;\n                return this;\n            },\n            add: function(b) {\n                this.x += b.x;\n                this.y += b.y;\n                return this;\n            },\n            friction: function(b) {\n                this.x *= b;\n                this.y *= b;\n                return this;\n            },\n            copy: function(b) {\n                return new Vector(this.x, this.y);\n            },\n            toString: function() {\n                return '{' + this.x + ',' + this.y + '}';\n            },\n        };\n        return Vector;\n    });\n\n    app.factory('Utils', ['$compile', '$controller', 'Vector', function($compile, $controller, Vector) {\n        (function() {\n            // POLYFILL window.requestAnimationFrame\n            var lastTime = 0;\n            var vendors = ['ms', 'moz', 'webkit', 'o'];\n            for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n                window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n                window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||\n                    window[vendors[x] + 'CancelRequestAnimationFrame'];\n            }\n            if (!window.requestAnimationFrame) {\n                window.requestAnimationFrame = function(callback, element) {\n                    var currTime = new Date().getTime();\n                    var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n                    var id = window.setTimeout(function() { callback(currTime + timeToCall); }, timeToCall);\n                    lastTime = currTime + timeToCall;\n                    return id;\n                };\n            }\n            if (!window.cancelAnimationFrame) {\n                window.cancelAnimationFrame = function(id) {\n                    clearTimeout(id);\n                };\n            }\n        }());\n        (function() {\n            // POLYFILL Array.prototype.reduce\n            // Production steps of ECMA-262, Edition 5, 15.4.4.21\n            // Reference: http://es5.github.io/#x15.4.4.21\n            // https://tc39.github.io/ecma262/#sec-array.prototype.reduce\n            if (!Array.prototype.reduce) {\n                Object.defineProperty(Array.prototype, 'reduce', {\n                    value: function(callback) { // , initialvalue\n                        if (this === null) {\n                            throw new TypeError('Array.prototype.reduce called on null or undefined');\n                        }\n                        if (typeof callback !== 'function') {\n                            throw new TypeError(callback + ' is not a function');\n                        }\n                        var o = Object(this);\n                        var len = o.length >>> 0;\n                        var k = 0;\n                        var value;\n                        if (arguments.length == 2) {\n                            value = arguments[1];\n                        } else {\n                            while (k < len && !(k in o)) {\n                                k++;\n                            }\n                            if (k >= len) {\n                                throw new TypeError('Reduce of empty array with no initial value');\n                            }\n                            value = o[k++];\n                        }\n                        while (k < len) {\n                            if (k in o) {\n                                value = callback(value, o[k], k, o);\n                            }\n                            k++;\n                        }\n                        return value;\n                    }\n                });\n            }\n        }());\n        var _isTouch;\n        var getNow = Date.now || function() {\n            return new Date().getTime();\n        };\n        var ua = window.navigator.userAgent.toLowerCase();\n        var safari = ua.indexOf('safari') !== -1 && ua.indexOf('chrome') === -1;\n        var msie = ua.indexOf('trident') !== -1 || ua.indexOf('edge') !== -1 || ua.indexOf('msie') !== -1;\n        var chrome = !safari && !msie && ua.indexOf('chrome') !== -1;\n        var mobile = ua.indexOf('mobile') !== -1;\n        var isChrome = navigator.userAgent.toLowerCase().indexOf('chrome') > -1;\n        var isSafari = navigator.userAgent.toLowerCase().indexOf('safari') > -1;\n\n        function Utils() {}\n        Utils.reverseSortOn = reverseSortOn;\n        Utils.getTouch = getTouch;\n        Utils.getRelativeTouch = getRelativeTouch;\n        Utils.getClosest = getClosest;\n        Utils.getClosestElement = getClosestElement;\n        Utils.throttle = throttle;\n        Utils.where = where;\n        Utils.format = format;\n        Utils.compileController = compileController;\n        Utils.reducer = reducer;\n        Utils.reducerSetter = reducerSetter;\n        Utils.reducerAdder = reducerAdder;\n        Utils.downloadFile = downloadFile;\n        Utils.serverDownload = serverDownload;\n        Utils.toMd5 = function(string) {\n            return Md5.encode(string);\n        };\n        Utils.ua = {\n            safari: safari,\n            msie: msie,\n            chrome: chrome,\n            mobile: mobile,\n        };\n        angular.forEach(Utils.ua, function(value, key) {\n            if (value) {\n                angular.element(document.getElementsByTagName('body')).addClass(key);\n            }\n        });\n        return Utils;\n\n        function isTouch() {\n            if (!_isTouch) {\n                _isTouch = {\n                    value: ('ontouchstart' in window || 'onmsgesturechange' in window)\n                };\n            }\n            // console.log(_isTouch);\n            return _isTouch.value;\n        }\n\n        function getTouch(e, previous) {\n            var t = new Vector();\n            if (e.type === 'touchstart' || e.type === 'touchmove' || e.type === 'touchend' || e.type === 'touchcancel') {\n                var touch = null;\n                var event = e.originalEvent ? e.originalEvent : e;\n                var touches = event.touches.length ? event.touches : event.changedTouches;\n                if (touches && touches.length) {\n                    touch = touches[0];\n                }\n                if (touch) {\n                    t.x = touch.pageX;\n                    t.y = touch.pageY;\n                }\n            } else if (e.type === 'click' || e.type === 'mousedown' || e.type === 'mouseup' || e.type === 'mousemove' || e.type === 'mouseover' || e.type === 'mouseout' || e.type === 'mouseenter' || e.type === 'mouseleave' || e.type === 'contextmenu') {\n                t.x = e.pageX;\n                t.y = e.pageY;\n            }\n            if (previous) {\n                t.s = Vector.difference(t, previous);\n            }\n            t.type = e.type;\n            return t;\n        }\n\n        function getRelativeTouch(node, point) {\n            var element = angular.element(node); // passing through jqlite for accepting both\n            node = element[0];\n            var rect = node.getBoundingClientRect();\n            // var e = new Vector(rect.left + node.scrollLeft, rect.top + node.scrollTop);\n            var e = new Vector(rect.left, rect.top);\n            return Vector.difference(point, e);\n        }\n\n        function getClosest(el, selector) {\n            var matchesFn, parent;\n            ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'].some(function(fn) {\n                if (typeof document.body[fn] == 'function') {\n                    matchesFn = fn;\n                    return true;\n                }\n                return false;\n            });\n            if (el[matchesFn](selector)) {\n                return el;\n            }\n            while (el !== null) {\n                parent = el.parentElement;\n                if (parent !== null && parent[matchesFn](selector)) {\n                    return parent;\n                }\n                el = parent;\n            }\n            return null;\n        }\n\n        function getClosestElement(el, target) {\n            var matchesFn, parent;\n            if (el === target) {\n                return el;\n            }\n            while (el !== null) {\n                parent = el.parentElement;\n                if (parent !== null && parent === target) {\n                    return parent;\n                }\n                el = parent;\n            }\n            return null;\n        }\n\n        function throttle(func, wait, options) {\n            // Returns a function, that, when invoked, will only be triggered at most once\n            // during a given window of time. Normally, the throttled function will run\n            // as much as it can, without ever going more than once per `wait` duration;\n            // but if you'd like to disable the execution on the leading edge, pass\n            // `{leading: false}`. To disable execution on the trailing edge, ditto.\n            var context, args, result;\n            var timeout = null;\n            var previous = 0;\n            if (!options) options = {};\n            var later = function() {\n                previous = options.leading === false ? 0 : getNow();\n                timeout = null;\n                result = func.apply(context, args);\n                if (!timeout) context = args = null;\n            };\n            return function() {\n                var now = getNow();\n                if (!previous && options.leading === false) previous = now;\n                var remaining = wait - (now - previous);\n                context = this;\n                args = arguments;\n                if (remaining <= 0 || remaining > wait) {\n                    if (timeout) {\n                        clearTimeout(timeout);\n                        timeout = null;\n                    }\n                    previous = now;\n                    result = func.apply(context, args);\n                    if (!timeout) context = args = null;\n                } else if (!timeout && options.trailing !== false) {\n                    timeout = setTimeout(later, remaining);\n                }\n                return result;\n            };\n        }\n\n        function where(array, query) {\n            var found = null;\n            if (array) {\n                angular.forEach(array, function(item) {\n                    var has = true;\n                    angular.forEach(query, function(value, key) {\n                        has = has && item[key] === value;\n                    });\n                    if (has) {\n                        found = item;\n                    }\n                });\n            }\n            return found;\n        }\n\n        function compileController(scope, element, html, data) {\n            // console.log('Utils.compileController', element);\n            element.html(html);\n            var link = $compile(element.contents());\n            if (data.controller) {\n                var $scope = scope.$new();\n                angular.extend($scope, data);\n                var controller = $controller(data.controller, { $scope: $scope });\n                if (data.controllerAs) {\n                    scope[data.controllerAs] = controller;\n                }\n                element.data('$ngControllerController', controller);\n                element.children().data('$ngControllerController', controller);\n                scope = $scope;\n            }\n            link(scope);\n        }\n\n        function reverseSortOn(key) {\n            return function(a, b) {\n                if (a[key] < b[key]) {\n                    return 1;\n                }\n                if (a[key] > b[key]) {\n                    return -1;\n                }\n                // a must be equal to b\n                return 0;\n            };\n        }\n\n        function format(string, prepend, expression) {\n            string = string || '';\n            prepend = prepend || '';\n            var splitted = string.split(',');\n            if (splitted.length > 1) {\n                var formatted = splitted.shift();\n                angular.forEach(splitted, function(value, index) {\n                    if (expression) {\n                        formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n                    } else {\n                        formatted = formatted.split('{' + index + '}').join(prepend + value);\n                    }\n                });\n                if (expression) {\n                    return '\\'' + formatted + '\\'';\n                } else {\n                    return formatted;\n                }\n            } else {\n                return prepend + string;\n            }\n        }\n\n        function reducer(o, key) {\n            return o[key];\n        }\n\n        function reducerSetter(o, key, value) {\n            if (typeof key == 'string') {\n                return reducerSetter(o, key.split('.'), value);\n            } else if (key.length == 1 && value !== undefined) {\n                return (o[key[0]] = value);\n            } else if (key.length === 0) {\n                return o;\n            } else {\n                return reducerSetter(o[key[0]], key.slice(1), value);\n            }\n        }\n\n        function reducerAdder(o, key, value) {\n            if (typeof key == 'string') {\n                return reducerAdder(o, key.split('.'), value);\n            } else if (key.length == 1 && value !== undefined) {\n                return (o[key[0]] += value);\n            } else if (key.length === 0) {\n                return o;\n            } else {\n                return reducerAdder(o[key[0]], key.slice(1), value);\n            }\n        }\n\n        function downloadFile(content, name, type) {\n            type = type || 'application/octet-stream';\n            var base64 = null;\n            var blob = new Blob([content], { type: type });\n            var reader = new window.FileReader();\n            reader.readAsDataURL(blob);\n            reader.onloadend = function() {\n                base64 = reader.result;\n                download();\n            };\n\n            function download() {\n                // If in Chrome or Safari - download via virtual link click\n                // if (isChrome || isSafari) {\n                //Creating new link node.\n                if (document.createEvent) {\n                    var anchor = document.createElement('a');\n                    anchor.href = base64;\n                    if (anchor.download !== undefined) {\n                        //Set HTML5 download attribute. This will prevent file from opening if supported.\n                        var downloadName = name || base64.substring(base64.lastIndexOf('/') + 1, base64.length);\n                        anchor.download = downloadName;\n                    }\n                    //Dispatching click event.\n                    var event = document.createEvent('MouseEvents');\n                    event.initEvent('click', true, true);\n                    anchor.dispatchEvent(event);\n                    return true;\n                }\n                // }\n                // Force file download (whether supported by server).\n                var query = '?download';\n                window.open(base64.indexOf('?') > -1 ? base64 : base64 + query, '_self');\n            }\n\n            function __download() {\n                var supportsDownloadAttribute = 'download' in document.createElement('a');\n                if (supportsDownloadAttribute) {\n                    var anchor = document.createElement('a');\n                    anchor.href = 'data:attachment/text;base64,' + encodeURI(window.btoa(content));\n                    anchor.target = '_blank';\n                    anchor.download = name;\n                    //Dispatching click event.\n                    if (document.createEvent) {\n                        var event = document.createEvent('MouseEvents');\n                        event.initEvent('click', true, true);\n                        anchor.dispatchEvent(event);\n                        return true;\n                    }\n                } else if (window.Blob !== undefined && window.saveAs !== undefined) {\n                    var blob = new Blob([content], { type: type });\n                    saveAs(blob, filename);\n                } else {\n                    window.open('data:attachment/text;charset=utf-8,' + encodeURI(content));\n                }\n            }\n            /*\n            var headers = response.headers();\n            // console.log(response);\n            var blob = new Blob([response.data], { type: \"application/octet-stream\" }); // { type: headers['content-type'] });\n            var windowUrl = (window.URL || window.webkitURL);\n            var downloadUrl = windowUrl.createObjectURL(blob);\n            var anchor = document.createElement(\"a\");\n            anchor.href = downloadUrl;\n            var fileNamePattern = /filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/;\n            anchor.download = fileNamePattern.exec(headers['content-disposition'])[1];\n            document.body.appendChild(anchor);\n            anchor.click();\n            windowUrl.revokeObjectURL(blob);\n            anchor.remove();\n            */\n            /*\n            //Dispatching click event.\n            if (document.createEvent) {\n                var e = document.createEvent('MouseEvents');\n                e.initEvent('click', true, true);\n                link.dispatchEvent(e);\n                return true;\n            }\n            */\n        }\n\n        function serverDownload(options) {\n            var defaults = {\n                uri: '/api/reports/download',\n                name: 'Filename',\n                extension: 'txt',\n                type: 'text/plain',\n                content: 'Hello!',\n            };\n            options = angular.extend(defaults, options);\n            var content = JSON.stringify(options); // unescape(encodeURIComponent(JSON.stringify(download)));\n            var form = document.createElement('form');\n            var input = document.createElement('input');\n            input.name = 'download';\n            input.value = content;\n            form.appendChild(input);\n            form.action = options.uri;\n            form.method = 'POST';\n            form.target = 'ProjectDownloads';\n            form.enctype = 'application/x-www-form-urlencoded';\n            // form.enctype = 'multipart/form-data';\n            // form.enctype = 'text/plain';\n            document.body.appendChild(form);\n            form.submit();\n            setTimeout(function() {\n                document.body.removeChild(form);\n            }, 100);\n            // angular.element(form).find('button')[0].click();\n            return Utils;\n        }\n    }]);\n\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.factory('Doc', ['Api', '$promise', function(Api, $promise) {\r\n        function Doc(item) {\r\n            if (item) {\r\n                angular.extend(this, item);\r\n            }\r\n        }\r\n\r\n        Doc.prototype = {\r\n\r\n        };\r\n\r\n        var statics = {};\r\n\r\n        angular.extend(Doc, statics);\r\n\r\n        return Doc;\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.factory('View', ['Api', '$promise', '$location', '$routeParams', 'environment', 'Doc', function(Api, $promise, $location, $routeParams, environment, Doc) {\r\n        function View(doc) {\r\n            var url = $location.path(),\r\n                params = $routeParams;\r\n            var view = {\r\n                environment: environment,\r\n                route: {\r\n                    url: url,\r\n                    params: params,\r\n                },\r\n                doc: doc,\r\n            };\r\n            angular.extend(this, view);\r\n        }\r\n\r\n        View.prototype = {\r\n\r\n        };\r\n\r\n        var statics = {\r\n            current: function() {\r\n                return $promise(function(promise) {\r\n                    var url = $location.path();\r\n                    console.log('View.current', url);\r\n                    Api.docs.url(url).then(function(response) {\r\n                        var doc = new Doc(response);\r\n                        var view = new View(doc);\r\n                        promise.resolve(view);\r\n\r\n                    }, function(error) {\r\n                        promise.reject(error);\r\n\r\n                    });\r\n                    /*\r\n                    Api.navs.main().then(function(items) {\r\n                        var doc = null,\r\n                            url = $location.path(),\r\n                            pool = getPool(items);\r\n                        var item = pool[url];\r\n                        if (item) {\r\n                            doc = new Doc(item);\r\n                        }\r\n                        promise.resolve(doc);\r\n\r\n                    }, function(error) {\r\n                        promise.reject(error);\r\n\r\n                    });\r\n                    */\r\n                });\r\n            }\r\n        };\r\n\r\n        angular.extend(View, statics);\r\n\r\n        function getPool(items) {\r\n            var pool = {};\r\n\r\n            function _getPool(items) {\r\n                if (items) {\r\n                    angular.forEach(items, function(item) {\r\n                        pool[item.url] = item;\r\n                        _getPool(item.items);\r\n                    });\r\n                }\r\n            }\r\n            _getPool(items);\r\n            return pool;\r\n        }\r\n\r\n        return View;\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.service('WebApi', ['$http', '$promise', '$timeout', 'environment',\r\n        function($http, $promise, $timeout, environment) {\r\n\r\n            function $httpPromise(method, url, data) {\r\n                return $promise(function(promise) {\r\n\r\n                    $http[method](environment.api + url, data).then(function(response) {\r\n                        promise.resolve(response.data);\r\n\r\n                    }, function(e, status) {\r\n                        var error = (e && e.data) ? e.data : {};\r\n                        error.status = e.status;\r\n                        promise.reject(error);\r\n\r\n                    });\r\n                });\r\n            }\r\n\r\n            function $get(url) {\r\n                return $httpPromise('get', url);\r\n            }\r\n\r\n            function $post(url, data) {\r\n                return $httpPromise('post', url, data);\r\n            }\r\n\r\n            function $put(url, data) {\r\n                return $httpPromise('put', url, data);\r\n            }\r\n\r\n            function $patch(url, data) {\r\n                return $httpPromise('patch', url, data);\r\n            }\r\n\r\n            function $delete(url) {\r\n                return $httpPromise('delete', url);\r\n            }\r\n\r\n            function $fake(data) {\r\n                var deferred = $q.defer();\r\n                $timeout(function() {\r\n                    deferred.resolve({ data: data });\r\n                }, 1000);\r\n                return deferred.promise;\r\n            }\r\n\r\n            this.get = $get;\r\n            this.post = $post;\r\n            this.put = $put;\r\n            this.patch = $patch;\r\n            this.delete = $delete;\r\n            this.fake = $fake;\r\n\r\n        }\r\n    ]);\r\n\r\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.service('Router', ['$location', '$timeout', function($location, $timeout) {\n\n        var service = this;\n        service.redirect = redirect;\n        service.path = path;\n        service.apply = apply;\n\n        function redirect(path, msecs) {\n            function doRedirect() {\n                $location.$$lastRequestedPath = $location.path();\n                $location.path(path);\n            }\n            if (msecs) {\n                $timeout(function() {\n                    doRedirect();\n                }, msecs);\n            } else {\n                doRedirect();\n            }\n        }\n\n        function path(path, msecs) {\n            function doRetry() {\n                path = $location.$$lastRequestedPath || path;\n                $location.$$lastRequestedPath = null;\n                $location.path(path);\n            }\n            if (msecs) {\n                $timeout(function() {\n                    doRetry();\n                }, msecs);\n            } else {\n                doRetry();\n            }\n        }\n\n        function apply(path, msecs) {\n            function doRetry() {\n                $location.path(path);\n            }\n            if (msecs) {\n                $timeout(function() {\n                    doRetry();\n                }, msecs);\n            } else {\n                $timeout(function() {\n                    doRetry();\n                });\n            }\n        }\n\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('$silent', ['$rootScope', '$location', function($rootScope, $location) {\n        function $silent() {}\n\n        var $path;\n\n        function unlink() {\n            var listeners = $rootScope.$$listeners.$locationChangeSuccess;\n            angular.forEach(listeners, function(value, name) {\n                if (value === listener) {\n                    return;\n                }\n\n                function relink() {\n                    listeners[name] = value;\n                }\n                listeners[name] = relink; // temporary unlinking\n            });\n        }\n\n        function listener(e) {\n            // console.log('onLocationChangeSuccess', e);\n            if ($path === $location.path()) {\n                unlink();\n            }\n            $path = null;\n        }\n\n        var statics = {\n            silent: function(path, replace) {\n                // this.prev = $location.path(); ???\n                var location = $location.url(path);\n                if (replace) {\n                    location.replace();\n                }\n                $path = $location.path();\n            },\n            path: function(path) {\n                return $location.path(path);\n            },\n        };\n\n        angular.extend($silent, statics);\n        $rootScope.$$listeners.$locationChangeSuccess.unshift(listener);\n        // console.log('$rootScope.$$listeners.$locationChangeSuccess', $rootScope.$$listeners.$locationChangeSuccess);\n        return $silent;\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('Cookie', ['$q', '$window', function($q, $window) {\n        function Cookie() {}\n        Cookie.TIMEOUT = 5 * 60 * 1000; // five minutes\n        Cookie._set = function(name, value, days) {\n            var expires;\n            if (days) {\n                var date = new Date();\n                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n                expires = '; expires=' + date.toGMTString();\n            } else {\n                expires = '';\n            }\n            $window.document.cookie = name + '=' + value + expires + '; path=/';\n        };\n        Cookie.exists = function(name) {\n            return $window.document.cookie.indexOf(';' + name + '=') !== -1 || $window.document.cookie.indexOf(name + '=') === 0;\n        };\n        Cookie.get = function(name) {\n            var cookieName = name + \"=\";\n            var ca = $window.document.cookie.split(';');\n            for (var i = 0; i < ca.length; i++) {\n                var c = ca[i];\n                while (c.charAt(0) == ' ') {\n                    c = c.substring(1, c.length);\n                }\n                if (c.indexOf(cookieName) === 0) {\n                    var value = c.substring(cookieName.length, c.length);\n                    var model = null;\n                    try {\n                        model = JSON.parse(decodeURIComponent(atob(value)));\n                    } catch (e) {\n                        console.log('Cookie.get.error parsing', key, e);\n                    }\n                    return model;\n                }\n            }\n            return null;\n        };\n        Cookie.set = function(name, value, days) {\n            try {\n                var cache = [];\n                var json = JSON.stringify(value, function(key, value) {\n                    if (key === 'pool') {\n                        return;\n                    }\n                    if (typeof value === 'object' && value !== null) {\n                        if (cache.indexOf(value) !== -1) {\n                            // Circular reference found, discard key\n                            return;\n                        }\n                        cache.push(value);\n                    }\n                    return value;\n                });\n                cache = null;\n                Cookie._set(name, btoa(encodeURIComponent(json)), days);\n            } catch (e) {\n                console.log('Cookie.set.error serializing', name, value, e);\n            }\n        };\n        Cookie.delete = function(name) {\n            Cookie._set(name, \"\", -1);\n        };\n        Cookie.on = function(name) {\n            var deferred = $q.defer();\n            var i, interval = 1000,\n                elapsed = 0,\n                timeout = Cookie.TIMEOUT;\n\n            function checkCookie() {\n                if (elapsed > timeout) {\n                    deferred.reject('timeout');\n                } else {\n                    var c = Cookie.get(name);\n                    if (c) {\n                        deferred.resolve(c);\n                    } else {\n                        elapsed += interval;\n                        i = setTimeout(checkCookie, interval);\n                    }\n                }\n            }\n            checkCookie();\n            return deferred.promise;\n        };\n        return Cookie;\n    }]);\n\n    app.factory('LocalStorage', ['$q', '$window', 'Cookie', function($q, $window, Cookie) {\n        function LocalStorage() {}\n\n        function isLocalStorageSupported() {\n            var supported = false;\n            try {\n                supported = 'localStorage' in $window && $window.localStorage !== null;\n                if (supported) {\n                    $window.localStorage.setItem('test', '1');\n                    $window.localStorage.removeItem('test');\n                } else {\n                    supported = false;\n                }\n            } catch (e) {\n                supported = false;\n            }\n            return supported;\n        }\n        LocalStorage.isSupported = isLocalStorageSupported();\n        if (LocalStorage.isSupported) {\n            LocalStorage.exists = function(name) {\n                return $window.localStorage[name] !== undefined;\n            };\n            LocalStorage.get = function(name) {\n                var value = null;\n                if ($window.localStorage[name] !== undefined) {\n                    try {\n                        value = JSON.parse($window.localStorage[name]);\n                    } catch (e) {\n                        console.log('LocalStorage.get.error parsing', name, e);\n                    }\n                }\n                return value;\n            };\n            LocalStorage.set = function(name, value) {\n                try {\n                    var cache = [];\n                    var json = JSON.stringify(value, function(key, value) {\n                        if (key === 'pool') {\n                            return;\n                        }\n                        if (typeof value === 'object' && value !== null) {\n                            if (cache.indexOf(value) !== -1) {\n                                // Circular reference found, discard key\n                                return;\n                            }\n                            cache.push(value);\n                        }\n                        return value;\n                    });\n                    cache = null;\n                    $window.localStorage.setItem(name, json);\n                } catch (e) {\n                    console.log('LocalStorage.set.error serializing', name, value, e);\n                }\n            };\n            LocalStorage.delete = function(name) {\n                $window.localStorage.removeItem(name);\n            };\n            LocalStorage.on = function(name) {\n                var deferred = $q.defer();\n                var i, timeout = Cookie.TIMEOUT;\n\n                function storageEvent(e) {\n                    // console.log('LocalStorage.on', name, e);\n                    clearTimeout(i);\n                    if (e.originalEvent.key == name) {\n                        try {\n                            var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n                            deferred.resolve(value);\n                        } catch (error) {\n                            console.log('LocalStorage.on.error parsing', name, error);\n                            deferred.reject('error parsing ' + name);\n                        }\n                    }\n                }\n                angular.element($window).on('storage', storageEvent);\n                i = setTimeout(function() {\n                    deferred.reject('timeout');\n                }, timeout);\n                return deferred.promise;\n            };\n        } else {\n            console.log('LocalStorage.unsupported switching to cookies');\n            LocalStorage.exists = Cookie.exists;\n            LocalStorage.set = Cookie.set;\n            LocalStorage.get = Cookie.get;\n            LocalStorage.delete = Cookie.delete;\n            LocalStorage.on = Cookie.on;\n        }\n        return LocalStorage;\n    }]);\n\n    app.factory('SessionStorage', ['$q', '$window', 'Cookie', function($q, $window, Cookie) {\n        function SessionStorage() {}\n\n        function isSessionStorageSupported() {\n            var supported = false;\n            try {\n                supported = 'sessionStorage' in $window && $window.sessionStorage !== undefined;\n                if (supported) {\n                    $window.sessionStorage.setItem('test', '1');\n                    $window.sessionStorage.removeItem('test');\n                } else {\n                    supported = false;\n                }\n            } catch (e) {\n                supported = false;\n            }\n            return supported;\n        }\n        SessionStorage.isSupported = isSessionStorageSupported();\n        if (SessionStorage.isSupported) {\n            SessionStorage.exists = function(name) {\n                return $window.sessionStorage[name] !== undefined;\n            };\n            SessionStorage.get = function(name) {\n                var value = null;\n                if ($window.sessionStorage[name] !== undefined) {\n                    try {\n                        value = JSON.parse($window.sessionStorage[name]);\n                    } catch (e) {\n                        console.log('SessionStorage.get.error parsing', name, e);\n                    }\n                }\n                return value;\n            };\n            SessionStorage.set = function(name, value) {\n                try {\n                    var cache = [];\n                    var json = JSON.stringify(value, function(key, value) {\n                        if (key === 'pool') {\n                            return;\n                        }\n                        if (typeof value === 'object' && value !== null) {\n                            if (cache.indexOf(value) !== -1) {\n                                // Circular reference found, discard key\n                                return;\n                            }\n                            cache.push(value);\n                        }\n                        return value;\n                    });\n                    cache = null;\n                    $window.sessionStorage.setItem(name, json);\n                } catch (e) {\n                    console.log('SessionStorage.set.error serializing', name, value, e);\n                }\n            };\n            SessionStorage.delete = function(name) {\n                $window.sessionStorage.removeItem(name);\n            };\n            SessionStorage.on = function(name) {\n                var deferred = $q.defer();\n                var i, timeout = Cookie.TIMEOUT;\n\n                function storageEvent(e) {\n                    // console.log('SessionStorage.on', name, e);\n                    clearTimeout(i);\n                    if (e.originalEvent.key === name) {\n                        try {\n                            var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n                            deferred.resolve(value);\n                        } catch (error) {\n                            console.log('SessionStorage.on.error parsing', name, error);\n                            deferred.reject('error parsing ' + name);\n                        }\n                    }\n                }\n                angular.element($window).on('storage', storageEvent);\n                i = setTimeout(function() {\n                    deferred.reject('timeout');\n                }, timeout);\n                return deferred.promise;\n            };\n        } else {\n            console.log('SessionStorage.unsupported switching to cookies');\n            SessionStorage.exists = Cookie.exists;\n            SessionStorage.set = Cookie.set;\n            SessionStorage.get = Cookie.get;\n            SessionStorage.delete = Cookie.delete;\n            SessionStorage.on = Cookie.on;\n        }\n        return SessionStorage;\n    }]);\n\n}());\n/* global angular, firebase */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('Rect', [function() {\n        function Rect(x, y, w, h) {\n            this.x = x || 0;\n            this.y = y || 0;\n            this.w = w || 0;\n            this.h = h || 0;\n        }\n        Rect.mult = function(rect, value) {\n            rect.x *= value;\n            rect.y *= value;\n            rect.w *= value;\n            rect.h *= value;\n            return rect;\n        };\n        Rect.prototype = {\n            mult: function(value) {\n                return Rect.mult(this, value);\n            },\n            offset: function(x, y) {\n                this.x += x;\n                this.y += y;\n                return this;\n            },\n            reduce: function(size) {\n                return this.offset(-size);\n            },\n            reduceRect: function(rect) {\n                return this.offsetRect(Rect.mult(rect, -1));\n            },\n            expandRect: function(rect) {\n                this.x -= rect.x || 0;\n                this.y -= rect.y || 0;\n                this.w += rect.w || 0;\n                this.h += rect.h || 0;\n                return this;\n            },\n            expand: function(size) {\n                return this.expandRect({ x: size, y: size, w: size * 2, h: size * 2 });\n            },\n            intersect: function(rect) {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return !(rect.x > x + w || rect.x + rect.w < x || rect.y > y + h || rect.y + rect.h < y);\n            },\n            top: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x + w / 2, y: y };\n            },\n            right: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x + w, y: y + h / 2 };\n            },\n            bottom: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x + w / 2, y: y + h };\n            },\n            left: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x, y: y + h / 2 };\n            },\n            center: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x + w / 2, y: y + h / 2 };\n            },\n            topLeft: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x, y: y };\n            },\n            topRight: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x + w, y: y };\n            },\n            bottomRight: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x + w, y: y + h };\n            },\n            bottomLeft: function() {\n                var x = this.x,\n                    y = this.y,\n                    w = this.w,\n                    h = this.h;\n                return { x: x, y: y + h };\n            },\n            setX: function(x) {\n                this.x = x;\n                return this;\n            },\n            setY: function(y) {\n                this.y = y;\n                return this;\n            },\n            setW: function(w) {\n                this.w = w;\n                return this;\n            },\n            setH: function(h) {\n                this.h = h;\n                return this;\n            },\n            setPos: function(x, y) {\n                this.x = x;\n                this.y = y;\n                return this;\n            },\n            setSize: function(w, h) {\n                this.w = w;\n                this.h = h;\n                return this;\n            },\n            copy: function(rect) {\n                this.x = rect.x;\n                this.y = rect.y;\n                this.w = rect.w;\n                this.h = rect.h;\n                return this;\n            },\n            clone: function() {\n                return new Rect(this.x, this.y, this.w, this.h);\n            },\n            toString: function() {\n                return '{' + this.x + ',' + this.y + ',' + this.w + ',' + this.h + '}';\n            },\n        };\n        return Rect;\n    }]);\n\n    app.factory('Color', [function() {\n        function Color(r, g, b, a) {\n            if (arguments.length > 1) {\n                this.r = (r || r === 0) ? r : 0;\n                this.g = (g || g === 0) ? g : 0;\n                this.b = (b || b === 0) ? b : 0;\n                this.a = (a || a === 0) ? a : 255;\n            } else {\n                var uint = r || '0xffffff';\n                uint = parseInt(uint);\n                if (r.length > 8) {\n                    this.r = uint >> 24 & 0xff;\n                    this.g = uint >> 16 & 0xff;\n                    this.b = uint >> 8 & 0xff;\n                    this.a = uint >> 0 & 0xff;\n                } else {\n                    this.r = uint >> 16 & 0xff;\n                    this.g = uint >> 8 & 0xff;\n                    this.b = uint >> 0 & 0xff;\n                    this.a = 255;\n                }\n            }\n        }\n        Color.componentToHex = function(c) {\n            var hex = c.toString(16);\n            return hex.length == 1 ? '0' + hex : hex;\n        };\n        Color.luma = function(color) {\n            // var luma = color.dot({ r: 54.213, g: 182.376, b: 18.411 });\n            var luma = color.dot({ r: 95, g: 100, b: 60 });\n            return luma;\n        };\n        Color.contrast = function(color) {\n            var luma = Color.luma(color);\n            if (luma > 0.6) {\n                return new Color('0x000000');\n            } else {\n                return new Color('0xffffff');\n            }\n        };\n        Color.darker = function(color, pow, min) {\n            min = min || 0;\n            var r = Math.max(Math.floor(color.r * min), Math.floor(color.r - 255 * pow));\n            var g = Math.max(Math.floor(color.g * min), Math.floor(color.g - 255 * pow));\n            var b = Math.max(Math.floor(color.b * min), Math.floor(color.b - 255 * pow));\n            return new Color(r, g, b, color.a);\n        };\n        Color.lighter = function(color, pow, max) {\n            max = max || 1;\n            var r = Math.min(color.r + Math.floor((255 - color.r) * max), Math.floor(color.r + 255 * pow));\n            var g = Math.min(color.g + Math.floor((255 - color.g) * max), Math.floor(color.g + 255 * pow));\n            var b = Math.min(color.b + Math.floor((255 - color.b) * max), Math.floor(color.b + 255 * pow));\n            return new Color(r, g, b, color.a);\n        };\n        /*\n        Color.rgbaToHex = function (rgba) {        \n            rgba = rgba.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\n            return (rgba && rgba.length === 4) ? \"#\" +\n                (\"0\" + parseInt(rgba[1], 10).toString(16)).slice(-2) +\n                (\"0\" + parseInt(rgba[2], 10).toString(16)).slice(-2) +\n                (\"0\" + parseInt(rgba[3], 10).toString(16)).slice(-2) : '';        \n        }\n        */\n        Color.prototype = {\n            toUint: function() {\n                return (this.r << 24) + (this.g << 16) + (this.b << 8) + (this.a);\n            },\n            toHex: function() {\n                return '#' + Color.componentToHex(this.r) + Color.componentToHex(this.g) + Color.componentToHex(this.b) + Color.componentToHex(this.a);\n            },\n            toRgba: function() {\n                return 'rgba(' + this.r + ',' + this.g + ',' + this.b + ',' + (this.a / 255).toFixed(3) + ')';\n            },\n            dot: function(color) {\n                return ((this.r / 255) * (color.r / 255) + (this.g / 255) * (color.g / 255) + (this.b / 255) * (color.b / 255));\n            },\n            alpha: function(pow, min, max) {\n                min = min || 0;\n                max = max || 1;\n                this.a = Math.floor((min + (pow * (max - min))) * 255);\n                return this;\n            },\n            makeSet: function() {\n                this.foreground = Color.contrast(this);\n                this.border = Color.darker(this, 0.3);\n                this.light = Color.lighter(this, 0.3);\n                return this;\n            },\n        };\n        return Color;\n    }]);\n\n    app.factory('Shape', [function() {\n        function Shape() {}\n        Shape.shapeCircle = function(p, cx, cy, r, sa, ea) {\n            sa = sa || 0;\n            ea = ea || 2 * Math.PI;\n            p.ctx.arc(cx, cy, r, sa, ea, false);\n        };\n        Shape.shapeStar = function(p, cx, cy, or, ir, steps) {\n            var x, y;\n            var angle = Math.PI / 2 * 3;\n            var step = Math.PI / steps;\n            var ctx = p.ctx;\n            ctx.moveTo(cx, cy - or);\n            for (i = 0; i < steps; i++) {\n                x = cx + Math.cos(angle) * or;\n                y = cy + Math.sin(angle) * or;\n                ctx.lineTo(x, y);\n                angle += step;\n                x = cx + Math.cos(angle) * ir;\n                y = cy + Math.sin(angle) * ir;\n                ctx.lineTo(x, y);\n                angle += step;\n            }\n            ctx.lineTo(cx, cy - or);\n        };\n        Shape.shapeRoundRect = function(p, rect, r) {\n            var ctx = p.ctx,\n                x = rect.x,\n                y = rect.y,\n                w = rect.w,\n                h = rect.h;\n            if (typeof r === undefined) {\n                r = 4;\n            }\n            if (typeof r === 'number') {\n                r = { tl: r, tr: r, br: r, bl: r };\n            } else {\n                var defaultRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\n                for (var key in defaultRadius) {\n                    r[key] = r[key] || defaultRadius[key];\n                }\n            }\n            ctx.moveTo(x + r.tl, y);\n            ctx.lineTo(x + w - r.tr, y);\n            ctx.quadraticCurveTo(x + w, y, x + w, y + r.tr);\n            ctx.lineTo(x + w, y + h - r.br);\n            ctx.quadraticCurveTo(x + w, y + h, x + w - r.br, y + h);\n            ctx.lineTo(x + r.bl, y + h);\n            ctx.quadraticCurveTo(x, y + h, x, y + h - r.bl);\n            ctx.lineTo(x, y + r.tl);\n            ctx.quadraticCurveTo(x, y, x + r.tl, y);\n        };\n        Shape.circle = function() {\n            var params = Array.prototype.slice.call(arguments);\n            var ctx = params[0].ctx;\n            ctx.beginPath();\n            Shape.shapeCircle.apply(this, params);\n            ctx.closePath();\n        };\n        Shape.star = function() {\n            var params = Array.prototype.slice.call(arguments);\n            var ctx = params[0].ctx;\n            ctx.beginPath();\n            Shape.shapeStar.apply(this, params);\n            ctx.closePath();\n        };\n        Shape.roundRect = function() {\n            var params = Array.prototype.slice.call(arguments);\n            var ctx = params[0].ctx;\n            ctx.beginPath();\n            Shape.shapeRoundRect.apply(this, params);\n            ctx.closePath();\n        };\n        return Shape;\n    }]);\n\n    app.constant('PainterColors', {\n        /*\n        black: new Color('0x111111'),\n        white: new Color('0xffffff'),\n        red: new Color('0xff0000'),\n        green: new Color('0x00ff00'),\n        blue: new Color('0x0000ff'),\n        yellow: new Color('0xffff00'),\n        cyan: new Color('0x00ffff'),\n        purple: new Color('0xff00ff'),\n        */\n        black: '0x14191e',\n        white: '0xffffff',\n        blue: '0x0023FF',\n        red: '0xF21500',\n        lightBlue: '0x79ccf2',\n        lightYellow: '0xfff79a',\n        greyLighter: '0xf8f8f8',\n        greyLight: '0xeeeeee',\n        greyMedium: '0xcccccc',\n        grey: '0x90939b',\n        map: '0x24292e',\n    });\n\n    app.factory('Palette', ['$q', 'Painter', 'Rect', function($q, Painter, Rect) {\n        function Palette() {\n            this.painter = new Painter().setSize(0, 0);\n            this.buffer = new Painter().setSize(0, 0);\n            this.size = { w: 0, h: 0 };\n            this.pool = {};\n            this.rows = {};\n        }\n        Palette.prototype = {\n            getRect: function(w, h) {\n                var p = this.painter,\n                    size = this.size,\n                    rows = this.rows,\n                    r = new Rect(0, 0, w, h),\n                    row = rows[h] || { x: 0, y: size.h };\n                size.w = Math.max(size.w, row.x + w);\n                size.h = Math.max(size.h, row.y + h);\n                if (!p.canvas.width && !p.canvas.height) {\n                    p.setSize(size.w, size.h);\n                } else if (size.w > p.canvas.width || size.h > p.canvas.height) {\n                    // var img = new Image();\n                    // img.src = p.toDataURL();\n                    // document.body.appendChild(canvas);\n                    // console.log(p.canvas.width, p.canvas.height);\n                    // var data = p.ctx.getImageData(0, 0, p.canvas.width, p.canvas.height);\n                    var canvas = p.canvas;\n                    p.setCanvas(document.createElement('canvas'));\n                    p.setSize(size.w, size.h);\n                    p.ctx.drawImage(canvas, 0, 0);\n                    // p.ctx.putImageData(data, 0, 0);\n                    // p.ctx.drawImage(img, 0, 0);\n                    // document.body.removeChild(canvas);\n                }\n                r.x = row.x;\n                r.y = row.y;\n                row.x += w;\n                rows[h] = row;\n                return r;\n            },\n            add: function(key, path) {\n                var palette = this;\n                if (angular.isString(path)) {\n                    var deferred = $q.defer();\n                    var img = new Image();\n                    img.onload = function() {\n                        palette.addShape(key, img.width, img.height, function(p, rect) {\n                            p.ctx.drawImage(img, 0, 0);\n                        });\n                        deferred.resolve(img);\n                    };\n                    img.onerror = function() {\n                        deferred.reject('connot load ' + path);\n                    };\n                    img.src = path;\n                    return deferred.promise;\n                } else {\n                    var params = Array.prototype.slice.call(arguments);\n                    return palette.addShape.apply(palette, params);\n                }\n            },\n            addShape: function(key, w, h, callback) {\n                var p = this.painter,\n                    r = this.getRect(w, h);\n                p.ctx.save();\n                p.ctx.rect(r.x, r.y, r.w, r.h);\n                // p.ctx.stroke();\n                p.ctx.clip();\n                p.ctx.translate(r.x, r.y);\n                callback.call(p, p, r.clone().setPos(0, 0));\n                p.ctx.restore();\n                this.pool[key] = r;\n                // console.log('Painter.add', r);\n            },\n            draw: function(target, key, x, y, pre) {\n                var r = this.pool[key];\n                if (r) {\n                    // var ctx = target.ctx;\n                    // ctx.save();\n                    target.drawRect(this.painter.canvas, r, { x: x, y: y, w: r.w, h: r.h }, pre);\n                    // target.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, x - r.w / 2, y - r.h / 2, r.w, r.h);\n                    // ctx.restore();\n                }\n            },\n            tint: function(target, key, x, y, color, pre) {\n                var r = this.pool[key];\n                if (r) {\n                    var p = this.painter,\n                        b = this.buffer.setSize(r.w, r.h);\n                    b.save();\n                    b.setFill(color);\n                    b.fillRect();\n                    b.ctx.globalCompositeOperation = \"destination-atop\";\n                    b.ctx.drawImage(p.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n                    b.restore();\n                    console.log(x, y, b.canvas, target.canvas);\n                    target.draw(b.canvas, { x: x, y: y }, pre);\n                }\n            },\n            pattern: function(target, key, x, y, w, h, color) {\n                function drawPattern(pattern) {\n                    var ctx = target.ctx;\n                    ctx.save();\n                    ctx.translate(x, y);\n                    // draw\n                    // ctx.beginPath();\n                    // ctx.rect(-x, -y, w, h);\n                    ctx.fillStyle = pattern;\n                    ctx.fillRect(-x, -y, w, h);\n                    ctx.translate(-x, -y);\n                    // ctx.fill();\n                    ctx.restore();\n                }\n                var r = this.pool[key];\n                if (r) {\n                    var img = r.img,\n                        pattern;\n                    if (!img || r.color != color) {\n                        var b = this.buffer.setSize(r.w, r.h);\n                        if (color) {\n                            r.color = color;\n                            b.save();\n                            b.setFill(color);\n                            b.fillRect();\n                            b.ctx.globalCompositeOperation = \"destination-atop\";\n                            b.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n                            b.restore();\n                        } else {\n                            b.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\n                        }\n                        img = new Image();\n                        img.onload = function() {\n                            r.img = img;\n                            pattern = target.ctx.createPattern(img, \"repeat\");\n                            drawPattern(pattern);\n                        };\n                        img.src = b.toDataURL();\n                    } else {\n                        pattern = target.ctx.createPattern(img, \"repeat\");\n                        drawPattern(pattern);\n                    }\n                }\n            },\n        };\n        return Palette;\n    }]);\n\n    app.factory('Painter', ['Shape', 'Rect', 'Color', 'PainterColors', function(Shape, Rect, Color, PainterColors) {\n        function Painter(canvas) {\n            canvas = canvas || document.createElement('canvas');\n            this.rect = new Rect();\n            this.drawingRect = new Rect();\n            this.setColors();\n            this.setCanvas(canvas);\n        }\n        Painter.colors = {};\n        angular.forEach(PainterColors, function(value, key) {\n            Painter.colors[key] = new Color(value).makeSet();\n        });\n        var colors = Painter.colors;\n        Painter.prototype = {\n            colors: Painter.colors,\n            setColors: function() {\n                var colors = this.colors;\n                angular.forEach(PainterColors, function(value, key) {\n                    colors[key] = new Color(value).makeSet();\n                });\n            },\n            setCanvas: function(canvas) {\n                this.canvas = canvas;\n                this.setSize(canvas.offsetWidth, canvas.offsetHeight);\n                var ctx = canvas.getContext('2d');\n                ctx.lineCap = 'square';\n                this.ctx = ctx;\n                return this;\n            },\n            setSize: function(w, h) {\n                this.canvas.width = w;\n                this.canvas.height = h;\n                this.rect.w = w;\n                this.rect.h = h;\n                return this;\n            },\n            copy: function(canvas) {\n                this.ctx.drawImage(canvas, 0, 0);\n                return this;\n            },\n            clear: function() {\n                this.resize();\n                // this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n                return this;\n            },\n            resize: function() {\n                this.setSize(this.canvas.offsetWidth, this.canvas.offsetHeight);\n                return this;\n            },\n            setText: function(font, align, verticalAlign, color) {\n                font = font || '11px monospace';\n                align = align || 'center';\n                verticalAlign = verticalAlign || 'middle';\n                color = color || this.colors.black;\n                var ctx = this.ctx;\n                ctx.font = font;\n                ctx.textAlign = align;\n                ctx.textBaseline = verticalAlign;\n                ctx.fillStyle = color.toRgba();\n                return this;\n            },\n            setFill: function(color) {\n                color = color || this.colors.black;\n                var ctx = this.ctx;\n                /*\n                var my_gradient = ctx.createLinearGradient(0, 0, 0, 170);\n                my_gradient.addColorStop(0, \"black\");\n                my_gradient.addColorStop(1, \"white\");\n                ctx.fillStyle = my_gradient;\n                */\n                ctx.fillStyle = color.toRgba();\n                return this;\n            },\n            setStroke: function(color, size) {\n                color = color || this.colors.black;\n                var ctx = this.ctx;\n                size = size || 1;\n                /*            \n                var gradient=ctx.createLinearGradient(0,0,170,0);\n                gradient.addColorStop(\"0\",\"magenta\");\n                gradient.addColorStop(\"0.5\",\"blue\");\n                gradient.addColorStop(\"1.0\",\"red\");\n                ctx.strokeStyle = gradient;\n                */\n                // Fill with gradient\n                ctx.strokeStyle = color.toRgba();\n                ctx.lineWidth = size;\n                return this;\n            },\n            /*\n            drawRoundRect: function (rect, r) {\n                rect = rect || this.rect;\n                Shape.roundRect(this, rect, r);\n                return this;\n            },\n            */\n            fillText: function(text, point, width, post, maxLength) {\n                if (width) {\n                    post = post || '';\n                    maxLength = maxLength || Math.floor(width / 8);\n                    if (text.length > maxLength) {\n                        text = text.substr(0, Math.min(text.length, maxLength)).trim() + post;\n                    }\n                }\n                this.ctx.fillText(text, point.x, point.y);\n                return this;\n            },\n            fillRect: function(rect) {\n                rect = rect || this.rect;\n                var ctx = this.ctx,\n                    x = rect.x,\n                    y = rect.y,\n                    w = rect.w,\n                    h = rect.h;\n                ctx.fillRect(x, y, w, h);\n                return this;\n            },\n            strokeRect: function(rect) {\n                rect = rect || this.rect;\n                var ctx = this.ctx,\n                    x = rect.x,\n                    y = rect.y,\n                    w = rect.w,\n                    h = rect.h;\n                ctx.strokeRect(x, y, w, h);\n                return this;\n            },\n            fill: function() {\n                this.ctx.fill();\n                return this;\n            },\n            stroke: function() {\n                this.ctx.stroke();\n                return this;\n            },\n            begin: function() {\n                this.ctx.beginPath();\n                return this;\n            },\n            close: function() {\n                this.ctx.closePath();\n                return this;\n            },\n            save: function() {\n                this.ctx.save();\n                return this;\n            },\n            restore: function() {\n                this.ctx.restore();\n                return this;\n            },\n            rotate: function(angle) {\n                this.ctx.rotate(angle * Math.PI / 180);\n            },\n            translate: function(xy) {\n                this.ctx.translate(xy.x, xy.y);\n            },\n            toDataURL: function() {\n                return this.canvas.toDataURL();\n            },\n            draw: function(image, t, pre) {\n                if (image) {\n                    t.w = t.w || image.width;\n                    t.h = t.h || image.height;\n                    var ctx = this.ctx,\n                        rect = this.drawingRect,\n                        x = rect.x = t.x - t.w / 2,\n                        y = rect.y = t.y - t.h / 2,\n                        w = rect.w = t.w,\n                        h = rect.h = t.h;\n                    ctx.save();\n                    ctx.translate(x, y);\n                    if (pre) {\n                        pre.call(this);\n                    }\n                    ctx.drawImage(image, 0, 0);\n                    ctx.restore();\n                    // console.log('painter.draw', x, y, w, h);\n                }\n                return this;\n            },\n            drawRect: function(image, s, t, pre) {\n                if (image) {\n                    s.w = s.w || image.width;\n                    s.h = s.h || image.height;\n                    t.w = t.w || image.width;\n                    t.h = t.h || image.height;\n                    var ctx = this.ctx,\n                        rect = this.drawingRect,\n                        x = rect.x = t.x - s.w / 2,\n                        y = rect.y = t.y - s.h / 2,\n                        w = rect.w = t.w,\n                        h = rect.h = t.h;\n                    ctx.save();\n                    ctx.translate(x, y);\n                    if (pre) {\n                        pre.call(this);\n                    }\n                    ctx.drawImage(image, s.x, s.y, s.w, s.h, 0, 0, t.w, t.h);\n                    ctx.restore();\n                    // console.log('painter.drawRect', x, y, w, h);\n                }\n                return this;\n            },\n            flip: function(scale) {\n                scale = scale || { x: 1, y: -1 };\n                var ctx = this.ctx,\n                    rect = this.drawingRect;\n                ctx.translate(scale.x === -1 ? rect.w : 0, scale.y === -1 ? rect.h : 0);\n                ctx.scale(scale.x, scale.y);\n            },\n        };\n        return Painter;\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.directive('controlMessages', [function() {\n        return {\n            restrict: 'E',\n            templateUrl: 'artisan/forms/messages',\n            transclude: {\n                'message': '?messageItems',\n            },\n            link: function(scope, element, attributes, model) {}\n        };\n    }]);\n\n    app.directive('control', ['$parse', function($parse) {\n        function formatLabel(string, prepend, expression) {\n            string = string || '';\n            prepend = prepend || '';\n            var splitted = string.split(',');\n            if (splitted.length > 1) {\n                var formatted = splitted.shift();\n                angular.forEach(splitted, function(value, index) {\n                    if (expression) {\n                        formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n                    } else {\n                        formatted = formatted.split('{' + index + '}').join(prepend + value);\n                    }\n                });\n                if (expression) {\n                    return '\\'' + formatted + '\\'';\n                } else {\n                    return formatted;\n                }\n            } else {\n                return prepend + string;\n            }\n        }\n        var uniqueId = 0;\n        return {\n            restrict: 'A',\n            templateUrl: function(element, attributes) {\n                var template = 'artisan/forms/text';\n                switch (attributes.control) {\n                    case 'select':\n                        template = 'artisan/forms/select';\n                        break;\n                }\n                return template;\n            },\n            scope: {\n                ngModel: '=',\n                required: '=',\n                form: '@',\n                title: '@',\n                placeholder: '@',\n                source: '=?',\n                key: '@?',\n                label: '@?',\n            },\n            require: 'ngModel',\n            transclude: true,\n            link: {\n                pre: function preLink(scope, element, attributes, controller, transclude) {\n                    var label = scope.label = (scope.label ? scope.label : 'name');\n                    var key = scope.key = (scope.key ? scope.key : 'id');\n                    if (attributes.control === 'select') {\n                        var filter = (attributes.filter ? '| ' + attributes.filter : '');\n                        var optionLabel = formatLabel(label, 'item.', true);\n                        scope.getOptions = function() {\n                            return attributes.number ?\n                                'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in source ' + filter :\n                                optionLabel + ' disable when item.disabled for item in source ' + filter + ' track by item.' + key;\n                        };\n                    }\n                    var type = scope.type = attributes.control;\n                    var form = scope.form = scope.form || 'form';\n                    var title = scope.title = scope.title || 'untitled';\n                    var placeholder = scope.placeholder = scope.placeholder || title;\n                    var field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\n                    scope.format = attributes.format || null;\n                    scope.precision = attributes.precision || null;\n                    scope.validate = attributes.validate || attributes.control;\n                    scope.minLength = attributes.minLength || 0;\n                    scope.maxLength = attributes.maxLength || Number.POSITIVE_INFINITY;\n                    scope.min = attributes.min || null;\n                    scope.max = attributes.max || null;\n                    scope.options = $parse(attributes.options)(scope) || {};\n                    scope.focus = false;\n                    scope.visible = false;\n                    scope.onChange = function(model) {\n                        $parse(attributes.onChange)(scope.$parent);\n                    };\n                    scope.onFilter = function(model) {\n                        $parse(attributes.onFilter)(scope.$parent);\n                    };\n                    scope.getType = function() {\n                        var type = 'text';\n                        switch (attributes.control) {\n                            case 'password':\n                                type = scope.visible ? 'text' : 'password';\n                                break;\n                            default:\n                                type = attributes.control;\n                        }\n                        return type;\n                    };\n                    scope.getClasses = function() {\n                        var form = $parse(scope.form)(scope.$parent);\n                        var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n                        return {\n                            'control-focus': scope.focus,\n                            'control-success': field.$valid,\n                            'control-error': field.$invalid && (form.$submitted || field.$touched),\n                            'control-empty': !field.$viewValue\n                        };\n                    };\n                    scope.getMessages = function() {\n                        var form = $parse(scope.form)(scope.$parent);\n                        var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n                        return (form.$submitted || field.$touched) && field.$error;\n                    };\n                    scope.toggleVisibility = function() {\n                        scope.visible = !scope.visible;\n                    };\n                },\n            },\n        };\n    }]);\n\n    app.directive('_control', ['$http', '$templateCache', '$compile', '$parse', function($http, $templateCache, $compile, $parse) {\n        function formatLabel(string, prepend, expression) {\n            string = string || '';\n            prepend = prepend || '';\n            var splitted = string.split(',');\n            if (splitted.length > 1) {\n                var formatted = splitted.shift();\n                angular.forEach(splitted, function(value, index) {\n                    if (expression) {\n                        formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\n                    } else {\n                        formatted = formatted.split('{' + index + '}').join(prepend + value);\n                    }\n                });\n                if (expression) {\n                    return '\\'' + formatted + '\\'';\n                } else {\n                    return formatted;\n                }\n            } else {\n                return prepend + string;\n            }\n        }\n        var uniqueId = 0;\n        return {\n            restrict: 'A',\n            templateUrl: function(element, attributes) {\n                var template = 'artisan/forms/text';\n                switch (attributes.control) {\n                    case 'select':\n                        template = 'artisan/forms/select';\n                        break;\n                }\n                return template;\n            },\n            scope: {\n                ngModel: '=',\n                required: '=',\n                form: '@',\n                title: '@',\n                placeholder: '@',\n            },\n            require: 'ngModel',\n            /*\n            link: function(scope, element, attributes, model) {\n            },\n            */\n            compile: function(element, attributes) {\n                    return {\n                        pre: function(scope, element, attributes) {\n                            if (attributes.control === 'select') {\n                                var label = (attributes.label ? attributes.label : 'name');\n                                var key = (attributes.key ? attributes.key : 'id');\n                                var filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\n                                var optionLabel = formatLabel(label, 'item.', true);\n                                scope.options = attributes.number ?\n                                    'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter :\n                                    optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter + ' track by item.' + key;\n                                console.log('control.compile.pre', scope.options);\n                            }\n                            var type = scope.type = attributes.control;\n                            var form = scope.form = scope.form || 'form';\n                            var title = scope.title = scope.title || 'untitled';\n                            var placeholder = scope.placeholder = scope.placeholder || title;\n                            var field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\n                            scope.validate = attributes.validate || attributes.control;\n                            scope.format = attributes.format || null;\n                            scope.precision = attributes.precision || null;\n                            scope.validate = attributes.validate || attributes.control;\n                            scope.minLength = attributes.min || 0;\n                            scope.maxLength = attributes.max || Number.POSITIVE_INFINITY;\n                            scope.options = $parse(attributes.options)(scope) || {};\n                            scope.focus = false;\n                            scope.visible = false;\n                            scope.getType = function() {\n                                var type = 'text';\n                                switch (attributes.control) {\n                                    case 'password':\n                                        // var form = $parse(scope.form)(scope.$parent);\n                                        // var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n                                        type = scope.visible ? 'text' : 'password';\n                                        break;\n                                    default:\n                                        type = attributes.control;\n                                }\n                                // console.log('control.getType', type);\n                                return type;\n                            };\n                            scope.getClasses = function() {\n                                var form = $parse(scope.form)(scope.$parent);\n                                var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n                                return {\n                                    'control-focus': scope.focus,\n                                    'control-success': field.$valid,\n                                    'control-error': field.$invalid && (form.$submitted || field.$touched),\n                                    'control-empty': !field.$viewValue\n                                };\n                            };\n                            scope.getMessages = function() {\n                                var form = $parse(scope.form)(scope.$parent);\n                                var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\n                                return (form.$submitted || field.$touched) && field.$error;\n                            };\n                        },\n                        // post: function (scope, element, attributes) { }\n                    };\n                }\n                /*\n                compile: function(element, attributes) {\n                    element.removeAttr('my-dir'); \n                    element.attr('ng-hide', 'true');\n                    return function(scope) {\n                        $compile(element)(scope);\n                    };\n                },\n                */\n        };\n    }]);\n\n    app.directive('numberPicker', ['$parse', '$timeout', function($parse, $timeout) {\n        return {\n            restrict: 'A',\n            template: '<div class=\"input-group\">' +\n                '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">-</button></span>' +\n                '   <div ng-transclude></div>' +\n                '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">+</button></span>' +\n                '</div>',\n            replace: true,\n            transclude: true,\n            link: function(scope, element, attributes, model) {\n                var node = element[0];\n                var nodeRemove = node.querySelectorAll('.input-group-btn > .btn')[0];\n                var nodeAdd = node.querySelectorAll('.input-group-btn > .btn')[1];\n\n                function onRemove(e) {\n                    var min = $parse(attributes.min)(scope);\n                    var getter = $parse(attributes.numberPicker);\n                    var setter = getter.assign;\n                    $timeout(function() {\n                        setter(scope, Math.max(min, getter(scope) - 1));\n                    });\n                    // console.log('numberPicker.onRemove', min);\n                }\n\n                function onAdd(e) {\n                    var max = $parse(attributes.max)(scope);\n                    var getter = $parse(attributes.numberPicker);\n                    var setter = getter.assign;\n                    $timeout(function() {\n                        setter(scope, Math.min(max, getter(scope) + 1));\n                    });\n                    // console.log('numberPicker.onAdd', max);\n                }\n\n                function addListeners() {\n                    angular.element(nodeRemove).on('touchstart mousedown', onRemove);\n                    angular.element(nodeAdd).on('touchstart mousedown', onAdd);\n                }\n\n                function removeListeners() {\n                    angular.element(nodeRemove).off('touchstart mousedown', onRemove);\n                    angular.element(nodeAdd).off('touchstart mousedown', onAdd);\n                }\n                scope.$on('$destroy', function() {\n                    removeListeners();\n                });\n                addListeners();\n            }\n        };\n    }]);\n\n}());\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.directive('validate', ['$filter', function($filter) {\n        return {\n            require: 'ngModel',\n            link: function(scope, element, attributes, model) {\n                var type = attributes.validate;\n                var format = attributes.format || '';\n                var precision = attributes.precision || 2;\n                var focus = false;\n                // console.log('validate', type);\n                switch (type) {\n                    case 'date':\n                    case 'datetime':\n                    case 'datetime-local':\n                        model.$formatters.push(function(value) {\n                            if (value) {\n                                return $filter('date')(value, format);\n                            } else {\n                                return null;\n                            }\n                        });\n                        break;\n                    case 'number':\n                        model.$parsers.unshift(function(value) {\n                            var valid = false;\n                            if (value !== undefined && value !== \"\") {\n                                valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \n                                value = Number(value);\n                                model.$setValidity('number', valid);\n                                if (valid) {\n                                    model.$setValidity('positive', value >= 0.01);\n                                    if (attributes.min !== undefined) {\n                                        model.$setValidity('range', value >= Number(attributes.min));\n                                    }\n                                    if (attributes.max !== undefined) {\n                                        model.$setValidity('range', value <= Number(attributes.max));\n                                    }\n                                }\n                            } else {\n                                valid = true;\n                                value = Number(value);\n                                model.$setValidity('number', true);\n                                model.$setValidity('positive', true);\n                                if (attributes.min !== undefined) {\n                                    model.$setValidity('range', true);\n                                }\n                                if (attributes.max !== undefined) {\n                                    model.$setValidity('range', true);\n                                }\n                            }\n                            return value;\n                        });\n                        model.$formatters.push(function(value) {\n                            if (value) {\n                                return $filter('number')(value, precision) + ' ' + format;\n                            } else {\n                                return null;\n                            }\n                        });\n                        break;\n                    case 'anynumber':\n                        model.$parsers.unshift(function(value) {\n                            var valid = false;\n                            if (value !== undefined && value !== \"\") {\n                                valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \n                                value = Number(value);\n                                model.$setValidity('number', valid);\n                                if (valid) {\n                                    if (attributes.min !== undefined) {\n                                        model.$setValidity('range', value >= Number(attributes.min));\n                                    }\n                                    if (attributes.max !== undefined) {\n                                        model.$setValidity('range', value <= Number(attributes.max));\n                                    }\n                                }\n                            } else {\n                                valid = true;\n                                value = Number(value);\n                                model.$setValidity('number', true);\n                                if (attributes.min !== undefined) {\n                                    model.$setValidity('range', true);\n                                }\n                                if (attributes.max !== undefined) {\n                                    model.$setValidity('range', true);\n                                }\n                            }\n                            return value;\n                        });\n                        model.$formatters.push(function(value) {\n                            if (value || value === 0) {\n                                return $filter('number')(value, precision) + ' ' + format;\n                            } else {\n                                return null;\n                            }\n                        });\n                        break;\n                }\n\n                function onFocus() {\n                    focus = true;\n                    if (format) {\n                        element[0].value = model.$modelValue || null;\n                        if (!model.$modelValue) {\n                            model.$setViewValue(null);\n                        }\n                    }\n                }\n\n                function doBlur() {\n                    if (format && !model.$invalid) {\n                        switch (type) {\n                            case 'date':\n                            case 'datetime':\n                            case 'datetime-local':\n                                element[0].value = model.$modelValue ? $filter('date')(model.$modelValue, format) : ' ';\n                                break;\n                            default:\n                                element[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\n                                break;\n                        }\n                    }\n                }\n\n                function onBlur() {\n                    focus = false;\n                    doBlur();\n                }\n\n                function addListeners() {\n                    element.on('focus', onFocus);\n                    element.on('blur', onBlur);\n                }\n\n                function removeListeners() {\n                    element.off('focus', onFocus);\n                    element.off('blur', onBlur);\n                }\n                scope.$on('$destroy', function() {\n                    removeListeners();\n                });\n                addListeners();\n            }\n        };\n    }]);\n\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.directive('modalView', ['$parse', '$templateRequest', '$compile', '$controller', 'Utils', function($parse, $templateRequest, $compile, $controller, Utils) {\r\n\r\n        function compileController(scope, element, html, data) {\r\n            // console.log('modalView.compileController', element);\r\n            element.html(html);\r\n            var link = $compile(element.contents());\r\n            if (data.controller) {\r\n                var $scope = scope.$new();\r\n                angular.extend($scope, data);\r\n                var controller = $controller(data.controller, { $scope: $scope });\r\n                if (data.controllerAs) {\r\n                    scope[data.controllerAs] = controller;\r\n                }\r\n                element.data('$ngControllerController', controller);\r\n                element.children().data('$ngControllerController', controller);\r\n                scope = $scope;\r\n            }\r\n            link(scope);\r\n        }\r\n\r\n        return {\r\n            restrict: 'A',\r\n            priority: -400,\r\n            link: function(scope, element, attributes, model) {\r\n                var modal = $parse(attributes.modalView);\r\n                modal = modal(scope);\r\n                modal.templateUrl = modal.templateUrl || 'artisan/modals/modal';\r\n                $templateRequest(modal.templateUrl).then(function(html) {\r\n                    compileController(scope, element, html, modal);\r\n                });\r\n                /*\r\n                // window.scrollTo(0, element[0].offsetTop - 100);\r\n                function onClick(e) {\r\n                    var closest = Utils.getClosestElement(e.target, element[0]);\r\n                    if (closest === null) {\r\n                        modal.reject(null);\r\n                    }\r\n                    // console.log('onClick', closest);\r\n                }\r\n                function addListeners() {\r\n                    angular.element(window).on('click', onClick);\r\n                }\r\n                function removeListeners() {\r\n                    angular.element(window).off('click', onClick);\r\n                }\r\n                scope.$on('destroy', function () {\r\n                    removeListeners();\r\n                });\r\n                setTimeout(function () {\r\n                    addListeners();\r\n                }, 500);\r\n                */\r\n            }\r\n        };\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.provider('$modal', [function $modalProvider() {\r\n\r\n        var modals = [];\r\n        var routes = {};\r\n\r\n        this.modals = modals;\r\n        this.routes = routes;\r\n        this.when = when;\r\n\r\n        function when(path, modal) {\r\n            routes[path] = modal;\r\n            return this;\r\n        }\r\n\r\n        this.$get = ['$q', '$timeout', function modalFactory($q, $timeout) {\r\n\r\n            function popModal(modal) {\r\n                // console.log('modalProvider.popModal', modal);                \r\n                var index = -1;\r\n                angular.forEach(modals, function(m, i) {\r\n                    if (m === modal) {\r\n                        index = i;\r\n                    }\r\n                });\r\n                if (index !== -1) {\r\n                    $timeout(function() {\r\n                        modal.active = false;\r\n                        modals.splice(index, 1);\r\n                        if (modals.length) {\r\n                            modals[modals.length - 1].active = true;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n\r\n            function closeModal(modal) {\r\n                // console.log('modalProvider.closeModal', modal);                \r\n                var index = -1;\r\n                angular.forEach(modals, function(m, i) {\r\n                    if (m === modal) {\r\n                        index = i;\r\n                    }\r\n                });\r\n                if (index !== -1) {\r\n                    modal.active = false;\r\n                    $timeout(function() {\r\n                        while (modals.length) {\r\n                            modals.splice(modals.length - 1, 1);\r\n                        }\r\n                    }, 500);\r\n                }\r\n            }\r\n\r\n            function addModal(path, params) {\r\n                // console.log('modalProvider.addModal', path, params);\r\n                var deferred = $q.defer();\r\n                params = params || null;\r\n                var modal = {\r\n                    title: 'Untitled',\r\n                    controller: null,\r\n                    templateUrl: null,\r\n                    params: params,\r\n                };\r\n                var current = routes[path];\r\n                if (current) {\r\n                    angular.extend(modal, current);\r\n                }\r\n                modal.deferred = deferred;\r\n                modal.back = function(data) {\r\n                    popModal(this);\r\n                    modal.deferred.resolve(data, modal);\r\n                }\r\n                modal.resolve = function(data) {\r\n                    closeModal(this);\r\n                    modal.deferred.resolve(data, modal);\r\n                }\r\n                modal.reject = function() {\r\n                    closeModal(this);\r\n                    modal.deferred.reject(modal);\r\n                }\r\n                modals.push(modal);\r\n                angular.forEach(modals, function(m, i) {\r\n                    m.active = false;\r\n                });\r\n                if (modals.length) {\r\n                    modal.active = true;\r\n                } else {\r\n                    $timeout(function() {\r\n                        modal.active = true;\r\n                        // window.scrollTo(0, 0);\r\n                    }, 500);\r\n                }\r\n                return deferred.promise;\r\n            }\r\n\r\n            return {\r\n                modals: modals,\r\n                addModal: addModal,\r\n            };\r\n        }];\r\n\r\n    }]);\r\n\r\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.directive('nav', ['$parse', 'Nav', function ($parse, Nav) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function (element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/nav/nav';\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\titems: '=nav',\n\t\t\t},\n\t\t\tlink: function (scope, element, attributes, model) {\n\t\t\t\tscope.$watch('items', function (value) {\n\t\t\t\t\t// console.log(value instanceof Nav, value);\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tif (angular.isArray(value)) {\n\t\t\t\t\t\t\tvar onLink = $parse(attributes.onLink)(scope.$parent);\n\t\t\t\t\t\t\tvar onNav = $parse(attributes.onNav)(scope.$parent);\n\t\t\t\t\t\t\tvar nav = new Nav({\n\t\t\t\t\t\t\t\tonLink: onLink,\n\t\t\t\t\t\t\t\tonNav: onNav\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tnav.setItems(value);\n\t\t\t\t\t\t\tscope.item = nav;\n\n\t\t\t\t\t\t} else if (value instanceof Nav) {\n\t\t\t\t\t\t\tscope.item = value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t};\n    }]);\n\n\tapp.directive('navItem', ['$timeout', function ($timeout) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\ttemplateUrl: function (element, attributes) {\n\t\t\t\treturn attributes.template || 'artisan/nav/nav-item';\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\titem: '=navItem',\n\t\t\t},\n\t\t\tlink: function (scope, element, attributes, model) {\n\t\t\t\tvar navItem = angular.element(element[0].querySelector('.nav-link'));\n\n\t\t\t\tvar output;\n\n\t\t\t\tfunction itemOpen(item, immediate) {\n\t\t\t\t\tvar state = item.$nav.state;\n\t\t\t\t\tstate.active = true;\n\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\tstate.immediate = immediate;\n\t\t\t\t\t\tstate.closed = state.closing = false;\n\t\t\t\t\t\tstate.opening = true;\n\t\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t\tstate.opening = false;\n\t\t\t\t\t\t\tstate.opened = true;\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction itemClose(item, immediate) {\n\t\t\t\t\tvar state = item.$nav.state;\n\t\t\t\t\tstate.active = false;\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\tstate.immediate = immediate;\n\t\t\t\t\t\tstate.opened = state.opening = false;\n\t\t\t\t\t\tstate.closing = true;\n\t\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t\tstate.closing = false;\n\t\t\t\t\t\t\tstate.closed = true;\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tif (item.items) {\n\t\t\t\t\t\tangular.forEach(item.items, function (o) {\n\t\t\t\t\t\t\titemClose(o, true);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction itemToggle(item) {\n\t\t\t\t\t// console.log('itemToggle', item);\n\t\t\t\t\tvar state = item.$nav.state;\n\t\t\t\t\tstate.active = item.items ? !state.active : true;\n\t\t\t\t\tif (state.active) {\n\t\t\t\t\t\tif (item.$nav.parent) {\n\t\t\t\t\t\t\tangular.forEach(item.$nav.parent.items, function (o) {\n\t\t\t\t\t\t\t\tif (o !== item) {\n\t\t\t\t\t\t\t\t\titemClose(o, true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\titemOpen(item);\n\t\t\t\t\t} else {\n\t\t\t\t\t\titemClose(item);\n\t\t\t\t\t}\n\t\t\t\t\t// console.log(state);\n\t\t\t\t}\n\n\t\t\t\tfunction onTap(e) {\n\t\t\t\t\tvar item = scope.item;\n\t\t\t\t\t// console.log('Item.onTap', item);\n\t\t\t\t\tvar state = item.$nav.state;\n\t\t\t\t\tif (state.active) {\n\t\t\t\t\t\toutput = false;\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t} else if (item.$nav.onNav) {\n\t\t\t\t\t\tvar promise = item.$nav.onNav(item, item.$nav);\n\t\t\t\t\t\tif (promise && typeof promise.then === 'function') {\n\t\t\t\t\t\t\tpromise.then(function (resolved) {\n\t\t\t\t\t\t\t\t// go on\n\t\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t\t}, function (rejected) {\n\t\t\t\t\t\t\t\t// do nothing\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\toutput = false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toutput = promise;\n\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction trigger() {\n\t\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t\titemToggle(item);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction onTouchStart(e) {\n\t\t\t\t\t// console.log('Item.onTouchStart', e);\n\t\t\t\t\tonTap(e);\n\t\t\t\t\tnavItem\n\t\t\t\t\t\t.off('mousedown', onMouseDown);\n\t\t\t\t\t// return r || prevent(e);\n\t\t\t\t}\n\n\t\t\t\tfunction onMouseDown(e) {\n\t\t\t\t\t// console.log('Item.onMouseDown', e);\n\t\t\t\t\tonTap(e);\n\t\t\t\t\tnavItem\n\t\t\t\t\t\t.off('touchstart', onTouchStart);\n\t\t\t\t\t// return r || prevent(e);\n\t\t\t\t}\n\n\t\t\t\tfunction onClick(e) {\n\t\t\t\t\t// console.log('Item.onClick', e);\n\t\t\t\t\treturn prevent(e);\n\t\t\t\t}\n\n\t\t\t\tfunction prevent(e) {\n\t\t\t\t\tif (output === false) {\n\t\t\t\t\t\t// console.log('Item.prevent', e);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t// e.stopPropagation();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction addListeners() {\n\t\t\t\t\tnavItem\n\t\t\t\t\t\t.on('touchstart', onTouchStart)\n\t\t\t\t\t\t.on('mousedown', onMouseDown)\n\t\t\t\t\t\t.on('click', onClick);\n\t\t\t\t}\n\n\t\t\t\tfunction removeListeners() {\n\t\t\t\t\tnavItem\n\t\t\t\t\t\t.off('touchstart', onTouchStart)\n\t\t\t\t\t\t.off('mousedown', onMouseDown)\n\t\t\t\t\t\t.off('click', onClick);\n\t\t\t\t}\n\n\t\t\t\taddListeners();\n\n\t\t\t\tscope.$on('$destroy', function () {\n\t\t\t\t\tremoveListeners();\n\t\t\t\t});\n\t\t\t}\n\t\t};\n    }]);\n\n}());\n\n/* global angular */\n\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    app.factory('Nav', ['$silent', function($silent) {\n        function Nav(options) {\n            var nav = this;\n            var defaults = {\n                items: [],\n            }\n            angular.extend(nav, defaults);\n            if (options) {\n                angular.extend(nav, options);\n            }\n            nav.setNav(nav, null);\n        }\n        Nav.prototype = {\n            setItems: function(items) {\n                var nav = this;\n                nav.path = $silent.path();\n                nav.items = items;\n                nav.setNavs(items, nav);\n            },\n            setNavs: function(items, parent) {\n                var nav = this;\n                if (items) {\n                    angular.forEach(items, function(item) {\n                        nav.setNav(item, parent);\n                        nav.setNavs(item.items, item);\n                    });\n                }\n            },\n            setNav: function(item, parent) {\n                var nav = this;\n                var $nav = {\n                    parent: parent || null,\n                    level: parent ? parent.$nav.level + 1 : 0,\n                    state: {},\n                    addItems: function(x) {\n                        nav.addItems(x, item);\n                    },\n                    onNav: nav.onNav,\n                };\n                item.$nav = $nav;\n                $nav.link = nav.getLink(item);\n                if ($nav.link === nav.path) {\n                    $nav.state.active = true;\n                    $nav.state.opened = true;\n                    while ($nav.parent) {\n                        $nav = $nav.parent.$nav;\n                        $nav.state.active = true;\n                        $nav.state.opened = true;\n                    }\n                }\n            },\n            addItems: function(itemOrItems, parent) {\n                var nav = this;\n                if (angular.isArray(itemOrItems)) {\n                    angular.forEach(itemOrItems, function(item) {\n                        nav.addItem(item, parent);\n                    });\n                } else {\n                    nav.addItem(itemOrItems, parent);\n                }\n            },\n            addItem: function(item, parent) {\n                var nav = this,\n                    onLink = nav.onLink,\n                    onNav = nav.onNav;\n                nav.setNav(item, parent);\n                if (parent) {\n                    parent.items = parent.items || [];\n                    parent.items.push(item);\n                }\n            },\n            getLink: function(item) {\n                var link = null;\n                if (this.onLink) {\n                    link = this.onLink(item, item.$nav);\n                } else {\n                    link = item.link;\n                }\n                return link;\n            },\n        };\n        var statics = {\n            silent: function(path) {\n                $silent.silent(path);\n            },\n            path: function(path) {\n                $silent.path(path);\n            },\n        };\n        angular.extend(Nav, statics);\n        return Nav;\n    }]);\n\n}());\n/* global angular */\n\n(function () {\n\t\"use strict\";\n\n\tvar app = angular.module('artisan');\n\n\tapp.factory('Events', [function () {\n\n\t\tfunction Event(e, element) {\n\t\t\tvar documentNode = (document.documentElement || document.body.parentNode || document.body);\n\t\t\tvar scroll = {\n\t\t\t\tx: window.pageXOffset || documentNode.scrollLeft,\n\t\t\t\ty: window.pageYOffset || documentNode.scrollTop\n\t\t\t};\n\t\t\tif (e.type === 'resize') {\n\t\t\t\tvar view = {\n\t\t\t\t\tw: this.getWidth(),\n\t\t\t\t\th: this.getHeight(),\n\t\t\t\t};\n\t\t\t\tthis.view = view;\n\t\t\t}\n\t\t\tvar node = getNode(element);\n\t\t\tvar offset = {\n\t\t\t\tx: node.offsetLeft,\n\t\t\t\ty: node.offsetTop,\n\t\t\t};\n\t\t\tvar rect = node.getBoundingClientRect();\n\t\t\tvar page = this.getPage(e);\n\t\t\tif (page) {\n\t\t\t\tvar relative = {\n\t\t\t\t\tx: page.x - scroll.x - rect.left,\n\t\t\t\t\ty: page.y - scroll.y - rect.top,\n\t\t\t\t};\n\t\t\t\tvar absolute = {\n\t\t\t\t\tx: page.x - scroll.x,\n\t\t\t\t\ty: page.y - scroll.y,\n\t\t\t\t};\n\t\t\t\tthis.relative = relative;\n\t\t\t\tthis.absolute = absolute;\n\t\t\t}\n\t\t\tif (this.type === 'resize') {\n\t\t\t\tconsole.log(this.type);\n\t\t\t}\n\t\t\tthis.originalEvent = e;\n\t\t\tthis.element = element;\n\t\t\tthis.node = node;\n\t\t\tthis.offset = offset;\n\t\t\tthis.rect = rect;\n\t\t\t// console.log('Event', 'page', page, 'scroll', scroll, 'offset', offset, 'rect', rect, 'relative', relative, 'absolute', absolute);\n\t\t\t// console.log('scroll.y', scroll.y, 'page.y', page.y, 'offset.y', offset.y, 'rect.top', rect.top);\n\t\t}\n\t\tEvent.prototype = {\n\t\t\tgetPage: getPage,\n\t\t\tgetWidth: getWidth,\n\t\t\tgetHeight: getHeight,\n\t\t};\n\n\t\tfunction getWidth() {\n\t\t\tif (self.innerWidth) {\n\t\t\t\treturn self.innerWidth;\n\t\t\t}\n\t\t\tif (document.documentElement && document.documentElement.clientWidth) {\n\t\t\t\treturn document.documentElement.clientWidth;\n\t\t\t}\n\t\t\tif (document.body) {\n\t\t\t\treturn document.body.clientWidth;\n\t\t\t}\n\t\t}\n\n\t\tfunction getHeight() {\n\t\t\tif (self.innerHeight) {\n\t\t\t\treturn self.innerHeight;\n\t\t\t}\n\t\t\tif (document.documentElement && document.documentElement.clientHeight) {\n\t\t\t\treturn document.documentElement.clientHeight;\n\t\t\t}\n\t\t\tif (document.body) {\n\t\t\t\treturn document.body.clientHeight;\n\t\t\t}\n\t\t}\n\n\t\tfunction getPage(e) {\n\t\t\tvar standardEvents = ['click', 'mousedown', 'mouseup', 'mousemove', 'mouseover', 'mouseout', 'mouseenter', 'mouseleave', 'contextmenu'];\n\t\t\tvar touchEvents = ['touchstart', 'touchmove', 'touchend', 'touchcancel'];\n\t\t\tvar page = null;\n\t\t\tif (touchEvents.indexOf(e.type) !== -1) {\n\t\t\t\tvar t = null;\n\t\t\t\tvar event = e.originalEvent ? e.originalEvent : e;\n\t\t\t\tvar touches = event.touches.length ? event.touches : event.changedTouches;\n\t\t\t\tif (touches && touches.length) {\n\t\t\t\t\tt = touches[0];\n\t\t\t\t}\n\t\t\t\tif (t) {\n\t\t\t\t\tpage = {\n\t\t\t\t\t\tx: t.pageX,\n\t\t\t\t\t\ty: t.pageY,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t} else if (standardEvents.indexOf(e.type) !== -1) {\n\t\t\t\tpage = {\n\t\t\t\t\tx: e.pageX,\n\t\t\t\t\ty: e.pageY,\n\t\t\t\t};\n\t\t\t}\n\t\t\tthis.type = e.type;\n\t\t\treturn page;\n\t\t}\n\n\t\tfunction Events(element) {\n\t\t\tthis.element = element;\n\t\t\tthis.listeners = {};\n\t\t\tthis.standardEvents = {\n\t\t\t\tclick: {\n\t\t\t\t\tkey: 'click',\n\t\t\t\t\tcallback: onClick\n\t\t\t\t},\n\t\t\t\tdown: {\n\t\t\t\t\tkey: 'mousedown',\n\t\t\t\t\tcallback: onMouseDown\n\t\t\t\t},\n\t\t\t\tmove: {\n\t\t\t\t\tkey: 'mousemove',\n\t\t\t\t\tcallback: onMouseMove\n\t\t\t\t},\n\t\t\t\tup: {\n\t\t\t\t\tkey: 'mouseup',\n\t\t\t\t\tcallback: onMouseUp\n\t\t\t\t},\n\t\t\t\tresize: {\n\t\t\t\t\tkey: 'resize',\n\t\t\t\t\tcallback: onResize\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis.touchEvents = {\n\t\t\t\tdown: {\n\t\t\t\t\tkey: 'touchstart',\n\t\t\t\t\tcallback: onTouchStart\n\t\t\t\t},\n\t\t\t\tmove: {\n\t\t\t\t\tkey: 'touchmove',\n\t\t\t\t\tcallback: onTouchMove\n\t\t\t\t},\n\t\t\t\tup: {\n\t\t\t\t\tkey: 'touchend',\n\t\t\t\t\tcallback: onTouchEnd\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tvar events = this;\n\n\t\t\tfunction onClick(e) {\n\t\t\t\t// console.log('onClick', e, events);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.listeners.click.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onMouseDown(e) {\n\t\t\t\t// console.log('onMouseDown', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.listeners.down.apply(this, [event]);\n\t\t\t\tevents.removeTouchEvents();\n\t\t\t}\n\n\t\t\tfunction onMouseMove(e) {\n\t\t\t\t// console.log('onMouseMove', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.listeners.move.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onMouseUp(e) {\n\t\t\t\t// console.log('onMouseUp', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.listeners.up.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onResize(e) {\n\t\t\t\tconsole.log('onResize', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.listeners.resize.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onTouchStart(e) {\n\t\t\t\t// console.log('onTouchStart', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.listeners.down.apply(this, [event]);\n\t\t\t\tevents.removeStandardEvents();\n\t\t\t}\n\n\t\t\tfunction onTouchMove(e) {\n\t\t\t\t// console.log('onTouchMove', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.listeners.move.apply(this, [event]);\n\t\t\t}\n\n\t\t\tfunction onTouchEnd(e) {\n\t\t\t\t// console.log('onTouchEnd', e);\n\t\t\t\tvar event = new Event(e, events.element);\n\t\t\t\tevents.listeners.up.apply(this, [event]);\n\t\t\t}\n\t\t}\n\t\tEvents.prototype = {\n\t\t\tadd: add,\n\t\t\tremove: remove,\n\t\t\tremoveStandardEvents: removeStandardEvents,\n\t\t\tremoveTouchEvents: removeTouchEvents,\n\t\t};\n\t\treturn Events;\n\n\t\tfunction getNode(element) {\n\t\t\treturn element.length ? element[0] : element; // (element.length && (element[0] instanceOf Node || element[0] instanceOf HTMLElement)) ? element[0] : element;\n\t\t}\n\n\t\tfunction getElement(element) {\n\t\t\treturn element.length ? element : angular.element(element); // (element.length && (element[0] instanceOf Node || element[0] instanceOf HTMLElement)) ? element : angular.element(element);\n\t\t}\n\n\t\tfunction add(listeners, scope) {\n\t\t\tvar events = this,\n\t\t\t\tstandard = this.standardEvents,\n\t\t\t\ttouch = this.touchEvents;\n\t\t\tvar element = getElement(this.element),\n\t\t\t\twindowElement = angular.element(window);\n\n\t\t\tangular.forEach(listeners, function (callback, key) {\n\t\t\t\tif (events.listeners[key]) {\n\t\t\t\t\tvar listener = {};\n\t\t\t\t\tlistener[key] = events.listeners[key];\n\t\t\t\t\tremove(listener);\n\t\t\t\t}\n\t\t\t\tevents.listeners[key] = callback;\n\t\t\t\tif (standard[key]) {\n\t\t\t\t\tif (key === 'resize') {\n\t\t\t\t\t\twindowElement.on(standard[key].key, standard[key].callback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.on(standard[key].key, standard[key].callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (touch[key]) {\n\t\t\t\t\telement.on(touch[key].key, touch[key].callback);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (scope) {\n\t\t\t\tscope.$on('$destroy', function () {\n\t\t\t\t\tevents.remove(listeners);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn events;\n\t\t}\n\n\t\tfunction remove(listeners) {\n\t\t\tvar events = this,\n\t\t\t\tstandard = this.standardEvents,\n\t\t\t\ttouch = this.touchEvents;\n\t\t\tvar element = getElement(this.element),\n\t\t\t\twindowElement = angular.element(window);\n\t\t\tangular.forEach(listeners, function (callback, key) {\n\t\t\t\tif (standard[key]) {\n\t\t\t\t\tif (key === 'resize') {\n\t\t\t\t\t\twindowElement.off(standard[key].key, standard[key].callback);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.off(standard[key].key, standard[key].callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (touch[key]) {\n\t\t\t\t\telement.off(touch[key].key, touch[key].callback);\n\t\t\t\t}\n\t\t\t\tevents.listeners[key] = null;\n\t\t\t});\n\t\t\treturn events;\n\t\t}\n\n\t\tfunction removeStandardEvents() {\n\t\t\tvar events = this,\n\t\t\t\tstandard = events.standardEvents,\n\t\t\t\ttouch = events.touchEvents;\n\t\t\tvar element = getElement(events.element);\n\t\t\telement.off('mousedown', standard.down.callback);\n\t\t\telement.off('mousemove', standard.move.callback);\n\t\t\telement.off('mouseup', standard.up.callback);\n\t\t}\n\n\t\tfunction removeTouchEvents() {\n\t\t\tvar events = this,\n\t\t\t\tstandard = events.standardEvents,\n\t\t\t\ttouch = events.touchEvents;\n\t\t\tvar element = getElement(events.element);\n\t\t\telement.off('touchstart', touch.down.callback);\n\t\t\telement.off('touchmove', touch.move.callback);\n\t\t\telement.off('touchend', touch.up.callback);\n\t\t}\n\n    }]);\n\n}());\n\n/* global angular */\n(function() {\n    \"use strict\";\n\n    var app = angular.module('artisan');\n\n    // micro interactions\n\n    function tap(Events) {\n        return {\n            restrict: 'A',\n            priority: 0,\n            link: link\n        };\n\n        function link(scope, element, attributes, model) {\n            if (attributes.ngBind) {\n                return;\n            }\n            if (attributes.href === '#' && !attributes.ngHref && !attributes.ngClick) {\n                return;\n            }\n\n            element.addClass('interaction-tap');\n            var node = document.createElement('interaction');\n            element[0].appendChild(node);\n\n            function onDown(e) {\n                element.removeClass('interaction-animate');\n                void element.offsetWidth;\n                // node.style.animationPlayState = \"paused\";\n                node.style.left = e.relative.x + 'px';\n                node.style.top = e.relative.y + 'px';\n                setTimeout(function() {\n                    element.addClass('interaction-animate');\n                    setTimeout(function() {\n                        element.removeClass('interaction-animate');\n                    }, 1000);\n                }, 10);\n\n                // console.log('tap.onDown', node, node.parentElement);\n            }\n            var listeners = { // down, move, up, click\n                down: onDown,\n            };\n            var events = new Events(element).add(listeners, scope); // passing scope to add remove listeners automatically on $destroy\n        }\n    }\n    app.directive('href', ['Events', tap]);\n    app.directive('ngClick', ['Events', tap]);\n\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.factory('State', ['$timeout', function($timeout) {\r\n        var DELAY = 2000;\r\n\r\n        function State() {\r\n            this.errors = [];\r\n            this.isReady = false;\r\n            this.idle();\r\n        }\r\n\r\n        State.prototype = {\r\n            idle: function() {\r\n                var state = this;\r\n                state.isBusy = false;\r\n                state.isError = false;\r\n                state.isErroring = false;\r\n                state.isSuccess = false;\r\n                state.isSuccessing = false;\r\n                state.button = null;\r\n                state.errors = [];\r\n            },\r\n            busy: function() {\r\n                var state = this;\r\n                if (!state.isBusy) {\r\n                    state.isBusy = true;\r\n                    state.isError = false;\r\n                    state.isErroring = false;\r\n                    state.isSuccess = false;\r\n                    state.isSuccessing = false;\r\n                    state.errors = [];\r\n                    return true;\r\n                } else {\r\n                    return false;\r\n                }\r\n            },\r\n            error: function error(error) {\r\n                console.log('State.error', error);\r\n                var state = this;\r\n                state.isBusy = false;\r\n                state.isError = true;\r\n                state.isErroring = true;\r\n                state.isSuccess = false;\r\n                state.isSuccessing = false;\r\n                state.errors.push(error);\r\n                $timeout(function() {\r\n                    state.isErroring = false;\r\n                }, DELAY);\r\n            },\r\n            ready: function ready() {\r\n                var state = this;\r\n                state.idle();\r\n                state.isReady = true;\r\n            },\r\n            success: function success() {\r\n                var state = this;\r\n                state.isBusy = false;\r\n                state.isError = false;\r\n                state.isErroring = false;\r\n                state.isSuccess = true;\r\n                state.isSuccessing = true;\r\n                state.errors = [];\r\n                $timeout(function() {\r\n                    state.isSuccessing = false;\r\n                }, DELAY);\r\n            },\r\n            enabled: function enabled() {\r\n                var state = this;\r\n                return !state.isBusy && !state.isErroring && !state.isSuccessing;\r\n            },\r\n            errorMessage: function errorMessage() {\r\n                var state = this;\r\n                return state.isError ? state.errors[state.errors.length - 1] : null;\r\n            },\r\n            submitClass: function submitClass() {\r\n                var state = this;\r\n                return {\r\n                    busy: state.isBusy,\r\n                    ready: state.isReady,\r\n                    successing: state.isSuccessing,\r\n                    success: state.isSuccess,\r\n                    errorring: state.isErroring,\r\n                    error: state.isError,\r\n                };\r\n            },\r\n            labels: function labels(addons) {\r\n                var state = this;\r\n                var defaults = {\r\n                    ready: 'submit',\r\n                    busy: 'sending',\r\n                    error: 'error',\r\n                    success: 'success',\r\n                };\r\n                if (addons) {\r\n                    angular.extend(defaults, addons);\r\n                }\r\n                var label = defaults.ready;\r\n                if (state.isBusy) {\r\n                    label = defaults.busy;\r\n                } else if (state.isSuccess) {\r\n                    label = defaults.success;\r\n                } else if (state.isError) {\r\n                    label = defaults.error;\r\n                }\r\n                return label;\r\n            },\r\n            classes: function classes(addons) {\r\n                var state = this,\r\n                    classes = null;\r\n                classes = {\r\n                    ready: state.isReady,\r\n                    busy: state.isBusy,\r\n                    successing: state.isSuccessing,\r\n                    success: state.isSuccess,\r\n                    errorring: state.isErroring,\r\n                    error: state.isError,\r\n                };\r\n                if (addons) {\r\n                    angular.forEach(addons, function(value, key) {\r\n                        classes[value] = classes[key];\r\n                    });\r\n                }\r\n                return classes;\r\n            }\r\n        };\r\n\r\n        return State;\r\n    }]);\r\n\r\n}());"]}