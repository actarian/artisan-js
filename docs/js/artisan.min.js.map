{"version":3,"sources":["docs/js/artisan.js"],"names":["angular","module","factory","Animate","callback","this","key","ticks","prototype","play","loop","time","_this","window","requestAnimationFrame","pause","cancelAnimationFrame","playpause","doNOTPlay","lastTime","vendors","x","length","element","currTime","Date","getTime","timeToCall","Math","max","id","setTimeout","clearTimeout","Event","e","documentNode","document","documentElement","body","parentNode","scroll","pageXOffset","scrollLeft","y","pageYOffset","scrollTop","type","view","w","getWidth","h","getHeight","node","getNode","offset","offsetLeft","offsetTop","rect","getBoundingClientRect","page","getPage","relative","left","top","absolute","console","log","originalEvent","self","innerWidth","clientWidth","innerHeight","clientHeight","standardEvents","touchEvents","indexOf","t","event","touches","changedTouches","pageX","pageY","Events","onClick","events","listeners","click","apply","onMouseDown","down","removeTouchEvents","onMouseMove","move","onMouseUp","up","onResize","resize","onTouchStart","removeStandardEvents","onTouchMove","onTouchEnd","getElement","add","scope","standard","touch","windowElement","forEach","listener","remove","on","$on","off","addEventListener","defaults","passive","capture","supported","options","Object","defineProperty","get","original","EventTarget","usesListenerOptions","undefined","call","filter","$filter","array","filters","item","i","Point","mult","point","value","setX","setY","setPos","copy","clone","toString","Rect","reduce","size","reduceRect","offsetRect","expandRect","expand","intersect","right","bottom","center","topLeft","topRight","bottomRight","bottomLeft","setW","setH","setSize","Hash","pool","defineProperties","enumerable","writable","has","getId","hash","set","push","newItem","p","keys","oldItem","index","splice","addMany","items","removeMany","removeAll","shift","each","forward","reverse","sort","c","d","a","b","backward","differs","updatePool","pools","Array","$q","$promise","deferred","defer","promise","statics","all","promises","extend","$timeout","State","errors","isReady","idle","state","isBusy","isError","isErroring","isSuccess","isSuccessing","button","busy","error","ready","success","enabled","errorMessage","submitClass","successing","errorring","labels","addons","label","classes","transformProperty","div","createElement","style","every","prefix","Style","props","scale","hoverScale","currentScale","styles","cssText","join","transform","transformOrigin","round","app","Vector","make","sqrt","normalize","l","incidence","atan2","distance","cross","difference","power","abs","towards","friction","$compile","$controller","Utils","getTouch","previous","s","getRelativeTouch","getClosest","el","selector","matchesFn","parent","some","fn","parentElement","getClosestElement","target","throttle","func","wait","context","args","result","timeout","later","leading","getNow","now","remaining","arguments","trailing","where","query","found","compileController","html","data","link","contents","controller","$scope","$new","controllerAs","children","reverseSortOn","format","string","prepend","expression","splitted","split","formatted","reducer","o","reducerSetter","slice","reducerAdder","downloadFile","content","name","download","createEvent","anchor","href","base64","downloadName","substring","lastIndexOf","initEvent","dispatchEvent","open","blob","Blob","reader","FileReader","readAsDataURL","onloadend","serverDownload","uri","extension","JSON","stringify","form","input","appendChild","action","method","enctype","submit","removeChild","TypeError","len","k","ua","navigator","userAgent","toLowerCase","safari","msie","chrome","mobile","toMd5","Md5","encode","getElementsByTagName","addClass","Api","Doc","$location","$routeParams","environment","View","doc","url","path","params","route","current","docs","then","response","resolve","reject","service","$http","$httpPromise","urls","api","status","$get","$post","$put","$patch","$delete","$fake","post","put","patch","delete","fake","redirect","msecs","doRedirect","$$lastRequestedPath","doRetry","$rootScope","$silent","unlink","$$listeners","$locationChangeSuccess","relink","$path","silent","replace","location","unshift","$window","Cookie","TIMEOUT","_set","days","expires","date","setTime","toGMTString","cookie","exists","cookieName","ca","charAt","model","parse","decodeURIComponent","atob","cache","json","btoa","encodeURIComponent","checkCookie","elapsed","interval","LocalStorage","isSupported","localStorage","setItem","removeItem","storageEvent","newValue","SessionStorage","sessionStorage","Color","r","g","uint","parseInt","componentToHex","hex","luma","color","dot","contrast","darker","pow","min","floor","lighter","toUint","toHex","toRgba","toFixed","alpha","makeSet","foreground","border","light","Shape","shapeCircle","cx","cy","sa","ea","PI","ctx","arc","shapeStar","or","ir","steps","angle","step","moveTo","cos","sin","lineTo","shapeRoundRect","tl","tr","br","bl","defaultRadius","quadraticCurveTo","circle","beginPath","closePath","star","roundRect","constant","black","white","blue","red","lightBlue","lightYellow","greyLighter","greyLight","greyMedium","grey","map","Painter","Palette","painter","buffer","rows","getRect","row","canvas","width","height","setCanvas","drawImage","palette","isString","img","Image","onload","addShape","onerror","src","save","clip","translate","restore","draw","pre","drawRect","tint","setFill","fillRect","globalCompositeOperation","pattern","drawPattern","fillStyle","createPattern","toDataURL","PainterColors","drawingRect","setColors","colors","offsetWidth","offsetHeight","getContext","lineCap","clear","setText","font","align","verticalAlign","textAlign","textBaseline","setStroke","strokeStyle","lineWidth","fillText","text","maxLength","substr","trim","strokeRect","fill","stroke","begin","close","rotate","xy","image","flip","directive","restrict","templateUrl","transclude","message","attributes","$parse","formatLabel","uniqueId","template","control","ngModel","required","title","placeholder","source","require","optionLabel","getOptions","number","field","precision","validate","minLength","Number","POSITIVE_INFINITY","focus","visible","onChange","$parent","onFilter","getType","getClasses","control-focus","control-success","$valid","control-error","$invalid","$submitted","$touched","control-empty","$viewValue","getMessages","$error","toggleVisibility","$templateCache","compile","onRemove","getter","numberPicker","setter","assign","onAdd","removeListeners","nodeRemove","nodeAdd","querySelectorAll","onFocus","$modelValue","$setViewValue","doBlur","onBlur","$formatters","$parsers","valid","String","$setValidity","$templateRequest","priority","modal","modalView","provider","when","routes","modals","popModal","m","active","closeModal","addModal","back","Nav","$watch","isArray","onLink","onNav","nav","setItems","itemOpen","immediate","$nav","closed","closing","opening","opened","itemClose","itemToggle","onTap","trigger","output","resolved","rejected","navItem","prevent","preventDefault","querySelector","setNav","setNavs","level","addItems","getLink","itemOrItems","addItem","ondragstart","Scrollable","render","scrollable","setEnabled","isEnabled","renderX","getCurrent","contentStyle","contentNode","onDown","dragStart","dragOn","animate","onMove","dragMove","onUp","dragEnd","dragOff","_onWheel","dir","deltaY","wheelDelta","wheelX","scrollableWhen","containerNode","setContainer","setContent","onWheel","onLeft","onRight","scrollableX","showIndicatorFor","reset","doReset","attr","oldValue","container","flag","getIndicator","indicator","bounceX","end","doLeft","doRight","dragging","start","speed","wheeling","scrollToX","finally","padding","prev","methods","tap","removeClass","ngBind","ngHref","ngClick"],"mappings":"CAEC,WACG,YAEUA,SAAQC,OAAO,WAAY,KAAM,UAAW,kBAKzD,WACA,YAEUD,SAAQC,OAAO,WAErBC,QAAQ,WAAY,WAEvB,QAASC,GAAQC,GAChBC,KAAKD,SAAWA,EAChBC,KAAKC,IAAM,KACXD,KAAKE,MAAQ,EAgCd,MA9BAJ,GAAQK,WACPC,KAAM,WAGL,QAASC,GAAKC,GACbC,EAAML,QACNK,EAAMR,SAASO,EAAMC,EAAML,OAC3BK,EAAMN,IAAMO,OAAOC,sBAAsBJ,GAL1C,GAAIE,GAAQP,IAOPA,MAAKC,KACTI,KAGFK,MAAO,WACFV,KAAKC,MACRO,OAAOG,qBAAqBX,KAAKC,KACjCD,KAAKC,IAAM,OAGbW,UAAW,WACNZ,KAAKC,IACRD,KAAKU,QAELV,KAAKI,QAGPS,UAAW,WACVb,KAAKU,UAGAZ,KAGP,WAGA,IAAK,GAFDgB,GAAW,EACXC,GAAW,KAAM,MAAO,SAAU,KAC7BC,EAAI,EAAGA,EAAID,EAAQE,SAAWT,OAAOC,wBAAyBO,EACtER,OAAOC,sBAAwBD,OAAOO,EAAQC,GAAK,yBACnDR,OAAOG,qBAAuBH,OAAOO,EAAQC,GAAK,yBACjDR,OAAOO,EAAQC,GAAK,8BAEjBR,QAAOC,wBACXD,OAAOC,sBAAwB,SAAUV,EAAUmB,GAClD,GAAIC,IAAW,GAAIC,OAAOC,UACtBC,EAAaC,KAAKC,IAAI,EAAG,IAAML,EAAWL,IAC1CW,EAAKjB,OAAOkB,WAAW,WAC1B3B,EAASoB,EAAWG,IAClBA,EAEH,OADAR,GAAWK,EAAWG,EACfG,IAGJjB,OAAOG,uBACXH,OAAOG,qBAAuB,SAAUc,GACvCE,aAAaF,WAShB,WACA,YAEU9B,SAAQC,OAAO,WAErBC,QAAQ,UAAW,WAEtB,QAAS+B,GAAMC,EAAGX,GACjB,GAAIY,GAAgBC,SAASC,iBAAmBD,SAASE,KAAKC,YAAcH,SAASE,KACjFE,GACHnB,EAAGR,OAAO4B,aAAeN,EAAaO,WACtCC,EAAG9B,OAAO+B,aAAeT,EAAaU,UAEvC,IAAe,WAAXX,EAAEY,KAAmB,CACxB,GAAIC,IACHC,EAAG3C,KAAK4C,WACRC,EAAG7C,KAAK8C,YAET9C,MAAK0C,KAAOA,EAEb,GAAIK,GAAOC,EAAQ9B,GACf+B,GACHjC,EAAG+B,EAAKG,WACRZ,EAAGS,EAAKI,WAELC,EAAOL,EAAKM,wBACZC,EAAOtD,KAAKuD,QAAQ1B,EACxB,IAAIyB,EAAM,CACT,GAAIE,IACHxC,EAAGsC,EAAKtC,EAAImB,EAAOnB,EAAIoC,EAAKK,KAC5BnB,EAAGgB,EAAKhB,EAAIH,EAAOG,EAAIc,EAAKM,KAEzBC,GACH3C,EAAGsC,EAAKtC,EAAImB,EAAOnB,EACnBsB,EAAGgB,EAAKhB,EAAIH,EAAOG,EAEpBtC,MAAKwD,SAAWA,EAChBxD,KAAK2D,SAAWA,EAEC,WAAd3D,KAAKyC,MACRmB,QAAQC,IAAI7D,KAAKyC,MAElBzC,KAAK8D,cAAgBjC,EACrB7B,KAAKkB,QAAUA,EACflB,KAAK+C,KAAOA,EACZ/C,KAAKiD,OAASA,EACdjD,KAAKoD,KAAOA,EAUb,QAASR,KACR,MAAImB,MAAKC,WACDD,KAAKC,WAETjC,SAASC,iBAAmBD,SAASC,gBAAgBiC,YACjDlC,SAASC,gBAAgBiC,YAE7BlC,SAASE,KACLF,SAASE,KAAKgC,gBADtB,GAKD,QAASnB,KACR,MAAIiB,MAAKG,YACDH,KAAKG,YAETnC,SAASC,iBAAmBD,SAASC,gBAAgBmC,aACjDpC,SAASC,gBAAgBmC,aAE7BpC,SAASE,KACLF,SAASE,KAAKkC,iBADtB,GAKD,QAASZ,GAAQ1B,GAChB,GAAIuC,IAAkB,QAAS,YAAa,UAAW,YAAa,YAAa,WAAY,aAAc,aAAc,eACrHC,GAAe,aAAc,YAAa,WAAY,eACtDf,EAAO,IACX,KAAqC,IAAjCe,EAAYC,QAAQzC,EAAEY,MAAc,CACvC,GAAI8B,GAAI,KACJC,EAAQ3C,EAAEiC,cAAgBjC,EAAEiC,cAAgBjC,EAC5C4C,EAAUD,EAAMC,QAAQxD,OAASuD,EAAMC,QAAUD,EAAME,cACvDD,IAAWA,EAAQxD,SACtBsD,EAAIE,EAAQ,IAETF,IACHjB,GACCtC,EAAGuD,EAAEI,MACLrC,EAAGiC,EAAEK,aAGuC,IAApCR,EAAeE,QAAQzC,EAAEY,QACnCa,GACCtC,EAAGa,EAAE8C,MACLrC,EAAGT,EAAE+C,OAIP,OADA5E,MAAKyC,KAAOZ,EAAEY,KACPa,EAGR,QAASuB,GAAO3D,GA0Cf,QAAS4D,GAAQjD,GAEhB,GAAI2C,GAAQ,GAAI5C,GAAMC,EAAGkD,EAAO7D,QAChC6D,GAAOC,UAAUC,MAAMC,MAAMlF,MAAOwE,IAGrC,QAASW,GAAYtD,GAEpB,GAAI2C,GAAQ,GAAI5C,GAAMC,EAAGkD,EAAO7D,QAChC6D,GAAOC,UAAUI,KAAKF,MAAMlF,MAAOwE,IACnCO,EAAOM,oBAGR,QAASC,GAAYzD,GAEpB,GAAI2C,GAAQ,GAAI5C,GAAMC,EAAGkD,EAAO7D,QAChC6D,GAAOC,UAAUO,KAAKL,MAAMlF,MAAOwE,IAGpC,QAASgB,GAAU3D,GAElB,GAAI2C,GAAQ,GAAI5C,GAAMC,EAAGkD,EAAO7D,QAChC6D,GAAOC,UAAUS,GAAGP,MAAMlF,MAAOwE,IAGlC,QAASkB,GAAS7D,GACjB+B,QAAQC,IAAI,WAAYhC,EACxB,IAAI2C,GAAQ,GAAI5C,GAAMC,EAAGkD,EAAO7D,QAChC6D,GAAOC,UAAUW,OAAOT,MAAMlF,MAAOwE,IAGtC,QAASoB,GAAa/D,GAErB,GAAI2C,GAAQ,GAAI5C,GAAMC,EAAGkD,EAAO7D,QAChC6D,GAAOC,UAAUI,KAAKF,MAAMlF,MAAOwE,IACnCO,EAAOc,uBAGR,QAASC,GAAYjE,GAEpB,GAAI2C,GAAQ,GAAI5C,GAAMC,EAAGkD,EAAO7D,QAChC6D,GAAOC,UAAUO,KAAKL,MAAMlF,MAAOwE,IAGpC,QAASuB,GAAWlE,GAEnB,GAAI2C,GAAQ,GAAI5C,GAAMC,EAAGkD,EAAO7D,QAChC6D,GAAOC,UAAUS,GAAGP,MAAMlF,MAAOwE,IAxFlCxE,KAAKkB,QAAUA,EACflB,KAAKgF,aACLhF,KAAKoE,gBACJa,OACChF,IAAK,QACLF,SAAU+E,GAEXM,MACCnF,IAAK,YACLF,SAAUoF,GAEXI,MACCtF,IAAK,YACLF,SAAUuF,GAEXG,IACCxF,IAAK,UACLF,SAAUyF,GAEXG,QACC1F,IAAK,SACLF,SAAU2F,IAGZ1F,KAAKqE,aACJe,MACCnF,IAAK,aACLF,SAAU6F,GAEXL,MACCtF,IAAK,YACLF,SAAU+F,GAEXL,IACCxF,IAAK,WACLF,SAAUgG,GAIZ,IAAIhB,GAAS/E,KA4Dd,QAASgD,GAAQ9B,GAChB,MAAOA,GAAQD,OAASC,EAAQ,GAAKA,EAGtC,QAAS8E,GAAW9E,GACnB,MAAOA,GAAQD,OAASC,EAAUvB,QAAQuB,QAAQA,GAGnD,QAAS+E,GAAIjB,EAAWkB,GACvB,GAAInB,GAAS/E,KACZmG,EAAWnG,KAAKoE,eAChBgC,EAAQpG,KAAKqE,YACVnD,EAAU8E,EAAWhG,KAAKkB,SAC7BmF,EAAgB1G,QAAQuB,QAAQV,OA2BjC,OAzBAb,SAAQ2G,QAAQtB,EAAW,SAAUjF,EAAUE,GAC9C,GAAI8E,EAAOC,UAAU/E,GAAM,CAC1B,GAAIsG,KACJA,GAAStG,GAAO8E,EAAOC,UAAU/E,GACjCuG,EAAOD,GAERxB,EAAOC,UAAU/E,GAAOF,EACpBoG,EAASlG,KACA,WAARA,EACHoG,EAAcI,GAAGN,EAASlG,GAAKA,IAAKkG,EAASlG,GAAKF,UAElDmB,EAAQuF,GAAGN,EAASlG,GAAKA,IAAKkG,EAASlG,GAAKF,WAG1CqG,EAAMnG,IACTiB,EAAQuF,GAAGL,EAAMnG,GAAKA,IAAKmG,EAAMnG,GAAKF,YAIpCmG,GACHA,EAAMQ,IAAI,WAAY,WACrB3B,EAAOyB,OAAOxB,KAITD,EAGR,QAASyB,GAAOxB,GACf,GAAID,GAAS/E,KACZmG,EAAWnG,KAAKoE,eAChBgC,EAAQpG,KAAKqE,YACVnD,EAAU8E,EAAWhG,KAAKkB,SAC7BmF,EAAgB1G,QAAQuB,QAAQV,OAcjC,OAbAb,SAAQ2G,QAAQtB,EAAW,SAAUjF,EAAUE,GAC1CkG,EAASlG,KACA,WAARA,EACHoG,EAAcM,IAAIR,EAASlG,GAAKA,IAAKkG,EAASlG,GAAKF,UAEnDmB,EAAQyF,IAAIR,EAASlG,GAAKA,IAAKkG,EAASlG,GAAKF,WAG3CqG,EAAMnG,IACTiB,EAAQyF,IAAIP,EAAMnG,GAAKA,IAAKmG,EAAMnG,GAAKF,UAExCgF,EAAOC,UAAU/E,GAAO,OAElB8E,EAGR,QAASc,KACR,GAAId,GAAS/E,KACZmG,EAAWpB,EAAOX,eAEflD,GADK6D,EAAOV,YACF2B,EAAWjB,EAAO7D,SAChCA,GAAQyF,IAAI,YAAaR,EAASf,KAAKrF,UACvCmB,EAAQyF,IAAI,YAAaR,EAASZ,KAAKxF,UACvCmB,EAAQyF,IAAI,UAAWR,EAASV,GAAG1F,UAGpC,QAASsF,KACR,GAAIN,GAAS/E,KAEZoG,GADWrB,EAAOX,eACVW,EAAOV,aACZnD,EAAU8E,EAAWjB,EAAO7D,QAChCA,GAAQyF,IAAI,aAAcP,EAAMhB,KAAKrF,UACrCmB,EAAQyF,IAAI,YAAaP,EAAMb,KAAKxF,UACpCmB,EAAQyF,IAAI,WAAYP,EAAMX,GAAG1F,UApFlC,MA3JA6B,GAAMzB,WACLoD,QAASA,EACTX,SAAUA,EACVE,UAAWA,GAkJZ+B,EAAO1E,WACN8F,IAAKA,EACLO,OAAQA,EACRX,qBAAsBA,EACtBR,kBAAmBA,GAEbR,KAyFR,WACC,GAAKrE,OAAOoG,iBAAZ,CAkBA,GAAIC,IACHC,SAAS,EACTC,SAAS,EAcV,IA9BA,WACC,GAAIC,IAAY,CAChB,KACC,GAAIC,GAAUC,OAAOC,kBAAmB,WACvCC,IAAK,WACJJ,GAAY,IAGdxG,QAAOoG,iBAAiB,OAAQ,KAAMK,GACrC,MAAOpF,GACR+B,QAAQC,IAAI,8BAA+BhC,GAE5C,MAAOmF,MAkBO,CACd,GAAIK,GAAWC,YAAYnH,UAAUyG,kBAZtC,SAA2BS,GAC1BC,YAAYnH,UAAUyG,iBAAmB,SAAUnE,EAAM8D,EAAUU,GAClE,GAAIM,GAAyC,gBAAZN,GAC7BF,EAAUQ,EAAsBN,EAAQF,QAAUE,CACtDA,GAAUM,EAAsBN,KAChCA,EAAQH,YAA8BU,KAApBP,EAAQH,QAAwBG,EAAQH,QAAUD,EAASC,QAC7EG,EAAQF,YAAsBS,KAAZT,EAAwBA,EAAUF,EAASE,QAC7DM,EAASI,KAAKzH,KAAMyC,EAAM8D,EAAUU,KAMnBI,WASpB,WAEA,YAEU1H,SAAQC,OAAO,WAErB8H,OAAO,SAAU,UAAW,SAAUC,GACzC,MAAO,UAAUC,EAAOC,EAAS3G,GAChC,GAAI2G,EACH,MAAOF,GAAQ,UAAUC,EAAO,SAAUE,GACzC,IAAK,GAAIC,GAAI,EAAGA,EAAIF,EAAQ5G,OAAQ8G,IACnC,GAAIF,EAAQE,GAAG7G,KAAa4G,EAAK5G,GAAU,OAAO,CAEnD,QAAO,WAUX,WACA,YAEUvB,SAAQC,OAAO,WAErBC,QAAQ,SAAU,WACrB,QAASmI,GAAMhH,EAAGsB,GACjBtC,KAAKgB,EAAIA,GAAK,EACdhB,KAAKsC,EAAIA,GAAK,EAyCf,MAvCA0F,GAAMC,KAAO,SAAUC,EAAOC,GAG7B,MAFAD,GAAMlH,GAAKmH,EACXD,EAAM5F,GAAK6F,EACJD,GAERF,EAAM7H,WACL8H,KAAM,SAAUE,GACf,MAAOH,GAAMC,KAAKjI,KAAMmI,IAEzBlF,OAAQ,SAAUjC,EAAGsB,GAGpB,MAFAtC,MAAKgB,GAAKA,EACVhB,KAAKsC,GAAKA,EACHtC,MAERoI,KAAM,SAAUpH,GAEf,MADAhB,MAAKgB,EAAIA,EACFhB,MAERqI,KAAM,SAAU/F,GAEf,MADAtC,MAAKsC,EAAIA,EACFtC,MAERsI,OAAQ,SAAUtH,EAAGsB,GAGpB,MAFAtC,MAAKgB,EAAIA,EACThB,KAAKsC,EAAIA,EACFtC,MAERuI,KAAM,SAAUL,GAGf,MAFAlI,MAAKgB,EAAIkH,EAAMlH,EACfhB,KAAKsC,EAAI4F,EAAM5F,EACRtC,MAERwI,MAAO,WACN,MAAO,IAAIR,GAAMhI,KAAKgB,EAAGhB,KAAKsC,IAE/BmG,SAAU,WACT,MAAO,IAAMzI,KAAKgB,EAAI,IAAMhB,KAAKsC,EAAI,MAGhC0F,QAOR,WACA,YAEUrI,SAAQC,OAAO,WAErBC,QAAQ,QAAS,WACpB,QAAS6I,GAAK1H,EAAGsB,EAAGK,EAAGE,GACtB7C,KAAKgB,EAAIA,GAAK,EACdhB,KAAKsC,EAAIA,GAAK,EACdtC,KAAK2C,EAAIA,GAAK,EACd3C,KAAK6C,EAAIA,GAAK,EAgLf,MA9KA6F,GAAKT,KAAO,SAAU7E,EAAM+E,GAK3B,MAJA/E,GAAKpC,GAAKmH,EACV/E,EAAKd,GAAK6F,EACV/E,EAAKT,GAAKwF,EACV/E,EAAKP,GAAKsF,EACH/E,GAERsF,EAAKvI,WACJ8H,KAAM,SAAUE,GACf,MAAOO,GAAKT,KAAKjI,KAAMmI,IAExBlF,OAAQ,SAAUjC,EAAGsB,GAGpB,MAFAtC,MAAKgB,GAAKA,EACVhB,KAAKsC,GAAKA,EACHtC,MAER2I,OAAQ,SAAUC,GACjB,MAAO5I,MAAKiD,QAAQ2F,IAErBC,WAAY,SAAUzF,GACrB,MAAOpD,MAAK8I,WAAWJ,EAAKT,KAAK7E,GAAO,KAEzC2F,WAAY,SAAU3F,GAKrB,MAJApD,MAAKgB,GAAKoC,EAAKpC,GAAK,EACpBhB,KAAKsC,GAAKc,EAAKd,GAAK,EACpBtC,KAAK2C,GAAKS,EAAKT,GAAK,EACpB3C,KAAK6C,GAAKO,EAAKP,GAAK,EACb7C,MAERgJ,OAAQ,SAAUJ,GACjB,MAAO5I,MAAK+I,YACX/H,EAAG4H,EACHtG,EAAGsG,EACHjG,EAAU,EAAPiG,EACH/F,EAAU,EAAP+F,KAGLK,UAAW,SAAU7F,GACpB,GAAIpC,GAAIhB,KAAKgB,EACZsB,EAAItC,KAAKsC,EACTK,EAAI3C,KAAK2C,EACTE,EAAI7C,KAAK6C,CACV,SAASO,EAAKpC,EAAIA,EAAI2B,GAAKS,EAAKpC,EAAIoC,EAAKT,EAAI3B,GAAKoC,EAAKd,EAAIA,EAAIO,GAAKO,EAAKd,EAAIc,EAAKP,EAAIP,IAEvFoB,IAAK,WACJ,GAAI1C,GAAIhB,KAAKgB,EACZsB,EAAItC,KAAKsC,EACTK,EAAI3C,KAAK2C,CAEV,OADK3C,MAAK6C,GAET7B,EAAGA,EAAI2B,EAAI,EACXL,EAAGA,IAGL4G,MAAO,WACN,GAAIlI,GAAIhB,KAAKgB,EACZsB,EAAItC,KAAKsC,CAGV,QACCtB,EAAGA,EAHChB,KAAK2C,EAITL,EAAGA,EAHCtC,KAAK6C,EAGE,IAGbsG,OAAQ,WACP,GAAInI,GAAIhB,KAAKgB,EACZsB,EAAItC,KAAKsC,CAGV,QACCtB,EAAGA,EAHChB,KAAK2C,EAGE,EACXL,EAAGA,EAHCtC,KAAK6C,IAMXY,KAAM,WACL,GAAIzC,GAAIhB,KAAKgB,EACZsB,EAAItC,KAAKsC,CAGV,OAFKtC,MAAK2C,GAGT3B,EAAGA,EACHsB,EAAGA,EAHCtC,KAAK6C,EAGE,IAGbuG,OAAQ,WACP,GAAIpI,GAAIhB,KAAKgB,EACZsB,EAAItC,KAAKsC,CAGV,QACCtB,EAAGA,EAHChB,KAAK2C,EAGE,EACXL,EAAGA,EAHCtC,KAAK6C,EAGE,IAGbwG,QAAS,WACR,GAAIrI,GAAIhB,KAAKgB,EACZsB,EAAItC,KAAKsC,CAGV,OAFKtC,MAAK2C,EACL3C,KAAK6C,GAET7B,EAAGA,EACHsB,EAAGA,IAGLgH,SAAU,WACT,GAAItI,GAAIhB,KAAKgB,EACZsB,EAAItC,KAAKsC,EACTK,EAAI3C,KAAK2C,CAEV,OADK3C,MAAK6C,GAET7B,EAAGA,EAAI2B,EACPL,EAAGA,IAGLiH,YAAa,WACZ,GAAIvI,GAAIhB,KAAKgB,EACZsB,EAAItC,KAAKsC,CAGV,QACCtB,EAAGA,EAHChB,KAAK2C,EAITL,EAAGA,EAHCtC,KAAK6C,IAMX2G,WAAY,WACX,GAAIxI,GAAIhB,KAAKgB,EACZsB,EAAItC,KAAKsC,CAGV,OAFKtC,MAAK2C,GAGT3B,EAAGA,EACHsB,EAAGA,EAHCtC,KAAK6C,IAMXuF,KAAM,SAAUpH,GAEf,MADAhB,MAAKgB,EAAIA,EACFhB,MAERqI,KAAM,SAAU/F,GAEf,MADAtC,MAAKsC,EAAIA,EACFtC,MAERyJ,KAAM,SAAU9G,GAEf,MADA3C,MAAK2C,EAAIA,EACF3C,MAER0J,KAAM,SAAU7G,GAEf,MADA7C,MAAK6C,EAAIA,EACF7C,MAERsI,OAAQ,SAAUtH,EAAGsB,GAGpB,MAFAtC,MAAKgB,EAAIA,EACThB,KAAKsC,EAAIA,EACFtC,MAER2J,QAAS,SAAUhH,EAAGE,GAGrB,MAFA7C,MAAK2C,EAAIA,EACT3C,KAAK6C,EAAIA,EACF7C,MAERuI,KAAM,SAAUnF,GAKf,MAJApD,MAAKgB,EAAIoC,EAAKpC,EACdhB,KAAKsC,EAAIc,EAAKd,EACdtC,KAAK2C,EAAIS,EAAKT,EACd3C,KAAK6C,EAAIO,EAAKP,EACP7C,MAERwI,MAAO,WACN,MAAO,IAAIE,GAAK1I,KAAKgB,EAAGhB,KAAKsC,EAAGtC,KAAK2C,EAAG3C,KAAK6C,IAE9C4F,SAAU,WACT,MAAO,IAAMzI,KAAKgB,EAAI,IAAMhB,KAAKsC,EAAI,IAAMtC,KAAK2C,EAAI,IAAM3C,KAAK6C,EAAI,MAG9D6F,QAOR,WACG,YAEU/I,SAAQC,OAAO,WAErBC,QAAQ,QAAS,WAGjB,QAAS+J,GAAK3J,EAAK4J,GACf5J,EAAMA,GAAO,KACb4J,EAAOA,EAAOD,EAAKxC,IAAIyC,MACvB3C,OAAO4C,iBAAiB9J,MACpBC,KACIkI,MAAOlI,EACP8J,YAAY,EACZC,UAAU,GAEdH,MACI1B,MAAO0B,EACPE,YAAY,EACZC,UAAU,GAEd/I,QACIkH,MAAO,EACP4B,YAAY,EACZC,UAAU,KAwBtB,QAASC,GAAIxI,GACT,WAAyB+F,KAAlBxH,KAAK6J,KAAKpI,GAGrB,QAASyI,GAAMzI,GACX,MAAOzB,MAAK6J,KAAKpI,GAGrB,QAAS2F,GAAIU,GACT,GAAIqC,GAAOnK,KACPC,EAAMD,KAAKC,GACf,OAAO6H,GAAOqC,EAAKD,MAAMpC,EAAK7H,IAAQ,KAG1C,QAASmK,GAAItC,GACT,GAAIqC,GAAOnK,IAKX,OAJWA,MAAK6J,KAEX/B,EADK9H,KAAKC,MACG6H,EAClBqC,EAAKE,KAAKvC,GACHA,EAGX,QAAS7B,GAAIqE,GACT,GAAIH,GAAOnK,KACP8H,EAAOqC,EAAK/C,IAAIkD,EACpB,IAAIxC,EACA,IAAK,GAAwCyC,GAApCxC,EAAI,EAAGyC,EAAOtD,OAAOsD,KAAKF,GAAavC,EAAIyC,EAAKvJ,OAAQ8G,IAC7DwC,EAAIC,EAAKzC,GACTD,EAAKyC,GAAKD,EAAQC,OAGtBzC,GAAOqC,EAAKC,IAAIE,EAEpB,OAAOxC,GAGX,QAAStB,GAAOiE,GACZ,GAAIN,GAAOnK,KACP6J,EAAO7J,KAAK6J,KACZ5J,EAAMD,KAAKC,IACX6H,EAAOqC,EAAK/C,IAAIqD,EACpB,IAAI3C,EAAM,CACN,GAAI4C,GAAQP,EAAK7F,QAAQwD,IACV,IAAX4C,GACAP,EAAKQ,OAAOD,EAAO,SAEhBb,GAAK/B,EAAK7H,IAErB,MAAOkK,GAGX,QAASS,GAAQC,GACb,GAAIV,GAAOnK,IACX,KAAK6K,EACD,MAAOV,EAGX,KADA,GAAIpC,GAAI,EACDA,EAAI8C,EAAM5J,QACbkJ,EAAKlE,IAAI4E,EAAM9C,IACfA,GAEJ,OAAOoC,GAGX,QAASW,GAAWD,GAChB,GAAIV,GAAOnK,IACX,KAAK6K,EACD,MAAOV,EAGX,KADA,GAAIpC,GAAI,EACDA,EAAI8C,EAAM5J,QACbkJ,EAAK3D,OAAOqE,EAAM9C,IAClBA,GAEJ,OAAOoC,GAGX,QAASY,KACL,GAKIjD,GALAqC,EAAOnK,KACPC,EAAMkK,EAAKlK,IACX4J,EAAOM,EAAKN,KACZ9B,EAAI,CAGR,KAFQoC,EAAKlJ,OAENkJ,EAAKlJ,QACR6G,EAAOqC,EAAKa,cACLnB,GAAK/B,EAAK7H,IACjB8H,GAEJ,OAAOoC,GAGX,QAASc,GAAKlL,GACV,GAAIoK,GAAOnK,IACX,IAAID,EAEA,IADA,GAAIgI,GAAI,EACDA,EAAIoC,EAAKlJ,QACZlB,EAASoK,EAAKpC,GAAIA,GAClBA,GAGR,OAAOoC,GAGX,QAASe,GAAQjL,EAAKkL,GAClB,GAAIhB,GAAOnK,IAOX,OANAC,GAAOA,GAAOD,KAAKC,IACnBkK,EAAKiB,KAAK,SAASC,EAAGC,GAClB,GAAIC,GAAIJ,EAAUG,EAAID,EAClBG,EAAIL,EAAUE,EAAIC,CACtB,OAAOC,GAAEtL,GAAOuL,EAAEvL,KAEfkK,EAGX,QAASsB,GAASxL,GACd,MAAOD,MAAKkL,QAAQjL,GAAK,GAG7B,QAASyL,GAAQvB,GACb,GAAIA,EAAKlK,MAAQD,KAAKC,KAAOkK,EAAKlJ,SAAWjB,KAAKiB,OAC9C,OAAO,CAMP,KAJA,GAAIyK,IAAU,EACV3D,EAAI,EACJxD,EAAIvE,KAAKiB,OACThB,EAAMD,KAAKC,IACRyL,GAAW3D,EAAIxD,GAClBmH,EAAU1L,KAAK+H,GAAG9H,KAASkK,EAAKpC,GAAG9H,GACnC8H,IAKZ,QAAS4D,KACL,GAAIxB,GAAOnK,KACP6J,EAAO7J,KAAK6J,KACZ5J,EAAMD,KAAKC,GACfiH,QAAOsD,KAAKX,GAAMvD,QAAQ,SAASrG,SACxB4J,GAAK5J,KAEhBN,QAAQ2G,QAAQ6D,EAAM,SAASrC,GAC3B+B,EAAK/B,EAAK7H,IAAQ6H,IA1L1B,GAAI8D,KAyCJ,OAlBAhC,GAAKxC,IAAM,SAASyC,GAChB,MAAQ+B,GAAM/B,GAAQ+B,EAAM/B,QAEhCD,EAAKzJ,UAAY,GAAI0L,OACrBjC,EAAKzJ,UAAU8J,IAAMA,EACrBL,EAAKzJ,UAAU+J,MAAQA,EACvBN,EAAKzJ,UAAUiH,IAAMA,EACrBwC,EAAKzJ,UAAUiK,IAAMA,EACrBR,EAAKzJ,UAAU8F,IAAMA,EACrB2D,EAAKzJ,UAAUqG,OAASA,EACxBoD,EAAKzJ,UAAU8K,KAAOA,EACtBrB,EAAKzJ,UAAUyK,QAAUA,EACzBhB,EAAKzJ,UAAU2K,WAAaA,EAC5BlB,EAAKzJ,UAAU4K,UAAYA,EAC3BnB,EAAKzJ,UAAU+K,QAAUA,EACzBtB,EAAKzJ,UAAUsL,SAAWA,EAC1B7B,EAAKzJ,UAAUuL,QAAUA,EACzB9B,EAAKzJ,UAAUwL,WAAaA,EACrB/B,QA0Jd,WACG,YAEUjK,SAAQC,OAAO,WAErBC,QAAQ,YAAa,KAAM,SAASiM,GACpC,QAASC,GAAShM,GACd,GAAwB,kBAAbA,GACP,KAAM,kCAEV,IAAIiM,GAAWF,EAAGG,OAElB,OADAlM,GAASiM,GACFA,EAASE,QAEpB,GAAIC,IACAC,IAAK,SAASC,GACV,MAAOP,GAAGM,IAAIC,IAItB,OADA1M,SAAQ2M,OAAOP,EAAUI,GAClBJ,QAMd,WACG,YAEUpM,SAAQC,OAAO,WAErBC,QAAQ,SAAU,WAAY,SAAS0M,GAGvC,QAASC,KACLxM,KAAKyM,UACLzM,KAAK0M,SAAU,EACf1M,KAAK2M,OAsHT,MAnHAH,GAAMrM,WACFwM,KAAM,WACF,GAAIC,GAAQ5M,IACZ4M,GAAMC,QAAS,EACfD,EAAME,SAAU,EAChBF,EAAMG,YAAa,EACnBH,EAAMI,WAAY,EAClBJ,EAAMK,cAAe,EACrBL,EAAMM,OAAS,KACfN,EAAMH,WAEVU,KAAM,WACF,GAAIP,GAAQ5M,IACZ,QAAK4M,EAAMC,SACPD,EAAMC,QAAS,EACfD,EAAME,SAAU,EAChBF,EAAMG,YAAa,EACnBH,EAAMI,WAAY,EAClBJ,EAAMK,cAAe,EACrBL,EAAMH,WACC,IAKfW,MAAO,SAAeA,GAClBxJ,QAAQC,IAAI,cAAeuJ,EAC3B,IAAIR,GAAQ5M,IACZ4M,GAAMC,QAAS,EACfD,EAAME,SAAU,EAChBF,EAAMG,YAAa,EACnBH,EAAMI,WAAY,EAClBJ,EAAMK,cAAe,EACrBL,EAAMH,OAAOpC,KAAK+C,GAClBb,EAAS,WACLK,EAAMG,YAAa,GA3CnB,MA8CRM,MAAO,WACH,GAAIT,GAAQ5M,IACZ4M,GAAMD,OACNC,EAAMF,SAAU,GAEpBY,QAAS,WACL,GAAIV,GAAQ5M,IACZ4M,GAAMC,QAAS,EACfD,EAAME,SAAU,EAChBF,EAAMG,YAAa,EACnBH,EAAMI,WAAY,EAClBJ,EAAMK,cAAe,EACrBL,EAAMH,UACNF,EAAS,WACLK,EAAMK,cAAe,GA5DrB,MA+DRM,QAAS,WACL,GAAIX,GAAQ5M,IACZ,QAAQ4M,EAAMC,SAAWD,EAAMG,aAAeH,EAAMK,cAExDO,aAAc,WACV,GAAIZ,GAAQ5M,IACZ,OAAO4M,GAAME,QAAUF,EAAMH,OAAOG,EAAMH,OAAOxL,OAAS,GAAK,MAEnEwM,YAAa,WACT,GAAIb,GAAQ5M,IACZ,QACImN,KAAMP,EAAMC,OACZQ,MAAOT,EAAMF,QACbgB,WAAYd,EAAMK,aAClBK,QAASV,EAAMI,UACfW,UAAWf,EAAMG,WACjBK,MAAOR,EAAME,UAGrBc,OAAQ,SAAgBC,GACpB,GAAIjB,GAAQ5M,KACR6G,GACAwG,MAAO,SACPF,KAAM,UACNC,MAAO,QACPE,QAAS,UAETO,IACAlO,QAAQ2M,OAAOzF,EAAUgH,EAE7B,IAAIC,GAAQjH,EAASwG,KAQrB,OAPIT,GAAMC,OACNiB,EAAQjH,EAASsG,KACVP,EAAMI,UACbc,EAAQjH,EAASyG,QACVV,EAAME,UACbgB,EAAQjH,EAASuG,OAEdU,GAEXC,QAAS,SAAiBF,GACtB,GAAIjB,GAAQ5M,KACR+N,EAAU,IAcd,OAbAA,IACIV,MAAOT,EAAMF,QACbS,KAAMP,EAAMC,OACZa,WAAYd,EAAMK,aAClBK,QAASV,EAAMI,UACfW,UAAWf,EAAMG,WACjBK,MAAOR,EAAME,SAEbe,GACAlO,QAAQ2G,QAAQuH,EAAQ,SAAS1F,EAAOlI,GACpC8N,EAAQ5F,GAAS4F,EAAQ9N,KAG1B8N,IAIRvB,QAMd,WACA,YAEA,IAAIwB,GAmCJ,WACC,GAAIA,GAAoB,YAEpBC,EAAMlM,SAASmM,cAAc,MAejC,YAd4C,KAAjCD,EAAIE,MAAMH,IACV,SAAU,MAAO,IAAK,MAAMI,MAAM,SAAUC,GACrD,GAAIxM,GAAI,IAAMwM,EAAS,YACvB,YAA4B,KAAjBJ,EAAIE,MAAMtM,KACpBmM,EAAoBnM,GACb,KAKTmM,MADmD,KAAlCC,EAAIE,MAAwB,gBACzB,wBAEA3G,GAEdwG,IAnDErO,SAAQC,OAAO,WAErBC,QAAQ,SAAU,WACrB,QAASyO,KACRtO,KAAKuO,OACJC,MAAO,EACPC,WAAY,EACZC,aAAc,GAuBhB,MAnBAJ,GAAMnO,WACLiK,IAAK,SAAUlJ,GACd,GAAIyN,KACJ,KAAK,GAAI1O,KAAOD,MACH,UAARC,GACH0O,EAAOtE,KAAKpK,EAAM,IAAMD,KAAKC,GAG/BiB,GAAQiN,MAAMS,QAAUD,EAAOE,KAAK,KAAO,KAE5CC,UAAW,SAAUA,GACpB9O,KAAKgO,GAAqBc,GAE3BC,gBAAiB,SAAU/N,EAAGsB,GAC7BtC,KAAKgO,EAAoB,aAAgBzM,KAAKyN,MAAU,IAAJhO,GAAY,IAAQ,IACxEhB,KAAKgO,EAAoB,aAAgBzM,KAAKyN,MAAU,IAAJ1M,GAAY,IAAQ,MAInEgM,QA4BR,WACA,YAEA,IAAIW,GAAMtP,QAAQC,OAAO,UAEzBqP,GAAIpP,QAAQ,SAAU,WACrB,QAASqP,GAAOlO,EAAGsB,GAClBtC,KAAKgB,EAAIA,GAAK,EACdhB,KAAKsC,EAAIA,GAAK,EA+Ef,MA7EA4M,GAAOC,KAAO,SAAU5D,EAAGC,GAC1B,MAAO,IAAI0D,GAAO1D,EAAExK,EAAIuK,EAAEvK,EAAGwK,EAAElJ,EAAIiJ,EAAEjJ,IAEtC4M,EAAOtG,KAAO,SAAU2C,GACvB,MAAOhK,MAAK6N,KAAK7D,EAAEvK,EAAIuK,EAAEvK,EAAIuK,EAAEjJ,EAAIiJ,EAAEjJ,IAEtC4M,EAAOG,UAAY,SAAU9D,GAC5B,GAAI+D,GAAIJ,EAAOtG,KAAK2C,EAGpB,OAFAA,GAAEvK,GAAKsO,EACP/D,EAAEjJ,GAAKgN,EACA/D,GAER2D,EAAOK,UAAY,SAAUhE,EAAGC,GAI/B,MAHYjK,MAAKiO,MAAMhE,EAAElJ,EAAGkJ,EAAExK,GAAKO,KAAKiO,MAAMjE,EAAEjJ,EAAGiJ,EAAEvK,IAKtDkO,EAAOO,SAAW,SAAUlE,EAAGC,GAC9B,MAAOjK,MAAK6N,MAAM7D,EAAEvK,EAAIwK,EAAExK,IAAMuK,EAAEvK,EAAIwK,EAAExK,IAAMuK,EAAEjJ,EAAIkJ,EAAElJ,IAAMiJ,EAAEjJ,EAAIkJ,EAAElJ,KAErE4M,EAAOQ,MAAQ,SAAUnE,EAAGC,GAC3B,MAAQD,GAAEvK,EAAIwK,EAAElJ,EAAMiJ,EAAEjJ,EAAIkJ,EAAExK,GAE/BkO,EAAOS,WAAa,SAAUpE,EAAGC,GAChC,MAAO,IAAI0D,GAAO3D,EAAEvK,EAAIwK,EAAExK,EAAGuK,EAAEjJ,EAAIkJ,EAAElJ,IAEtC4M,EAAOU,MAAQ,SAAUrE,EAAGC,GAG3B,OAFQjK,KAAKsO,IAAIrE,EAAExK,EAAIuK,EAAEvK,GACjBO,KAAKsO,IAAIrE,EAAElJ,EAAIiJ,EAAEjJ,IACR,GAElB4M,EAAO/O,WACNyI,KAAM,WACL,MAAOsG,GAAOtG,KAAK5I,OAEpBqP,UAAW,WACV,MAAOH,GAAOG,UAAUrP,OAEzBuP,UAAW,SAAU/D,GACpB,MAAO0D,GAAOK,UAAUvP,KAAMwL,IAE/BkE,MAAO,SAAUlE,GAChB,MAAO0D,GAAOQ,MAAM1P,KAAMwL,IAE3BiE,SAAU,SAAUjE,GACnB,MAAO0D,GAAOO,SAASzP,KAAMwL,IAE9BmE,WAAY,SAAUnE,GACrB,MAAO0D,GAAOS,WAAW3P,KAAMwL,IAEhCoE,MAAO,WACN,OAAQrO,KAAKsO,IAAI7P,KAAKgB,GAAKO,KAAKsO,IAAI7P,KAAKsC,IAAM,GAEhDwN,QAAS,SAAUtE,EAAGuE,GAIrB,MAHAA,GAAWA,GAAY,KACvB/P,KAAKgB,IAAMwK,EAAExK,EAAIhB,KAAKgB,GAAK+O,EAC3B/P,KAAKsC,IAAMkJ,EAAElJ,EAAItC,KAAKsC,GAAKyN,EACpB/P,MAERiG,IAAK,SAAUuF,GAGd,MAFAxL,MAAKgB,GAAKwK,EAAExK,EACZhB,KAAKsC,GAAKkJ,EAAElJ,EACLtC,MAER+P,SAAU,SAAUvE,GAGnB,MAFAxL,MAAKgB,GAAKwK,EACVxL,KAAKsC,GAAKkJ,EACHxL,MAERuI,KAAM,SAAUiD,GACf,MAAO,IAAI0D,GAAOlP,KAAKgB,EAAGhB,KAAKsC,IAEhCmG,SAAU,WACT,MAAO,IAAMzI,KAAKgB,EAAI,IAAMhB,KAAKsC,EAAI,MAGhC4M,IAGRD,EAAIpP,QAAQ,SAAU,WAAY,cAAe,SAAU,SAAUmQ,EAAUC,EAAaf,GAsD3F,QAASgB,MAyCT,QAASC,GAAStO,EAAGuO,GACpB,GAAI7L,GAAI,GAAI2K,EACZ,IAAe,eAAXrN,EAAEY,MAAoC,cAAXZ,EAAEY,MAAmC,aAAXZ,EAAEY,MAAkC,gBAAXZ,EAAEY,KAAwB,CAC3G,GAAI2D,GAAQ,KACR5B,EAAQ3C,EAAEiC,cAAgBjC,EAAEiC,cAAgBjC,EAC5C4C,EAAUD,EAAMC,QAAQxD,OAASuD,EAAMC,QAAUD,EAAME,cACvDD,IAAWA,EAAQxD,SACtBmF,EAAQ3B,EAAQ,IAEb2B,IACH7B,EAAEvD,EAAIoF,EAAMzB,MACZJ,EAAEjC,EAAI8D,EAAMxB,WAEQ,UAAX/C,EAAEY,MAA+B,cAAXZ,EAAEY,MAAmC,YAAXZ,EAAEY,MAAiC,cAAXZ,EAAEY,MAAmC,cAAXZ,EAAEY,MAAmC,aAAXZ,EAAEY,MAAkC,eAAXZ,EAAEY,MAAoC,eAAXZ,EAAEY,MAAoC,gBAAXZ,EAAEY,OACvN8B,EAAEvD,EAAIa,EAAE8C,MACRJ,EAAEjC,EAAIT,EAAE+C,MAMT,OAJIwL,KACH7L,EAAE8L,EAAInB,EAAOS,WAAWpL,EAAG6L,IAE5B7L,EAAE9B,KAAOZ,EAAEY,KACJ8B,EAGR,QAAS+L,GAAiBvN,EAAMmF,GAE/BnF,EADcpD,QAAQuB,QAAQ6B,GACf,EACf,IAAIK,GAAOL,EAAKM,wBAEZxB,EAAI,GAAIqN,GAAO9L,EAAKK,KAAML,EAAKM,IACnC,OAAOwL,GAAOS,WAAWzH,EAAOrG,GAGjC,QAAS0O,GAAWC,EAAIC,GACvB,GAAIC,GAAWC,CAQf,KAPU,UAAW,wBAAyB,qBAAsB,oBAAqB,oBAAoBC,KAAK,SAAUC,GAC3H,MAAgC,kBAArB9O,UAASE,KAAK4O,KACxBH,EAAYG,GACL,KAILL,EAAGE,GAAWD,GACjB,MAAOD,EAER,MAAc,OAAPA,GAAa,CAEnB,GAAe,QADfG,EAASH,EAAGM,gBACWH,EAAOD,GAAWD,GACxC,MAAOE,EAERH,GAAKG,EAEN,MAAO,MAGR,QAASI,GAAkBP,EAAIQ,GAC9B,GAAeL,EACf,IAAIH,IAAOQ,EACV,MAAOR,EAER,MAAc,OAAPA,GAAa,CAEnB,GAAe,QADfG,EAASH,EAAGM,gBACWH,IAAWK,EACjC,MAAOL,EAERH,GAAKG,EAEN,MAAO,MAGR,QAASM,GAASC,EAAMC,EAAMlK,GAM7B,GAAImK,GAASC,EAAMC,EACfC,EAAU,KACVnB,EAAW,CACVnJ,KAASA,KACd,IAAIuK,GAAQ,WACXpB,GAA+B,IAApBnJ,EAAQwK,QAAoB,EAAIC,IAC3CH,EAAU,KACVD,EAASJ,EAAKhM,MAAMkM,EAASC,GACxBE,IAASH,EAAUC,EAAO,MAEhC,OAAO,YACN,GAAIM,GAAMD,GACLtB,KAAgC,IAApBnJ,EAAQwK,UAAmBrB,EAAWuB,EACvD,IAAIC,GAAYT,GAAQQ,EAAMvB,EAc9B,OAbAgB,GAAUpR,KACVqR,EAAOQ,UACHD,GAAa,GAAKA,EAAYT,GAC7BI,IACH5P,aAAa4P,GACbA,EAAU,MAEXnB,EAAWuB,EACXL,EAASJ,EAAKhM,MAAMkM,EAASC,GACxBE,IAASH,EAAUC,EAAO,OACpBE,IAAgC,IAArBtK,EAAQ6K,WAC9BP,EAAU7P,WAAW8P,EAAOI,IAEtBN,GAIT,QAASS,GAAMnK,EAAOoK,GACrB,GAAIC,GAAQ,IAYZ,OAXIrK,IACHjI,QAAQ2G,QAAQsB,EAAO,SAAUE,GAChC,GAAImC,IAAM,CACVtK,SAAQ2G,QAAQ0L,EAAO,SAAU7J,EAAOlI,GACvCgK,EAAMA,GAAOnC,EAAK7H,KAASkI,IAExB8B,IACHgI,EAAQnK,KAIJmK,EAGR,QAASC,GAAkBhM,EAAOhF,EAASiR,EAAMC,GAEhDlR,EAAQiR,KAAKA,EACb,IAAIE,GAAOrC,EAAS9O,EAAQoR,WAC5B,IAAIF,EAAKG,WAAY,CACpB,GAAIC,GAAStM,EAAMuM,MACnB9S,SAAQ2M,OAAOkG,EAAQJ,EACvB,IAAIG,GAAatC,EAAYmC,EAAKG,YACjCC,OAAQA,GAELJ,GAAKM,eACRxM,EAAMkM,EAAKM,cAAgBH,GAE5BrR,EAAQkR,KAAK,0BAA2BG,GACxCrR,EAAQyR,WAAWP,KAAK,0BAA2BG,GACnDrM,EAAQsM,EAETH,EAAKnM,GAGN,QAAS0M,GAAc3S,GACtB,MAAO,UAAUsL,EAAGC,GACnB,MAAID,GAAEtL,GAAOuL,EAAEvL,GACP,EAEJsL,EAAEtL,GAAOuL,EAAEvL,IACN,EAGF,GAIT,QAAS4S,GAAOC,EAAQC,EAASC,GAChCF,EAASA,GAAU,GACnBC,EAAUA,GAAW,EACrB,IAAIE,GAAWH,EAAOI,MAAM,IAC5B,IAAID,EAAShS,OAAS,EAAG,CACxB,GAAIkS,GAAYF,EAASjI,OAQzB,OAPArL,SAAQ2G,QAAQ2M,EAAU,SAAU9K,EAAOuC,GAEzCyI,EADGH,EACSG,EAAUD,MAAM,IAAMxI,EAAQ,KAAKmE,KAAK,OAAUkE,EAAU5K,EAAQ,QAEpEgL,EAAUD,MAAM,IAAMxI,EAAQ,KAAKmE,KAAKkE,EAAU5K,KAG5D6K,EACI,IAAOG,EAAY,IAEnBA,EAGR,MAAOJ,GAAUD,EAInB,QAASM,GAAQC,EAAGpT,GACnB,MAAOoT,GAAEpT,GAGV,QAASqT,GAAcD,EAAGpT,EAAKkI,GAC9B,MAAkB,gBAAPlI,GACHqT,EAAcD,EAAGpT,EAAIiT,MAAM,KAAM/K,GAChB,GAAdlI,EAAIgB,YAAyBuG,KAAVW,EACrBkL,EAAEpT,EAAI,IAAMkI,EACK,IAAflI,EAAIgB,OACPoS,EAEAC,EAAcD,EAAEpT,EAAI,IAAKA,EAAIsT,MAAM,GAAIpL,GAIhD,QAASqL,GAAaH,EAAGpT,EAAKkI,GAC7B,MAAkB,gBAAPlI,GACHuT,EAAaH,EAAGpT,EAAIiT,MAAM,KAAM/K,GACf,GAAdlI,EAAIgB,YAAyBuG,KAAVW,EACrBkL,EAAEpT,EAAI,KAAOkI,EACI,IAAflI,EAAIgB,OACPoS,EAEAG,EAAaH,EAAEpT,EAAI,IAAKA,EAAIsT,MAAM,GAAIpL,GAI/C,QAASsL,GAAaC,EAASC,EAAMlR,GAapC,QAASmR,KAIR,GAAI7R,SAAS8R,YAAa,CACzB,GAAIC,GAAS/R,SAASmM,cAAc,IAEpC,IADA4F,EAAOC,KAAOC,MACUxM,KAApBsM,EAAOF,SAAwB,CAElC,GAAIK,GAAeN,GAAQK,EAAOE,UAAUF,EAAOG,YAAY,KAAO,EAAGH,EAAO/S,OAChF6S,GAAOF,SAAWK,EAGnB,GAAIzP,GAAQzC,SAAS8R,YAAY,cAGjC,OAFArP,GAAM4P,UAAU,SAAS,GAAM,GAC/BN,EAAOO,cAAc7P,IACd,EAKRhE,OAAO8T,KAAKN,EAAO1P,QAAQ,MAAQ,EAAI0P,EAASA,EADpC,YACoD,SAjCjEvR,EAAOA,GAAQ,0BACf,IAAIuR,GAAS,KACTO,EAAO,GAAIC,OAAMd,IACpBjR,KAAMA,IAEHgS,EAAS,GAAIjU,QAAOkU,UACxBD,GAAOE,cAAcJ,GACrBE,EAAOG,UAAY,WAClBZ,EAASS,EAAOnD,OAChBsC,KA4EF,QAASiB,GAAe5N,GACvB,GAAIJ,IACHiO,IAAK,wBACLnB,KAAM,WACNoB,UAAW,MACXtS,KAAM,aACNiR,QAAS,SAEVzM,GAAUtH,QAAQ2M,OAAOzF,EAAUI,EACnC,IAAIyM,GAAUsB,KAAKC,UAAUhO,GACzBiO,EAAOnT,SAASmM,cAAc,QAC9BiH,EAAQpT,SAASmM,cAAc,QAgBnC,OAfAiH,GAAMxB,KAAO,WACbwB,EAAMhN,MAAQuL,EACdwB,EAAKE,YAAYD,GACjBD,EAAKG,OAASpO,EAAQ6N,IACtBI,EAAKI,OAAS,OACdJ,EAAKlE,OAAS,mBACdkE,EAAKK,QAAU,oCAGfxT,SAASE,KAAKmT,YAAYF,GAC1BA,EAAKM,SACL9T,WAAW,WACVK,SAASE,KAAKwT,YAAYP,IACxB,KAEIhF,GA7ZP,WAKKrE,MAAM1L,UAAUwI,QACpBzB,OAAOC,eAAe0E,MAAM1L,UAAW,UACtCgI,MAAO,SAAUpI,GAChB,GAAa,OAATC,KACH,KAAM,IAAI0V,WAAU,qDAErB,IAAwB,kBAAb3V,GACV,KAAM,IAAI2V,WAAU3V,EAAW,qBAEhC,IAGIoI,GAHAkL,EAAInM,OAAOlH,MACX2V,EAAMtC,EAAEpS,SAAW,EACnB2U,EAAI,CAER,IAAwB,GAApB/D,UAAU5Q,OACbkH,EAAQ0J,UAAU,OACZ,CACN,KAAO+D,EAAID,KAASC,IAAKvC,KACxBuC,GAED,IAAIA,GAAKD,EACR,KAAM,IAAID,WAAU,8CAErBvN,GAAQkL,EAAEuC,KAEX,KAAOA,EAAID,GACNC,IAAKvC,KACRlL,EAAQpI,EAASoI,EAAOkL,EAAEuC,GAAIA,EAAGvC,IAElCuC,GAED,OAAOzN,QAKX,IACIuJ,GAAStQ,KAAKuQ,KAAO,WACxB,OAAO,GAAIvQ,OAAOC,WAEfwU,EAAKrV,OAAOsV,UAAUC,UAAUC,cAChCC,GAAmC,IAA1BJ,EAAGvR,QAAQ,YAA8C,IAA1BuR,EAAGvR,QAAQ,UACnD4R,GAAkC,IAA3BL,EAAGvR,QAAQ,aAA6C,IAAxBuR,EAAGvR,QAAQ,UAA0C,IAAxBuR,EAAGvR,QAAQ,QAC/E6R,GAAUF,IAAWC,IAAkC,IAA1BL,EAAGvR,QAAQ,UACxC8R,GAAmC,IAA1BP,EAAGvR,QAAQ,SACTwR,WAAUC,UAAUC,cAAc1R,QAAQ,UAC1CwR,UAAUC,UAAUC,cAAc1R,QAAQ,SA+BzD,OA5BA4L,GAAM0C,cAAgBA,EACtB1C,EAAMC,SAAWA,EACjBD,EAAMI,iBAAmBA,EACzBJ,EAAMK,WAAaA,EACnBL,EAAMa,kBAAoBA,EAC1Bb,EAAMe,SAAWA,EACjBf,EAAM6B,MAAQA,EACd7B,EAAM2C,OAASA,EACf3C,EAAMgC,kBAAoBA,EAC1BhC,EAAMkD,QAAUA,EAChBlD,EAAMoD,cAAgBA,EACtBpD,EAAMsD,aAAeA,EACrBtD,EAAMuD,aAAeA,EACrBvD,EAAM2E,eAAiBA,EACvB3E,EAAMmG,MAAQ,SAAUvD,GACvB,MAAOwD,KAAIC,OAAOzD,IAEnB5C,EAAM2F,IACLI,OAAQA,EACRC,KAAMA,EACNC,OAAQA,EACRC,OAAQA,GAETzW,QAAQ2G,QAAQ4J,EAAM2F,GAAI,SAAU1N,EAAOlI,GACtCkI,GACHxI,QAAQuB,QAAQa,SAASyU,qBAAqB,SAASC,SAASxW,KAG3DiQ,QAoVR,WACG,YAEUvQ,SAAQC,OAAO,WAErBC,QAAQ,OAAQ,MAAO,WAAY,SAAS6W,EAAK3K,GACjD,QAAS4K,GAAI7O,GACLA,GACAnI,QAAQ2M,OAAOtM,KAAM8H,GAI7B6O,EAAIxW,YAIJ,IAAIgM,KAIJ,OAFAxM,SAAQ2M,OAAOqK,EAAKxK,GAEbwK,QAMd,WACG,YAEUhX,SAAQC,OAAO,WAErBC,QAAQ,QAAS,MAAO,WAAY,YAAa,eAAgB,cAAe,MAAO,SAAS6W,EAAK3K,EAAU6K,EAAWC,EAAcC,EAAaH,GACrJ,QAASI,GAAKC,GACV,GAAIC,GAAML,EAAUM,OAChBC,EAASN,EACTnU,GACAoU,YAAaA,EACbM,OACIH,IAAKA,EACLE,OAAQA,GAEZH,IAAKA,EAETrX,SAAQ2M,OAAOtM,KAAM0C,GAGzBqU,EAAK5W,YAIL,IAAIgM,IACAkL,QAAS,WACL,MAAOtL,GAAS,SAASG,GACrB,GAAI+K,GAAML,EAAUM,MACpBtT,SAAQC,IAAI,eAAgBoT,GAC5BP,EAAIY,KAAKL,IAAIA,GAAKM,KAAK,SAASC,GAC5B,GAAIR,GAAM,GAAIL,GAAIa,GACd9U,EAAO,GAAIqU,GAAKC,EACpB9K,GAAQuL,QAAQ/U,IAEjB,SAAS0K,GACRlB,EAAQwL,OAAOtK,QAwC/B,OAjBAzN,SAAQ2M,OAAOyK,EAAM5K,GAiBd4K,QAMd,WACG,YAEUpX,SAAQC,OAAO,WAErB+X,QAAQ,UAAW,QAAS,WAAY,WAAY,cACpD,SAASC,EAAO7L,EAAUQ,EAAUuK,GAEhC,QAASe,GAAavC,EAAQ2B,EAAK7E,GAC/B,MAAOrG,GAAS,SAASG,GAErB0L,EAAMtC,GAAQwB,EAAYgB,KAAKC,IAAMd,EAAK7E,GAAMmF,KAAK,SAASC,GAC1DtL,EAAQuL,QAAQD,EAASpF,OAE1B,SAASvQ,EAAGmW,GACX,GAAI5K,GAASvL,GAAKA,EAAEuQ,KAAQvQ,EAAEuQ,OAC9BhF,GAAM4K,OAASnW,EAAEmW,OACjB9L,EAAQwL,OAAOtK,OAM3B,QAAS6K,GAAKhB,GACV,MAAOY,GAAa,MAAOZ,GAG/B,QAASiB,GAAMjB,EAAK7E,GAChB,MAAOyF,GAAa,OAAQZ,EAAK7E,GAGrC,QAAS+F,GAAKlB,EAAK7E,GACf,MAAOyF,GAAa,MAAOZ,EAAK7E,GAGpC,QAASgG,GAAOnB,EAAK7E,GACjB,MAAOyF,GAAa,QAASZ,EAAK7E,GAGtC,QAASiG,GAAQpB,GACb,MAAOY,GAAa,SAAUZ,GAGlC,QAASqB,GAAMlG,GACX,GAAIpG,GAAWF,GAAGG,OAIlB,OAHAM,GAAS,WACLP,EAASyL,SAAUrF,KAAMA,KAC1B,KACIpG,EAASE,QAGpBlM,KAAKoH,IAAM6Q,EACXjY,KAAKuY,KAAOL,EACZlY,KAAKwY,IAAML,EACXnY,KAAKyY,MAAQL,EACbpY,KAAK0Y,OAASL,EACdrY,KAAK2Y,KAAOL,QAQvB,WACG,YAEU3Y,SAAQC,OAAO,WAErB+X,QAAQ,UAAW,YAAa,WAAY,SAASf,EAAWrK,GAOhE,QAASqM,GAAS1B,EAAM2B,GACpB,QAASC,KACLlC,EAAUmC,oBAAsBnC,EAAUM,OAC1CN,EAAUM,KAAKA,GAEf2B,EACAtM,EAAS,WACLuM,KACDD,GAEHC,IAIR,QAAS5B,GAAKA,EAAM2B,GAChB,QAASG,KACL9B,EAAON,EAAUmC,qBAAuB7B,EACxCN,EAAUmC,oBAAsB,KAChCnC,EAAUM,KAAKA,GAEf2B,EACAtM,EAAS,WACLyM,KACDH,GAEHG,IAIR,QAAS9T,GAAMgS,EAAM2B,GACjB,QAASG,KACLpC,EAAUM,KAAKA,GAEf2B,EACAtM,EAAS,WACLyM,KACDH,GAEHtM,EAAS,WACLyM,MA5CZ,GAAIrB,GAAU3X,IACd2X,GAAQiB,SAAWA,EACnBjB,EAAQT,KAAOA,EACfS,EAAQzS,MAAQA,QAmDvB,WACG,YAEUvF,SAAQC,OAAO,WAErBC,QAAQ,WAAY,aAAc,YAAa,SAASoZ,EAAYrC,GACpE,QAASsC,MAIT,QAASC,KACL,GAAInU,GAAYiU,EAAWG,YAAYC,sBACvC1Z,SAAQ2G,QAAQtB,EAAW,SAASmD,EAAOwL,GAKvC,QAAS2F,KACLtU,EAAU2O,GAAQxL,EALlBA,IAAU5B,IAOdvB,EAAU2O,GAAQ2F,KAI1B,QAAS/S,GAAS1E,GAEV0X,IAAU3C,EAAUM,QACpBiC,IAEJI,EAAQ,KArBZ,GAAIA,GAwBApN,GACAqN,OAAQ,SAAStC,EAAMuC,GAEnB,GAAIC,GAAW9C,EAAUK,IAAIC,EACzBuC,IACAC,EAASD,UAEbF,EAAQ3C,EAAUM,QAEtBA,KAAM,SAASA,GACX,MAAON,GAAUM,KAAKA,IAO9B,OAHAvX,SAAQ2M,OAAO4M,EAAS/M,GACxB8M,EAAWG,YAAYC,uBAAuBM,QAAQpT,GAE/C2S,QAMd,WACG,YAEA,IAAIjK,GAAMtP,QAAQC,OAAO,UAEzBqP,GAAIpP,QAAQ,UAAW,KAAM,UAAW,SAASiM,EAAI8N,GACjD,QAASC,MAoFT,MAnFAA,GAAOC,QAAU,IACjBD,EAAOE,KAAO,SAASpG,EAAMxL,EAAO6R,GAChC,GAAIC,EACJ,IAAID,EAAM,CACN,GAAIE,GAAO,GAAI9Y,KACf8Y,GAAKC,QAAQD,EAAK7Y,UAAoB,GAAP2Y,EAAY,GAAK,GAAK,KACrDC,EAAU,aAAeC,EAAKE,kBAE9BH,GAAU,EAEdL,GAAQ7X,SAASsY,OAAS1G,EAAO,IAAMxL,EAAQ8R,EAAU,YAE7DJ,EAAOS,OAAS,SAAS3G,GACrB,OAA8D,IAAvDiG,EAAQ7X,SAASsY,OAAO/V,QAAQ,IAAMqP,EAAO,MAA+D,IAAhDiG,EAAQ7X,SAASsY,OAAO/V,QAAQqP,EAAO,MAE9GkG,EAAOzS,IAAM,SAASuM,GAGlB,IAAK,GAFD4G,GAAa5G,EAAO,IACpB6G,EAAKZ,EAAQ7X,SAASsY,OAAOnH,MAAM,KAC9BnL,EAAI,EAAGA,EAAIyS,EAAGvZ,OAAQ8G,IAAK,CAEhC,IADA,GAAIsD,GAAImP,EAAGzS,GACW,KAAfsD,EAAEoP,OAAO,IACZpP,EAAIA,EAAE6I,UAAU,EAAG7I,EAAEpK,OAEzB,IAA8B,IAA1BoK,EAAE/G,QAAQiW,GAAmB,CAC7B,GAAIpS,GAAQkD,EAAE6I,UAAUqG,EAAWtZ,OAAQoK,EAAEpK,QACzCyZ,EAAQ,IACZ,KACIA,EAAQ1F,KAAK2F,MAAMC,mBAAmBC,KAAK1S,KAC7C,MAAOtG,GACL+B,QAAQC,IAAI,2BAA4B5D,IAAK4B,GAEjD,MAAO6Y,IAGf,MAAO,OAEXb,EAAOzP,IAAM,SAASuJ,EAAMxL,EAAO6R,GAC/B,IACI,GAAIc,MACAC,EAAO/F,KAAKC,UAAU9M,EAAO,SAASlI,EAAKkI,GAC3C,GAAY,SAARlI,EAAJ,CAGA,GAAqB,gBAAVkI,IAAgC,OAAVA,EAAgB,CAC7C,IAA8B,IAA1B2S,EAAMxW,QAAQ6D,GAEd,MAEJ2S,GAAMzQ,KAAKlC,GAEf,MAAOA,KAEX2S,GAAQ,KACRjB,EAAOE,KAAKpG,EAAMqH,KAAKC,mBAAmBF,IAAQf,GACpD,MAAOnY,GACL+B,QAAQC,IAAI,+BAAgC8P,EAAMxL,EAAOtG,KAGjEgY,EAAOnB,OAAS,SAAS/E,GACrBkG,EAAOE,KAAKpG,EAAM,IAAK,IAE3BkG,EAAOpT,GAAK,SAASkN,GAMjB,QAASuH,KACL,GAAIC,EAAU5J,EACVvF,EAAS0L,OAAO,eACb,CACH,GAAIrM,GAAIwO,EAAOzS,IAAIuM,EACftI,GACAW,EAASyL,QAAQpM,IAEjB8P,GAAWC,EACXrT,EAAIrG,WAAWwZ,EAAaE,KAdxC,GACIrT,GADAiE,EAAWF,EAAGG,QACXmP,EAAW,IACdD,EAAU,EACV5J,EAAUsI,EAAOC,OAgBrB,OADAoB,KACOlP,EAASE,SAEb2N,KAGX5K,EAAIpP,QAAQ,gBAAiB,KAAM,UAAW,SAAU,SAASiM,EAAI8N,EAASC,GAC1E,QAASwB,MAyFT,MAxEAA,GAAaC,YAfb,WACI,GAAItU,IAAY,CAChB,KACIA,EAAY,gBAAkB4S,IAAoC,OAAzBA,EAAQ2B,aAC7CvU,GACA4S,EAAQ2B,aAAaC,QAAQ,OAAQ,KACrC5B,EAAQ2B,aAAaE,WAAW,SAEhCzU,GAAY,EAElB,MAAOnF,GACLmF,GAAY,EAEhB,MAAOA,MAGPqU,EAAaC,aACbD,EAAaf,OAAS,SAAS3G,GAC3B,WAAsCnM,KAA/BoS,EAAQ2B,aAAa5H,IAEhC0H,EAAajU,IAAM,SAASuM,GACxB,GAAIxL,GAAQ,IACZ,QAAmCX,KAA/BoS,EAAQ2B,aAAa5H,GACrB,IACIxL,EAAQ6M,KAAK2F,MAAMf,EAAQ2B,aAAa5H,IAC1C,MAAO9R,GACL+B,QAAQC,IAAI,iCAAkC8P,EAAM9R,GAG5D,MAAOsG,IAEXkT,EAAajR,IAAM,SAASuJ,EAAMxL,GAC9B,IACI,GAAI2S,MACAC,EAAO/F,KAAKC,UAAU9M,EAAO,SAASlI,EAAKkI,GAC3C,GAAY,SAARlI,EAAJ,CAGA,GAAqB,gBAAVkI,IAAgC,OAAVA,EAAgB,CAC7C,IAA8B,IAA1B2S,EAAMxW,QAAQ6D,GAEd,MAEJ2S,GAAMzQ,KAAKlC,GAEf,MAAOA,KAEX2S,GAAQ,KACRlB,EAAQ2B,aAAaC,QAAQ7H,EAAMoH,GACrC,MAAOlZ,GACL+B,QAAQC,IAAI,qCAAsC8P,EAAMxL,EAAOtG,KAGvEwZ,EAAa3C,OAAS,SAAS/E,GAC3BiG,EAAQ2B,aAAaE,WAAW9H,IAEpC0H,EAAa5U,GAAK,SAASkN,GAIvB,QAAS+H,GAAa7Z,GAGlB,GADAF,aAAaoG,GACTlG,EAAEiC,cAAc7D,KAAO0T,EACvB,IACI,GAAIxL,GAAQ6M,KAAK2F,MAAM9Y,EAAEiC,cAAc6X,SACvC3P,GAASyL,QAAQtP,GACnB,MAAOiF,GACLxJ,QAAQC,IAAI,gCAAiC8P,EAAMvG,GACnDpB,EAAS0L,OAAO,iBAAmB/D,IAZ/C,GACI5L,GADAiE,EAAWF,EAAGG,QACXsF,EAAUsI,EAAOC,OAmBxB,OAJAna,SAAQuB,QAAQ0Y,GAASnT,GAAG,UAAWiV,GACvC3T,EAAIrG,WAAW,WACXsK,EAAS0L,OAAO,YACjBnG,GACIvF,EAASE,WAGpBtI,QAAQC,IAAI,iDACZwX,EAAaf,OAAST,EAAOS,OAC7Be,EAAajR,IAAMyP,EAAOzP,IAC1BiR,EAAajU,IAAMyS,EAAOzS,IAC1BiU,EAAa3C,OAASmB,EAAOnB,OAC7B2C,EAAa5U,GAAKoT,EAAOpT,IAEtB4U,KAGXpM,EAAIpP,QAAQ,kBAAmB,KAAM,UAAW,SAAU,SAASiM,EAAI8N,EAASC,GAC5E,QAAS+B,MAyFT,MAxEAA,GAAeN,YAff,WACI,GAAItU,IAAY,CAChB,KACIA,EAAY,kBAAoB4S,QAAsCpS,KAA3BoS,EAAQiC,eAC/C7U,GACA4S,EAAQiC,eAAeL,QAAQ,OAAQ,KACvC5B,EAAQiC,eAAeJ,WAAW,SAElCzU,GAAY,EAElB,MAAOnF,GACLmF,GAAY,EAEhB,MAAOA,MAGP4U,EAAeN,aACfM,EAAetB,OAAS,SAAS3G,GAC7B,WAAwCnM,KAAjCoS,EAAQiC,eAAelI,IAElCiI,EAAexU,IAAM,SAASuM,GAC1B,GAAIxL,GAAQ,IACZ,QAAqCX,KAAjCoS,EAAQiC,eAAelI,GACvB,IACIxL,EAAQ6M,KAAK2F,MAAMf,EAAQiC,eAAelI,IAC5C,MAAO9R,GACL+B,QAAQC,IAAI,mCAAoC8P,EAAM9R,GAG9D,MAAOsG,IAEXyT,EAAexR,IAAM,SAASuJ,EAAMxL,GAChC,IACI,GAAI2S,MACAC,EAAO/F,KAAKC,UAAU9M,EAAO,SAASlI,EAAKkI,GAC3C,GAAY,SAARlI,EAAJ,CAGA,GAAqB,gBAAVkI,IAAgC,OAAVA,EAAgB,CAC7C,IAA8B,IAA1B2S,EAAMxW,QAAQ6D,GAEd,MAEJ2S,GAAMzQ,KAAKlC,GAEf,MAAOA,KAEX2S,GAAQ,KACRlB,EAAQiC,eAAeL,QAAQ7H,EAAMoH,GACvC,MAAOlZ,GACL+B,QAAQC,IAAI,uCAAwC8P,EAAMxL,EAAOtG,KAGzE+Z,EAAelD,OAAS,SAAS/E,GAC7BiG,EAAQiC,eAAeJ,WAAW9H,IAEtCiI,EAAenV,GAAK,SAASkN,GAIzB,QAAS+H,GAAa7Z,GAGlB,GADAF,aAAaoG,GACTlG,EAAEiC,cAAc7D,MAAQ0T,EACxB,IACI,GAAIxL,GAAQ6M,KAAK2F,MAAM9Y,EAAEiC,cAAc6X,SACvC3P,GAASyL,QAAQtP,GACnB,MAAOiF,GACLxJ,QAAQC,IAAI,kCAAmC8P,EAAMvG,GACrDpB,EAAS0L,OAAO,iBAAmB/D,IAZ/C,GACI5L,GADAiE,EAAWF,EAAGG,QACXsF,EAAUsI,EAAOC,OAmBxB,OAJAna,SAAQuB,QAAQ0Y,GAASnT,GAAG,UAAWiV,GACvC3T,EAAIrG,WAAW,WACXsK,EAAS0L,OAAO,YACjBnG,GACIvF,EAASE,WAGpBtI,QAAQC,IAAI,mDACZ+X,EAAetB,OAAST,EAAOS,OAC/BsB,EAAexR,IAAMyP,EAAOzP,IAC5BwR,EAAexU,IAAMyS,EAAOzS,IAC5BwU,EAAelD,OAASmB,EAAOnB,OAC/BkD,EAAenV,GAAKoT,EAAOpT,IAExBmV,QAMd,WACA,YAEA,IAAI3M,GAAMtP,QAAQC,OAAO,UAEzBqP,GAAIpP,QAAQ,SAAU,WACrB,QAASic,GAAMC,EAAGC,EAAGxQ,EAAGD,GACvB,GAAIsG,UAAU5Q,OAAS,EACtBjB,KAAK+b,EAAKA,GAAW,IAANA,EAAWA,EAAI,EAC9B/b,KAAKgc,EAAKA,GAAW,IAANA,EAAWA,EAAI,EAC9Bhc,KAAKwL,EAAKA,GAAW,IAANA,EAAWA,EAAI,EAC9BxL,KAAKuL,EAAKA,GAAW,IAANA,EAAWA,EAAI,QACxB,CACN,GAAI0Q,GAAOF,GAAK,UAChBE,GAAOC,SAASD,GACZF,EAAE9a,OAAS,GACdjB,KAAK+b,EAAIE,GAAQ,GAAK,IACtBjc,KAAKgc,EAAIC,GAAQ,GAAK,IACtBjc,KAAKwL,EAAIyQ,GAAQ,EAAI,IACrBjc,KAAKuL,EAAI0Q,GAAQ,EAAI,MAErBjc,KAAK+b,EAAIE,GAAQ,GAAK,IACtBjc,KAAKgc,EAAIC,GAAQ,EAAI,IACrBjc,KAAKwL,EAAIyQ,GAAQ,EAAI,IACrBjc,KAAKuL,EAAI,MA0EZ,MAtEAuQ,GAAMK,eAAiB,SAAU9Q,GAChC,GAAI+Q,GAAM/Q,EAAE5C,SAAS,GACrB,OAAqB,IAAd2T,EAAInb,OAAc,IAAMmb,EAAMA,GAEtCN,EAAMO,KAAO,SAAUC,GAOtB,MALWA,GAAMC,KAChBR,EAAG,GACHC,EAAG,IACHxQ,EAAG,MAILsQ,EAAMU,SAAW,SAAUF,GAE1B,MACQ,IAAIR,GAFDA,EAAMO,KAAKC,GACX,GACO,WAEA,aAGnBR,EAAMW,OAAS,SAAUH,EAAOI,EAAKC,GAKpC,MAJAA,GAAMA,GAAO,EAIN,GAAIb,GAHHva,KAAKC,IAAID,KAAKqb,MAAMN,EAAMP,EAAIY,GAAMpb,KAAKqb,MAAMN,EAAMP,EAAI,IAAMW,IAC/Dnb,KAAKC,IAAID,KAAKqb,MAAMN,EAAMN,EAAIW,GAAMpb,KAAKqb,MAAMN,EAAMN,EAAI,IAAMU,IAC/Dnb,KAAKC,IAAID,KAAKqb,MAAMN,EAAM9Q,EAAImR,GAAMpb,KAAKqb,MAAMN,EAAM9Q,EAAI,IAAMkR,IAC7CJ,EAAM/Q,IAEjCuQ,EAAMe,QAAU,SAAUP,EAAOI,EAAKlb,GAKrC,MAJAA,GAAMA,GAAO,EAIN,GAAIsa,GAHHva,KAAKob,IAAIL,EAAMP,EAAIxa,KAAKqb,OAAO,IAAMN,EAAMP,GAAKva,GAAMD,KAAKqb,MAAMN,EAAMP,EAAI,IAAMW,IACjFnb,KAAKob,IAAIL,EAAMN,EAAIza,KAAKqb,OAAO,IAAMN,EAAMN,GAAKxa,GAAMD,KAAKqb,MAAMN,EAAMN,EAAI,IAAMU,IACjFnb,KAAKob,IAAIL,EAAM9Q,EAAIjK,KAAKqb,OAAO,IAAMN,EAAM9Q,GAAKhK,GAAMD,KAAKqb,MAAMN,EAAM9Q,EAAI,IAAMkR,IAC/DJ,EAAM/Q,IAWjCuQ,EAAM3b,WACL2c,OAAQ,WACP,OAAQ9c,KAAK+b,GAAK,KAAO/b,KAAKgc,GAAK,KAAOhc,KAAKwL,GAAK,GAAMxL,KAAM,GAEjE+c,MAAO,WACN,MAAO,IAAMjB,EAAMK,eAAenc,KAAK+b,GAAKD,EAAMK,eAAenc,KAAKgc,GAAKF,EAAMK,eAAenc,KAAKwL,GAAKsQ,EAAMK,eAAenc,KAAKuL,IAErIyR,OAAQ,WACP,MAAO,QAAUhd,KAAK+b,EAAI,IAAM/b,KAAKgc,EAAI,IAAMhc,KAAKwL,EAAI,KAAOxL,KAAKuL,EAAI,KAAK0R,QAAQ,GAAK,KAE3FV,IAAK,SAAUD,GACd,MAAStc,MAAK+b,EAAI,KAAQO,EAAMP,EAAI,KAAQ/b,KAAKgc,EAAI,KAAQM,EAAMN,EAAI,KAAQhc,KAAKwL,EAAI,KAAQ8Q,EAAM9Q,EAAI,MAE3G0R,MAAO,SAAUR,EAAKC,EAAKnb,GAI1B,MAHAmb,GAAMA,GAAO,EACbnb,EAAMA,GAAO,EACbxB,KAAKuL,EAAIhK,KAAKqb,MAAoC,KAA7BD,EAAOD,GAAOlb,EAAMmb,KAClC3c,MAERmd,QAAS,WAIR,MAHAnd,MAAKod,WAAatB,EAAMU,SAASxc,MACjCA,KAAKqd,OAASvB,EAAMW,OAAOzc,KAAM,IACjCA,KAAKsd,MAAQxB,EAAMe,QAAQ7c,KAAM,IAC1BA,OAGF8b,KAGR7M,EAAIpP,QAAQ,SAAU,WACrB,QAAS0d,MAkFT,MAjFAA,GAAMC,YAAc,SAAUjT,EAAGkT,EAAIC,EAAI3B,EAAG4B,EAAIC,GAC/CD,EAAKA,GAAM,EACXC,EAAKA,GAAM,EAAIrc,KAAKsc,GACpBtT,EAAEuT,IAAIC,IAAIN,EAAIC,EAAI3B,EAAG4B,EAAIC,GAAI,IAE9BL,EAAMS,UAAY,SAAUzT,EAAGkT,EAAIC,EAAIO,EAAIC,EAAIC,GAC9C,GAAInd,GAAGsB,EACH8b,EAAQ7c,KAAKsc,GAAK,EAAI,EACtBQ,EAAO9c,KAAKsc,GAAKM,EACjBL,EAAMvT,EAAEuT,GAEZ,KADAA,EAAIQ,OAAOb,EAAIC,EAAKO,GACflW,EAAI,EAAGA,EAAIoW,EAAOpW,IACtB/G,EAAIyc,EAAKlc,KAAKgd,IAAIH,GAASH,EAC3B3b,EAAIob,EAAKnc,KAAKid,IAAIJ,GAASH,EAC3BH,EAAIW,OAAOzd,EAAGsB,GACd8b,GAASC,EACTrd,EAAIyc,EAAKlc,KAAKgd,IAAIH,GAASF,EAC3B5b,EAAIob,EAAKnc,KAAKid,IAAIJ,GAASF,EAC3BJ,EAAIW,OAAOzd,EAAGsB,GACd8b,GAASC,CAEVP,GAAIW,OAAOhB,EAAIC,EAAKO,IAErBV,EAAMmB,eAAiB,SAAUnU,EAAGnH,EAAM2Y,GACzC,GAAI+B,GAAMvT,EAAEuT,IACX9c,EAAIoC,EAAKpC,EACTsB,EAAIc,EAAKd,EACTK,EAAIS,EAAKT,EACTE,EAAIO,EAAKP,CAIV,QAHiB2E,WAANuU,KACVA,EAAI,GAEY,gBAANA,GACVA,GACC4C,GAAI5C,EACJ6C,GAAI7C,EACJ8C,GAAI9C,EACJ+C,GAAI/C,OAEC,CACN,GAAIgD,IACHJ,GAAI,EACJC,GAAI,EACJC,GAAI,EACJC,GAAI,EAEL,KAAK,GAAI7e,KAAO8e,GACfhD,EAAE9b,GAAO8b,EAAE9b,IAAQ8e,EAAc9e,GAGnC6d,EAAIQ,OAAOtd,EAAI+a,EAAE4C,GAAIrc,GACrBwb,EAAIW,OAAOzd,EAAI2B,EAAIoZ,EAAE6C,GAAItc,GACzBwb,EAAIkB,iBAAiBhe,EAAI2B,EAAGL,EAAGtB,EAAI2B,EAAGL,EAAIyZ,EAAE6C,IAC5Cd,EAAIW,OAAOzd,EAAI2B,EAAGL,EAAIO,EAAIkZ,EAAE8C,IAC5Bf,EAAIkB,iBAAiBhe,EAAI2B,EAAGL,EAAIO,EAAG7B,EAAI2B,EAAIoZ,EAAE8C,GAAIvc,EAAIO,GACrDib,EAAIW,OAAOzd,EAAI+a,EAAE+C,GAAIxc,EAAIO,GACzBib,EAAIkB,iBAAiBhe,EAAGsB,EAAIO,EAAG7B,EAAGsB,EAAIO,EAAIkZ,EAAE+C,IAC5ChB,EAAIW,OAAOzd,EAAGsB,EAAIyZ,EAAE4C,IACpBb,EAAIkB,iBAAiBhe,EAAGsB,EAAGtB,EAAI+a,EAAE4C,GAAIrc,IAEtCib,EAAM0B,OAAS,WACd,GAAI9H,GAAStL,MAAM1L,UAAUoT,MAAM9L,KAAKoK,WACpCiM,EAAM3G,EAAO,GAAG2G,GACpBA,GAAIoB,YACJ3B,EAAMC,YAAYtY,MAAMlF,KAAMmX,GAC9B2G,EAAIqB,aAEL5B,EAAM6B,KAAO,WACZ,GAAIjI,GAAStL,MAAM1L,UAAUoT,MAAM9L,KAAKoK,WACpCiM,EAAM3G,EAAO,GAAG2G,GACpBA,GAAIoB,YACJ3B,EAAMS,UAAU9Y,MAAMlF,KAAMmX,GAC5B2G,EAAIqB,aAEL5B,EAAM8B,UAAY,WACjB,GAAIlI,GAAStL,MAAM1L,UAAUoT,MAAM9L,KAAKoK,WACpCiM,EAAM3G,EAAO,GAAG2G,GACpBA,GAAIoB,YACJ3B,EAAMmB,eAAexZ,MAAMlF,KAAMmX,GACjC2G,EAAIqB,aAEE5B,KAGRtO,EAAIqQ,SAAS,iBAWZC,MAAO,WACPC,MAAO,WACPC,KAAM,WACNC,IAAK,WACLC,UAAW,WACXC,YAAa,WACbC,YAAa,WACbC,UAAW,WACXC,WAAY,WACZC,KAAM,WACNC,IAAK,aAGNhR,EAAIpP,QAAQ,WAAY,KAAM,UAAW,OAAQ,SAAUiM,EAAIoU,EAASxX,GACvE,QAASyX,KACRngB,KAAKogB,SAAU,GAAIF,IAAUvW,QAAQ,EAAG,GACxC3J,KAAKqgB,QAAS,GAAIH,IAAUvW,QAAQ,EAAG,GACvC3J,KAAK4I,MACJjG,EAAG,EACHE,EAAG,GAEJ7C,KAAK6J,QACL7J,KAAKsgB,QAoJN,MAlJAH,GAAQhgB,WACPogB,QAAS,SAAU5d,EAAGE,GACrB,GAAI0H,GAAIvK,KAAKogB,QACZxX,EAAO5I,KAAK4I,KACZ0X,EAAOtgB,KAAKsgB,KACZvE,EAAI,GAAIrT,GAAK,EAAG,EAAG/F,EAAGE,GACtB2d,EAAMF,EAAKzd,KACV7B,EAAG,EACHsB,EAAGsG,EAAK/F,EAIV,IAFA+F,EAAKjG,EAAIpB,KAAKC,IAAIoH,EAAKjG,EAAG6d,EAAIxf,EAAI2B,GAClCiG,EAAK/F,EAAItB,KAAKC,IAAIoH,EAAK/F,EAAG2d,EAAIle,EAAIO,GAC7B0H,EAAEkW,OAAOC,OAAUnW,EAAEkW,OAAOE,QAE1B,GAAI/X,EAAKjG,EAAI4H,EAAEkW,OAAOC,OAAS9X,EAAK/F,EAAI0H,EAAEkW,OAAOE,OAAQ,CAM/D,GAAIF,GAASlW,EAAEkW,MACflW,GAAEqW,UAAU7e,SAASmM,cAAc,WACnC3D,EAAEZ,QAAQf,EAAKjG,EAAGiG,EAAK/F,GACvB0H,EAAEuT,IAAI+C,UAAUJ,EAAQ,EAAG,QAV3BlW,GAAEZ,QAAQf,EAAKjG,EAAGiG,EAAK/F,EAmBxB,OAJAkZ,GAAE/a,EAAIwf,EAAIxf,EACV+a,EAAEzZ,EAAIke,EAAIle,EACVke,EAAIxf,GAAK2B,EACT2d,EAAKzd,GAAK2d,EACHzE,GAER9V,IAAK,SAAUhG,EAAKiX,GACnB,GAAI4J,GAAU9gB,IACd,IAAIL,QAAQohB,SAAS7J,GAAO,CAC3B,GAAIlL,GAAWF,EAAGG,QACd+U,EAAM,GAAIC,MAWd,OAVAD,GAAIE,OAAS,WACZJ,EAAQK,SAASlhB,EAAK+gB,EAAIN,MAAOM,EAAIL,OAAQ,SAAUpW,EAAGnH,GACzDmH,EAAEuT,IAAI+C,UAAUG,EAAK,EAAG,KAEzBhV,EAASyL,QAAQuJ,IAElBA,EAAII,QAAU,WACbpV,EAAS0L,OAAO,eAAiBR,IAElC8J,EAAIK,IAAMnK,EACHlL,EAASE,QAEhB,GAAIiL,GAAStL,MAAM1L,UAAUoT,MAAM9L,KAAKoK,UACxC,OAAOiP,GAAQK,SAASjc,MAAM4b,EAAS3J,IAGzCgK,SAAU,SAAUlhB,EAAK0C,EAAGE,EAAG9C,GAC9B,GAAIwK,GAAIvK,KAAKogB,QACZrE,EAAI/b,KAAKugB,QAAQ5d,EAAGE,EACrB0H,GAAEuT,IAAIwD,OACN/W,EAAEuT,IAAI1a,KAAK2Y,EAAE/a,EAAG+a,EAAEzZ,EAAGyZ,EAAEpZ,EAAGoZ,EAAElZ,GAE5B0H,EAAEuT,IAAIyD,OACNhX,EAAEuT,IAAI0D,UAAUzF,EAAE/a,EAAG+a,EAAEzZ,GACvBvC,EAAS0H,KAAK8C,EAAGA,EAAGwR,EAAEvT,QAAQF,OAAO,EAAG,IACxCiC,EAAEuT,IAAI2D,UACNzhB,KAAK6J,KAAK5J,GAAO8b,GAGlB2F,KAAM,SAAU1Q,EAAQ/Q,EAAKe,EAAGsB,EAAGqf,GAClC,GAAI5F,GAAI/b,KAAK6J,KAAK5J,EACd8b,IAGH/K,EAAO4Q,SAAS5hB,KAAKogB,QAAQK,OAAQ1E,GACpC/a,EAAGA,EACHsB,EAAGA,EACHK,EAAGoZ,EAAEpZ,EACLE,EAAGkZ,EAAElZ,GACH8e,IAKLE,KAAM,SAAU7Q,EAAQ/Q,EAAKe,EAAGsB,EAAGga,EAAOqF,GACzC,GAAI5F,GAAI/b,KAAK6J,KAAK5J,EAClB,IAAI8b,EAAG,CACN,GAAIxR,GAAIvK,KAAKogB,QACZ5U,EAAIxL,KAAKqgB,OAAO1W,QAAQoS,EAAEpZ,EAAGoZ,EAAElZ,EAChC2I,GAAE8V,OACF9V,EAAEsW,QAAQxF,GACV9Q,EAAEuW,WACFvW,EAAEsS,IAAIkE,yBAA2B,mBACjCxW,EAAEsS,IAAI+C,UAAUtW,EAAEkW,OAAQ1E,EAAE/a,EAAG+a,EAAEzZ,EAAGyZ,EAAEpZ,EAAGoZ,EAAElZ,EAAG,EAAG,EAAGkZ,EAAEpZ,EAAGoZ,EAAElZ,GAC3D2I,EAAEiW,UACF7d,QAAQC,IAAI7C,EAAGsB,EAAGkJ,EAAEiV,OAAQzP,EAAOyP,QACnCzP,EAAO0Q,KAAKlW,EAAEiV,QACbzf,EAAGA,EACHsB,EAAGA,GACDqf,KAGLM,QAAS,SAAUjR,EAAQ/Q,EAAKe,EAAGsB,EAAGK,EAAGE,EAAGyZ,GAC3C,QAAS4F,GAAYD,GACpB,GAAInE,GAAM9M,EAAO8M,GACjBA,GAAIwD,OACJxD,EAAI0D,UAAUxgB,EAAGsB,GAIjBwb,EAAIqE,UAAYF,EAChBnE,EAAIiE,UAAU/gB,GAAIsB,EAAGK,EAAGE,GACxBib,EAAI0D,WAAWxgB,GAAIsB,GAEnBwb,EAAI2D,UAEL,GAAI1F,GAAI/b,KAAK6J,KAAK5J,EAClB,IAAI8b,EAAG,CACN,GACCkG,GADGjB,EAAMjF,EAAEiF,GAEZ,IAAKA,GAAOjF,EAAEO,OAASA,EAqBtB2F,EAAUjR,EAAO8M,IAAIsE,cAAcpB,EAAK,UACxCkB,EAAYD,OAtBiB,CAC7B,GAAIzW,GAAIxL,KAAKqgB,OAAO1W,QAAQoS,EAAEpZ,EAAGoZ,EAAElZ,EAC/ByZ,IACHP,EAAEO,MAAQA,EACV9Q,EAAE8V,OACF9V,EAAEsW,QAAQxF,GACV9Q,EAAEuW,WACFvW,EAAEsS,IAAIkE,yBAA2B,mBACjCxW,EAAEsS,IAAI+C,UAAU7gB,KAAKogB,QAAQK,OAAQ1E,EAAE/a,EAAG+a,EAAEzZ,EAAGyZ,EAAEpZ,EAAGoZ,EAAElZ,EAAG,EAAG,EAAGkZ,EAAEpZ,EAAGoZ,EAAElZ,GACtE2I,EAAEiW,WAEFjW,EAAEsS,IAAI+C,UAAU7gB,KAAKogB,QAAQK,OAAQ1E,EAAE/a,EAAG+a,EAAEzZ,EAAGyZ,EAAEpZ,EAAGoZ,EAAElZ,EAAG,EAAG,EAAGkZ,EAAEpZ,EAAGoZ,EAAElZ,GAEvEme,EAAM,GAAIC,OACVD,EAAIE,OAAS,WACZnF,EAAEiF,IAAMA,EACRiB,EAAUjR,EAAO8M,IAAIsE,cAAcpB,EAAK,UACxCkB,EAAYD,IAEbjB,EAAIK,IAAM7V,EAAE6W,gBAQTlC,KAGRlR,EAAIpP,QAAQ,WAAY,QAAS,OAAQ,QAAS,gBAAiB,SAAU0d,EAAO7U,EAAMoT,EAAOwG,GAChG,QAASpC,GAAQO,GAChBA,EAASA,GAAU1e,SAASmM,cAAc,UAC1ClO,KAAKoD,KAAO,GAAIsF,GAChB1I,KAAKuiB,YAAc,GAAI7Z,GACvB1I,KAAKwiB,YACLxiB,KAAK4gB,UAAUH,GAEhBP,EAAQuC,UACR9iB,QAAQ2G,QAAQgc,EAAe,SAAUna,EAAOlI,GAC/CigB,EAAQuC,OAAOxiB,GAAO,GAAI6b,GAAM3T,GAAOgV,WAE3B+C,GAAQuC,MA2MrB,OA1MAvC,GAAQ/f,WACPsiB,OAAQvC,EAAQuC,OAChBD,UAAW,WACV,GAAIC,GAASziB,KAAKyiB,MAClB9iB,SAAQ2G,QAAQgc,EAAe,SAAUna,EAAOlI,GAC/CwiB,EAAOxiB,GAAO,GAAI6b,GAAM3T,GAAOgV,aAGjCyD,UAAW,SAAUH,GACpBzgB,KAAKygB,OAASA,EACdzgB,KAAK2J,QAAQ8W,EAAOiC,YAAajC,EAAOkC,aACxC,IAAI7E,GAAM2C,EAAOmC,WAAW,KAG5B,OAFA9E,GAAI+E,QAAU,SACd7iB,KAAK8d,IAAMA,EACJ9d,MAER2J,QAAS,SAAUhH,EAAGE,GAKrB,MAJA7C,MAAKygB,OAAOC,MAAQ/d,EACpB3C,KAAKygB,OAAOE,OAAS9d,EACrB7C,KAAKoD,KAAKT,EAAIA,EACd3C,KAAKoD,KAAKP,EAAIA,EACP7C,MAERuI,KAAM,SAAUkY,GAEf,MADAzgB,MAAK8d,IAAI+C,UAAUJ,EAAQ,EAAG,GACvBzgB,MAER8iB,MAAO,WAGN,MAFA9iB,MAAK2F,SAEE3F,MAER2F,OAAQ,WAEP,MADA3F,MAAK2J,QAAQ3J,KAAKygB,OAAOiC,YAAa1iB,KAAKygB,OAAOkC,cAC3C3iB,MAER+iB,QAAS,SAAUC,EAAMC,EAAOC,EAAe5G,GAC9C0G,EAAOA,GAAQ,iBACfC,EAAQA,GAAS,SACjBC,EAAgBA,GAAiB,SACjC5G,EAAQA,GAAStc,KAAKyiB,OAAOlD,KAC7B,IAAIzB,GAAM9d,KAAK8d,GAKf,OAJAA,GAAIkF,KAAOA,EACXlF,EAAIqF,UAAYF,EAChBnF,EAAIsF,aAAeF,EACnBpF,EAAIqE,UAAY7F,EAAMU,SACfhd,MAER8hB,QAAS,SAAUxF,GAUlB,MATAA,GAAQA,GAAStc,KAAKyiB,OAAOlD,MACnBvf,KAAK8d,IAOXqE,UAAY7F,EAAMU,SACfhd,MAERqjB,UAAW,SAAU/G,EAAO1T,GAC3B0T,EAAQA,GAAStc,KAAKyiB,OAAOlD,KAC7B,IAAIzB,GAAM9d,KAAK8d,GAYf,OAXAlV,GAAOA,GAAQ,EASfkV,EAAIwF,YAAchH,EAAMU,SACxBc,EAAIyF,UAAY3a,EACT5I,MASRwjB,SAAU,SAAUC,EAAMvb,EAAOwY,EAAOnI,EAAMmL,GAS7C,MARIhD,KACHnI,EAAOA,GAAQ,GACfmL,EAAYA,GAAaniB,KAAKqb,MAAM8D,EAAQ,GACxC+C,EAAKxiB,OAASyiB,IACjBD,EAAOA,EAAKE,OAAO,EAAGpiB,KAAKob,IAAI8G,EAAKxiB,OAAQyiB,IAAYE,OAASrL,IAGnEvY,KAAK8d,IAAI0F,SAASC,EAAMvb,EAAMlH,EAAGkH,EAAM5F,GAChCtC,MAER+hB,SAAU,SAAU3e,GACnBA,EAAOA,GAAQpD,KAAKoD,IACpB,IAAI0a,GAAM9d,KAAK8d,IACd9c,EAAIoC,EAAKpC,EACTsB,EAAIc,EAAKd,EACTK,EAAIS,EAAKT,EACTE,EAAIO,EAAKP,CAEV,OADAib,GAAIiE,SAAS/gB,EAAGsB,EAAGK,EAAGE,GACf7C,MAER6jB,WAAY,SAAUzgB,GACrBA,EAAOA,GAAQpD,KAAKoD,IACpB,IAAI0a,GAAM9d,KAAK8d,IACd9c,EAAIoC,EAAKpC,EACTsB,EAAIc,EAAKd,EACTK,EAAIS,EAAKT,EACTE,EAAIO,EAAKP,CAEV,OADAib,GAAI+F,WAAW7iB,EAAGsB,EAAGK,EAAGE,GACjB7C,MAER8jB,KAAM,WAEL,MADA9jB,MAAK8d,IAAIgG,OACF9jB,MAER+jB,OAAQ,WAEP,MADA/jB,MAAK8d,IAAIiG,SACF/jB,MAERgkB,MAAO,WAEN,MADAhkB,MAAK8d,IAAIoB,YACFlf,MAERikB,MAAO,WAEN,MADAjkB,MAAK8d,IAAIqB,YACFnf,MAERshB,KAAM,WAEL,MADAthB,MAAK8d,IAAIwD,OACFthB,MAERyhB,QAAS,WAER,MADAzhB,MAAK8d,IAAI2D,UACFzhB,MAERkkB,OAAQ,SAAU9F;mBACjBpe,KAAK8d,IAAIoG,OAAO9F,EAAQ7c,KAAKsc,GAAK,MAEnC2D,UAAW,SAAU2C,GACpBnkB,KAAK8d,IAAI0D,UAAU2C,EAAGnjB,EAAGmjB,EAAG7hB,IAE7B+f,UAAW,WACV,MAAOriB,MAAKygB,OAAO4B,aAEpBX,KAAM,SAAU0C,EAAO7f,EAAGod,GACzB,GAAIyC,EAAO,CACV7f,EAAE5B,EAAI4B,EAAE5B,GAAKyhB,EAAM1D,MACnBnc,EAAE1B,EAAI0B,EAAE1B,GAAKuhB,EAAMzD,MACnB,IAAI7C,GAAM9d,KAAK8d,IACd1a,EAAOpD,KAAKuiB,YACZvhB,EAAIoC,EAAKpC,EAAIuD,EAAEvD,EAAIuD,EAAE5B,EAAI,EACzBL,EAAIc,EAAKd,EAAIiC,EAAEjC,EAAIiC,EAAE1B,EAAI,CACrBO,GAAKT,EAAI4B,EAAE5B,EACXS,EAAKP,EAAI0B,EAAE1B,CAChBib,GAAIwD,OACJxD,EAAI0D,UAAUxgB,EAAGsB,GACbqf,GACHA,EAAIla,KAAKzH,MAEV8d,EAAI+C,UAAUuD,EAAO,EAAG,GACxBtG,EAAI2D,UAGL,MAAOzhB,OAER4hB,SAAU,SAAUwC,EAAO/T,EAAG9L,EAAGod,GAChC,GAAIyC,EAAO,CACV/T,EAAE1N,EAAI0N,EAAE1N,GAAKyhB,EAAM1D,MACnBrQ,EAAExN,EAAIwN,EAAExN,GAAKuhB,EAAMzD,OACnBpc,EAAE5B,EAAI4B,EAAE5B,GAAKyhB,EAAM1D,MACnBnc,EAAE1B,EAAI0B,EAAE1B,GAAKuhB,EAAMzD,MACnB,IAAI7C,GAAM9d,KAAK8d,IACd1a,EAAOpD,KAAKuiB,YACZvhB,EAAIoC,EAAKpC,EAAIuD,EAAEvD,EAAIqP,EAAE1N,EAAI,EACzBL,EAAIc,EAAKd,EAAIiC,EAAEjC,EAAI+N,EAAExN,EAAI,CACrBO,GAAKT,EAAI4B,EAAE5B,EACXS,EAAKP,EAAI0B,EAAE1B,CAChBib,GAAIwD,OACJxD,EAAI0D,UAAUxgB,EAAGsB,GACbqf,GACHA,EAAIla,KAAKzH,MAEV8d,EAAI+C,UAAUuD,EAAO/T,EAAErP,EAAGqP,EAAE/N,EAAG+N,EAAE1N,EAAG0N,EAAExN,EAAG,EAAG,EAAG0B,EAAE5B,EAAG4B,EAAE1B,GACtDib,EAAI2D,UAGL,MAAOzhB,OAERqkB,KAAM,SAAU7V,GACfA,EAAQA,IACPxN,EAAG,EACHsB,GAAI,EAEL,IAAIwb,GAAM9d,KAAK8d,IACd1a,EAAOpD,KAAKuiB,WACbzE,GAAI0D,WAAuB,IAAbhT,EAAMxN,EAAWoC,EAAKT,EAAI,GAAgB,IAAb6L,EAAMlM,EAAWc,EAAKP,EAAI,GACrEib,EAAItP,MAAMA,EAAMxN,EAAGwN,EAAMlM,KAGpB4d,QAOR,WACG,YAEA,IAAIjR,GAAMtP,QAAQC,OAAO,UAEzBqP,GAAIqV,UAAU,mBAAoB,WAC9B,OACIC,SAAU,IACVC,YAAa,yBACbC,YACIC,QAAW,iBAEfrS,KAAM,SAASnM,EAAOhF,EAASyjB,EAAYjK,SAInDzL,EAAIqV,UAAU,WAAY,SAAU,SAASM,GACzC,QAASC,GAAY/R,EAAQC,EAASC,GAClCF,EAASA,GAAU,GACnBC,EAAUA,GAAW,EACrB,IAAIE,GAAWH,EAAOI,MAAM,IAC5B,IAAID,EAAShS,OAAS,EAAG,CACrB,GAAIkS,GAAYF,EAASjI,OAQzB,OAPArL,SAAQ2G,QAAQ2M,EAAU,SAAS9K,EAAOuC,GAElCyI,EADAH,EACYG,EAAUD,MAAM,IAAMxI,EAAQ,KAAKmE,KAAK,OAAUkE,EAAU5K,EAAQ,QAEpEgL,EAAUD,MAAM,IAAMxI,EAAQ,KAAKmE,KAAKkE,EAAU5K,KAGlE6K,EACO,IAAOG,EAAY,IAEnBA,EAGX,MAAOJ,GAAUD,EAGzB,GAAIgS,GAAW,CACf,QACIP,SAAU,IACVC,YAAa,SAAStjB,EAASyjB,GAC3B,GAAII,GAAW,oBACf,QAAQJ,EAAWK,SACf,IAAK,SACDD,EAAW,uBAGnB,MAAOA,IAEX7e,OACI+e,QAAS,IACTC,SAAU,IACVhQ,KAAM,IACNiQ,MAAO,IACPC,YAAa,IACbC,OAAQ,KACRplB,IAAK,KACL6N,MAAO,MAEXwX,QAAS,UACTb,YAAY,EACZpS,MACIsP,IAAK,SAAiBzb,EAAOhF,EAASyjB,EAAYpS,EAAYkS,GAC1D,GAAI3W,GAAQ5H,EAAM4H,MAAS5H,EAAM4H,MAAQ5H,EAAM4H,MAAQ,OACnD7N,EAAMiG,EAAMjG,IAAOiG,EAAMjG,IAAMiG,EAAMjG,IAAM,IAC/C,IAA2B,WAAvB0kB,EAAWK,QAAsB,CACjC,GAAItd,GAAUid,EAAWjd,OAAS,KAAOid,EAAWjd,OAAS,GACzD6d,EAAcV,EAAY/W,EAAO,SAAS,EAC9C5H,GAAMsf,WAAa,WACf,MAAOb,GAAWc,OACd,QAAUxlB,EAAM,OAASslB,EAAc,kDAAoD7d,EAC3F6d,EAAc,kDAAoD7d,EAAS,kBAAoBzH,GAG3G,GAEIklB,IAFOjf,EAAMzD,KAAOkiB,EAAWK,QACxB9e,EAAMgP,KAAOhP,EAAMgP,MAAQ,OAC1BhP,EAAMif,MAAQjf,EAAMif,OAAS,WACvBjf,GAAMkf,YAAclf,EAAMkf,aAAeD,EAC/Cjf,EAAMwf,MAAQP,EAAM1L,QAAQ,gBAAiB,IAAIvG,MAAM,KAAKrE,KAAK,OAASiW,CACtF5e,GAAM2M,OAAS8R,EAAW9R,QAAU,KACpC3M,EAAMyf,UAAYhB,EAAWgB,WAAa,KAC1Czf,EAAM0f,SAAWjB,EAAWiB,UAAYjB,EAAWK,QACnD9e,EAAM2f,UAAYlB,EAAWkB,WAAa,EAC1C3f,EAAMwd,UAAYiB,EAAWjB,WAAaoC,OAAOC,kBACjD7f,EAAMyW,IAAMgI,EAAWhI,KAAO,KAC9BzW,EAAM1E,IAAMmjB,EAAWnjB,KAAO,KAC9B0E,EAAMe,QAAU2d,EAAOD,EAAW1d,SAASf,OAC3CA,EAAM8f,OAAQ,EACd9f,EAAM+f,SAAU,EAChB/f,EAAMggB,SAAW,SAASxL,GACtBkK,EAAOD,EAAWuB,UAAUhgB,EAAMigB,UAEtCjgB,EAAMkgB,SAAW,SAAS1L,GACtBkK,EAAOD,EAAWyB,UAAUlgB,EAAMigB,UAEtCjgB,EAAMmgB,QAAU,WACZ,GAAI5jB,GAAO,MACX,QAAQkiB,EAAWK,SACf,IAAK,WACDviB,EAAOyD,EAAM+f,QAAU,OAAS,UAChC,MACJ,SACIxjB,EAAOkiB,EAAWK,QAE1B,MAAOviB,IAEXyD,EAAMogB,WAAa,WACf,GAAIpR,GAAO0P,EAAO1e,EAAMgP,MAAMhP,EAAMigB,SAChCT,EAAQd,EAAO1e,EAAMgP,KAAO,IAAMhP,EAAMwf,OAAOxf,EAAMigB,QACzD,QACII,gBAAiBrgB,EAAM8f,MACvBQ,kBAAmBd,EAAMe,OACzBC,gBAAiBhB,EAAMiB,WAAazR,EAAK0R,YAAclB,EAAMmB,UAC7DC,iBAAkBpB,EAAMqB,aAGhC7gB,EAAM8gB,YAAc,WAChB,GAAI9R,GAAO0P,EAAO1e,EAAMgP,MAAMhP,EAAMigB,SAChCT,EAAQd,EAAO1e,EAAMgP,KAAO,IAAMhP,EAAMwf,OAAOxf,EAAMigB,QACzD,QAAQjR,EAAK0R,YAAclB,EAAMmB,WAAanB,EAAMuB,QAExD/gB,EAAMghB,iBAAmB,WACrBhhB,EAAM+f,SAAW/f,EAAM+f,eAO3ChX,EAAIqV,UAAU,YAAa,QAAS,iBAAkB,WAAY,SAAU,SAAS1M,EAAOuP,EAAgBnX,EAAU4U,GAClH,QAASC,GAAY/R,EAAQC,EAASC,GAClCF,EAASA,GAAU,GACnBC,EAAUA,GAAW,EACrB,IAAIE,GAAWH,EAAOI,MAAM,IAC5B,IAAID,EAAShS,OAAS,EAAG,CACrB,GAAIkS,GAAYF,EAASjI,OAQzB,OAPArL,SAAQ2G,QAAQ2M,EAAU,SAAS9K,EAAOuC,GAElCyI,EADAH,EACYG,EAAUD,MAAM,IAAMxI,EAAQ,KAAKmE,KAAK,OAAUkE,EAAU5K,EAAQ,QAEpEgL,EAAUD,MAAM,IAAMxI,EAAQ,KAAKmE,KAAKkE,EAAU5K,KAGlE6K,EACO,IAAOG,EAAY,IAEnBA,EAGX,MAAOJ,GAAUD,EAGzB,GAAIgS,GAAW,CACf,QACIP,SAAU,IACVC,YAAa,SAAStjB,EAASyjB,GAC3B,GAAII,GAAW,oBACf,QAAQJ,EAAWK,SACf,IAAK,SACDD,EAAW,uBAGnB,MAAOA,IAEX7e,OACI+e,QAAS,IACTC,SAAU,IACVhQ,KAAM,IACNiQ,MAAO,IACPC,YAAa,KAEjBE,QAAS,UAKT8B,QAAS,SAASlmB,EAASyjB,GACnB,OACIhD,IAAK,SAASzb,EAAOhF,EAASyjB,GAC1B,GAA2B,WAAvBA,EAAWK,QAAsB,CACjC,GAAIlX,GAAS6W,EAAW7W,MAAQ6W,EAAW7W,MAAQ,OAC/C7N,EAAO0kB,EAAW1kB,IAAM0kB,EAAW1kB,IAAM,KACzCyH,EAAUid,EAAWhI,IAAM,kBAAqB1c,EAAM,MAAS0kB,EAAWhI,IAAM,IAAM,GACtF4I,EAAcV,EAAY/W,EAAO,SAAS,EAC9C5H,GAAMe,QAAU0d,EAAWc,OACvB,QAAUxlB,EAAM,OAASslB,EAAc,2CAA6CZ,EAAWU,OAAS3d,EACxG6d,EAAc,2CAA6CZ,EAAWU,OAAS3d,EAAS,kBAAoBzH,EAChH2D,QAAQC,IAAI,sBAAuBqC,EAAMe,SAE7C,GAEIke,IAFOjf,EAAMzD,KAAOkiB,EAAWK,QACxB9e,EAAMgP,KAAOhP,EAAMgP,MAAQ,OAC1BhP,EAAMif,MAAQjf,EAAMif,OAAS,WACvBjf,GAAMkf,YAAclf,EAAMkf,aAAeD,EAC/Cjf,EAAMwf,MAAQP,EAAM1L,QAAQ,gBAAiB,IAAIvG,MAAM,KAAKrE,KAAK,OAASiW,CACtF5e,GAAM0f,SAAWjB,EAAWiB,UAAYjB,EAAWK,QACnD9e,EAAM2M,OAAS8R,EAAW9R,QAAU,KACpC3M,EAAMyf,UAAYhB,EAAWgB,WAAa,KAC1Czf,EAAM0f,SAAWjB,EAAWiB,UAAYjB,EAAWK,QACnD9e,EAAM2f,UAAYlB,EAAWhI,KAAO,EACpCzW,EAAMwd,UAAYiB,EAAWnjB,KAAOskB,OAAOC,kBAC3C7f,EAAMe,QAAU2d,EAAOD,EAAW1d,SAASf,OAC3CA,EAAM8f,OAAQ,EACd9f,EAAM+f,SAAU,EAChB/f,EAAMmgB,QAAU,WACZ,GAAI5jB,GAAO,MACX,QAAQkiB,EAAWK,SACf,IAAK,WAGDviB,EAAOyD,EAAM+f,QAAU,OAAS,UAChC,MACJ,SACIxjB,EAAOkiB,EAAWK,QAG1B,MAAOviB,IAEXyD,EAAMogB,WAAa,WACf,GAAIpR,GAAO0P,EAAO1e,EAAMgP,MAAMhP,EAAMigB,SAChCT,EAAQd,EAAO1e,EAAMgP,KAAO,IAAMhP,EAAMwf,OAAOxf,EAAMigB,QACzD,QACII,gBAAiBrgB,EAAM8f,MACvBQ,kBAAmBd,EAAMe,OACzBC,gBAAiBhB,EAAMiB,WAAazR,EAAK0R,YAAclB,EAAMmB,UAC7DC,iBAAkBpB,EAAMqB,aAGhC7gB,EAAM8gB,YAAc,WAChB,GAAI9R,GAAO0P,EAAO1e,EAAMgP,MAAMhP,EAAMigB,SAChCT,EAAQd,EAAO1e,EAAMgP,KAAO,IAAMhP,EAAMwf,OAAOxf,EAAMigB,QACzD,QAAQjR,EAAK0R,YAAclB,EAAMmB,WAAanB,EAAMuB,eAkBhFhY,EAAIqV,UAAU,gBAAiB,SAAU,WAAY,SAASM,EAAQrY,GAClE,OACIgY,SAAU,IACVQ,SAAU,8QAKVtL,SAAS,EACTgL,YAAY,EACZpS,KAAM,SAASnM,EAAOhF,EAASyjB,EAAYjK,GAKvC,QAAS2M,GAASxlB,GACd,GAAI8a,GAAMiI,EAAOD,EAAWhI,KAAKzW,GAC7BohB,EAAS1C,EAAOD,EAAW4C,cAC3BC,EAASF,EAAOG,MACpBlb,GAAS,WACLib,EAAOthB,EAAO3E,KAAKC,IAAImb,EAAK2K,EAAOphB,GAAS,MAKpD,QAASwhB,GAAM7lB,GACX,GAAIL,GAAMojB,EAAOD,EAAWnjB,KAAK0E,GAC7BohB,EAAS1C,EAAOD,EAAW4C,cAC3BC,EAASF,EAAOG,MACpBlb,GAAS,WACLib,EAAOthB,EAAO3E,KAAKob,IAAInb,EAAK8lB,EAAOphB,GAAS,MAUpD,QAASyhB,KACLhoB,QAAQuB,QAAQ0mB,GAAYjhB,IAAI,uBAAwB0gB,GACxD1nB,QAAQuB,QAAQ2mB,GAASlhB,IAAI,uBAAwB+gB,GA/BzD,GAAI3kB,GAAO7B,EAAQ,GACf0mB,EAAa7kB,EAAK+kB,iBAAiB,2BAA2B,GAC9DD,EAAU9kB,EAAK+kB,iBAAiB,2BAA2B,EA+B/D5hB,GAAMQ,IAAI,WAAY,WAClBihB,MAVJ,WACIhoB,QAAQuB,QAAQ0mB,GAAYnhB,GAAG,uBAAwB4gB,GACvD1nB,QAAQuB,QAAQ2mB,GAASphB,GAAG,uBAAwBihB,cAkBvE,WACG,YAEU/nB,SAAQC,OAAO,WAErB0kB,UAAU,YAAa,UAAW,SAAS3c,GAC3C,OACI2d,QAAS,UACTjT,KAAM,SAASnM,EAAOhF,EAASyjB,EAAYjK,GA8FvC,QAASqN,KACL/B,GAAQ,EACJnT,IACA3R,EAAQ,GAAGiH,MAAQuS,EAAMsN,aAAe,KACnCtN,EAAMsN,aACPtN,EAAMuN,cAAc,OAKhC,QAASC,KACL,GAAIrV,IAAW6H,EAAMiM,SACjB,OAAQlkB,GACJ,IAAK,OACL,IAAK,WACL,IAAK,iBACDvB,EAAQ,GAAGiH,MAAQuS,EAAMsN,YAAcrgB,EAAQ,QAAQ+S,EAAMsN,YAAanV,GAAU,GACpF,MACJ,SACI3R,EAAQ,GAAGiH,MAAQuS,EAAMsN,YAAcrgB,EAAQ,UAAU+S,EAAMsN,YAAarC,GAAa,IAAM9S,EAAS,KAMxH,QAASsV,KACLnC,GAAQ,EACRkC,IAQJ,QAASP,KACLzmB,EAAQyF,IAAI,QAASohB,GACrB7mB,EAAQyF,IAAI,OAAQwhB,GAlIxB,GAAI1lB,GAAOkiB,EAAWiB,SAClB/S,EAAS8R,EAAW9R,QAAU,GAC9B8S,EAAYhB,EAAWgB,WAAa,EACpCK,GAAQ,CAEZ,QAAQvjB,GACJ,IAAK,OACL,IAAK,WACL,IAAK,iBACDiY,EAAM0N,YAAY/d,KAAK,SAASlC,GAC5B,MAAIA,GACOR,EAAQ,QAAQQ,EAAO0K,GAEvB,MAGf,MACJ,KAAK,SACD6H,EAAM2N,SAAS1O,QAAQ,SAASxR,GAC5B,GAAImgB,IAAQ,CA0BZ,YAzBc9gB,KAAVW,GAAiC,KAAVA,GACvBmgB,GAA6D,IAArDC,OAAOpgB,GAAO7D,QAAQwhB,OAAO3d,GAAOM,YAC5CN,EAAQ2d,OAAO3d,GACfuS,EAAM8N,aAAa,SAAUF,GACzBA,IACA5N,EAAM8N,aAAa,WAAYrgB,GAAS,SACjBX,KAAnBmd,EAAWhI,KACXjC,EAAM8N,aAAa,QAASrgB,GAAS2d,OAAOnB,EAAWhI,UAEpCnV,KAAnBmd,EAAWnjB,KACXkZ,EAAM8N,aAAa,QAASrgB,GAAS2d,OAAOnB,EAAWnjB,SAI/D8mB,GAAQ,EACRngB,EAAQ2d,OAAO3d,GACfuS,EAAM8N,aAAa,UAAU,GAC7B9N,EAAM8N,aAAa,YAAY,OACRhhB,KAAnBmd,EAAWhI,KACXjC,EAAM8N,aAAa,SAAS,OAEThhB,KAAnBmd,EAAWnjB,KACXkZ,EAAM8N,aAAa,SAAS,IAG7BrgB,IAEXuS,EAAM0N,YAAY/d,KAAK,SAASlC,GAC5B,MAAIA,GACOR,EAAQ,UAAUQ,EAAOwd,GAAa,IAAM9S,EAE5C,MAGf,MACJ,KAAK,YACD6H,EAAM2N,SAAS1O,QAAQ,SAASxR,GAC5B,GAAImgB,IAAQ,CAwBZ,YAvBc9gB,KAAVW,GAAiC,KAAVA,GACvBmgB,GAA6D,IAArDC,OAAOpgB,GAAO7D,QAAQwhB,OAAO3d,GAAOM,YAC5CN,EAAQ2d,OAAO3d,GACfuS,EAAM8N,aAAa,SAAUF,GACzBA,QACuB9gB,KAAnBmd,EAAWhI,KACXjC,EAAM8N,aAAa,QAASrgB,GAAS2d,OAAOnB,EAAWhI,UAEpCnV,KAAnBmd,EAAWnjB,KACXkZ,EAAM8N,aAAa,QAASrgB,GAAS2d,OAAOnB,EAAWnjB,SAI/D8mB,GAAQ,EACRngB,EAAQ2d,OAAO3d,GACfuS,EAAM8N,aAAa,UAAU,OACNhhB,KAAnBmd,EAAWhI,KACXjC,EAAM8N,aAAa,SAAS,OAEThhB,KAAnBmd,EAAWnjB,KACXkZ,EAAM8N,aAAa,SAAS,IAG7BrgB,IAEXuS,EAAM0N,YAAY/d,KAAK,SAASlC,GAC5B,MAAIA,IAAmB,IAAVA,EACFR,EAAQ,UAAUQ,EAAOwd,GAAa,IAAM9S,EAE5C,OA6CvB3M,EAAMQ,IAAI,WAAY,WAClBihB,MAVJ,WACIzmB,EAAQuF,GAAG,QAASshB,GACpB7mB,EAAQuF,GAAG,OAAQ0hB,cAkBtC,WACG,YAEUxoB,SAAQC,OAAO,WAErB0kB,UAAU,aAAc,SAAU,mBAAoB,WAAY,cAAe,QAAS,SAASM,EAAQ6D,EAAkBzY,EAAUC,EAAaC,GAEpJ,QAASgC,GAAkBhM,EAAOhF,EAASiR,EAAMC,GAE7ClR,EAAQiR,KAAKA,EACb,IAAIE,GAAOrC,EAAS9O,EAAQoR,WAC5B,IAAIF,EAAKG,WAAY,CACjB,GAAIC,GAAStM,EAAMuM,MACnB9S,SAAQ2M,OAAOkG,EAAQJ,EACvB,IAAIG,GAAatC,EAAYmC,EAAKG,YAAcC,OAAQA,GACpDJ,GAAKM,eACLxM,EAAMkM,EAAKM,cAAgBH,GAE/BrR,EAAQkR,KAAK,0BAA2BG,GACxCrR,EAAQyR,WAAWP,KAAK,0BAA2BG,GACnDrM,EAAQsM,EAEZH,EAAKnM,GAGT,OACIqe,SAAU,IACVmE,UAAW,IACXrW,KAAM,SAASnM,EAAOhF,EAASyjB,EAAYjK,GACvC,GAAIiO,GAAQ/D,EAAOD,EAAWiE,UAC9BD,GAAQA,EAAMziB,GACdyiB,EAAMnE,YAAcmE,EAAMnE,aAAe,uBACzCiE,EAAiBE,EAAMnE,aAAajN,KAAK,SAASpF,GAC9CD,EAAkBhM,EAAOhF,EAASiR,EAAMwW,aA+B3D,WACG,YAEUhpB,SAAQC,OAAO,WAErBipB,SAAS,UAAW,WASpB,QAASC,GAAK5R,EAAMyR,GAEhB,MADAI,GAAO7R,GAAQyR,EACR3oB,KATX,GAAIgpB,MACAD,IAEJ/oB,MAAKgpB,OAASA,EACdhpB,KAAK+oB,OAASA,EACd/oB,KAAK8oB,KAAOA,EAOZ9oB,KAAKiY,MAAQ,KAAM,WAAY,SAAsBnM,EAAIS,GAErD,QAAS0c,GAASN,GAEd,GAAIje,IAAS,CACb/K,SAAQ2G,QAAQ0iB,EAAQ,SAASE,EAAGnhB,GAC5BmhB,IAAMP,IACNje,EAAQ3C,MAGD,IAAX2C,GACA6B,EAAS,WACLoc,EAAMQ,QAAS,EACfH,EAAOre,OAAOD,EAAO,GACjBse,EAAO/nB,SACP+nB,EAAOA,EAAO/nB,OAAS,GAAGkoB,QAAS,KAMnD,QAASC,GAAWT,GAEhB,GAAIje,IAAS,CACb/K,SAAQ2G,QAAQ0iB,EAAQ,SAASE,EAAGnhB,GAC5BmhB,IAAMP,IACNje,EAAQ3C,MAGD,IAAX2C,IACAie,EAAMQ,QAAS,EACf5c,EAAS,WACL,KAAOyc,EAAO/nB,QACV+nB,EAAOre,OAAOqe,EAAO/nB,OAAS,EAAG,IAEtC,MAIX,QAASooB,GAASnS,EAAMC,GAEpB,GAAInL,GAAWF,EAAGG,OAClBkL,GAASA,GAAU,IACnB,IAAIwR,IACAxD,MAAO,WACP5S,WAAY,KACZiS,YAAa,KACbrN,OAAQA,GAERE,EAAU0R,EAAO7R,EA6BrB,OA5BIG,IACA1X,QAAQ2M,OAAOqc,EAAOtR,GAE1BsR,EAAM3c,SAAWA,EACjB2c,EAAMW,KAAO,SAASlX,GAClB6W,EAASjpB,MACT2oB,EAAM3c,SAASyL,QAAQrF,EAAMuW,IAEjCA,EAAMlR,QAAU,SAASrF,GACrBgX,EAAWppB,MACX2oB,EAAM3c,SAASyL,QAAQrF,EAAMuW,IAEjCA,EAAMjR,OAAS,WACX0R,EAAWppB,MACX2oB,EAAM3c,SAAS0L,OAAOiR,IAE1BK,EAAO3e,KAAKse,GACZhpB,QAAQ2G,QAAQ0iB,EAAQ,SAASE,EAAGnhB,GAChCmhB,EAAEC,QAAS,IAEXH,EAAO/nB,OACP0nB,EAAMQ,QAAS,EAEf5c,EAAS,WACLoc,EAAMQ,QAAS,GAEhB,KAEAnd,EAASE,QAGpB,OACI8c,OAAQA,EACRK,SAAUA,WASzB,WACA,YAEA,IAAIpa,GAAMtP,QAAQC,OAAO,UAEzBqP,GAAIqV,UAAU,OAAQ,SAAU,MAAO,SAAUM,EAAQ2E,GACxD,OACChF,SAAU,IACVC,YAAa,SAAUtjB,EAASyjB,GAC/B,MAAOA,GAAWI,UAAY,mBAE/B7e,OACC2E,MAAO,QAERwH,KAAM,SAAUnM,EAAOhF,EAASyjB,EAAYjK,GAC3CxU,EAAMsjB,OAAO,QAAS,SAAUrhB,GAE/B,GAAIA,EACH,GAAIxI,QAAQ8pB,QAAQthB,GAAQ,CAC3B,GAAIuhB,GAAS9E,EAAOD,EAAW+E,QAAQxjB,EAAMigB,SACzCwD,EAAQ/E,EAAOD,EAAWgF,OAAOzjB,EAAMigB,SACvCyD,EAAM,GAAIL,IACbG,OAAQA,EACRC,MAAOA,GAERC,GAAIC,SAAS1hB,GACbjC,EAAM4B,KAAO8hB,MAEHzhB,aAAiBohB,KAC3BrjB,EAAM4B,KAAOK,UAQnB8G,EAAIqV,UAAU,WAAY,WAAY,SAAU/X,GAC/C,OACCgY,SAAU,IACVC,YAAa,SAAUtjB,EAASyjB,GAC/B,MAAOA,GAAWI,UAAY,wBAE/B7e,OACC4B,KAAM,YAEPuK,KAAM,SAAUnM,EAAOhF,EAASyjB,EAAYjK,GAK3C,QAASoP,GAAShiB,EAAMiiB,GACvB,GAAInd,GAAQ9E,EAAKkiB,KAAKpd,KACtBA,GAAMuc,QAAS,EAEf5c,EAAS,WACRK,EAAMmd,UAAYA,EAClBnd,EAAMqd,OAASrd,EAAMsd,SAAU,EAC/Btd,EAAMud,SAAU,EAChB5d,EAAS,WACRK,EAAMud,SAAU,EAChBvd,EAAMwd,QAAS,MAKlB,QAASC,GAAUviB,EAAMiiB,GACxB,GAAInd,GAAQ9E,EAAKkiB,KAAKpd,KACtBA,GAAMuc,QAAS,EACf5c,EAAS,WACRK,EAAMmd,UAAYA,EAClBnd,EAAMwd,OAASxd,EAAMud,SAAU,EAC/Bvd,EAAMsd,SAAU,EAChB3d,EAAS,WACRK,EAAMsd,SAAU,EAChBtd,EAAMqd,QAAS,MAGbniB,EAAK+C,OACRlL,QAAQ2G,QAAQwB,EAAK+C,MAAO,SAAUwI,GACrCgX,EAAUhX,GAAG,KAKhB,QAASiX,GAAWxiB,GAEnB,GAAI8E,GAAQ9E,EAAKkiB,KAAKpd,KACtBA,GAAMuc,QAASrhB,EAAK+C,QAAS+B,EAAMuc,OAC/Bvc,EAAMuc,QACLrhB,EAAKkiB,KAAKrZ,QACbhR,QAAQ2G,QAAQwB,EAAKkiB,KAAKrZ,OAAO9F,MAAO,SAAUwI,GAC7CA,IAAMvL,GACTuiB,EAAUhX,GAAG,KAIhByW,EAAShiB,IAETuiB,EAAUviB,GAKZ,QAASyiB,GAAM1oB,GAuBd,QAAS2oB,KACRje,EAAS,WACR+d,EAAWxiB,KAxBb,GAAIA,GAAO5B,EAAM4B,IAGjB,IADYA,EAAKkiB,KAAKpd,MACZuc,OACTsB,GAAS,EACTD,QACM,IAAI1iB,EAAKkiB,KAAKL,MAAO,CAC3B,GAAIzd,GAAUpE,EAAKkiB,KAAKL,MAAM7hB,EAAMA,EAAKkiB,KACrC9d,IAAmC,kBAAjBA,GAAQqL,MAC7BrL,EAAQqL,KAAK,SAAUmT,GAEtBF,KACE,SAAUG,MAGbF,GAAS,IAETA,EAASve,EACTse,MAWH,QAAS5kB,GAAa/D,GAErB0oB,EAAM1oB,GACN+oB,EACEjkB,IAAI,YAAaxB,GAIpB,QAASA,GAAYtD,GAEpB0oB,EAAM1oB,GACN+oB,EACEjkB,IAAI,aAAcf,GAIrB,QAASd,GAAQjD,GAEhB,MAAOgpB,GAAQhpB,GAGhB,QAASgpB,GAAQhpB,GAChB,IAAe,IAAX4oB,EAIH,MAFA5oB,GAAEipB,kBAEK,EAWT,QAASnD,KACRiD,EACEjkB,IAAI,aAAcf,GAClBe,IAAI,YAAaxB,GACjBwB,IAAI,QAAS7B,GAhIhB,GAEI2lB,GAFAG,EAAUjrB,QAAQuB,QAAQA,EAAQ,GAAG6pB,cAAc,eAqHvD,WACCH,EACEnkB,GAAG,aAAcb,GACjBa,GAAG,YAAatB,GAChBsB,GAAG,QAAS3B,MAYfoB,EAAMQ,IAAI,WAAY,WACrBihB,cAUJ,WACG,YAEUhoB,SAAQC,OAAO,WAErBC,QAAQ,OAAQ,UAAW,SAASqZ,GACpC,QAASqQ,GAAItiB,GACT,GAAI2iB,GAAM5pB,KACN6G,GACAgE,SAEJlL,SAAQ2M,OAAOsd,EAAK/iB,GAChBI,GACAtH,QAAQ2M,OAAOsd,EAAK3iB,GAExB2iB,EAAIoB,OAAOpB,EAAK,MAEpBL,EAAIppB,WACA0pB,SAAU,SAAShf,GACf,GAAI+e,GAAM5pB,IACV4pB,GAAI1S,KAAOgC,EAAQhC,OACnB0S,EAAI/e,MAAQA,EACZ+e,EAAIqB,QAAQpgB,EAAO+e,IAEvBqB,QAAS,SAASpgB,EAAO8F,GACrB,GAAIiZ,GAAM5pB,IACN6K,IACAlL,QAAQ2G,QAAQuE,EAAO,SAAS/C,GAC5B8hB,EAAIoB,OAAOljB,EAAM6I,GACjBiZ,EAAIqB,QAAQnjB,EAAK+C,MAAO/C,MAIpCkjB,OAAQ,SAASljB,EAAM6I,GACnB,GAAIiZ,GAAM5pB,KACNgqB,GACArZ,OAAQA,GAAU,KAClBua,MAAOva,EAASA,EAAOqZ,KAAKkB,MAAQ,EAAI,EACxCte,SACAue,SAAU,SAASnqB,GACf4oB,EAAIuB,SAASnqB,EAAG8G,IAEpB6hB,MAAOC,EAAID,MAIf,IAFA7hB,EAAKkiB,KAAOA,EACZA,EAAK3X,KAAOuX,EAAIwB,QAAQtjB,GACpBkiB,EAAK3X,OAASuX,EAAI1S,KAGlB,IAFA8S,EAAKpd,MAAMuc,QAAS,EACpBa,EAAKpd,MAAMwd,QAAS,EACbJ,EAAKrZ,QACRqZ,EAAOA,EAAKrZ,OAAOqZ,KACnBA,EAAKpd,MAAMuc,QAAS,EACpBa,EAAKpd,MAAMwd,QAAS,GAIhCe,SAAU,SAASE,EAAa1a,GAC5B,GAAIiZ,GAAM5pB,IACNL,SAAQ8pB,QAAQ4B,GAChB1rB,QAAQ2G,QAAQ+kB,EAAa,SAASvjB,GAClC8hB,EAAI0B,QAAQxjB,EAAM6I,KAGtBiZ,EAAI0B,QAAQD,EAAa1a,IAGjC2a,QAAS,SAASxjB,EAAM6I,GACpB,GAAIiZ,GAAM5pB,IACG4pB,GAAIF,OACLE,EAAID,MAChBC,EAAIoB,OAAOljB,EAAM6I,GACbA,IACAA,EAAO9F,MAAQ8F,EAAO9F,UACtB8F,EAAO9F,MAAMR,KAAKvC,KAG1BsjB,QAAS,SAAStjB,GAOd,MALI9H,MAAK0pB,OACE1pB,KAAK0pB,OAAO5hB,EAAMA,EAAKkiB,MAEvBliB,EAAKuK,MAKxB,IAAIlG,IACAqN,OAAQ,SAAStC,GACbgC,EAAQM,OAAOtC,IAEnBA,KAAM,SAASA,GACXgC,EAAQhC,KAAKA,IAIrB,OADAvX,SAAQ2M,OAAOid,EAAKpd,GACbod,QAMd,WACA,YAEA/oB,QAAO+qB,YAAc,WACpB,OAAO,GAGE5rB,QAAQC,OAAO,WAErB0kB,UAAU,eAAgB,SAAU,WAAY,UAAW,WAAY,aAAc,UAAW,QAAS,SAAU,QAAS,SAAUM,EAAQ5U,EAAU4J,EAASrN,EAAUif,EAAY1rB,EAASwO,EAAOzJ,EAAQqL,GAClN,OACCqU,SAAU,IACVQ,SAAU,4CACVN,YAAY,EACZpS,KAAM,SAAUnM,EAAOhF,EAASyjB,EAAYjK,GAuD3C,QAAS+Q,GAAOnrB,GACforB,EAAWC,WAAWC,KACtBF,EAAWG,SACX,IAAIxU,GAAUqU,EAAWI,YACzBC,GAAajd,UAAU,eAAiBuI,EAAQrW,EAAEic,QAAQ,GAAK,WAC/D8O,EAAa3hB,IAAI4hB,GA0BlB,QAASC,GAAOznB,GACG,cAAdA,EAAM/B,MACTvB,EAAQyF,IAAI,YAAaslB,GAEtBP,EAAWQ,UAAUhc,EAAMC,SAAS3L,MACvC2nB,IACAC,EAAQhsB,QAIV,QAASisB,GAAO7nB,GACG,aAAdA,EAAM/B,MACT9C,QAAQuB,QAAQ0Y,GAASjT,IAAI,YAAa0lB,GAE3CX,EAAWY,SAASpc,EAAMC,SAAS3L,IAGpC,QAAS+nB,GAAK/nB,GACK,YAAdA,EAAM/B,MACT9C,QAAQuB,QAAQ0Y,GAASjT,IAAI,UAAW4lB,GAEzCb,EAAWc,UACXC,IAGD,QAASC,GAAS7qB,GACZA,IAAGA,EAAI+X,EAAQpV,OACpB3C,EAAIA,EAAEiC,cAAgBjC,EAAEiC,cAAgBjC,CACxC,IAAI8qB,GAAS9qB,EAAE+qB,OAAS,GAAK/qB,EAAEgrB,WAAa,GAAMhrB,EAAE+qB,OAAS,EAAK,GAAK,CACzClB,GAAWoB,OAAOH,IAE/CP,EAAQhsB,OAQV,QAASuG,KACR8lB,IACAL,EAAQ1rB,QACRgrB,EAAW/kB,MAGZ,QAASilB,KACR,GAAIre,IAAU,CAMd,OALIwf,KACHxf,EAAUA,GAAWwf,EAAe7mB,IAErCqH,EAAUA,GAAWqM,EAAQ5V,YAAc,KAC3CuJ,EAAUA,GAAYyf,EAActK,YAAcsJ,EAAYtJ,YAI/D,QAAShd,KACRgmB,EAAWuB,aAAaD,GACxBtB,EAAWwB,WAAWlB,GACRJ,KAEbjlB,IAED8kB,IAuBD,QAAS9D,KACRhoB,QAAQuB,QAAQ0Y,GAASjT,IAAI,SAAUjB,GACvCxE,EAAQyF,IAAI,uBAAwBslB,GACpC/qB,EAAQyF,IAAI,QAASwmB,GAGtB,QAAShB,KACRxsB,QAAQuB,QAAQ0Y,GAASnT,GAAG,sBAAuB4lB,GACnD1sB,QAAQuB,QAAQ0Y,GAASnT,GAAG,mBAAoB8lB,GAGjD,QAASE,KACR9sB,QAAQuB,QAAQ0Y,GAASjT,IAAI,sBAAuB0lB,GACpD1sB,QAAQuB,QAAQ0Y,GAASjT,IAAI,mBAAoB4lB,GAtLlD,GAAIb,GAAY0B,EAAQC,EAA2BN,CAElDrB,GADG/G,EAAW2I,YACD1I,EAAOD,EAAW2I,aAAapnB,GAE/B,GAAIslB,OAEQhkB,KAAtBmd,EAAWyI,SACdA,EAASxI,EAAOD,EAAWyI,aAED5lB,KAAvBmd,EAAW0I,UACdA,EAAUzI,EAAOD,EAAW0I,cAEO7lB,KAAhCmd,EAAW4I,kBACK3I,EAAOD,EAAW4I,sBAEJ/lB,KAA9Bmd,EAAWoI,iBACdA,EAAiBnI,EAAOD,EAAWoI,iBAEpCrB,EAAWrZ,MACVmb,MAAO,WACN9B,EAAW+B,UACXhC,KAED2B,OAAQA,EACRC,QAASA,IAIVnsB,EAAQwsB,KAAK,eAAgB,MAAMjX,SAAS,eAC5C,IAAIuW,GAAgB9rB,EAAQ,GACxB8qB,EAAcgB,EAAcjC,cAAc,YAC1CrX,EAAU/T,QAAQuB,QAAQwS,GAC1BqY,EAAe,GAAIzd,GAmBnB8d,EAAU,GAAItsB,GAAQ2rB,GAqEtB0B,EAAUjd,EAAMe,SAASyb,EAAU,GA6BvCxmB,GAAMsjB,OAAO,WACZ,MAAOwC,GAAYtJ,aACjB,SAAU/G,EAAUgS,GACtBjoB,MAgCDQ,EAAMQ,IAAI,WAAY,WACrBihB,IACAyE,EAAQ1rB,UA/BT,WACCf,QAAQuB,QAAQ0Y,GAASnT,GAAG,SAAUf,GACtCxE,EAAQuF,GAAG,uBAAwBwlB,GACnC/qB,EAAQuF,GAAG,QAAS0mB,cAsExB,WACA,YAEUxtB,SAAQC,OAAO,WAErBC,QAAQ,cAAe,QAAS,OAAQ,SAAUmI,EAAOU,GAC5D,QAAS8iB,KAiDR,QAASyB,GAAalqB,GACrB6qB,EAAUlN,MAAQ3d,EAAK2f,YACvBkL,EAAUjN,OAAS5d,EAAK4f,aAGzB,QAASuK,GAAWnqB,GACnB2Q,EAAQgN,MAAQ3d,EAAK2f,YACrBhP,EAAQiN,OAAS5d,EAAK4f,aAGvB,QAASgJ,GAAWkC,GACnBtgB,EAAUsgB,EAGX,QAAS/B,KACR,MAAOzU,GAGR,QAASyW,KACR,MAAOC,GAGR,QAASC,KAER5qB,EAAKK,MADS,IAEdL,EAAK8F,OAFS,IAGV+kB,EAAIjtB,EAAIoC,EAAKK,KAChByqB,IACUD,EAAIjtB,EAAIoC,EAAK8F,OACvBilB,IAIF,QAAStC,KACJte,GACHnK,EAAKK,KAAO,EACZL,EAAK8F,MAAQ0kB,EAAUlN,MAAQhN,EAAQgN,MACnC0N,GACHH,EAAIjtB,EAAIqtB,EAAMrtB,EAAIuE,EAAKvE,EAAIoE,EAAKpE,EAChCgtB,KACUM,EAAMttB,IAChBitB,EAAIjtB,GAAKstB,EAAMttB,EACfstB,EAAMttB,GAAK,IACPutB,GACHP,IAEGzsB,KAAKsO,IAAIye,EAAMttB,GAAK,MACvBstB,EAAMttB,EAAI,EACVitB,EAAIjtB,EAAIqtB,EAAMrtB,EAAIqW,EAAQrW,EAC1B0qB,EAAW6C,UAAW,IAIxBN,EAAIjtB,EAAIO,KAAKob,IAAIvZ,EAAKK,KAAMwqB,EAAIjtB,GAChCitB,EAAIjtB,EAAIO,KAAKC,IAAI4B,EAAK8F,MAAO+kB,EAAIjtB,GACjCqW,EAAQrW,IAAMitB,EAAIjtB,EAAIqW,EAAQrW,GAAK,GAEnCqW,EAAQrW,EAAIitB,EAAIjtB,EAAI,EAItB,QAASwtB,GAAUxtB,GAClBqtB,EAAMrtB,EAAIitB,EAAIjtB,EAAI,EAClBU,WAAW,WACViF,IACAwG,GAAO,GACL,KAGJ,QAAS+gB,GAAOhoB,GACXiH,GAGCue,EAAW0B,SAGhBjgB,GAAO,EACPue,EAAW0B,OAAOlnB,GAAOqR,OAAOkX,QAAQ,WACvCD,EAAU,MAIZ,QAASL,GAAQjoB,GACZiH,GAGCue,EAAW2B,UAGhBlgB,GAAO,EACPue,EAAW2B,QAAQnnB,GAAOqR,OAAOkX,QAAQ,WAC5Bb,EAAUlN,MAAQhN,EAAQgN,MAC1Btd,EAAK8F,MAChBmlB,EAAMrtB,EAAIitB,EAAIjtB,EAAIoC,EAAK8F,MAEvBmlB,EAAMrtB,EAAIitB,EAAIjtB,EAAIoC,EAAK8F,MAAQwlB,EAEhCF,EAAU,MAIZ,QAAS7nB,KACRynB,GAAW,EACXG,GAAW,EACXhpB,EAAO,KACPH,EAAO,KAGR,QAAS8mB,GAAUhkB,GAClB,OAAKiF,IACJkhB,EAAMrtB,EAAIitB,EAAIjtB,EAAIqW,EAAQrW,EAC1BqtB,EAAM/rB,EAAI2rB,EAAI3rB,EAAI+U,EAAQ/U,EAC1BgsB,EAAMttB,EAAI,EACVstB,EAAMhsB,EAAI,EACV8C,EAAO8C,EACPqmB,GAAW,GACJ,GAMT,QAASjC,GAASpkB,GACjBymB,EAAOppB,EACPA,EAAO2C,EACPkmB,GAAW,EAGZ,QAAS5B,KACJjnB,GAAQopB,IACXL,EAAMttB,GAAyB,GAAnBuE,EAAKvE,EAAI2tB,EAAK3tB,GAC1BstB,EAAMhsB,GAAyB,GAAnBiD,EAAKjD,EAAIqsB,EAAKrsB,IAE3B+rB,EAAMrtB,EAAIitB,EAAIjtB,EAAIqW,EAAQrW,EAC1BqtB,EAAM/rB,EAAI2rB,EAAI3rB,EAAI+U,EAAQ/U,EAC1B8rB,GAAW,EACX7oB,EAAO,KACPH,EAAO,KACPupB,EAAO,KASR,QAAS7B,GAAOH,GACf,IAAKxf,GAAQI,EAKZ,MAJA0gB,GAAIjtB,GAAK2rB,EAAMjZ,EAAQiN,OACvB2N,EAAMttB,GAAW,EAAN2rB,EAEX4B,GAAW,EACHN,EAAIjtB,EAAIstB,EAAMttB,EAAIoC,EAAKK,MAAQwqB,EAAIjtB,EAAIstB,EAAMttB,EAAIoC,EAAK8F,MAIhE,QAASukB,KACRQ,EAAIjtB,EAAIqW,EAAQrW,EAAI,EA7MrB,GACIuM,GAASJ,EAAMihB,EAAUG,EAAUnpB,EAAMG,EAAMopB,EAD/CD,EAAU,IAGVL,EAAQ,GAAIrmB,GACfimB,EAAM,GAAIjmB,GACVqP,EAAU,GAAIrP,GACd+lB,EAAY,GAAI/lB,GAChBsmB,EAAQ,GAAItmB,GACZ5E,EAAO,GAAIsF,GACXklB,EAAY,GAAIllB,GAChBgL,EAAU,GAAIhL,EAEftF,GAAKM,IAAMN,EAAK8F,MAAQ9F,EAAK+F,OAAS/F,EAAKK,KAAO,CAElD,IAAIioB,IAEH2C,MAAOA,EACPJ,IAAKA,EACL5W,QAASA,EACT0W,UAAWA,EACXO,MAAOA,EACPlrB,KAAMA,EACNwqB,UAAWA,EACXla,QAASA,EAETuZ,aAAcA,EACdC,WAAYA,EACZvB,WAAYA,EACZG,WAAYA,EACZgC,aAAcA,EACdE,QAASA,EACTnC,QAASA,EACT2C,UAAWA,EACXN,OAAQA,EACRC,QAASA,EACTjC,UAAWA,EACXI,SAAUA,EACVE,QAASA,EACTM,OAAQA,EACRW,QAASA,EACT9mB,IAAKA,EAGNhH,SAAQ2M,OAAOtM,KAAM0rB,GAErBA,EAAa1rB,KAqKd,QAASqS,GAAKuc,GACbjvB,QAAQ2M,OAAOtM,KAAM4uB,GAMtB,MAHApD,GAAWrrB,WACVkS,KAAMA,GAEAmZ,QAMR,WACG,YAMA,SAASqD,GAAIhqB,GAOT,QAASwN,GAAKnM,EAAOhF,EAASyjB,EAAYjK,GAYtC,QAASuR,GAAOpqB,GACZX,EAAQ4tB,YAAY,uBACf5tB,EAAQwhB,YAEb3f,EAAKoL,MAAM1K,KAAO5B,EAAE2B,SAASxC,EAAI,KACjC+B,EAAKoL,MAAMzK,IAAM7B,EAAE2B,SAASlB,EAAI,KAChCZ,WAAW,WACPR,EAAQuV,SAAS,uBACjB/U,WAAW,WACPR,EAAQ4tB,YAAY,wBACrB,MACJ,IAtBP,IAAInK,EAAWoK,SAGS,MAApBpK,EAAW5Q,MAAiB4Q,EAAWqK,QAAWrK,EAAWsK,SAAjE,CAIA/tB,EAAQuV,SAAS,kBACjB,IAAI1T,GAAOhB,SAASmM,cAAc,cAClChN,GAAQ,GAAGkU,YAAYrS,EAiBvB,IAAIiC,IACAI,KAAM6mB,EAEG,IAAIpnB,GAAO3D,GAAS+E,IAAIjB,EAAWkB,IApCpD,OACIqe,SAAU,IACVmE,SAAU,EACVrW,KAAMA,GARd,GAAIpD,GAAMtP,QAAQC,OAAO,UA4CzBqP,GAAIqV,UAAU,QAAS,SAAUuK,IACjC5f,EAAIqV,UAAU,WAAY,SAAUuK","file":"artisan.min.js","sourcesContent":["/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan', ['ng', 'ngRoute', 'ngMessages']);\r\n\r\n}());\n/* global angular */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.factory('Animate', [function () {\r\n\r\n\t\tfunction Animate(callback) {\r\n\t\t\tthis.callback = callback;\r\n\t\t\tthis.key = null;\r\n\t\t\tthis.ticks = 0;\r\n\t\t}\r\n\t\tAnimate.prototype = {\r\n\t\t\tplay: function () {\r\n\t\t\t\tvar _this = this;\r\n\r\n\t\t\t\tfunction loop(time) {\r\n\t\t\t\t\t_this.ticks++;\r\n\t\t\t\t\t_this.callback(time, _this.ticks);\r\n\t\t\t\t\t_this.key = window.requestAnimationFrame(loop);\r\n\t\t\t\t}\r\n\t\t\t\tif (!this.key) {\r\n\t\t\t\t\tloop();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tpause: function () {\r\n\t\t\t\tif (this.key) {\r\n\t\t\t\t\twindow.cancelAnimationFrame(this.key);\r\n\t\t\t\t\tthis.key = null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tplaypause: function () {\r\n\t\t\t\tif (this.key) {\r\n\t\t\t\t\tthis.pause();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.play();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdoNOTPlay: function () {\r\n\t\t\t\tthis.pause();\r\n\t\t\t},\r\n\t\t}\r\n\t\treturn Animate;\r\n    }]);\r\n\r\n\t(function () {\r\n\t\tvar lastTime = 0;\r\n\t\tvar vendors = ['ms', 'moz', 'webkit', 'o'];\r\n\t\tfor (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\r\n\t\t\twindow.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\r\n\t\t\twindow.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||\r\n\t\t\t\twindow[vendors[x] + 'CancelRequestAnimationFrame'];\r\n\t\t}\r\n\t\tif (!window.requestAnimationFrame) {\r\n\t\t\twindow.requestAnimationFrame = function (callback, element) {\r\n\t\t\t\tvar currTime = new Date().getTime();\r\n\t\t\t\tvar timeToCall = Math.max(0, 16 - (currTime - lastTime));\r\n\t\t\t\tvar id = window.setTimeout(function () {\r\n\t\t\t\t\tcallback(currTime + timeToCall);\r\n\t\t\t\t}, timeToCall);\r\n\t\t\t\tlastTime = currTime + timeToCall;\r\n\t\t\t\treturn id;\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (!window.cancelAnimationFrame) {\r\n\t\t\twindow.cancelAnimationFrame = function (id) {\r\n\t\t\t\tclearTimeout(id);\r\n\t\t\t};\r\n\t\t}\r\n\t}());\r\n\r\n}());\r\n\n/* global angular */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.factory('Events', [function () {\r\n\r\n\t\tfunction Event(e, element) {\r\n\t\t\tvar documentNode = (document.documentElement || document.body.parentNode || document.body);\r\n\t\t\tvar scroll = {\r\n\t\t\t\tx: window.pageXOffset || documentNode.scrollLeft,\r\n\t\t\t\ty: window.pageYOffset || documentNode.scrollTop\r\n\t\t\t};\r\n\t\t\tif (e.type === 'resize') {\r\n\t\t\t\tvar view = {\r\n\t\t\t\t\tw: this.getWidth(),\r\n\t\t\t\t\th: this.getHeight(),\r\n\t\t\t\t};\r\n\t\t\t\tthis.view = view;\r\n\t\t\t}\r\n\t\t\tvar node = getNode(element);\r\n\t\t\tvar offset = {\r\n\t\t\t\tx: node.offsetLeft,\r\n\t\t\t\ty: node.offsetTop,\r\n\t\t\t};\r\n\t\t\tvar rect = node.getBoundingClientRect();\r\n\t\t\tvar page = this.getPage(e);\r\n\t\t\tif (page) {\r\n\t\t\t\tvar relative = {\r\n\t\t\t\t\tx: page.x - scroll.x - rect.left,\r\n\t\t\t\t\ty: page.y - scroll.y - rect.top,\r\n\t\t\t\t};\r\n\t\t\t\tvar absolute = {\r\n\t\t\t\t\tx: page.x - scroll.x,\r\n\t\t\t\t\ty: page.y - scroll.y,\r\n\t\t\t\t};\r\n\t\t\t\tthis.relative = relative;\r\n\t\t\t\tthis.absolute = absolute;\r\n\t\t\t}\r\n\t\t\tif (this.type === 'resize') {\r\n\t\t\t\tconsole.log(this.type);\r\n\t\t\t}\r\n\t\t\tthis.originalEvent = e;\r\n\t\t\tthis.element = element;\r\n\t\t\tthis.node = node;\r\n\t\t\tthis.offset = offset;\r\n\t\t\tthis.rect = rect;\r\n\t\t\t// console.log('Event', 'page', page, 'scroll', scroll, 'offset', offset, 'rect', rect, 'relative', relative, 'absolute', absolute);\r\n\t\t\t// console.log('scroll.y', scroll.y, 'page.y', page.y, 'offset.y', offset.y, 'rect.top', rect.top);\r\n\t\t}\r\n\t\tEvent.prototype = {\r\n\t\t\tgetPage: getPage,\r\n\t\t\tgetWidth: getWidth,\r\n\t\t\tgetHeight: getHeight,\r\n\t\t};\r\n\r\n\t\tfunction getWidth() {\r\n\t\t\tif (self.innerWidth) {\r\n\t\t\t\treturn self.innerWidth;\r\n\t\t\t}\r\n\t\t\tif (document.documentElement && document.documentElement.clientWidth) {\r\n\t\t\t\treturn document.documentElement.clientWidth;\r\n\t\t\t}\r\n\t\t\tif (document.body) {\r\n\t\t\t\treturn document.body.clientWidth;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction getHeight() {\r\n\t\t\tif (self.innerHeight) {\r\n\t\t\t\treturn self.innerHeight;\r\n\t\t\t}\r\n\t\t\tif (document.documentElement && document.documentElement.clientHeight) {\r\n\t\t\t\treturn document.documentElement.clientHeight;\r\n\t\t\t}\r\n\t\t\tif (document.body) {\r\n\t\t\t\treturn document.body.clientHeight;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction getPage(e) {\r\n\t\t\tvar standardEvents = ['click', 'mousedown', 'mouseup', 'mousemove', 'mouseover', 'mouseout', 'mouseenter', 'mouseleave', 'contextmenu'];\r\n\t\t\tvar touchEvents = ['touchstart', 'touchmove', 'touchend', 'touchcancel'];\r\n\t\t\tvar page = null;\r\n\t\t\tif (touchEvents.indexOf(e.type) !== -1) {\r\n\t\t\t\tvar t = null;\r\n\t\t\t\tvar event = e.originalEvent ? e.originalEvent : e;\r\n\t\t\t\tvar touches = event.touches.length ? event.touches : event.changedTouches;\r\n\t\t\t\tif (touches && touches.length) {\r\n\t\t\t\t\tt = touches[0];\r\n\t\t\t\t}\r\n\t\t\t\tif (t) {\r\n\t\t\t\t\tpage = {\r\n\t\t\t\t\t\tx: t.pageX,\r\n\t\t\t\t\t\ty: t.pageY,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t} else if (standardEvents.indexOf(e.type) !== -1) {\r\n\t\t\t\tpage = {\r\n\t\t\t\t\tx: e.pageX,\r\n\t\t\t\t\ty: e.pageY,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tthis.type = e.type;\r\n\t\t\treturn page;\r\n\t\t}\r\n\r\n\t\tfunction Events(element) {\r\n\t\t\tthis.element = element;\r\n\t\t\tthis.listeners = {};\r\n\t\t\tthis.standardEvents = {\r\n\t\t\t\tclick: {\r\n\t\t\t\t\tkey: 'click',\r\n\t\t\t\t\tcallback: onClick\r\n\t\t\t\t},\r\n\t\t\t\tdown: {\r\n\t\t\t\t\tkey: 'mousedown',\r\n\t\t\t\t\tcallback: onMouseDown\r\n\t\t\t\t},\r\n\t\t\t\tmove: {\r\n\t\t\t\t\tkey: 'mousemove',\r\n\t\t\t\t\tcallback: onMouseMove\r\n\t\t\t\t},\r\n\t\t\t\tup: {\r\n\t\t\t\t\tkey: 'mouseup',\r\n\t\t\t\t\tcallback: onMouseUp\r\n\t\t\t\t},\r\n\t\t\t\tresize: {\r\n\t\t\t\t\tkey: 'resize',\r\n\t\t\t\t\tcallback: onResize\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t\tthis.touchEvents = {\r\n\t\t\t\tdown: {\r\n\t\t\t\t\tkey: 'touchstart',\r\n\t\t\t\t\tcallback: onTouchStart\r\n\t\t\t\t},\r\n\t\t\t\tmove: {\r\n\t\t\t\t\tkey: 'touchmove',\r\n\t\t\t\t\tcallback: onTouchMove\r\n\t\t\t\t},\r\n\t\t\t\tup: {\r\n\t\t\t\t\tkey: 'touchend',\r\n\t\t\t\t\tcallback: onTouchEnd\r\n\t\t\t\t},\r\n\t\t\t};\r\n\r\n\t\t\tvar events = this;\r\n\r\n\t\t\tfunction onClick(e) {\r\n\t\t\t\t// console.log('onClick', e, events);\r\n\t\t\t\tvar event = new Event(e, events.element);\r\n\t\t\t\tevents.listeners.click.apply(this, [event]);\r\n\t\t\t}\r\n\r\n\t\t\tfunction onMouseDown(e) {\r\n\t\t\t\t// console.log('onMouseDown', e);\r\n\t\t\t\tvar event = new Event(e, events.element);\r\n\t\t\t\tevents.listeners.down.apply(this, [event]);\r\n\t\t\t\tevents.removeTouchEvents();\r\n\t\t\t}\r\n\r\n\t\t\tfunction onMouseMove(e) {\r\n\t\t\t\t// console.log('onMouseMove', e);\r\n\t\t\t\tvar event = new Event(e, events.element);\r\n\t\t\t\tevents.listeners.move.apply(this, [event]);\r\n\t\t\t}\r\n\r\n\t\t\tfunction onMouseUp(e) {\r\n\t\t\t\t// console.log('onMouseUp', e);\r\n\t\t\t\tvar event = new Event(e, events.element);\r\n\t\t\t\tevents.listeners.up.apply(this, [event]);\r\n\t\t\t}\r\n\r\n\t\t\tfunction onResize(e) {\r\n\t\t\t\tconsole.log('onResize', e);\r\n\t\t\t\tvar event = new Event(e, events.element);\r\n\t\t\t\tevents.listeners.resize.apply(this, [event]);\r\n\t\t\t}\r\n\r\n\t\t\tfunction onTouchStart(e) {\r\n\t\t\t\t// console.log('onTouchStart', e);\r\n\t\t\t\tvar event = new Event(e, events.element);\r\n\t\t\t\tevents.listeners.down.apply(this, [event]);\r\n\t\t\t\tevents.removeStandardEvents();\r\n\t\t\t}\r\n\r\n\t\t\tfunction onTouchMove(e) {\r\n\t\t\t\t// console.log('onTouchMove', e);\r\n\t\t\t\tvar event = new Event(e, events.element);\r\n\t\t\t\tevents.listeners.move.apply(this, [event]);\r\n\t\t\t}\r\n\r\n\t\t\tfunction onTouchEnd(e) {\r\n\t\t\t\t// console.log('onTouchEnd', e);\r\n\t\t\t\tvar event = new Event(e, events.element);\r\n\t\t\t\tevents.listeners.up.apply(this, [event]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tEvents.prototype = {\r\n\t\t\tadd: add,\r\n\t\t\tremove: remove,\r\n\t\t\tremoveStandardEvents: removeStandardEvents,\r\n\t\t\tremoveTouchEvents: removeTouchEvents,\r\n\t\t};\r\n\t\treturn Events;\r\n\r\n\t\tfunction getNode(element) {\r\n\t\t\treturn element.length ? element[0] : element; // (element.length && (element[0] instanceOf Node || element[0] instanceOf HTMLElement)) ? element[0] : element;\r\n\t\t}\r\n\r\n\t\tfunction getElement(element) {\r\n\t\t\treturn element.length ? element : angular.element(element); // (element.length && (element[0] instanceOf Node || element[0] instanceOf HTMLElement)) ? element : angular.element(element);\r\n\t\t}\r\n\r\n\t\tfunction add(listeners, scope) {\r\n\t\t\tvar events = this,\r\n\t\t\t\tstandard = this.standardEvents,\r\n\t\t\t\ttouch = this.touchEvents;\r\n\t\t\tvar element = getElement(this.element),\r\n\t\t\t\twindowElement = angular.element(window);\r\n\r\n\t\t\tangular.forEach(listeners, function (callback, key) {\r\n\t\t\t\tif (events.listeners[key]) {\r\n\t\t\t\t\tvar listener = {};\r\n\t\t\t\t\tlistener[key] = events.listeners[key];\r\n\t\t\t\t\tremove(listener);\r\n\t\t\t\t}\r\n\t\t\t\tevents.listeners[key] = callback;\r\n\t\t\t\tif (standard[key]) {\r\n\t\t\t\t\tif (key === 'resize') {\r\n\t\t\t\t\t\twindowElement.on(standard[key].key, standard[key].callback);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\telement.on(standard[key].key, standard[key].callback);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (touch[key]) {\r\n\t\t\t\t\telement.on(touch[key].key, touch[key].callback);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (scope) {\r\n\t\t\t\tscope.$on('$destroy', function () {\r\n\t\t\t\t\tevents.remove(listeners);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn events;\r\n\t\t}\r\n\r\n\t\tfunction remove(listeners) {\r\n\t\t\tvar events = this,\r\n\t\t\t\tstandard = this.standardEvents,\r\n\t\t\t\ttouch = this.touchEvents;\r\n\t\t\tvar element = getElement(this.element),\r\n\t\t\t\twindowElement = angular.element(window);\r\n\t\t\tangular.forEach(listeners, function (callback, key) {\r\n\t\t\t\tif (standard[key]) {\r\n\t\t\t\t\tif (key === 'resize') {\r\n\t\t\t\t\t\twindowElement.off(standard[key].key, standard[key].callback);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\telement.off(standard[key].key, standard[key].callback);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (touch[key]) {\r\n\t\t\t\t\telement.off(touch[key].key, touch[key].callback);\r\n\t\t\t\t}\r\n\t\t\t\tevents.listeners[key] = null;\r\n\t\t\t});\r\n\t\t\treturn events;\r\n\t\t}\r\n\r\n\t\tfunction removeStandardEvents() {\r\n\t\t\tvar events = this,\r\n\t\t\t\tstandard = events.standardEvents,\r\n\t\t\t\ttouch = events.touchEvents;\r\n\t\t\tvar element = getElement(events.element);\r\n\t\t\telement.off('mousedown', standard.down.callback);\r\n\t\t\telement.off('mousemove', standard.move.callback);\r\n\t\t\telement.off('mouseup', standard.up.callback);\r\n\t\t}\r\n\r\n\t\tfunction removeTouchEvents() {\r\n\t\t\tvar events = this,\r\n\t\t\t\tstandard = events.standardEvents,\r\n\t\t\t\ttouch = events.touchEvents;\r\n\t\t\tvar element = getElement(events.element);\r\n\t\t\telement.off('touchstart', touch.down.callback);\r\n\t\t\telement.off('touchmove', touch.move.callback);\r\n\t\t\telement.off('touchend', touch.up.callback);\r\n\t\t}\r\n\r\n    }]);\r\n\r\n\tfunction fixPassiveEvents() {\r\n\t\tif (!window.addEventListener) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfunction isSupported() {\r\n\t\t\tvar supported = false;\r\n\t\t\ttry {\r\n\t\t\t\tvar options = Object.defineProperty({}, 'passive', {\r\n\t\t\t\t\tget: function () {\r\n\t\t\t\t\t\tsupported = true;\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t\twindow.addEventListener(\"test\", null, options);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.log('fixPassiveEvents.isSupprted', e);\r\n\t\t\t}\r\n\t\t\treturn supported;\r\n\t\t}\r\n\t\tvar defaults = {\r\n\t\t\tpassive: true,\r\n\t\t\tcapture: false,\r\n\t\t};\r\n\r\n\t\tfunction overwriteOriginal(original) {\r\n\t\t\tEventTarget.prototype.addEventListener = function (type, listener, options) {\r\n\t\t\t\tvar usesListenerOptions = typeof options === 'object';\r\n\t\t\t\tvar capture = usesListenerOptions ? options.capture : options;\r\n\t\t\t\toptions = usesListenerOptions ? options : {};\r\n\t\t\t\toptions.passive = options.passive !== undefined ? options.passive : defaults.passive;\r\n\t\t\t\toptions.capture = capture !== undefined ? capture : defaults.capture;\r\n\t\t\t\toriginal.call(this, type, listener, options);\r\n\t\t\t};\r\n\t\t}\r\n\t\tvar supported = isSupported();\r\n\t\tif (supported) {\r\n\t\t\tvar original = EventTarget.prototype.addEventListener;\r\n\t\t\toverwriteOriginal(original);\r\n\t\t}\r\n\t}\r\n\r\n\tfixPassiveEvents();\r\n\r\n}());\r\n\n/* global angular, app, Autolinker */\r\n(function () {\r\n\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.filter('notIn', ['$filter', function ($filter) {\r\n\t\treturn function (array, filters, element) {\r\n\t\t\tif (filters) {\r\n\t\t\t\treturn $filter(\"filter\")(array, function (item) {\r\n\t\t\t\t\tfor (var i = 0; i < filters.length; i++) {\r\n\t\t\t\t\t\tif (filters[i][element] === item[element]) return false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n}());\r\n\n/* global angular, firebase */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.factory('Point', [function () {\r\n\t\tfunction Point(x, y) {\r\n\t\t\tthis.x = x || 0;\r\n\t\t\tthis.y = y || 0;\r\n\t\t}\r\n\t\tPoint.mult = function (point, value) {\r\n\t\t\tpoint.x *= value;\r\n\t\t\tpoint.y *= value;\r\n\t\t\treturn point;\r\n\t\t};\r\n\t\tPoint.prototype = {\r\n\t\t\tmult: function (value) {\r\n\t\t\t\treturn Point.mult(this, value);\r\n\t\t\t},\r\n\t\t\toffset: function (x, y) {\r\n\t\t\t\tthis.x += x;\r\n\t\t\t\tthis.y += y;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tsetX: function (x) {\r\n\t\t\t\tthis.x = x;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tsetY: function (y) {\r\n\t\t\t\tthis.y = y;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tsetPos: function (x, y) {\r\n\t\t\t\tthis.x = x;\r\n\t\t\t\tthis.y = y;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tcopy: function (point) {\r\n\t\t\t\tthis.x = point.x;\r\n\t\t\t\tthis.y = point.y;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tclone: function () {\r\n\t\t\t\treturn new Point(this.x, this.y);\r\n\t\t\t},\r\n\t\t\ttoString: function () {\r\n\t\t\t\treturn '{' + this.x + ',' + this.y + '}';\r\n\t\t\t},\r\n\t\t};\r\n\t\treturn Point;\r\n    }]);\r\n\r\n}());\r\n\n/* global angular, firebase */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.factory('Rect', [function () {\r\n\t\tfunction Rect(x, y, w, h) {\r\n\t\t\tthis.x = x || 0;\r\n\t\t\tthis.y = y || 0;\r\n\t\t\tthis.w = w || 0;\r\n\t\t\tthis.h = h || 0;\r\n\t\t}\r\n\t\tRect.mult = function (rect, value) {\r\n\t\t\trect.x *= value;\r\n\t\t\trect.y *= value;\r\n\t\t\trect.w *= value;\r\n\t\t\trect.h *= value;\r\n\t\t\treturn rect;\r\n\t\t};\r\n\t\tRect.prototype = {\r\n\t\t\tmult: function (value) {\r\n\t\t\t\treturn Rect.mult(this, value);\r\n\t\t\t},\r\n\t\t\toffset: function (x, y) {\r\n\t\t\t\tthis.x += x;\r\n\t\t\t\tthis.y += y;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\treduce: function (size) {\r\n\t\t\t\treturn this.offset(-size);\r\n\t\t\t},\r\n\t\t\treduceRect: function (rect) {\r\n\t\t\t\treturn this.offsetRect(Rect.mult(rect, -1));\r\n\t\t\t},\r\n\t\t\texpandRect: function (rect) {\r\n\t\t\t\tthis.x -= rect.x || 0;\r\n\t\t\t\tthis.y -= rect.y || 0;\r\n\t\t\t\tthis.w += rect.w || 0;\r\n\t\t\t\tthis.h += rect.h || 0;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\texpand: function (size) {\r\n\t\t\t\treturn this.expandRect({\r\n\t\t\t\t\tx: size,\r\n\t\t\t\t\ty: size,\r\n\t\t\t\t\tw: size * 2,\r\n\t\t\t\t\th: size * 2\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tintersect: function (rect) {\r\n\t\t\t\tvar x = this.x,\r\n\t\t\t\t\ty = this.y,\r\n\t\t\t\t\tw = this.w,\r\n\t\t\t\t\th = this.h;\r\n\t\t\t\treturn !(rect.x > x + w || rect.x + rect.w < x || rect.y > y + h || rect.y + rect.h < y);\r\n\t\t\t},\r\n\t\t\ttop: function () {\r\n\t\t\t\tvar x = this.x,\r\n\t\t\t\t\ty = this.y,\r\n\t\t\t\t\tw = this.w,\r\n\t\t\t\t\th = this.h;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: x + w / 2,\r\n\t\t\t\t\ty: y\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\tright: function () {\r\n\t\t\t\tvar x = this.x,\r\n\t\t\t\t\ty = this.y,\r\n\t\t\t\t\tw = this.w,\r\n\t\t\t\t\th = this.h;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: x + w,\r\n\t\t\t\t\ty: y + h / 2\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\tbottom: function () {\r\n\t\t\t\tvar x = this.x,\r\n\t\t\t\t\ty = this.y,\r\n\t\t\t\t\tw = this.w,\r\n\t\t\t\t\th = this.h;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: x + w / 2,\r\n\t\t\t\t\ty: y + h\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\tleft: function () {\r\n\t\t\t\tvar x = this.x,\r\n\t\t\t\t\ty = this.y,\r\n\t\t\t\t\tw = this.w,\r\n\t\t\t\t\th = this.h;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: x,\r\n\t\t\t\t\ty: y + h / 2\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\tcenter: function () {\r\n\t\t\t\tvar x = this.x,\r\n\t\t\t\t\ty = this.y,\r\n\t\t\t\t\tw = this.w,\r\n\t\t\t\t\th = this.h;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: x + w / 2,\r\n\t\t\t\t\ty: y + h / 2\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\ttopLeft: function () {\r\n\t\t\t\tvar x = this.x,\r\n\t\t\t\t\ty = this.y,\r\n\t\t\t\t\tw = this.w,\r\n\t\t\t\t\th = this.h;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: x,\r\n\t\t\t\t\ty: y\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\ttopRight: function () {\r\n\t\t\t\tvar x = this.x,\r\n\t\t\t\t\ty = this.y,\r\n\t\t\t\t\tw = this.w,\r\n\t\t\t\t\th = this.h;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: x + w,\r\n\t\t\t\t\ty: y\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\tbottomRight: function () {\r\n\t\t\t\tvar x = this.x,\r\n\t\t\t\t\ty = this.y,\r\n\t\t\t\t\tw = this.w,\r\n\t\t\t\t\th = this.h;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: x + w,\r\n\t\t\t\t\ty: y + h\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\tbottomLeft: function () {\r\n\t\t\t\tvar x = this.x,\r\n\t\t\t\t\ty = this.y,\r\n\t\t\t\t\tw = this.w,\r\n\t\t\t\t\th = this.h;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: x,\r\n\t\t\t\t\ty: y + h\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\tsetX: function (x) {\r\n\t\t\t\tthis.x = x;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tsetY: function (y) {\r\n\t\t\t\tthis.y = y;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tsetW: function (w) {\r\n\t\t\t\tthis.w = w;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tsetH: function (h) {\r\n\t\t\t\tthis.h = h;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tsetPos: function (x, y) {\r\n\t\t\t\tthis.x = x;\r\n\t\t\t\tthis.y = y;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tsetSize: function (w, h) {\r\n\t\t\t\tthis.w = w;\r\n\t\t\t\tthis.h = h;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tcopy: function (rect) {\r\n\t\t\t\tthis.x = rect.x;\r\n\t\t\t\tthis.y = rect.y;\r\n\t\t\t\tthis.w = rect.w;\r\n\t\t\t\tthis.h = rect.h;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tclone: function () {\r\n\t\t\t\treturn new Rect(this.x, this.y, this.w, this.h);\r\n\t\t\t},\r\n\t\t\ttoString: function () {\r\n\t\t\t\treturn '{' + this.x + ',' + this.y + ',' + this.w + ',' + this.h + '}';\r\n\t\t\t},\r\n\t\t};\r\n\t\treturn Rect;\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.factory('Hash', [function() {\r\n        var pools = {};\r\n\r\n        function Hash(key, pool) {\r\n            key = key || 'id';\r\n            pool = pool ? Hash.get(pool) : {};\r\n            Object.defineProperties(this, {\r\n                key: {\r\n                    value: key,\r\n                    enumerable: false,\r\n                    writable: false\r\n                },\r\n                pool: {\r\n                    value: pool,\r\n                    enumerable: false,\r\n                    writable: false\r\n                },\r\n                length: {\r\n                    value: 0,\r\n                    enumerable: false,\r\n                    writable: true\r\n                }\r\n            });\r\n        }\r\n        Hash.get = function(pool) {\r\n            return (pools[pool] = pools[pool] || {});\r\n        };\r\n        Hash.prototype = new Array;\r\n        Hash.prototype.has = has;\r\n        Hash.prototype.getId = getId;\r\n        Hash.prototype.get = get;\r\n        Hash.prototype.set = set;\r\n        Hash.prototype.add = add;\r\n        Hash.prototype.remove = remove;\r\n        Hash.prototype.each = each;\r\n        Hash.prototype.addMany = addMany;\r\n        Hash.prototype.removeMany = removeMany;\r\n        Hash.prototype.removeAll = removeAll;\r\n        Hash.prototype.forward = forward;\r\n        Hash.prototype.backward = backward;\r\n        Hash.prototype.differs = differs;\r\n        Hash.prototype.updatePool = updatePool;\r\n        return Hash;\r\n\r\n        function has(id) {\r\n            return this.pool[id] !== undefined;\r\n        }\r\n\r\n        function getId(id) {\r\n            return this.pool[id];\r\n        }\r\n\r\n        function get(item) {\r\n            var hash = this,\r\n                key = this.key;\r\n            return item ? hash.getId(item[key]) : null;\r\n        }\r\n\r\n        function set(item) {\r\n            var hash = this,\r\n                pool = this.pool,\r\n                key = this.key;\r\n            pool[item[key]] = item;\r\n            hash.push(item);\r\n            return item;\r\n        }\r\n\r\n        function add(newItem) {\r\n            var hash = this;\r\n            var item = hash.get(newItem);\r\n            if (item) {\r\n                for (var i = 0, keys = Object.keys(newItem), p; i < keys.length; i++) {\r\n                    p = keys[i];\r\n                    item[p] = newItem[p];\r\n                }\r\n            } else {\r\n                item = hash.set(newItem);\r\n            }\r\n            return item;\r\n        }\r\n\r\n        function remove(oldItem) {\r\n            var hash = this,\r\n                pool = this.pool,\r\n                key = this.key;\r\n            var item = hash.get(oldItem);\r\n            if (item) {\r\n                var index = hash.indexOf(item);\r\n                if (index !== -1) {\r\n                    hash.splice(index, 1);\r\n                }\r\n                delete pool[item[key]];\r\n            }\r\n            return hash;\r\n        }\r\n\r\n        function addMany(items) {\r\n            var hash = this;\r\n            if (!items) {\r\n                return hash;\r\n            }\r\n            var i = 0;\r\n            while (i < items.length) {\r\n                hash.add(items[i]);\r\n                i++;\r\n            }\r\n            return hash;\r\n        }\r\n\r\n        function removeMany(items) {\r\n            var hash = this;\r\n            if (!items) {\r\n                return hash;\r\n            }\r\n            var i = 0;\r\n            while (i < items.length) {\r\n                hash.remove(items[i]);\r\n                i++;\r\n            }\r\n            return hash;\r\n        }\r\n\r\n        function removeAll() {\r\n            var hash = this,\r\n                key = hash.key,\r\n                pool = hash.pool;\r\n            var i = 0,\r\n                t = hash.length,\r\n                item;\r\n            while (hash.length) {\r\n                item = hash.shift();\r\n                delete pool[item[key]];\r\n                i++;\r\n            }\r\n            return hash;\r\n        }\r\n\r\n        function each(callback) {\r\n            var hash = this;\r\n            if (callback) {\r\n                var i = 0;\r\n                while (i < hash.length) {\r\n                    callback(hash[i], i);\r\n                    i++;\r\n                }\r\n            }\r\n            return hash;\r\n        }\r\n\r\n        function forward(key, reverse) {\r\n            var hash = this;\r\n            key = (key || this.key);\r\n            hash.sort(function(c, d) {\r\n                var a = reverse ? d : c;\r\n                var b = reverse ? c : d;\r\n                return a[key] - b[key];\r\n            });\r\n            return hash;\r\n        }\r\n\r\n        function backward(key) {\r\n            return this.forward(key, true);\r\n        }\r\n\r\n        function differs(hash) {\r\n            if (hash.key !== this.key || hash.length !== this.length) {\r\n                return true;\r\n            } else {\r\n                var differs = false,\r\n                    i = 0,\r\n                    t = this.length,\r\n                    key = this.key;\r\n                while (differs && i < t) {\r\n                    differs = this[i][key] !== hash[i][key];\r\n                    i++;\r\n                }\r\n            }\r\n        }\r\n\r\n        function updatePool() {\r\n            var hash = this,\r\n                pool = this.pool,\r\n                key = this.key;\r\n            Object.keys(pool).forEach(function(key) {\r\n                delete pool[key];\r\n            });\r\n            angular.forEach(hash, function(item) {\r\n                pool[item[key]] = item;\r\n            });\r\n        }\r\n\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.factory('$promise', ['$q', function($q) {\r\n        function $promise(callback) {\r\n            if (typeof callback !== 'function') {\r\n                throw ('promise resolve callback missing');\r\n            }\r\n            var deferred = $q.defer();\r\n            callback(deferred);\r\n            return deferred.promise;\r\n        }\r\n        var statics = {\r\n            all: function(promises) {\r\n                return $q.all(promises);\r\n            },\r\n        };\r\n        angular.extend($promise, statics);\r\n        return $promise;\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.factory('State', ['$timeout', function($timeout) {\r\n        var DELAY = 2000;\r\n\r\n        function State() {\r\n            this.errors = [];\r\n            this.isReady = false;\r\n            this.idle();\r\n        }\r\n\r\n        State.prototype = {\r\n            idle: function() {\r\n                var state = this;\r\n                state.isBusy = false;\r\n                state.isError = false;\r\n                state.isErroring = false;\r\n                state.isSuccess = false;\r\n                state.isSuccessing = false;\r\n                state.button = null;\r\n                state.errors = [];\r\n            },\r\n            busy: function() {\r\n                var state = this;\r\n                if (!state.isBusy) {\r\n                    state.isBusy = true;\r\n                    state.isError = false;\r\n                    state.isErroring = false;\r\n                    state.isSuccess = false;\r\n                    state.isSuccessing = false;\r\n                    state.errors = [];\r\n                    return true;\r\n                } else {\r\n                    return false;\r\n                }\r\n            },\r\n            error: function error(error) {\r\n                console.log('State.error', error);\r\n                var state = this;\r\n                state.isBusy = false;\r\n                state.isError = true;\r\n                state.isErroring = true;\r\n                state.isSuccess = false;\r\n                state.isSuccessing = false;\r\n                state.errors.push(error);\r\n                $timeout(function() {\r\n                    state.isErroring = false;\r\n                }, DELAY);\r\n            },\r\n            ready: function ready() {\r\n                var state = this;\r\n                state.idle();\r\n                state.isReady = true;\r\n            },\r\n            success: function success() {\r\n                var state = this;\r\n                state.isBusy = false;\r\n                state.isError = false;\r\n                state.isErroring = false;\r\n                state.isSuccess = true;\r\n                state.isSuccessing = true;\r\n                state.errors = [];\r\n                $timeout(function() {\r\n                    state.isSuccessing = false;\r\n                }, DELAY);\r\n            },\r\n            enabled: function enabled() {\r\n                var state = this;\r\n                return !state.isBusy && !state.isErroring && !state.isSuccessing;\r\n            },\r\n            errorMessage: function errorMessage() {\r\n                var state = this;\r\n                return state.isError ? state.errors[state.errors.length - 1] : null;\r\n            },\r\n            submitClass: function submitClass() {\r\n                var state = this;\r\n                return {\r\n                    busy: state.isBusy,\r\n                    ready: state.isReady,\r\n                    successing: state.isSuccessing,\r\n                    success: state.isSuccess,\r\n                    errorring: state.isErroring,\r\n                    error: state.isError,\r\n                };\r\n            },\r\n            labels: function labels(addons) {\r\n                var state = this;\r\n                var defaults = {\r\n                    ready: 'submit',\r\n                    busy: 'sending',\r\n                    error: 'error',\r\n                    success: 'success',\r\n                };\r\n                if (addons) {\r\n                    angular.extend(defaults, addons);\r\n                }\r\n                var label = defaults.ready;\r\n                if (state.isBusy) {\r\n                    label = defaults.busy;\r\n                } else if (state.isSuccess) {\r\n                    label = defaults.success;\r\n                } else if (state.isError) {\r\n                    label = defaults.error;\r\n                }\r\n                return label;\r\n            },\r\n            classes: function classes(addons) {\r\n                var state = this,\r\n                    classes = null;\r\n                classes = {\r\n                    ready: state.isReady,\r\n                    busy: state.isBusy,\r\n                    successing: state.isSuccessing,\r\n                    success: state.isSuccess,\r\n                    errorring: state.isErroring,\r\n                    error: state.isError,\r\n                };\r\n                if (addons) {\r\n                    angular.forEach(addons, function(value, key) {\r\n                        classes[value] = classes[key];\r\n                    });\r\n                }\r\n                return classes;\r\n            }\r\n        };\r\n\r\n        return State;\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar transformProperty = detectTransformProperty();\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.factory('Style', [function () {\r\n\t\tfunction Style() {\r\n\t\t\tthis.props = {\r\n\t\t\t\tscale: 1,\r\n\t\t\t\thoverScale: 1,\r\n\t\t\t\tcurrentScale: 1,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tStyle.prototype = {\r\n\t\t\tset: function (element) {\r\n\t\t\t\tvar styles = [];\r\n\t\t\t\tfor (var key in this) {\r\n\t\t\t\t\tif (key !== 'props') {\r\n\t\t\t\t\t\tstyles.push(key + ':' + this[key]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telement.style.cssText = styles.join(';') + ';';\r\n\t\t\t},\r\n\t\t\ttransform: function (transform) {\r\n\t\t\t\tthis[transformProperty] = transform;\r\n\t\t\t},\r\n\t\t\ttransformOrigin: function (x, y) {\r\n\t\t\t\tthis[transformProperty + '-origin-x'] = (Math.round(x * 1000) / 1000) + '%';\r\n\t\t\t\tthis[transformProperty + '-origin-y'] = (Math.round(y * 1000) / 1000) + '%';\r\n\t\t\t},\r\n\t\t};\r\n\r\n\t\treturn Style;\r\n    }]);\r\n\r\n\tfunction detectTransformProperty() {\r\n\t\tvar transformProperty = 'transform',\r\n\t\t\tsafariPropertyHack = 'webkitTransform';\r\n\t\tvar div = document.createElement(\"DIV\");\r\n\t\tif (typeof div.style[transformProperty] !== 'undefined') {\r\n            ['webkit', 'moz', 'o', 'ms'].every(function (prefix) {\r\n\t\t\t\tvar e = '-' + prefix + '-transform';\r\n\t\t\t\tif (typeof div.style[e] !== 'undefined') {\r\n\t\t\t\t\ttransformProperty = e;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t} else if (typeof div.style[safariPropertyHack] !== 'undefined') {\r\n\t\t\ttransformProperty = '-webkit-transform';\r\n\t\t} else {\r\n\t\t\ttransformProperty = undefined;\r\n\t\t}\r\n\t\treturn transformProperty;\r\n\t}\r\n\r\n}());\r\n\n/* global angular */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.factory('Vector', function () {\r\n\t\tfunction Vector(x, y) {\r\n\t\t\tthis.x = x || 0;\r\n\t\t\tthis.y = y || 0;\r\n\t\t}\r\n\t\tVector.make = function (a, b) {\r\n\t\t\treturn new Vector(b.x - a.x, b.y - a.y);\r\n\t\t};\r\n\t\tVector.size = function (a) {\r\n\t\t\treturn Math.sqrt(a.x * a.x + a.y * a.y);\r\n\t\t};\r\n\t\tVector.normalize = function (a) {\r\n\t\t\tvar l = Vector.size(a);\r\n\t\t\ta.x /= l;\r\n\t\t\ta.y /= l;\r\n\t\t\treturn a;\r\n\t\t};\r\n\t\tVector.incidence = function (a, b) {\r\n\t\t\tvar angle = Math.atan2(b.y, b.x) - Math.atan2(a.y, a.x);\r\n\t\t\t// if (angle < 0) angle += 2 * Math.PI;\r\n\t\t\t// angle = Math.min(angle, (Math.PI * 2 - angle));\r\n\t\t\treturn angle;\r\n\t\t};\r\n\t\tVector.distance = function (a, b) {\r\n\t\t\treturn Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));\r\n\t\t};\r\n\t\tVector.cross = function (a, b) {\r\n\t\t\treturn (a.x * b.y) - (a.y * b.x);\r\n\t\t};\r\n\t\tVector.difference = function (a, b) {\r\n\t\t\treturn new Vector(a.x - b.x, a.y - b.y);\r\n\t\t};\r\n\t\tVector.power = function (a, b) {\r\n\t\t\tvar x = Math.abs(b.x - a.x);\r\n\t\t\tvar y = Math.abs(b.y - a.y);\r\n\t\t\treturn (x + y) / 2;\r\n\t\t};\r\n\t\tVector.prototype = {\r\n\t\t\tsize: function () {\r\n\t\t\t\treturn Vector.size(this);\r\n\t\t\t},\r\n\t\t\tnormalize: function () {\r\n\t\t\t\treturn Vector.normalize(this);\r\n\t\t\t},\r\n\t\t\tincidence: function (b) {\r\n\t\t\t\treturn Vector.incidence(this, b);\r\n\t\t\t},\r\n\t\t\tcross: function (b) {\r\n\t\t\t\treturn Vector.cross(this, b);\r\n\t\t\t},\r\n\t\t\tdistance: function (b) {\r\n\t\t\t\treturn Vector.distance(this, b);\r\n\t\t\t},\r\n\t\t\tdifference: function (b) {\r\n\t\t\t\treturn Vector.difference(this, b);\r\n\t\t\t},\r\n\t\t\tpower: function () {\r\n\t\t\t\treturn (Math.abs(this.x) + Math.abs(this.y)) / 2;\r\n\t\t\t},\r\n\t\t\ttowards: function (b, friction) {\r\n\t\t\t\tfriction = friction || 0.125;\r\n\t\t\t\tthis.x += (b.x - this.x) * friction;\r\n\t\t\t\tthis.y += (b.y - this.y) * friction;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tadd: function (b) {\r\n\t\t\t\tthis.x += b.x;\r\n\t\t\t\tthis.y += b.y;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tfriction: function (b) {\r\n\t\t\t\tthis.x *= b;\r\n\t\t\t\tthis.y *= b;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tcopy: function (b) {\r\n\t\t\t\treturn new Vector(this.x, this.y);\r\n\t\t\t},\r\n\t\t\ttoString: function () {\r\n\t\t\t\treturn '{' + this.x + ',' + this.y + '}';\r\n\t\t\t},\r\n\t\t};\r\n\t\treturn Vector;\r\n\t});\r\n\r\n\tapp.factory('Utils', ['$compile', '$controller', 'Vector', function ($compile, $controller, Vector) {\r\n\r\n\t\t(function () {\r\n\t\t\t// POLYFILL Array.prototype.reduce\r\n\t\t\t// Production steps of ECMA-262, Edition 5, 15.4.4.21\r\n\t\t\t// Reference: http://es5.github.io/#x15.4.4.21\r\n\t\t\t// https://tc39.github.io/ecma262/#sec-array.prototype.reduce\r\n\t\t\tif (!Array.prototype.reduce) {\r\n\t\t\t\tObject.defineProperty(Array.prototype, 'reduce', {\r\n\t\t\t\t\tvalue: function (callback) { // , initialvalue\r\n\t\t\t\t\t\tif (this === null) {\r\n\t\t\t\t\t\t\tthrow new TypeError('Array.prototype.reduce called on null or undefined');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (typeof callback !== 'function') {\r\n\t\t\t\t\t\t\tthrow new TypeError(callback + ' is not a function');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar o = Object(this);\r\n\t\t\t\t\t\tvar len = o.length >>> 0;\r\n\t\t\t\t\t\tvar k = 0;\r\n\t\t\t\t\t\tvar value;\r\n\t\t\t\t\t\tif (arguments.length == 2) {\r\n\t\t\t\t\t\t\tvalue = arguments[1];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\twhile (k < len && !(k in o)) {\r\n\t\t\t\t\t\t\t\tk++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (k >= len) {\r\n\t\t\t\t\t\t\t\tthrow new TypeError('Reduce of empty array with no initial value');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvalue = o[k++];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\twhile (k < len) {\r\n\t\t\t\t\t\t\tif (k in o) {\r\n\t\t\t\t\t\t\t\tvalue = callback(value, o[k], k, o);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tk++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}());\r\n\t\tvar _isTouch;\r\n\t\tvar getNow = Date.now || function () {\r\n\t\t\treturn new Date().getTime();\r\n\t\t};\r\n\t\tvar ua = window.navigator.userAgent.toLowerCase();\r\n\t\tvar safari = ua.indexOf('safari') !== -1 && ua.indexOf('chrome') === -1;\r\n\t\tvar msie = ua.indexOf('trident') !== -1 || ua.indexOf('edge') !== -1 || ua.indexOf('msie') !== -1;\r\n\t\tvar chrome = !safari && !msie && ua.indexOf('chrome') !== -1;\r\n\t\tvar mobile = ua.indexOf('mobile') !== -1;\r\n\t\tvar isChrome = navigator.userAgent.toLowerCase().indexOf('chrome') > -1;\r\n\t\tvar isSafari = navigator.userAgent.toLowerCase().indexOf('safari') > -1;\r\n\r\n\t\tfunction Utils() {}\r\n\t\tUtils.reverseSortOn = reverseSortOn;\r\n\t\tUtils.getTouch = getTouch;\r\n\t\tUtils.getRelativeTouch = getRelativeTouch;\r\n\t\tUtils.getClosest = getClosest;\r\n\t\tUtils.getClosestElement = getClosestElement;\r\n\t\tUtils.throttle = throttle;\r\n\t\tUtils.where = where;\r\n\t\tUtils.format = format;\r\n\t\tUtils.compileController = compileController;\r\n\t\tUtils.reducer = reducer;\r\n\t\tUtils.reducerSetter = reducerSetter;\r\n\t\tUtils.reducerAdder = reducerAdder;\r\n\t\tUtils.downloadFile = downloadFile;\r\n\t\tUtils.serverDownload = serverDownload;\r\n\t\tUtils.toMd5 = function (string) {\r\n\t\t\treturn Md5.encode(string);\r\n\t\t};\r\n\t\tUtils.ua = {\r\n\t\t\tsafari: safari,\r\n\t\t\tmsie: msie,\r\n\t\t\tchrome: chrome,\r\n\t\t\tmobile: mobile,\r\n\t\t};\r\n\t\tangular.forEach(Utils.ua, function (value, key) {\r\n\t\t\tif (value) {\r\n\t\t\t\tangular.element(document.getElementsByTagName('body')).addClass(key);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn Utils;\r\n\r\n\t\tfunction isTouch() {\r\n\t\t\tif (!_isTouch) {\r\n\t\t\t\t_isTouch = {\r\n\t\t\t\t\tvalue: ('ontouchstart' in window || 'onmsgesturechange' in window)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t// console.log(_isTouch);\r\n\t\t\treturn _isTouch.value;\r\n\t\t}\r\n\r\n\t\tfunction getTouch(e, previous) {\r\n\t\t\tvar t = new Vector();\r\n\t\t\tif (e.type === 'touchstart' || e.type === 'touchmove' || e.type === 'touchend' || e.type === 'touchcancel') {\r\n\t\t\t\tvar touch = null;\r\n\t\t\t\tvar event = e.originalEvent ? e.originalEvent : e;\r\n\t\t\t\tvar touches = event.touches.length ? event.touches : event.changedTouches;\r\n\t\t\t\tif (touches && touches.length) {\r\n\t\t\t\t\ttouch = touches[0];\r\n\t\t\t\t}\r\n\t\t\t\tif (touch) {\r\n\t\t\t\t\tt.x = touch.pageX;\r\n\t\t\t\t\tt.y = touch.pageY;\r\n\t\t\t\t}\r\n\t\t\t} else if (e.type === 'click' || e.type === 'mousedown' || e.type === 'mouseup' || e.type === 'mousemove' || e.type === 'mouseover' || e.type === 'mouseout' || e.type === 'mouseenter' || e.type === 'mouseleave' || e.type === 'contextmenu') {\r\n\t\t\t\tt.x = e.pageX;\r\n\t\t\t\tt.y = e.pageY;\r\n\t\t\t}\r\n\t\t\tif (previous) {\r\n\t\t\t\tt.s = Vector.difference(t, previous);\r\n\t\t\t}\r\n\t\t\tt.type = e.type;\r\n\t\t\treturn t;\r\n\t\t}\r\n\r\n\t\tfunction getRelativeTouch(node, point) {\r\n\t\t\tvar element = angular.element(node); // passing through jqlite for accepting both\r\n\t\t\tnode = element[0];\r\n\t\t\tvar rect = node.getBoundingClientRect();\r\n\t\t\t// var e = new Vector(rect.left + node.scrollLeft, rect.top + node.scrollTop);\r\n\t\t\tvar e = new Vector(rect.left, rect.top);\r\n\t\t\treturn Vector.difference(point, e);\r\n\t\t}\r\n\r\n\t\tfunction getClosest(el, selector) {\r\n\t\t\tvar matchesFn, parent;\r\n            ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'].some(function (fn) {\r\n\t\t\t\tif (typeof document.body[fn] == 'function') {\r\n\t\t\t\t\tmatchesFn = fn;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t\tif (el[matchesFn](selector)) {\r\n\t\t\t\treturn el;\r\n\t\t\t}\r\n\t\t\twhile (el !== null) {\r\n\t\t\t\tparent = el.parentElement;\r\n\t\t\t\tif (parent !== null && parent[matchesFn](selector)) {\r\n\t\t\t\t\treturn parent;\r\n\t\t\t\t}\r\n\t\t\t\tel = parent;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfunction getClosestElement(el, target) {\r\n\t\t\tvar matchesFn, parent;\r\n\t\t\tif (el === target) {\r\n\t\t\t\treturn el;\r\n\t\t\t}\r\n\t\t\twhile (el !== null) {\r\n\t\t\t\tparent = el.parentElement;\r\n\t\t\t\tif (parent !== null && parent === target) {\r\n\t\t\t\t\treturn parent;\r\n\t\t\t\t}\r\n\t\t\t\tel = parent;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tfunction throttle(func, wait, options) {\r\n\t\t\t// Returns a function, that, when invoked, will only be triggered at most once\r\n\t\t\t// during a given window of time. Normally, the throttled function will run\r\n\t\t\t// as much as it can, without ever going more than once per `wait` duration;\r\n\t\t\t// but if you'd like to disable the execution on the leading edge, pass\r\n\t\t\t// `{leading: false}`. To disable execution on the trailing edge, ditto.\r\n\t\t\tvar context, args, result;\r\n\t\t\tvar timeout = null;\r\n\t\t\tvar previous = 0;\r\n\t\t\tif (!options) options = {};\r\n\t\t\tvar later = function () {\r\n\t\t\t\tprevious = options.leading === false ? 0 : getNow();\r\n\t\t\t\ttimeout = null;\r\n\t\t\t\tresult = func.apply(context, args);\r\n\t\t\t\tif (!timeout) context = args = null;\r\n\t\t\t};\r\n\t\t\treturn function () {\r\n\t\t\t\tvar now = getNow();\r\n\t\t\t\tif (!previous && options.leading === false) previous = now;\r\n\t\t\t\tvar remaining = wait - (now - previous);\r\n\t\t\t\tcontext = this;\r\n\t\t\t\targs = arguments;\r\n\t\t\t\tif (remaining <= 0 || remaining > wait) {\r\n\t\t\t\t\tif (timeout) {\r\n\t\t\t\t\t\tclearTimeout(timeout);\r\n\t\t\t\t\t\ttimeout = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tprevious = now;\r\n\t\t\t\t\tresult = func.apply(context, args);\r\n\t\t\t\t\tif (!timeout) context = args = null;\r\n\t\t\t\t} else if (!timeout && options.trailing !== false) {\r\n\t\t\t\t\ttimeout = setTimeout(later, remaining);\r\n\t\t\t\t}\r\n\t\t\t\treturn result;\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction where(array, query) {\r\n\t\t\tvar found = null;\r\n\t\t\tif (array) {\r\n\t\t\t\tangular.forEach(array, function (item) {\r\n\t\t\t\t\tvar has = true;\r\n\t\t\t\t\tangular.forEach(query, function (value, key) {\r\n\t\t\t\t\t\thas = has && item[key] === value;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (has) {\r\n\t\t\t\t\t\tfound = item;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn found;\r\n\t\t}\r\n\r\n\t\tfunction compileController(scope, element, html, data) {\r\n\t\t\t// console.log('Utils.compileController', element);\r\n\t\t\telement.html(html);\r\n\t\t\tvar link = $compile(element.contents());\r\n\t\t\tif (data.controller) {\r\n\t\t\t\tvar $scope = scope.$new();\r\n\t\t\t\tangular.extend($scope, data);\r\n\t\t\t\tvar controller = $controller(data.controller, {\r\n\t\t\t\t\t$scope: $scope\r\n\t\t\t\t});\r\n\t\t\t\tif (data.controllerAs) {\r\n\t\t\t\t\tscope[data.controllerAs] = controller;\r\n\t\t\t\t}\r\n\t\t\t\telement.data('$ngControllerController', controller);\r\n\t\t\t\telement.children().data('$ngControllerController', controller);\r\n\t\t\t\tscope = $scope;\r\n\t\t\t}\r\n\t\t\tlink(scope);\r\n\t\t}\r\n\r\n\t\tfunction reverseSortOn(key) {\r\n\t\t\treturn function (a, b) {\r\n\t\t\t\tif (a[key] < b[key]) {\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t}\r\n\t\t\t\tif (a[key] > b[key]) {\r\n\t\t\t\t\treturn -1;\r\n\t\t\t\t}\r\n\t\t\t\t// a must be equal to b\r\n\t\t\t\treturn 0;\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction format(string, prepend, expression) {\r\n\t\t\tstring = string || '';\r\n\t\t\tprepend = prepend || '';\r\n\t\t\tvar splitted = string.split(',');\r\n\t\t\tif (splitted.length > 1) {\r\n\t\t\t\tvar formatted = splitted.shift();\r\n\t\t\t\tangular.forEach(splitted, function (value, index) {\r\n\t\t\t\t\tif (expression) {\r\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tformatted = formatted.split('{' + index + '}').join(prepend + value);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (expression) {\r\n\t\t\t\t\treturn '\\'' + formatted + '\\'';\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn formatted;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn prepend + string;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction reducer(o, key) {\r\n\t\t\treturn o[key];\r\n\t\t}\r\n\r\n\t\tfunction reducerSetter(o, key, value) {\r\n\t\t\tif (typeof key == 'string') {\r\n\t\t\t\treturn reducerSetter(o, key.split('.'), value);\r\n\t\t\t} else if (key.length == 1 && value !== undefined) {\r\n\t\t\t\treturn (o[key[0]] = value);\r\n\t\t\t} else if (key.length === 0) {\r\n\t\t\t\treturn o;\r\n\t\t\t} else {\r\n\t\t\t\treturn reducerSetter(o[key[0]], key.slice(1), value);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction reducerAdder(o, key, value) {\r\n\t\t\tif (typeof key == 'string') {\r\n\t\t\t\treturn reducerAdder(o, key.split('.'), value);\r\n\t\t\t} else if (key.length == 1 && value !== undefined) {\r\n\t\t\t\treturn (o[key[0]] += value);\r\n\t\t\t} else if (key.length === 0) {\r\n\t\t\t\treturn o;\r\n\t\t\t} else {\r\n\t\t\t\treturn reducerAdder(o[key[0]], key.slice(1), value);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction downloadFile(content, name, type) {\r\n\t\t\ttype = type || 'application/octet-stream';\r\n\t\t\tvar base64 = null;\r\n\t\t\tvar blob = new Blob([content], {\r\n\t\t\t\ttype: type\r\n\t\t\t});\r\n\t\t\tvar reader = new window.FileReader();\r\n\t\t\treader.readAsDataURL(blob);\r\n\t\t\treader.onloadend = function () {\r\n\t\t\t\tbase64 = reader.result;\r\n\t\t\t\tdownload();\r\n\t\t\t};\r\n\r\n\t\t\tfunction download() {\r\n\t\t\t\t// If in Chrome or Safari - download via virtual link click\r\n\t\t\t\t// if (isChrome || isSafari) {\r\n\t\t\t\t//Creating new link node.\r\n\t\t\t\tif (document.createEvent) {\r\n\t\t\t\t\tvar anchor = document.createElement('a');\r\n\t\t\t\t\tanchor.href = base64;\r\n\t\t\t\t\tif (anchor.download !== undefined) {\r\n\t\t\t\t\t\t//Set HTML5 download attribute. This will prevent file from opening if supported.\r\n\t\t\t\t\t\tvar downloadName = name || base64.substring(base64.lastIndexOf('/') + 1, base64.length);\r\n\t\t\t\t\t\tanchor.download = downloadName;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//Dispatching click event.\r\n\t\t\t\t\tvar event = document.createEvent('MouseEvents');\r\n\t\t\t\t\tevent.initEvent('click', true, true);\r\n\t\t\t\t\tanchor.dispatchEvent(event);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\t// }\r\n\t\t\t\t// Force file download (whether supported by server).\r\n\t\t\t\tvar query = '?download';\r\n\t\t\t\twindow.open(base64.indexOf('?') > -1 ? base64 : base64 + query, '_self');\r\n\t\t\t}\r\n\r\n\t\t\tfunction __download() {\r\n\t\t\t\tvar supportsDownloadAttribute = 'download' in document.createElement('a');\r\n\t\t\t\tif (supportsDownloadAttribute) {\r\n\t\t\t\t\tvar anchor = document.createElement('a');\r\n\t\t\t\t\tanchor.href = 'data:attachment/text;base64,' + encodeURI(window.btoa(content));\r\n\t\t\t\t\tanchor.target = '_blank';\r\n\t\t\t\t\tanchor.download = name;\r\n\t\t\t\t\t//Dispatching click event.\r\n\t\t\t\t\tif (document.createEvent) {\r\n\t\t\t\t\t\tvar event = document.createEvent('MouseEvents');\r\n\t\t\t\t\t\tevent.initEvent('click', true, true);\r\n\t\t\t\t\t\tanchor.dispatchEvent(event);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (window.Blob !== undefined && window.saveAs !== undefined) {\r\n\t\t\t\t\tvar blob = new Blob([content], {\r\n\t\t\t\t\t\ttype: type\r\n\t\t\t\t\t});\r\n\t\t\t\t\tsaveAs(blob, filename);\r\n\t\t\t\t} else {\r\n\t\t\t\t\twindow.open('data:attachment/text;charset=utf-8,' + encodeURI(content));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t/*\r\n\t\t\tvar headers = response.headers();\r\n\t\t\t// console.log(response);\r\n\t\t\tvar blob = new Blob([response.data], { type: \"application/octet-stream\" }); // { type: headers['content-type'] });\r\n\t\t\tvar windowUrl = (window.URL || window.webkitURL);\r\n\t\t\tvar downloadUrl = windowUrl.createObjectURL(blob);\r\n\t\t\tvar anchor = document.createElement(\"a\");\r\n\t\t\tanchor.href = downloadUrl;\r\n\t\t\tvar fileNamePattern = /filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/;\r\n\t\t\tanchor.download = fileNamePattern.exec(headers['content-disposition'])[1];\r\n\t\t\tdocument.body.appendChild(anchor);\r\n\t\t\tanchor.click();\r\n\t\t\twindowUrl.revokeObjectURL(blob);\r\n\t\t\tanchor.remove();\r\n\t\t\t*/\r\n\t\t\t/*\r\n\t\t\t//Dispatching click event.\r\n\t\t\tif (document.createEvent) {\r\n\t\t\t    var e = document.createEvent('MouseEvents');\r\n\t\t\t    e.initEvent('click', true, true);\r\n\t\t\t    link.dispatchEvent(e);\r\n\t\t\t    return true;\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t}\r\n\r\n\t\tfunction serverDownload(options) {\r\n\t\t\tvar defaults = {\r\n\t\t\t\turi: '/api/reports/download',\r\n\t\t\t\tname: 'Filename',\r\n\t\t\t\textension: 'txt',\r\n\t\t\t\ttype: 'text/plain',\r\n\t\t\t\tcontent: 'Hello!',\r\n\t\t\t};\r\n\t\t\toptions = angular.extend(defaults, options);\r\n\t\t\tvar content = JSON.stringify(options); // unescape(encodeURIComponent(JSON.stringify(download)));\r\n\t\t\tvar form = document.createElement('form');\r\n\t\t\tvar input = document.createElement('input');\r\n\t\t\tinput.name = 'download';\r\n\t\t\tinput.value = content;\r\n\t\t\tform.appendChild(input);\r\n\t\t\tform.action = options.uri;\r\n\t\t\tform.method = 'POST';\r\n\t\t\tform.target = 'ProjectDownloads';\r\n\t\t\tform.enctype = 'application/x-www-form-urlencoded';\r\n\t\t\t// form.enctype = 'multipart/form-data';\r\n\t\t\t// form.enctype = 'text/plain';\r\n\t\t\tdocument.body.appendChild(form);\r\n\t\t\tform.submit();\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tdocument.body.removeChild(form);\r\n\t\t\t}, 100);\r\n\t\t\t// angular.element(form).find('button')[0].click();\r\n\t\t\treturn Utils;\r\n\t\t}\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.factory('Doc', ['Api', '$promise', function(Api, $promise) {\r\n        function Doc(item) {\r\n            if (item) {\r\n                angular.extend(this, item);\r\n            }\r\n        }\r\n\r\n        Doc.prototype = {\r\n\r\n        };\r\n\r\n        var statics = {};\r\n\r\n        angular.extend(Doc, statics);\r\n\r\n        return Doc;\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.factory('View', ['Api', '$promise', '$location', '$routeParams', 'environment', 'Doc', function(Api, $promise, $location, $routeParams, environment, Doc) {\r\n        function View(doc) {\r\n            var url = $location.path(),\r\n                params = $routeParams;\r\n            var view = {\r\n                environment: environment,\r\n                route: {\r\n                    url: url,\r\n                    params: params,\r\n                },\r\n                doc: doc,\r\n            };\r\n            angular.extend(this, view);\r\n        }\r\n\r\n        View.prototype = {\r\n\r\n        };\r\n\r\n        var statics = {\r\n            current: function() {\r\n                return $promise(function(promise) {\r\n                    var url = $location.path();\r\n                    console.log('View.current', url);\r\n                    Api.docs.url(url).then(function(response) {\r\n                        var doc = new Doc(response);\r\n                        var view = new View(doc);\r\n                        promise.resolve(view);\r\n\r\n                    }, function(error) {\r\n                        promise.reject(error);\r\n\r\n                    });\r\n                    /*\r\n                    Api.navs.main().then(function(items) {\r\n                        var doc = null,\r\n                            url = $location.path(),\r\n                            pool = getPool(items);\r\n                        var item = pool[url];\r\n                        if (item) {\r\n                            doc = new Doc(item);\r\n                        }\r\n                        promise.resolve(doc);\r\n\r\n                    }, function(error) {\r\n                        promise.reject(error);\r\n\r\n                    });\r\n                    */\r\n                });\r\n            }\r\n        };\r\n\r\n        angular.extend(View, statics);\r\n\r\n        function getPool(items) {\r\n            var pool = {};\r\n\r\n            function _getPool(items) {\r\n                if (items) {\r\n                    angular.forEach(items, function(item) {\r\n                        pool[item.url] = item;\r\n                        _getPool(item.items);\r\n                    });\r\n                }\r\n            }\r\n            _getPool(items);\r\n            return pool;\r\n        }\r\n\r\n        return View;\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.service('WebApi', ['$http', '$promise', '$timeout', 'environment',\r\n        function($http, $promise, $timeout, environment) {\r\n\r\n            function $httpPromise(method, url, data) {\r\n                return $promise(function(promise) {\r\n\r\n                    $http[method](environment.urls.api + url, data).then(function(response) {\r\n                        promise.resolve(response.data);\r\n\r\n                    }, function(e, status) {\r\n                        var error = (e && e.data) ? e.data : {};\r\n                        error.status = e.status;\r\n                        promise.reject(error);\r\n\r\n                    });\r\n                });\r\n            }\r\n\r\n            function $get(url) {\r\n                return $httpPromise('get', url);\r\n            }\r\n\r\n            function $post(url, data) {\r\n                return $httpPromise('post', url, data);\r\n            }\r\n\r\n            function $put(url, data) {\r\n                return $httpPromise('put', url, data);\r\n            }\r\n\r\n            function $patch(url, data) {\r\n                return $httpPromise('patch', url, data);\r\n            }\r\n\r\n            function $delete(url) {\r\n                return $httpPromise('delete', url);\r\n            }\r\n\r\n            function $fake(data) {\r\n                var deferred = $q.defer();\r\n                $timeout(function() {\r\n                    deferred.resolve({ data: data });\r\n                }, 1000);\r\n                return deferred.promise;\r\n            }\r\n\r\n            this.get = $get;\r\n            this.post = $post;\r\n            this.put = $put;\r\n            this.patch = $patch;\r\n            this.delete = $delete;\r\n            this.fake = $fake;\r\n\r\n        }\r\n    ]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.service('Router', ['$location', '$timeout', function($location, $timeout) {\r\n\r\n        var service = this;\r\n        service.redirect = redirect;\r\n        service.path = path;\r\n        service.apply = apply;\r\n\r\n        function redirect(path, msecs) {\r\n            function doRedirect() {\r\n                $location.$$lastRequestedPath = $location.path();\r\n                $location.path(path);\r\n            }\r\n            if (msecs) {\r\n                $timeout(function() {\r\n                    doRedirect();\r\n                }, msecs);\r\n            } else {\r\n                doRedirect();\r\n            }\r\n        }\r\n\r\n        function path(path, msecs) {\r\n            function doRetry() {\r\n                path = $location.$$lastRequestedPath || path;\r\n                $location.$$lastRequestedPath = null;\r\n                $location.path(path);\r\n            }\r\n            if (msecs) {\r\n                $timeout(function() {\r\n                    doRetry();\r\n                }, msecs);\r\n            } else {\r\n                doRetry();\r\n            }\r\n        }\r\n\r\n        function apply(path, msecs) {\r\n            function doRetry() {\r\n                $location.path(path);\r\n            }\r\n            if (msecs) {\r\n                $timeout(function() {\r\n                    doRetry();\r\n                }, msecs);\r\n            } else {\r\n                $timeout(function() {\r\n                    doRetry();\r\n                });\r\n            }\r\n        }\r\n\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.factory('$silent', ['$rootScope', '$location', function($rootScope, $location) {\r\n        function $silent() {}\r\n\r\n        var $path;\r\n\r\n        function unlink() {\r\n            var listeners = $rootScope.$$listeners.$locationChangeSuccess;\r\n            angular.forEach(listeners, function(value, name) {\r\n                if (value === listener) {\r\n                    return;\r\n                }\r\n\r\n                function relink() {\r\n                    listeners[name] = value;\r\n                }\r\n                listeners[name] = relink; // temporary unlinking\r\n            });\r\n        }\r\n\r\n        function listener(e) {\r\n            // console.log('onLocationChangeSuccess', e);\r\n            if ($path === $location.path()) {\r\n                unlink();\r\n            }\r\n            $path = null;\r\n        }\r\n\r\n        var statics = {\r\n            silent: function(path, replace) {\r\n                // this.prev = $location.path(); ???\r\n                var location = $location.url(path);\r\n                if (replace) {\r\n                    location.replace();\r\n                }\r\n                $path = $location.path();\r\n            },\r\n            path: function(path) {\r\n                return $location.path(path);\r\n            },\r\n        };\r\n\r\n        angular.extend($silent, statics);\r\n        $rootScope.$$listeners.$locationChangeSuccess.unshift(listener);\r\n        // console.log('$rootScope.$$listeners.$locationChangeSuccess', $rootScope.$$listeners.$locationChangeSuccess);\r\n        return $silent;\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.factory('Cookie', ['$q', '$window', function($q, $window) {\r\n        function Cookie() {}\r\n        Cookie.TIMEOUT = 5 * 60 * 1000; // five minutes\r\n        Cookie._set = function(name, value, days) {\r\n            var expires;\r\n            if (days) {\r\n                var date = new Date();\r\n                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\r\n                expires = '; expires=' + date.toGMTString();\r\n            } else {\r\n                expires = '';\r\n            }\r\n            $window.document.cookie = name + '=' + value + expires + '; path=/';\r\n        };\r\n        Cookie.exists = function(name) {\r\n            return $window.document.cookie.indexOf(';' + name + '=') !== -1 || $window.document.cookie.indexOf(name + '=') === 0;\r\n        };\r\n        Cookie.get = function(name) {\r\n            var cookieName = name + \"=\";\r\n            var ca = $window.document.cookie.split(';');\r\n            for (var i = 0; i < ca.length; i++) {\r\n                var c = ca[i];\r\n                while (c.charAt(0) == ' ') {\r\n                    c = c.substring(1, c.length);\r\n                }\r\n                if (c.indexOf(cookieName) === 0) {\r\n                    var value = c.substring(cookieName.length, c.length);\r\n                    var model = null;\r\n                    try {\r\n                        model = JSON.parse(decodeURIComponent(atob(value)));\r\n                    } catch (e) {\r\n                        console.log('Cookie.get.error parsing', key, e);\r\n                    }\r\n                    return model;\r\n                }\r\n            }\r\n            return null;\r\n        };\r\n        Cookie.set = function(name, value, days) {\r\n            try {\r\n                var cache = [];\r\n                var json = JSON.stringify(value, function(key, value) {\r\n                    if (key === 'pool') {\r\n                        return;\r\n                    }\r\n                    if (typeof value === 'object' && value !== null) {\r\n                        if (cache.indexOf(value) !== -1) {\r\n                            // Circular reference found, discard key\r\n                            return;\r\n                        }\r\n                        cache.push(value);\r\n                    }\r\n                    return value;\r\n                });\r\n                cache = null;\r\n                Cookie._set(name, btoa(encodeURIComponent(json)), days);\r\n            } catch (e) {\r\n                console.log('Cookie.set.error serializing', name, value, e);\r\n            }\r\n        };\r\n        Cookie.delete = function(name) {\r\n            Cookie._set(name, \"\", -1);\r\n        };\r\n        Cookie.on = function(name) {\r\n            var deferred = $q.defer();\r\n            var i, interval = 1000,\r\n                elapsed = 0,\r\n                timeout = Cookie.TIMEOUT;\r\n\r\n            function checkCookie() {\r\n                if (elapsed > timeout) {\r\n                    deferred.reject('timeout');\r\n                } else {\r\n                    var c = Cookie.get(name);\r\n                    if (c) {\r\n                        deferred.resolve(c);\r\n                    } else {\r\n                        elapsed += interval;\r\n                        i = setTimeout(checkCookie, interval);\r\n                    }\r\n                }\r\n            }\r\n            checkCookie();\r\n            return deferred.promise;\r\n        };\r\n        return Cookie;\r\n    }]);\r\n\r\n    app.factory('LocalStorage', ['$q', '$window', 'Cookie', function($q, $window, Cookie) {\r\n        function LocalStorage() {}\r\n\r\n        function isLocalStorageSupported() {\r\n            var supported = false;\r\n            try {\r\n                supported = 'localStorage' in $window && $window.localStorage !== null;\r\n                if (supported) {\r\n                    $window.localStorage.setItem('test', '1');\r\n                    $window.localStorage.removeItem('test');\r\n                } else {\r\n                    supported = false;\r\n                }\r\n            } catch (e) {\r\n                supported = false;\r\n            }\r\n            return supported;\r\n        }\r\n        LocalStorage.isSupported = isLocalStorageSupported();\r\n        if (LocalStorage.isSupported) {\r\n            LocalStorage.exists = function(name) {\r\n                return $window.localStorage[name] !== undefined;\r\n            };\r\n            LocalStorage.get = function(name) {\r\n                var value = null;\r\n                if ($window.localStorage[name] !== undefined) {\r\n                    try {\r\n                        value = JSON.parse($window.localStorage[name]);\r\n                    } catch (e) {\r\n                        console.log('LocalStorage.get.error parsing', name, e);\r\n                    }\r\n                }\r\n                return value;\r\n            };\r\n            LocalStorage.set = function(name, value) {\r\n                try {\r\n                    var cache = [];\r\n                    var json = JSON.stringify(value, function(key, value) {\r\n                        if (key === 'pool') {\r\n                            return;\r\n                        }\r\n                        if (typeof value === 'object' && value !== null) {\r\n                            if (cache.indexOf(value) !== -1) {\r\n                                // Circular reference found, discard key\r\n                                return;\r\n                            }\r\n                            cache.push(value);\r\n                        }\r\n                        return value;\r\n                    });\r\n                    cache = null;\r\n                    $window.localStorage.setItem(name, json);\r\n                } catch (e) {\r\n                    console.log('LocalStorage.set.error serializing', name, value, e);\r\n                }\r\n            };\r\n            LocalStorage.delete = function(name) {\r\n                $window.localStorage.removeItem(name);\r\n            };\r\n            LocalStorage.on = function(name) {\r\n                var deferred = $q.defer();\r\n                var i, timeout = Cookie.TIMEOUT;\r\n\r\n                function storageEvent(e) {\r\n                    // console.log('LocalStorage.on', name, e);\r\n                    clearTimeout(i);\r\n                    if (e.originalEvent.key == name) {\r\n                        try {\r\n                            var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\r\n                            deferred.resolve(value);\r\n                        } catch (error) {\r\n                            console.log('LocalStorage.on.error parsing', name, error);\r\n                            deferred.reject('error parsing ' + name);\r\n                        }\r\n                    }\r\n                }\r\n                angular.element($window).on('storage', storageEvent);\r\n                i = setTimeout(function() {\r\n                    deferred.reject('timeout');\r\n                }, timeout);\r\n                return deferred.promise;\r\n            };\r\n        } else {\r\n            console.log('LocalStorage.unsupported switching to cookies');\r\n            LocalStorage.exists = Cookie.exists;\r\n            LocalStorage.set = Cookie.set;\r\n            LocalStorage.get = Cookie.get;\r\n            LocalStorage.delete = Cookie.delete;\r\n            LocalStorage.on = Cookie.on;\r\n        }\r\n        return LocalStorage;\r\n    }]);\r\n\r\n    app.factory('SessionStorage', ['$q', '$window', 'Cookie', function($q, $window, Cookie) {\r\n        function SessionStorage() {}\r\n\r\n        function isSessionStorageSupported() {\r\n            var supported = false;\r\n            try {\r\n                supported = 'sessionStorage' in $window && $window.sessionStorage !== undefined;\r\n                if (supported) {\r\n                    $window.sessionStorage.setItem('test', '1');\r\n                    $window.sessionStorage.removeItem('test');\r\n                } else {\r\n                    supported = false;\r\n                }\r\n            } catch (e) {\r\n                supported = false;\r\n            }\r\n            return supported;\r\n        }\r\n        SessionStorage.isSupported = isSessionStorageSupported();\r\n        if (SessionStorage.isSupported) {\r\n            SessionStorage.exists = function(name) {\r\n                return $window.sessionStorage[name] !== undefined;\r\n            };\r\n            SessionStorage.get = function(name) {\r\n                var value = null;\r\n                if ($window.sessionStorage[name] !== undefined) {\r\n                    try {\r\n                        value = JSON.parse($window.sessionStorage[name]);\r\n                    } catch (e) {\r\n                        console.log('SessionStorage.get.error parsing', name, e);\r\n                    }\r\n                }\r\n                return value;\r\n            };\r\n            SessionStorage.set = function(name, value) {\r\n                try {\r\n                    var cache = [];\r\n                    var json = JSON.stringify(value, function(key, value) {\r\n                        if (key === 'pool') {\r\n                            return;\r\n                        }\r\n                        if (typeof value === 'object' && value !== null) {\r\n                            if (cache.indexOf(value) !== -1) {\r\n                                // Circular reference found, discard key\r\n                                return;\r\n                            }\r\n                            cache.push(value);\r\n                        }\r\n                        return value;\r\n                    });\r\n                    cache = null;\r\n                    $window.sessionStorage.setItem(name, json);\r\n                } catch (e) {\r\n                    console.log('SessionStorage.set.error serializing', name, value, e);\r\n                }\r\n            };\r\n            SessionStorage.delete = function(name) {\r\n                $window.sessionStorage.removeItem(name);\r\n            };\r\n            SessionStorage.on = function(name) {\r\n                var deferred = $q.defer();\r\n                var i, timeout = Cookie.TIMEOUT;\r\n\r\n                function storageEvent(e) {\r\n                    // console.log('SessionStorage.on', name, e);\r\n                    clearTimeout(i);\r\n                    if (e.originalEvent.key === name) {\r\n                        try {\r\n                            var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\r\n                            deferred.resolve(value);\r\n                        } catch (error) {\r\n                            console.log('SessionStorage.on.error parsing', name, error);\r\n                            deferred.reject('error parsing ' + name);\r\n                        }\r\n                    }\r\n                }\r\n                angular.element($window).on('storage', storageEvent);\r\n                i = setTimeout(function() {\r\n                    deferred.reject('timeout');\r\n                }, timeout);\r\n                return deferred.promise;\r\n            };\r\n        } else {\r\n            console.log('SessionStorage.unsupported switching to cookies');\r\n            SessionStorage.exists = Cookie.exists;\r\n            SessionStorage.set = Cookie.set;\r\n            SessionStorage.get = Cookie.get;\r\n            SessionStorage.delete = Cookie.delete;\r\n            SessionStorage.on = Cookie.on;\r\n        }\r\n        return SessionStorage;\r\n    }]);\r\n\r\n}());\n/* global angular, firebase */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.factory('Color', [function () {\r\n\t\tfunction Color(r, g, b, a) {\r\n\t\t\tif (arguments.length > 1) {\r\n\t\t\t\tthis.r = (r || r === 0) ? r : 0;\r\n\t\t\t\tthis.g = (g || g === 0) ? g : 0;\r\n\t\t\t\tthis.b = (b || b === 0) ? b : 0;\r\n\t\t\t\tthis.a = (a || a === 0) ? a : 255;\r\n\t\t\t} else {\r\n\t\t\t\tvar uint = r || '0xffffff';\r\n\t\t\t\tuint = parseInt(uint);\r\n\t\t\t\tif (r.length > 8) {\r\n\t\t\t\t\tthis.r = uint >> 24 & 0xff;\r\n\t\t\t\t\tthis.g = uint >> 16 & 0xff;\r\n\t\t\t\t\tthis.b = uint >> 8 & 0xff;\r\n\t\t\t\t\tthis.a = uint >> 0 & 0xff;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.r = uint >> 16 & 0xff;\r\n\t\t\t\t\tthis.g = uint >> 8 & 0xff;\r\n\t\t\t\t\tthis.b = uint >> 0 & 0xff;\r\n\t\t\t\t\tthis.a = 255;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tColor.componentToHex = function (c) {\r\n\t\t\tvar hex = c.toString(16);\r\n\t\t\treturn hex.length == 1 ? '0' + hex : hex;\r\n\t\t};\r\n\t\tColor.luma = function (color) {\r\n\t\t\t// var luma = color.dot({ r: 54.213, g: 182.376, b: 18.411 });\r\n\t\t\tvar luma = color.dot({\r\n\t\t\t\tr: 95,\r\n\t\t\t\tg: 100,\r\n\t\t\t\tb: 60\r\n\t\t\t});\r\n\t\t\treturn luma;\r\n\t\t};\r\n\t\tColor.contrast = function (color) {\r\n\t\t\tvar luma = Color.luma(color);\r\n\t\t\tif (luma > 0.6) {\r\n\t\t\t\treturn new Color('0x000000');\r\n\t\t\t} else {\r\n\t\t\t\treturn new Color('0xffffff');\r\n\t\t\t}\r\n\t\t};\r\n\t\tColor.darker = function (color, pow, min) {\r\n\t\t\tmin = min || 0;\r\n\t\t\tvar r = Math.max(Math.floor(color.r * min), Math.floor(color.r - 255 * pow));\r\n\t\t\tvar g = Math.max(Math.floor(color.g * min), Math.floor(color.g - 255 * pow));\r\n\t\t\tvar b = Math.max(Math.floor(color.b * min), Math.floor(color.b - 255 * pow));\r\n\t\t\treturn new Color(r, g, b, color.a);\r\n\t\t};\r\n\t\tColor.lighter = function (color, pow, max) {\r\n\t\t\tmax = max || 1;\r\n\t\t\tvar r = Math.min(color.r + Math.floor((255 - color.r) * max), Math.floor(color.r + 255 * pow));\r\n\t\t\tvar g = Math.min(color.g + Math.floor((255 - color.g) * max), Math.floor(color.g + 255 * pow));\r\n\t\t\tvar b = Math.min(color.b + Math.floor((255 - color.b) * max), Math.floor(color.b + 255 * pow));\r\n\t\t\treturn new Color(r, g, b, color.a);\r\n\t\t};\r\n\t\t/*\r\n\t\tColor.rgbaToHex = function (rgba) {\r\n\t\t    rgba = rgba.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\r\n\t\t    return (rgba && rgba.length === 4) ? \"#\" +\r\n\t\t        (\"0\" + parseInt(rgba[1], 10).toString(16)).slice(-2) +\r\n\t\t        (\"0\" + parseInt(rgba[2], 10).toString(16)).slice(-2) +\r\n\t\t        (\"0\" + parseInt(rgba[3], 10).toString(16)).slice(-2) : '';\r\n\t\t}\r\n\t\t*/\r\n\t\tColor.prototype = {\r\n\t\t\ttoUint: function () {\r\n\t\t\t\treturn (this.r << 24) + (this.g << 16) + (this.b << 8) + (this.a);\r\n\t\t\t},\r\n\t\t\ttoHex: function () {\r\n\t\t\t\treturn '#' + Color.componentToHex(this.r) + Color.componentToHex(this.g) + Color.componentToHex(this.b) + Color.componentToHex(this.a);\r\n\t\t\t},\r\n\t\t\ttoRgba: function () {\r\n\t\t\t\treturn 'rgba(' + this.r + ',' + this.g + ',' + this.b + ',' + (this.a / 255).toFixed(3) + ')';\r\n\t\t\t},\r\n\t\t\tdot: function (color) {\r\n\t\t\t\treturn ((this.r / 255) * (color.r / 255) + (this.g / 255) * (color.g / 255) + (this.b / 255) * (color.b / 255));\r\n\t\t\t},\r\n\t\t\talpha: function (pow, min, max) {\r\n\t\t\t\tmin = min || 0;\r\n\t\t\t\tmax = max || 1;\r\n\t\t\t\tthis.a = Math.floor((min + (pow * (max - min))) * 255);\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tmakeSet: function () {\r\n\t\t\t\tthis.foreground = Color.contrast(this);\r\n\t\t\t\tthis.border = Color.darker(this, 0.3);\r\n\t\t\t\tthis.light = Color.lighter(this, 0.3);\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t};\r\n\t\treturn Color;\r\n    }]);\r\n\r\n\tapp.factory('Shape', [function () {\r\n\t\tfunction Shape() {}\r\n\t\tShape.shapeCircle = function (p, cx, cy, r, sa, ea) {\r\n\t\t\tsa = sa || 0;\r\n\t\t\tea = ea || 2 * Math.PI;\r\n\t\t\tp.ctx.arc(cx, cy, r, sa, ea, false);\r\n\t\t};\r\n\t\tShape.shapeStar = function (p, cx, cy, or, ir, steps) {\r\n\t\t\tvar x, y;\r\n\t\t\tvar angle = Math.PI / 2 * 3;\r\n\t\t\tvar step = Math.PI / steps;\r\n\t\t\tvar ctx = p.ctx;\r\n\t\t\tctx.moveTo(cx, cy - or);\r\n\t\t\tfor (i = 0; i < steps; i++) {\r\n\t\t\t\tx = cx + Math.cos(angle) * or;\r\n\t\t\t\ty = cy + Math.sin(angle) * or;\r\n\t\t\t\tctx.lineTo(x, y);\r\n\t\t\t\tangle += step;\r\n\t\t\t\tx = cx + Math.cos(angle) * ir;\r\n\t\t\t\ty = cy + Math.sin(angle) * ir;\r\n\t\t\t\tctx.lineTo(x, y);\r\n\t\t\t\tangle += step;\r\n\t\t\t}\r\n\t\t\tctx.lineTo(cx, cy - or);\r\n\t\t};\r\n\t\tShape.shapeRoundRect = function (p, rect, r) {\r\n\t\t\tvar ctx = p.ctx,\r\n\t\t\t\tx = rect.x,\r\n\t\t\t\ty = rect.y,\r\n\t\t\t\tw = rect.w,\r\n\t\t\t\th = rect.h;\r\n\t\t\tif (typeof r === undefined) {\r\n\t\t\t\tr = 4;\r\n\t\t\t}\r\n\t\t\tif (typeof r === 'number') {\r\n\t\t\t\tr = {\r\n\t\t\t\t\ttl: r,\r\n\t\t\t\t\ttr: r,\r\n\t\t\t\t\tbr: r,\r\n\t\t\t\t\tbl: r\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tvar defaultRadius = {\r\n\t\t\t\t\ttl: 0,\r\n\t\t\t\t\ttr: 0,\r\n\t\t\t\t\tbr: 0,\r\n\t\t\t\t\tbl: 0\r\n\t\t\t\t};\r\n\t\t\t\tfor (var key in defaultRadius) {\r\n\t\t\t\t\tr[key] = r[key] || defaultRadius[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tctx.moveTo(x + r.tl, y);\r\n\t\t\tctx.lineTo(x + w - r.tr, y);\r\n\t\t\tctx.quadraticCurveTo(x + w, y, x + w, y + r.tr);\r\n\t\t\tctx.lineTo(x + w, y + h - r.br);\r\n\t\t\tctx.quadraticCurveTo(x + w, y + h, x + w - r.br, y + h);\r\n\t\t\tctx.lineTo(x + r.bl, y + h);\r\n\t\t\tctx.quadraticCurveTo(x, y + h, x, y + h - r.bl);\r\n\t\t\tctx.lineTo(x, y + r.tl);\r\n\t\t\tctx.quadraticCurveTo(x, y, x + r.tl, y);\r\n\t\t};\r\n\t\tShape.circle = function () {\r\n\t\t\tvar params = Array.prototype.slice.call(arguments);\r\n\t\t\tvar ctx = params[0].ctx;\r\n\t\t\tctx.beginPath();\r\n\t\t\tShape.shapeCircle.apply(this, params);\r\n\t\t\tctx.closePath();\r\n\t\t};\r\n\t\tShape.star = function () {\r\n\t\t\tvar params = Array.prototype.slice.call(arguments);\r\n\t\t\tvar ctx = params[0].ctx;\r\n\t\t\tctx.beginPath();\r\n\t\t\tShape.shapeStar.apply(this, params);\r\n\t\t\tctx.closePath();\r\n\t\t};\r\n\t\tShape.roundRect = function () {\r\n\t\t\tvar params = Array.prototype.slice.call(arguments);\r\n\t\t\tvar ctx = params[0].ctx;\r\n\t\t\tctx.beginPath();\r\n\t\t\tShape.shapeRoundRect.apply(this, params);\r\n\t\t\tctx.closePath();\r\n\t\t};\r\n\t\treturn Shape;\r\n    }]);\r\n\r\n\tapp.constant('PainterColors', {\r\n\t\t/*\r\n\t\tblack: new Color('0x111111'),\r\n\t\twhite: new Color('0xffffff'),\r\n\t\tred: new Color('0xff0000'),\r\n\t\tgreen: new Color('0x00ff00'),\r\n\t\tblue: new Color('0x0000ff'),\r\n\t\tyellow: new Color('0xffff00'),\r\n\t\tcyan: new Color('0x00ffff'),\r\n\t\tpurple: new Color('0xff00ff'),\r\n\t\t*/\r\n\t\tblack: '0x14191e',\r\n\t\twhite: '0xffffff',\r\n\t\tblue: '0x0023FF',\r\n\t\tred: '0xF21500',\r\n\t\tlightBlue: '0x79ccf2',\r\n\t\tlightYellow: '0xfff79a',\r\n\t\tgreyLighter: '0xf8f8f8',\r\n\t\tgreyLight: '0xeeeeee',\r\n\t\tgreyMedium: '0xcccccc',\r\n\t\tgrey: '0x90939b',\r\n\t\tmap: '0x24292e',\r\n\t});\r\n\r\n\tapp.factory('Palette', ['$q', 'Painter', 'Rect', function ($q, Painter, Rect) {\r\n\t\tfunction Palette() {\r\n\t\t\tthis.painter = new Painter().setSize(0, 0);\r\n\t\t\tthis.buffer = new Painter().setSize(0, 0);\r\n\t\t\tthis.size = {\r\n\t\t\t\tw: 0,\r\n\t\t\t\th: 0\r\n\t\t\t};\r\n\t\t\tthis.pool = {};\r\n\t\t\tthis.rows = {};\r\n\t\t}\r\n\t\tPalette.prototype = {\r\n\t\t\tgetRect: function (w, h) {\r\n\t\t\t\tvar p = this.painter,\r\n\t\t\t\t\tsize = this.size,\r\n\t\t\t\t\trows = this.rows,\r\n\t\t\t\t\tr = new Rect(0, 0, w, h),\r\n\t\t\t\t\trow = rows[h] || {\r\n\t\t\t\t\t\tx: 0,\r\n\t\t\t\t\t\ty: size.h\r\n\t\t\t\t\t};\r\n\t\t\t\tsize.w = Math.max(size.w, row.x + w);\r\n\t\t\t\tsize.h = Math.max(size.h, row.y + h);\r\n\t\t\t\tif (!p.canvas.width && !p.canvas.height) {\r\n\t\t\t\t\tp.setSize(size.w, size.h);\r\n\t\t\t\t} else if (size.w > p.canvas.width || size.h > p.canvas.height) {\r\n\t\t\t\t\t// var img = new Image();\r\n\t\t\t\t\t// img.src = p.toDataURL();\r\n\t\t\t\t\t// document.body.appendChild(canvas);\r\n\t\t\t\t\t// console.log(p.canvas.width, p.canvas.height);\r\n\t\t\t\t\t// var data = p.ctx.getImageData(0, 0, p.canvas.width, p.canvas.height);\r\n\t\t\t\t\tvar canvas = p.canvas;\r\n\t\t\t\t\tp.setCanvas(document.createElement('canvas'));\r\n\t\t\t\t\tp.setSize(size.w, size.h);\r\n\t\t\t\t\tp.ctx.drawImage(canvas, 0, 0);\r\n\t\t\t\t\t// p.ctx.putImageData(data, 0, 0);\r\n\t\t\t\t\t// p.ctx.drawImage(img, 0, 0);\r\n\t\t\t\t\t// document.body.removeChild(canvas);\r\n\t\t\t\t}\r\n\t\t\t\tr.x = row.x;\r\n\t\t\t\tr.y = row.y;\r\n\t\t\t\trow.x += w;\r\n\t\t\t\trows[h] = row;\r\n\t\t\t\treturn r;\r\n\t\t\t},\r\n\t\t\tadd: function (key, path) {\r\n\t\t\t\tvar palette = this;\r\n\t\t\t\tif (angular.isString(path)) {\r\n\t\t\t\t\tvar deferred = $q.defer();\r\n\t\t\t\t\tvar img = new Image();\r\n\t\t\t\t\timg.onload = function () {\r\n\t\t\t\t\t\tpalette.addShape(key, img.width, img.height, function (p, rect) {\r\n\t\t\t\t\t\t\tp.ctx.drawImage(img, 0, 0);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tdeferred.resolve(img);\r\n\t\t\t\t\t};\r\n\t\t\t\t\timg.onerror = function () {\r\n\t\t\t\t\t\tdeferred.reject('connot load ' + path);\r\n\t\t\t\t\t};\r\n\t\t\t\t\timg.src = path;\r\n\t\t\t\t\treturn deferred.promise;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar params = Array.prototype.slice.call(arguments);\r\n\t\t\t\t\treturn palette.addShape.apply(palette, params);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\taddShape: function (key, w, h, callback) {\r\n\t\t\t\tvar p = this.painter,\r\n\t\t\t\t\tr = this.getRect(w, h);\r\n\t\t\t\tp.ctx.save();\r\n\t\t\t\tp.ctx.rect(r.x, r.y, r.w, r.h);\r\n\t\t\t\t// p.ctx.stroke();\r\n\t\t\t\tp.ctx.clip();\r\n\t\t\t\tp.ctx.translate(r.x, r.y);\r\n\t\t\t\tcallback.call(p, p, r.clone().setPos(0, 0));\r\n\t\t\t\tp.ctx.restore();\r\n\t\t\t\tthis.pool[key] = r;\r\n\t\t\t\t// console.log('Painter.add', r);\r\n\t\t\t},\r\n\t\t\tdraw: function (target, key, x, y, pre) {\r\n\t\t\t\tvar r = this.pool[key];\r\n\t\t\t\tif (r) {\r\n\t\t\t\t\t// var ctx = target.ctx;\r\n\t\t\t\t\t// ctx.save();\r\n\t\t\t\t\ttarget.drawRect(this.painter.canvas, r, {\r\n\t\t\t\t\t\tx: x,\r\n\t\t\t\t\t\ty: y,\r\n\t\t\t\t\t\tw: r.w,\r\n\t\t\t\t\t\th: r.h\r\n\t\t\t\t\t}, pre);\r\n\t\t\t\t\t// target.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, x - r.w / 2, y - r.h / 2, r.w, r.h);\r\n\t\t\t\t\t// ctx.restore();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\ttint: function (target, key, x, y, color, pre) {\r\n\t\t\t\tvar r = this.pool[key];\r\n\t\t\t\tif (r) {\r\n\t\t\t\t\tvar p = this.painter,\r\n\t\t\t\t\t\tb = this.buffer.setSize(r.w, r.h);\r\n\t\t\t\t\tb.save();\r\n\t\t\t\t\tb.setFill(color);\r\n\t\t\t\t\tb.fillRect();\r\n\t\t\t\t\tb.ctx.globalCompositeOperation = \"destination-atop\";\r\n\t\t\t\t\tb.ctx.drawImage(p.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\r\n\t\t\t\t\tb.restore();\r\n\t\t\t\t\tconsole.log(x, y, b.canvas, target.canvas);\r\n\t\t\t\t\ttarget.draw(b.canvas, {\r\n\t\t\t\t\t\tx: x,\r\n\t\t\t\t\t\ty: y\r\n\t\t\t\t\t}, pre);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tpattern: function (target, key, x, y, w, h, color) {\r\n\t\t\t\tfunction drawPattern(pattern) {\r\n\t\t\t\t\tvar ctx = target.ctx;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x, y);\r\n\t\t\t\t\t// draw\r\n\t\t\t\t\t// ctx.beginPath();\r\n\t\t\t\t\t// ctx.rect(-x, -y, w, h);\r\n\t\t\t\t\tctx.fillStyle = pattern;\r\n\t\t\t\t\tctx.fillRect(-x, -y, w, h);\r\n\t\t\t\t\tctx.translate(-x, -y);\r\n\t\t\t\t\t// ctx.fill();\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t\tvar r = this.pool[key];\r\n\t\t\t\tif (r) {\r\n\t\t\t\t\tvar img = r.img,\r\n\t\t\t\t\t\tpattern;\r\n\t\t\t\t\tif (!img || r.color != color) {\r\n\t\t\t\t\t\tvar b = this.buffer.setSize(r.w, r.h);\r\n\t\t\t\t\t\tif (color) {\r\n\t\t\t\t\t\t\tr.color = color;\r\n\t\t\t\t\t\t\tb.save();\r\n\t\t\t\t\t\t\tb.setFill(color);\r\n\t\t\t\t\t\t\tb.fillRect();\r\n\t\t\t\t\t\t\tb.ctx.globalCompositeOperation = \"destination-atop\";\r\n\t\t\t\t\t\t\tb.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\r\n\t\t\t\t\t\t\tb.restore();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tb.ctx.drawImage(this.painter.canvas, r.x, r.y, r.w, r.h, 0, 0, r.w, r.h);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\timg = new Image();\r\n\t\t\t\t\t\timg.onload = function () {\r\n\t\t\t\t\t\t\tr.img = img;\r\n\t\t\t\t\t\t\tpattern = target.ctx.createPattern(img, \"repeat\");\r\n\t\t\t\t\t\t\tdrawPattern(pattern);\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\timg.src = b.toDataURL();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tpattern = target.ctx.createPattern(img, \"repeat\");\r\n\t\t\t\t\t\tdrawPattern(pattern);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t};\r\n\t\treturn Palette;\r\n    }]);\r\n\r\n\tapp.factory('Painter', ['Shape', 'Rect', 'Color', 'PainterColors', function (Shape, Rect, Color, PainterColors) {\r\n\t\tfunction Painter(canvas) {\r\n\t\t\tcanvas = canvas || document.createElement('canvas');\r\n\t\t\tthis.rect = new Rect();\r\n\t\t\tthis.drawingRect = new Rect();\r\n\t\t\tthis.setColors();\r\n\t\t\tthis.setCanvas(canvas);\r\n\t\t}\r\n\t\tPainter.colors = {};\r\n\t\tangular.forEach(PainterColors, function (value, key) {\r\n\t\t\tPainter.colors[key] = new Color(value).makeSet();\r\n\t\t});\r\n\t\tvar colors = Painter.colors;\r\n\t\tPainter.prototype = {\r\n\t\t\tcolors: Painter.colors,\r\n\t\t\tsetColors: function () {\r\n\t\t\t\tvar colors = this.colors;\r\n\t\t\t\tangular.forEach(PainterColors, function (value, key) {\r\n\t\t\t\t\tcolors[key] = new Color(value).makeSet();\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tsetCanvas: function (canvas) {\r\n\t\t\t\tthis.canvas = canvas;\r\n\t\t\t\tthis.setSize(canvas.offsetWidth, canvas.offsetHeight);\r\n\t\t\t\tvar ctx = canvas.getContext('2d');\r\n\t\t\t\tctx.lineCap = 'square';\r\n\t\t\t\tthis.ctx = ctx;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tsetSize: function (w, h) {\r\n\t\t\t\tthis.canvas.width = w;\r\n\t\t\t\tthis.canvas.height = h;\r\n\t\t\t\tthis.rect.w = w;\r\n\t\t\t\tthis.rect.h = h;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tcopy: function (canvas) {\r\n\t\t\t\tthis.ctx.drawImage(canvas, 0, 0);\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tclear: function () {\r\n\t\t\t\tthis.resize();\r\n\t\t\t\t// this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tresize: function () {\r\n\t\t\t\tthis.setSize(this.canvas.offsetWidth, this.canvas.offsetHeight);\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tsetText: function (font, align, verticalAlign, color) {\r\n\t\t\t\tfont = font || '11px monospace';\r\n\t\t\t\talign = align || 'center';\r\n\t\t\t\tverticalAlign = verticalAlign || 'middle';\r\n\t\t\t\tcolor = color || this.colors.black;\r\n\t\t\t\tvar ctx = this.ctx;\r\n\t\t\t\tctx.font = font;\r\n\t\t\t\tctx.textAlign = align;\r\n\t\t\t\tctx.textBaseline = verticalAlign;\r\n\t\t\t\tctx.fillStyle = color.toRgba();\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tsetFill: function (color) {\r\n\t\t\t\tcolor = color || this.colors.black;\r\n\t\t\t\tvar ctx = this.ctx;\r\n\t\t\t\t/*\r\n\t\t\t\tvar my_gradient = ctx.createLinearGradient(0, 0, 0, 170);\r\n\t\t\t\tmy_gradient.addColorStop(0, \"black\");\r\n\t\t\t\tmy_gradient.addColorStop(1, \"white\");\r\n\t\t\t\tctx.fillStyle = my_gradient;\r\n\t\t\t\t*/\r\n\t\t\t\tctx.fillStyle = color.toRgba();\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tsetStroke: function (color, size) {\r\n\t\t\t\tcolor = color || this.colors.black;\r\n\t\t\t\tvar ctx = this.ctx;\r\n\t\t\t\tsize = size || 1;\r\n\t\t\t\t/*\r\n\t\t\t\tvar gradient=ctx.createLinearGradient(0,0,170,0);\r\n\t\t\t\tgradient.addColorStop(\"0\",\"magenta\");\r\n\t\t\t\tgradient.addColorStop(\"0.5\",\"blue\");\r\n\t\t\t\tgradient.addColorStop(\"1.0\",\"red\");\r\n\t\t\t\tctx.strokeStyle = gradient;\r\n\t\t\t\t*/\r\n\t\t\t\t// Fill with gradient\r\n\t\t\t\tctx.strokeStyle = color.toRgba();\r\n\t\t\t\tctx.lineWidth = size;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\t/*\r\n\t\t\tdrawRoundRect: function (rect, r) {\r\n\t\t\t    rect = rect || this.rect;\r\n\t\t\t    Shape.roundRect(this, rect, r);\r\n\t\t\t    return this;\r\n\t\t\t},\r\n\t\t\t*/\r\n\t\t\tfillText: function (text, point, width, post, maxLength) {\r\n\t\t\t\tif (width) {\r\n\t\t\t\t\tpost = post || '';\r\n\t\t\t\t\tmaxLength = maxLength || Math.floor(width / 8);\r\n\t\t\t\t\tif (text.length > maxLength) {\r\n\t\t\t\t\t\ttext = text.substr(0, Math.min(text.length, maxLength)).trim() + post;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.ctx.fillText(text, point.x, point.y);\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tfillRect: function (rect) {\r\n\t\t\t\trect = rect || this.rect;\r\n\t\t\t\tvar ctx = this.ctx,\r\n\t\t\t\t\tx = rect.x,\r\n\t\t\t\t\ty = rect.y,\r\n\t\t\t\t\tw = rect.w,\r\n\t\t\t\t\th = rect.h;\r\n\t\t\t\tctx.fillRect(x, y, w, h);\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tstrokeRect: function (rect) {\r\n\t\t\t\trect = rect || this.rect;\r\n\t\t\t\tvar ctx = this.ctx,\r\n\t\t\t\t\tx = rect.x,\r\n\t\t\t\t\ty = rect.y,\r\n\t\t\t\t\tw = rect.w,\r\n\t\t\t\t\th = rect.h;\r\n\t\t\t\tctx.strokeRect(x, y, w, h);\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tfill: function () {\r\n\t\t\t\tthis.ctx.fill();\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tstroke: function () {\r\n\t\t\t\tthis.ctx.stroke();\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tbegin: function () {\r\n\t\t\t\tthis.ctx.beginPath();\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tclose: function () {\r\n\t\t\t\tthis.ctx.closePath();\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tsave: function () {\r\n\t\t\t\tthis.ctx.save();\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\trestore: function () {\r\n\t\t\t\tthis.ctx.restore();\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\trotate: function (angle) {\r\n\t\t\t\tthis.ctx.rotate(angle * Math.PI / 180);\r\n\t\t\t},\r\n\t\t\ttranslate: function (xy) {\r\n\t\t\t\tthis.ctx.translate(xy.x, xy.y);\r\n\t\t\t},\r\n\t\t\ttoDataURL: function () {\r\n\t\t\t\treturn this.canvas.toDataURL();\r\n\t\t\t},\r\n\t\t\tdraw: function (image, t, pre) {\r\n\t\t\t\tif (image) {\r\n\t\t\t\t\tt.w = t.w || image.width;\r\n\t\t\t\t\tt.h = t.h || image.height;\r\n\t\t\t\t\tvar ctx = this.ctx,\r\n\t\t\t\t\t\trect = this.drawingRect,\r\n\t\t\t\t\t\tx = rect.x = t.x - t.w / 2,\r\n\t\t\t\t\t\ty = rect.y = t.y - t.h / 2,\r\n\t\t\t\t\t\tw = rect.w = t.w,\r\n\t\t\t\t\t\th = rect.h = t.h;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x, y);\r\n\t\t\t\t\tif (pre) {\r\n\t\t\t\t\t\tpre.call(this);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tctx.drawImage(image, 0, 0);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t\t// console.log('painter.draw', x, y, w, h);\r\n\t\t\t\t}\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tdrawRect: function (image, s, t, pre) {\r\n\t\t\t\tif (image) {\r\n\t\t\t\t\ts.w = s.w || image.width;\r\n\t\t\t\t\ts.h = s.h || image.height;\r\n\t\t\t\t\tt.w = t.w || image.width;\r\n\t\t\t\t\tt.h = t.h || image.height;\r\n\t\t\t\t\tvar ctx = this.ctx,\r\n\t\t\t\t\t\trect = this.drawingRect,\r\n\t\t\t\t\t\tx = rect.x = t.x - s.w / 2,\r\n\t\t\t\t\t\ty = rect.y = t.y - s.h / 2,\r\n\t\t\t\t\t\tw = rect.w = t.w,\r\n\t\t\t\t\t\th = rect.h = t.h;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x, y);\r\n\t\t\t\t\tif (pre) {\r\n\t\t\t\t\t\tpre.call(this);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tctx.drawImage(image, s.x, s.y, s.w, s.h, 0, 0, t.w, t.h);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t\t// console.log('painter.drawRect', x, y, w, h);\r\n\t\t\t\t}\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\t\t\tflip: function (scale) {\r\n\t\t\t\tscale = scale || {\r\n\t\t\t\t\tx: 1,\r\n\t\t\t\t\ty: -1\r\n\t\t\t\t};\r\n\t\t\t\tvar ctx = this.ctx,\r\n\t\t\t\t\trect = this.drawingRect;\r\n\t\t\t\tctx.translate(scale.x === -1 ? rect.w : 0, scale.y === -1 ? rect.h : 0);\r\n\t\t\t\tctx.scale(scale.x, scale.y);\r\n\t\t\t},\r\n\t\t};\r\n\t\treturn Painter;\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.directive('controlMessages', [function() {\r\n        return {\r\n            restrict: 'E',\r\n            templateUrl: 'artisan/forms/messages',\r\n            transclude: {\r\n                'message': '?messageItems',\r\n            },\r\n            link: function(scope, element, attributes, model) {}\r\n        };\r\n    }]);\r\n\r\n    app.directive('control', ['$parse', function($parse) {\r\n        function formatLabel(string, prepend, expression) {\r\n            string = string || '';\r\n            prepend = prepend || '';\r\n            var splitted = string.split(',');\r\n            if (splitted.length > 1) {\r\n                var formatted = splitted.shift();\r\n                angular.forEach(splitted, function(value, index) {\r\n                    if (expression) {\r\n                        formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\r\n                    } else {\r\n                        formatted = formatted.split('{' + index + '}').join(prepend + value);\r\n                    }\r\n                });\r\n                if (expression) {\r\n                    return '\\'' + formatted + '\\'';\r\n                } else {\r\n                    return formatted;\r\n                }\r\n            } else {\r\n                return prepend + string;\r\n            }\r\n        }\r\n        var uniqueId = 0;\r\n        return {\r\n            restrict: 'A',\r\n            templateUrl: function(element, attributes) {\r\n                var template = 'artisan/forms/text';\r\n                switch (attributes.control) {\r\n                    case 'select':\r\n                        template = 'artisan/forms/select';\r\n                        break;\r\n                }\r\n                return template;\r\n            },\r\n            scope: {\r\n                ngModel: '=',\r\n                required: '=',\r\n                form: '@',\r\n                title: '@',\r\n                placeholder: '@',\r\n                source: '=?',\r\n                key: '@?',\r\n                label: '@?',\r\n            },\r\n            require: 'ngModel',\r\n            transclude: true,\r\n            link: {\r\n                pre: function preLink(scope, element, attributes, controller, transclude) {\r\n                    var label = scope.label = (scope.label ? scope.label : 'name');\r\n                    var key = scope.key = (scope.key ? scope.key : 'id');\r\n                    if (attributes.control === 'select') {\r\n                        var filter = (attributes.filter ? '| ' + attributes.filter : '');\r\n                        var optionLabel = formatLabel(label, 'item.', true);\r\n                        scope.getOptions = function() {\r\n                            return attributes.number ?\r\n                                'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in source ' + filter :\r\n                                optionLabel + ' disable when item.disabled for item in source ' + filter + ' track by item.' + key;\r\n                        };\r\n                    }\r\n                    var type = scope.type = attributes.control;\r\n                    var form = scope.form = scope.form || 'form';\r\n                    var title = scope.title = scope.title || 'untitled';\r\n                    var placeholder = scope.placeholder = scope.placeholder || title;\r\n                    var field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\r\n                    scope.format = attributes.format || null;\r\n                    scope.precision = attributes.precision || null;\r\n                    scope.validate = attributes.validate || attributes.control;\r\n                    scope.minLength = attributes.minLength || 0;\r\n                    scope.maxLength = attributes.maxLength || Number.POSITIVE_INFINITY;\r\n                    scope.min = attributes.min || null;\r\n                    scope.max = attributes.max || null;\r\n                    scope.options = $parse(attributes.options)(scope) || {};\r\n                    scope.focus = false;\r\n                    scope.visible = false;\r\n                    scope.onChange = function(model) {\r\n                        $parse(attributes.onChange)(scope.$parent);\r\n                    };\r\n                    scope.onFilter = function(model) {\r\n                        $parse(attributes.onFilter)(scope.$parent);\r\n                    };\r\n                    scope.getType = function() {\r\n                        var type = 'text';\r\n                        switch (attributes.control) {\r\n                            case 'password':\r\n                                type = scope.visible ? 'text' : 'password';\r\n                                break;\r\n                            default:\r\n                                type = attributes.control;\r\n                        }\r\n                        return type;\r\n                    };\r\n                    scope.getClasses = function() {\r\n                        var form = $parse(scope.form)(scope.$parent);\r\n                        var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\r\n                        return {\r\n                            'control-focus': scope.focus,\r\n                            'control-success': field.$valid,\r\n                            'control-error': field.$invalid && (form.$submitted || field.$touched),\r\n                            'control-empty': !field.$viewValue\r\n                        };\r\n                    };\r\n                    scope.getMessages = function() {\r\n                        var form = $parse(scope.form)(scope.$parent);\r\n                        var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\r\n                        return (form.$submitted || field.$touched) && field.$error;\r\n                    };\r\n                    scope.toggleVisibility = function() {\r\n                        scope.visible = !scope.visible;\r\n                    };\r\n                },\r\n            },\r\n        };\r\n    }]);\r\n\r\n    app.directive('_control', ['$http', '$templateCache', '$compile', '$parse', function($http, $templateCache, $compile, $parse) {\r\n        function formatLabel(string, prepend, expression) {\r\n            string = string || '';\r\n            prepend = prepend || '';\r\n            var splitted = string.split(',');\r\n            if (splitted.length > 1) {\r\n                var formatted = splitted.shift();\r\n                angular.forEach(splitted, function(value, index) {\r\n                    if (expression) {\r\n                        formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\r\n                    } else {\r\n                        formatted = formatted.split('{' + index + '}').join(prepend + value);\r\n                    }\r\n                });\r\n                if (expression) {\r\n                    return '\\'' + formatted + '\\'';\r\n                } else {\r\n                    return formatted;\r\n                }\r\n            } else {\r\n                return prepend + string;\r\n            }\r\n        }\r\n        var uniqueId = 0;\r\n        return {\r\n            restrict: 'A',\r\n            templateUrl: function(element, attributes) {\r\n                var template = 'artisan/forms/text';\r\n                switch (attributes.control) {\r\n                    case 'select':\r\n                        template = 'artisan/forms/select';\r\n                        break;\r\n                }\r\n                return template;\r\n            },\r\n            scope: {\r\n                ngModel: '=',\r\n                required: '=',\r\n                form: '@',\r\n                title: '@',\r\n                placeholder: '@',\r\n            },\r\n            require: 'ngModel',\r\n            /*\r\n            link: function(scope, element, attributes, model) {\r\n            },\r\n            */\r\n            compile: function(element, attributes) {\r\n                    return {\r\n                        pre: function(scope, element, attributes) {\r\n                            if (attributes.control === 'select') {\r\n                                var label = (attributes.label ? attributes.label : 'name');\r\n                                var key = (attributes.key ? attributes.key : 'id');\r\n                                var filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\r\n                                var optionLabel = formatLabel(label, 'item.', true);\r\n                                scope.options = attributes.number ?\r\n                                    'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter :\r\n                                    optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter + ' track by item.' + key;\r\n                                console.log('control.compile.pre', scope.options);\r\n                            }\r\n                            var type = scope.type = attributes.control;\r\n                            var form = scope.form = scope.form || 'form';\r\n                            var title = scope.title = scope.title || 'untitled';\r\n                            var placeholder = scope.placeholder = scope.placeholder || title;\r\n                            var field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\r\n                            scope.validate = attributes.validate || attributes.control;\r\n                            scope.format = attributes.format || null;\r\n                            scope.precision = attributes.precision || null;\r\n                            scope.validate = attributes.validate || attributes.control;\r\n                            scope.minLength = attributes.min || 0;\r\n                            scope.maxLength = attributes.max || Number.POSITIVE_INFINITY;\r\n                            scope.options = $parse(attributes.options)(scope) || {};\r\n                            scope.focus = false;\r\n                            scope.visible = false;\r\n                            scope.getType = function() {\r\n                                var type = 'text';\r\n                                switch (attributes.control) {\r\n                                    case 'password':\r\n                                        // var form = $parse(scope.form)(scope.$parent);\r\n                                        // var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\r\n                                        type = scope.visible ? 'text' : 'password';\r\n                                        break;\r\n                                    default:\r\n                                        type = attributes.control;\r\n                                }\r\n                                // console.log('control.getType', type);\r\n                                return type;\r\n                            };\r\n                            scope.getClasses = function() {\r\n                                var form = $parse(scope.form)(scope.$parent);\r\n                                var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\r\n                                return {\r\n                                    'control-focus': scope.focus,\r\n                                    'control-success': field.$valid,\r\n                                    'control-error': field.$invalid && (form.$submitted || field.$touched),\r\n                                    'control-empty': !field.$viewValue\r\n                                };\r\n                            };\r\n                            scope.getMessages = function() {\r\n                                var form = $parse(scope.form)(scope.$parent);\r\n                                var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\r\n                                return (form.$submitted || field.$touched) && field.$error;\r\n                            };\r\n                        },\r\n                        // post: function (scope, element, attributes) { }\r\n                    };\r\n                }\r\n                /*\r\n                compile: function(element, attributes) {\r\n                    element.removeAttr('my-dir'); \r\n                    element.attr('ng-hide', 'true');\r\n                    return function(scope) {\r\n                        $compile(element)(scope);\r\n                    };\r\n                },\r\n                */\r\n        };\r\n    }]);\r\n\r\n    app.directive('numberPicker', ['$parse', '$timeout', function($parse, $timeout) {\r\n        return {\r\n            restrict: 'A',\r\n            template: '<div class=\"input-group\">' +\r\n                '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">-</button></span>' +\r\n                '   <div ng-transclude></div>' +\r\n                '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">+</button></span>' +\r\n                '</div>',\r\n            replace: true,\r\n            transclude: true,\r\n            link: function(scope, element, attributes, model) {\r\n                var node = element[0];\r\n                var nodeRemove = node.querySelectorAll('.input-group-btn > .btn')[0];\r\n                var nodeAdd = node.querySelectorAll('.input-group-btn > .btn')[1];\r\n\r\n                function onRemove(e) {\r\n                    var min = $parse(attributes.min)(scope);\r\n                    var getter = $parse(attributes.numberPicker);\r\n                    var setter = getter.assign;\r\n                    $timeout(function() {\r\n                        setter(scope, Math.max(min, getter(scope) - 1));\r\n                    });\r\n                    // console.log('numberPicker.onRemove', min);\r\n                }\r\n\r\n                function onAdd(e) {\r\n                    var max = $parse(attributes.max)(scope);\r\n                    var getter = $parse(attributes.numberPicker);\r\n                    var setter = getter.assign;\r\n                    $timeout(function() {\r\n                        setter(scope, Math.min(max, getter(scope) + 1));\r\n                    });\r\n                    // console.log('numberPicker.onAdd', max);\r\n                }\r\n\r\n                function addListeners() {\r\n                    angular.element(nodeRemove).on('touchstart mousedown', onRemove);\r\n                    angular.element(nodeAdd).on('touchstart mousedown', onAdd);\r\n                }\r\n\r\n                function removeListeners() {\r\n                    angular.element(nodeRemove).off('touchstart mousedown', onRemove);\r\n                    angular.element(nodeAdd).off('touchstart mousedown', onAdd);\r\n                }\r\n                scope.$on('$destroy', function() {\r\n                    removeListeners();\r\n                });\r\n                addListeners();\r\n            }\r\n        };\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.directive('validate', ['$filter', function($filter) {\r\n        return {\r\n            require: 'ngModel',\r\n            link: function(scope, element, attributes, model) {\r\n                var type = attributes.validate;\r\n                var format = attributes.format || '';\r\n                var precision = attributes.precision || 2;\r\n                var focus = false;\r\n                // console.log('validate', type);\r\n                switch (type) {\r\n                    case 'date':\r\n                    case 'datetime':\r\n                    case 'datetime-local':\r\n                        model.$formatters.push(function(value) {\r\n                            if (value) {\r\n                                return $filter('date')(value, format);\r\n                            } else {\r\n                                return null;\r\n                            }\r\n                        });\r\n                        break;\r\n                    case 'number':\r\n                        model.$parsers.unshift(function(value) {\r\n                            var valid = false;\r\n                            if (value !== undefined && value !== \"\") {\r\n                                valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \r\n                                value = Number(value);\r\n                                model.$setValidity('number', valid);\r\n                                if (valid) {\r\n                                    model.$setValidity('positive', value >= 0.01);\r\n                                    if (attributes.min !== undefined) {\r\n                                        model.$setValidity('range', value >= Number(attributes.min));\r\n                                    }\r\n                                    if (attributes.max !== undefined) {\r\n                                        model.$setValidity('range', value <= Number(attributes.max));\r\n                                    }\r\n                                }\r\n                            } else {\r\n                                valid = true;\r\n                                value = Number(value);\r\n                                model.$setValidity('number', true);\r\n                                model.$setValidity('positive', true);\r\n                                if (attributes.min !== undefined) {\r\n                                    model.$setValidity('range', true);\r\n                                }\r\n                                if (attributes.max !== undefined) {\r\n                                    model.$setValidity('range', true);\r\n                                }\r\n                            }\r\n                            return value;\r\n                        });\r\n                        model.$formatters.push(function(value) {\r\n                            if (value) {\r\n                                return $filter('number')(value, precision) + ' ' + format;\r\n                            } else {\r\n                                return null;\r\n                            }\r\n                        });\r\n                        break;\r\n                    case 'anynumber':\r\n                        model.$parsers.unshift(function(value) {\r\n                            var valid = false;\r\n                            if (value !== undefined && value !== \"\") {\r\n                                valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \r\n                                value = Number(value);\r\n                                model.$setValidity('number', valid);\r\n                                if (valid) {\r\n                                    if (attributes.min !== undefined) {\r\n                                        model.$setValidity('range', value >= Number(attributes.min));\r\n                                    }\r\n                                    if (attributes.max !== undefined) {\r\n                                        model.$setValidity('range', value <= Number(attributes.max));\r\n                                    }\r\n                                }\r\n                            } else {\r\n                                valid = true;\r\n                                value = Number(value);\r\n                                model.$setValidity('number', true);\r\n                                if (attributes.min !== undefined) {\r\n                                    model.$setValidity('range', true);\r\n                                }\r\n                                if (attributes.max !== undefined) {\r\n                                    model.$setValidity('range', true);\r\n                                }\r\n                            }\r\n                            return value;\r\n                        });\r\n                        model.$formatters.push(function(value) {\r\n                            if (value || value === 0) {\r\n                                return $filter('number')(value, precision) + ' ' + format;\r\n                            } else {\r\n                                return null;\r\n                            }\r\n                        });\r\n                        break;\r\n                }\r\n\r\n                function onFocus() {\r\n                    focus = true;\r\n                    if (format) {\r\n                        element[0].value = model.$modelValue || null;\r\n                        if (!model.$modelValue) {\r\n                            model.$setViewValue(null);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                function doBlur() {\r\n                    if (format && !model.$invalid) {\r\n                        switch (type) {\r\n                            case 'date':\r\n                            case 'datetime':\r\n                            case 'datetime-local':\r\n                                element[0].value = model.$modelValue ? $filter('date')(model.$modelValue, format) : ' ';\r\n                                break;\r\n                            default:\r\n                                element[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\r\n                                break;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                function onBlur() {\r\n                    focus = false;\r\n                    doBlur();\r\n                }\r\n\r\n                function addListeners() {\r\n                    element.on('focus', onFocus);\r\n                    element.on('blur', onBlur);\r\n                }\r\n\r\n                function removeListeners() {\r\n                    element.off('focus', onFocus);\r\n                    element.off('blur', onBlur);\r\n                }\r\n                scope.$on('$destroy', function() {\r\n                    removeListeners();\r\n                });\r\n                addListeners();\r\n            }\r\n        };\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.directive('modalView', ['$parse', '$templateRequest', '$compile', '$controller', 'Utils', function($parse, $templateRequest, $compile, $controller, Utils) {\r\n\r\n        function compileController(scope, element, html, data) {\r\n            // console.log('modalView.compileController', element);\r\n            element.html(html);\r\n            var link = $compile(element.contents());\r\n            if (data.controller) {\r\n                var $scope = scope.$new();\r\n                angular.extend($scope, data);\r\n                var controller = $controller(data.controller, { $scope: $scope });\r\n                if (data.controllerAs) {\r\n                    scope[data.controllerAs] = controller;\r\n                }\r\n                element.data('$ngControllerController', controller);\r\n                element.children().data('$ngControllerController', controller);\r\n                scope = $scope;\r\n            }\r\n            link(scope);\r\n        }\r\n\r\n        return {\r\n            restrict: 'A',\r\n            priority: -400,\r\n            link: function(scope, element, attributes, model) {\r\n                var modal = $parse(attributes.modalView);\r\n                modal = modal(scope);\r\n                modal.templateUrl = modal.templateUrl || 'artisan/modals/modal';\r\n                $templateRequest(modal.templateUrl).then(function(html) {\r\n                    compileController(scope, element, html, modal);\r\n                });\r\n                /*\r\n                // window.scrollTo(0, element[0].offsetTop - 100);\r\n                function onClick(e) {\r\n                    var closest = Utils.getClosestElement(e.target, element[0]);\r\n                    if (closest === null) {\r\n                        modal.reject(null);\r\n                    }\r\n                    // console.log('onClick', closest);\r\n                }\r\n                function addListeners() {\r\n                    angular.element(window).on('click', onClick);\r\n                }\r\n                function removeListeners() {\r\n                    angular.element(window).off('click', onClick);\r\n                }\r\n                scope.$on('destroy', function () {\r\n                    removeListeners();\r\n                });\r\n                setTimeout(function () {\r\n                    addListeners();\r\n                }, 500);\r\n                */\r\n            }\r\n        };\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.provider('$modal', [function $modalProvider() {\r\n\r\n        var modals = [];\r\n        var routes = {};\r\n\r\n        this.modals = modals;\r\n        this.routes = routes;\r\n        this.when = when;\r\n\r\n        function when(path, modal) {\r\n            routes[path] = modal;\r\n            return this;\r\n        }\r\n\r\n        this.$get = ['$q', '$timeout', function modalFactory($q, $timeout) {\r\n\r\n            function popModal(modal) {\r\n                // console.log('modalProvider.popModal', modal);                \r\n                var index = -1;\r\n                angular.forEach(modals, function(m, i) {\r\n                    if (m === modal) {\r\n                        index = i;\r\n                    }\r\n                });\r\n                if (index !== -1) {\r\n                    $timeout(function() {\r\n                        modal.active = false;\r\n                        modals.splice(index, 1);\r\n                        if (modals.length) {\r\n                            modals[modals.length - 1].active = true;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n\r\n            function closeModal(modal) {\r\n                // console.log('modalProvider.closeModal', modal);                \r\n                var index = -1;\r\n                angular.forEach(modals, function(m, i) {\r\n                    if (m === modal) {\r\n                        index = i;\r\n                    }\r\n                });\r\n                if (index !== -1) {\r\n                    modal.active = false;\r\n                    $timeout(function() {\r\n                        while (modals.length) {\r\n                            modals.splice(modals.length - 1, 1);\r\n                        }\r\n                    }, 500);\r\n                }\r\n            }\r\n\r\n            function addModal(path, params) {\r\n                // console.log('modalProvider.addModal', path, params);\r\n                var deferred = $q.defer();\r\n                params = params || null;\r\n                var modal = {\r\n                    title: 'Untitled',\r\n                    controller: null,\r\n                    templateUrl: null,\r\n                    params: params,\r\n                };\r\n                var current = routes[path];\r\n                if (current) {\r\n                    angular.extend(modal, current);\r\n                }\r\n                modal.deferred = deferred;\r\n                modal.back = function(data) {\r\n                    popModal(this);\r\n                    modal.deferred.resolve(data, modal);\r\n                }\r\n                modal.resolve = function(data) {\r\n                    closeModal(this);\r\n                    modal.deferred.resolve(data, modal);\r\n                }\r\n                modal.reject = function() {\r\n                    closeModal(this);\r\n                    modal.deferred.reject(modal);\r\n                }\r\n                modals.push(modal);\r\n                angular.forEach(modals, function(m, i) {\r\n                    m.active = false;\r\n                });\r\n                if (modals.length) {\r\n                    modal.active = true;\r\n                } else {\r\n                    $timeout(function() {\r\n                        modal.active = true;\r\n                        // window.scrollTo(0, 0);\r\n                    }, 500);\r\n                }\r\n                return deferred.promise;\r\n            }\r\n\r\n            return {\r\n                modals: modals,\r\n                addModal: addModal,\r\n            };\r\n        }];\r\n\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.directive('nav', ['$parse', 'Nav', function ($parse, Nav) {\r\n\t\treturn {\r\n\t\t\trestrict: 'A',\r\n\t\t\ttemplateUrl: function (element, attributes) {\r\n\t\t\t\treturn attributes.template || 'artisan/nav/nav';\r\n\t\t\t},\r\n\t\t\tscope: {\r\n\t\t\t\titems: '=nav',\r\n\t\t\t},\r\n\t\t\tlink: function (scope, element, attributes, model) {\r\n\t\t\t\tscope.$watch('items', function (value) {\r\n\t\t\t\t\t// console.log(value instanceof Nav, value);\r\n\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\tif (angular.isArray(value)) {\r\n\t\t\t\t\t\t\tvar onLink = $parse(attributes.onLink)(scope.$parent);\r\n\t\t\t\t\t\t\tvar onNav = $parse(attributes.onNav)(scope.$parent);\r\n\t\t\t\t\t\t\tvar nav = new Nav({\r\n\t\t\t\t\t\t\t\tonLink: onLink,\r\n\t\t\t\t\t\t\t\tonNav: onNav\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tnav.setItems(value);\r\n\t\t\t\t\t\t\tscope.item = nav;\r\n\r\n\t\t\t\t\t\t} else if (value instanceof Nav) {\r\n\t\t\t\t\t\t\tscope.item = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n\tapp.directive('navItem', ['$timeout', function ($timeout) {\r\n\t\treturn {\r\n\t\t\trestrict: 'A',\r\n\t\t\ttemplateUrl: function (element, attributes) {\r\n\t\t\t\treturn attributes.template || 'artisan/nav/nav-item';\r\n\t\t\t},\r\n\t\t\tscope: {\r\n\t\t\t\titem: '=navItem',\r\n\t\t\t},\r\n\t\t\tlink: function (scope, element, attributes, model) {\r\n\t\t\t\tvar navItem = angular.element(element[0].querySelector('.nav-link'));\r\n\r\n\t\t\t\tvar output;\r\n\r\n\t\t\t\tfunction itemOpen(item, immediate) {\r\n\t\t\t\t\tvar state = item.$nav.state;\r\n\t\t\t\t\tstate.active = true;\r\n\r\n\t\t\t\t\t$timeout(function () {\r\n\t\t\t\t\t\tstate.immediate = immediate;\r\n\t\t\t\t\t\tstate.closed = state.closing = false;\r\n\t\t\t\t\t\tstate.opening = true;\r\n\t\t\t\t\t\t$timeout(function () {\r\n\t\t\t\t\t\t\tstate.opening = false;\r\n\t\t\t\t\t\t\tstate.opened = true;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction itemClose(item, immediate) {\r\n\t\t\t\t\tvar state = item.$nav.state;\r\n\t\t\t\t\tstate.active = false;\r\n\t\t\t\t\t$timeout(function () {\r\n\t\t\t\t\t\tstate.immediate = immediate;\r\n\t\t\t\t\t\tstate.opened = state.opening = false;\r\n\t\t\t\t\t\tstate.closing = true;\r\n\t\t\t\t\t\t$timeout(function () {\r\n\t\t\t\t\t\t\tstate.closing = false;\r\n\t\t\t\t\t\t\tstate.closed = true;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (item.items) {\r\n\t\t\t\t\t\tangular.forEach(item.items, function (o) {\r\n\t\t\t\t\t\t\titemClose(o, true);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction itemToggle(item) {\r\n\t\t\t\t\t// console.log('itemToggle', item);\r\n\t\t\t\t\tvar state = item.$nav.state;\r\n\t\t\t\t\tstate.active = item.items ? !state.active : true;\r\n\t\t\t\t\tif (state.active) {\r\n\t\t\t\t\t\tif (item.$nav.parent) {\r\n\t\t\t\t\t\t\tangular.forEach(item.$nav.parent.items, function (o) {\r\n\t\t\t\t\t\t\t\tif (o !== item) {\r\n\t\t\t\t\t\t\t\t\titemClose(o, true);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\titemOpen(item);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\titemClose(item);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// console.log(state);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction onTap(e) {\r\n\t\t\t\t\tvar item = scope.item;\r\n\t\t\t\t\t// console.log('Item.onTap', item);\r\n\t\t\t\t\tvar state = item.$nav.state;\r\n\t\t\t\t\tif (state.active) {\r\n\t\t\t\t\t\toutput = false;\r\n\t\t\t\t\t\ttrigger();\r\n\t\t\t\t\t} else if (item.$nav.onNav) {\r\n\t\t\t\t\t\tvar promise = item.$nav.onNav(item, item.$nav);\r\n\t\t\t\t\t\tif (promise && typeof promise.then === 'function') {\r\n\t\t\t\t\t\t\tpromise.then(function (resolved) {\r\n\t\t\t\t\t\t\t\t// go on\r\n\t\t\t\t\t\t\t\ttrigger();\r\n\t\t\t\t\t\t\t}, function (rejected) {\r\n\t\t\t\t\t\t\t\t// do nothing\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\toutput = false;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\toutput = promise;\r\n\t\t\t\t\t\t\ttrigger();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfunction trigger() {\r\n\t\t\t\t\t\t$timeout(function () {\r\n\t\t\t\t\t\t\titemToggle(item);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction onTouchStart(e) {\r\n\t\t\t\t\t// console.log('Item.onTouchStart', e);\r\n\t\t\t\t\tonTap(e);\r\n\t\t\t\t\tnavItem\r\n\t\t\t\t\t\t.off('mousedown', onMouseDown);\r\n\t\t\t\t\t// return r || prevent(e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction onMouseDown(e) {\r\n\t\t\t\t\t// console.log('Item.onMouseDown', e);\r\n\t\t\t\t\tonTap(e);\r\n\t\t\t\t\tnavItem\r\n\t\t\t\t\t\t.off('touchstart', onTouchStart);\r\n\t\t\t\t\t// return r || prevent(e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction onClick(e) {\r\n\t\t\t\t\t// console.log('Item.onClick', e);\r\n\t\t\t\t\treturn prevent(e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction prevent(e) {\r\n\t\t\t\t\tif (output === false) {\r\n\t\t\t\t\t\t// console.log('Item.prevent', e);\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t// e.stopPropagation();\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction addListeners() {\r\n\t\t\t\t\tnavItem\r\n\t\t\t\t\t\t.on('touchstart', onTouchStart)\r\n\t\t\t\t\t\t.on('mousedown', onMouseDown)\r\n\t\t\t\t\t\t.on('click', onClick);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction removeListeners() {\r\n\t\t\t\t\tnavItem\r\n\t\t\t\t\t\t.off('touchstart', onTouchStart)\r\n\t\t\t\t\t\t.off('mousedown', onMouseDown)\r\n\t\t\t\t\t\t.off('click', onClick);\r\n\t\t\t\t}\r\n\r\n\t\t\t\taddListeners();\r\n\r\n\t\t\t\tscope.$on('$destroy', function () {\r\n\t\t\t\t\tremoveListeners();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\r\n\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    app.factory('Nav', ['$silent', function($silent) {\r\n        function Nav(options) {\r\n            var nav = this;\r\n            var defaults = {\r\n                items: [],\r\n            }\r\n            angular.extend(nav, defaults);\r\n            if (options) {\r\n                angular.extend(nav, options);\r\n            }\r\n            nav.setNav(nav, null);\r\n        }\r\n        Nav.prototype = {\r\n            setItems: function(items) {\r\n                var nav = this;\r\n                nav.path = $silent.path();\r\n                nav.items = items;\r\n                nav.setNavs(items, nav);\r\n            },\r\n            setNavs: function(items, parent) {\r\n                var nav = this;\r\n                if (items) {\r\n                    angular.forEach(items, function(item) {\r\n                        nav.setNav(item, parent);\r\n                        nav.setNavs(item.items, item);\r\n                    });\r\n                }\r\n            },\r\n            setNav: function(item, parent) {\r\n                var nav = this;\r\n                var $nav = {\r\n                    parent: parent || null,\r\n                    level: parent ? parent.$nav.level + 1 : 0,\r\n                    state: {},\r\n                    addItems: function(x) {\r\n                        nav.addItems(x, item);\r\n                    },\r\n                    onNav: nav.onNav,\r\n                };\r\n                item.$nav = $nav;\r\n                $nav.link = nav.getLink(item);\r\n                if ($nav.link === nav.path) {\r\n                    $nav.state.active = true;\r\n                    $nav.state.opened = true;\r\n                    while ($nav.parent) {\r\n                        $nav = $nav.parent.$nav;\r\n                        $nav.state.active = true;\r\n                        $nav.state.opened = true;\r\n                    }\r\n                }\r\n            },\r\n            addItems: function(itemOrItems, parent) {\r\n                var nav = this;\r\n                if (angular.isArray(itemOrItems)) {\r\n                    angular.forEach(itemOrItems, function(item) {\r\n                        nav.addItem(item, parent);\r\n                    });\r\n                } else {\r\n                    nav.addItem(itemOrItems, parent);\r\n                }\r\n            },\r\n            addItem: function(item, parent) {\r\n                var nav = this,\r\n                    onLink = nav.onLink,\r\n                    onNav = nav.onNav;\r\n                nav.setNav(item, parent);\r\n                if (parent) {\r\n                    parent.items = parent.items || [];\r\n                    parent.items.push(item);\r\n                }\r\n            },\r\n            getLink: function(item) {\r\n                var link = null;\r\n                if (this.onLink) {\r\n                    link = this.onLink(item, item.$nav);\r\n                } else {\r\n                    link = item.link;\r\n                }\r\n                return link;\r\n            },\r\n        };\r\n        var statics = {\r\n            silent: function(path) {\r\n                $silent.silent(path);\r\n            },\r\n            path: function(path) {\r\n                $silent.path(path);\r\n            },\r\n        };\r\n        angular.extend(Nav, statics);\r\n        return Nav;\r\n    }]);\r\n\r\n}());\n/* global angular */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\twindow.ondragstart = function () {\r\n\t\treturn false;\r\n\t};\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.directive('scrollableX', ['$parse', '$compile', '$window', '$timeout', 'Scrollable', 'Animate', 'Style', 'Events', 'Utils', function ($parse, $compile, $window, $timeout, Scrollable, Animate, Style, Events, Utils) {\r\n\t\treturn {\r\n\t\t\trestrict: 'A',\r\n\t\t\ttemplate: '<div class=\"content\" ng-transclude></div>',\r\n\t\t\ttransclude: true,\r\n\t\t\tlink: function (scope, element, attributes, model) {\r\n\r\n\t\t\t\tvar scrollable, onLeft, onRight, showIndicatorFor, scrollableWhen;\r\n\t\t\t\tif (attributes.scrollableX) {\r\n\t\t\t\t\tscrollable = $parse(attributes.scrollableX)(scope);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tscrollable = new Scrollable();\r\n\t\t\t\t}\r\n\t\t\t\tif (attributes.onLeft !== undefined) {\r\n\t\t\t\t\tonLeft = $parse(attributes.onLeft);\r\n\t\t\t\t}\r\n\t\t\t\tif (attributes.onRight !== undefined) {\r\n\t\t\t\t\tonRight = $parse(attributes.onRight);\r\n\t\t\t\t}\r\n\t\t\t\tif (attributes.showIndicatorFor !== undefined) {\r\n\t\t\t\t\tshowIndicatorFor = $parse(attributes.showIndicatorFor);\r\n\t\t\t\t}\r\n\t\t\t\tif (attributes.scrollableWhen !== undefined) {\r\n\t\t\t\t\tscrollableWhen = $parse(attributes.scrollableWhen);\r\n\t\t\t\t}\r\n\t\t\t\tscrollable.link({\r\n\t\t\t\t\treset: function () {\r\n\t\t\t\t\t\tscrollable.doReset();\r\n\t\t\t\t\t\trender();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonLeft: onLeft,\r\n\t\t\t\t\tonRight: onRight,\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// ELEMENTS & STYLESHEETS;\r\n\t\t\t\telement.attr('unselectable', 'on').addClass('unselectable');\r\n\t\t\t\tvar containerNode = element[0];\r\n\t\t\t\tvar contentNode = containerNode.querySelector('.content');\r\n\t\t\t\tvar content = angular.element(content);\r\n\t\t\t\tvar contentStyle = new Style();\r\n\r\n\t\t\t\t/*\r\n\t\t\t\tvar indicator = null,\r\n\t\t\t\t\tindicatorNode = null,\r\n\t\t\t\t\tindicatorStyle;\r\n\t\t\t\tshowIndicatorFor = false;\r\n\t\t\t\tif (showIndicatorFor) {\r\n\t\t\t\t\tindicator = angular.element('<div class=\"indicator\"></div>');\r\n\t\t\t\t\tindicatorNode = indicator[0];\r\n\t\t\t\t\tindicatorStyle = new Style();\r\n\t\t\t\t\telement.append(indicator);\r\n\t\t\t\t\t$compile(indicator.contents())(scope);\r\n\t\t\t\t\tvar i = scrollbar.getIndicator();\r\n\t\t\t\t\tindicatorStyle.transform('translate3d(' + i.x.toFixed(2) + 'px,' + i.y.toFixed(2) + 'px,0)');\r\n\t\t\t\t\tindicatorStyle.set(indicatorNode);\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\r\n\t\t\t\tvar animate = new Animate(render);\r\n\r\n\t\t\t\tfunction render(time) {\r\n\t\t\t\t\tscrollable.setEnabled(isEnabled());\r\n\t\t\t\t\tscrollable.renderX();\r\n\t\t\t\t\tvar current = scrollable.getCurrent();\r\n\t\t\t\t\tcontentStyle.transform('translate3d(' + current.x.toFixed(2) + 'px,0,0)');\r\n\t\t\t\t\tcontentStyle.set(contentNode);\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tif (showIndicatorFor) {\r\n\t\t\t\t\t\tif (dragging || wheeling || speed) {\r\n\t\t\t\t\t\t\tvar percent = c.x / (containerNode.offsetWidth - contentNode.offsetWidth);\r\n\t\t\t\t\t\t\tpercent = Math.max(0, Math.min(1, percent));\r\n\t\t\t\t\t\t\ti.x = (containerNode.offsetWidth - indicatorNode.offsetWidth) * (percent);\r\n\t\t\t\t\t\t\ti.y += (0 - i.y) / 4;\r\n\t\t\t\t\t\t\t// var count = Math.round(contentNode.offsetWidth / 315);\r\n\t\t\t\t\t\t\tvar index = Math.max(1, Math.round(percent * showIndicatorFor.rows.length));\r\n\t\t\t\t\t\t\tindicator.html(index + '/' + showIndicatorFor.count);\r\n\t\t\t\t\t\t\t// indicator.html((percent * 100).toFixed(2).toString());\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ti.y += (45 - i.y) / 4;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tindicatorStyle.transform('translate3d(' + i.x.toFixed(2) + 'px,' + i.y.toFixed(2) + 'px,0)');\r\n\t\t\t\t\t\tindicatorStyle.set(indicatorNode);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t*/\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction undrag() {\r\n\t\t\t\t\tscrollable.off();\r\n\t\t\t\t\tdragOff();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction onDown(event) {\r\n\t\t\t\t\tif (event.type == 'touchstart') {\r\n\t\t\t\t\t\telement.off('mousedown', onDown);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (scrollable.dragStart(Utils.getTouch(event))) {\r\n\t\t\t\t\t\tdragOn();\r\n\t\t\t\t\t\tanimate.play();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction onMove(event) {\r\n\t\t\t\t\tif (event.type == 'touchmove') {\r\n\t\t\t\t\t\tangular.element($window).off('mousemove', onMove);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tscrollable.dragMove(Utils.getTouch(event));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction onUp(event) {\r\n\t\t\t\t\tif (event.type == 'touchend') {\r\n\t\t\t\t\t\tangular.element($window).off('mouseup', onUp);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tscrollable.dragEnd();\r\n\t\t\t\t\tdragOff();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction _onWheel(e) {\r\n\t\t\t\t\tif (!e) e = $window.event;\r\n\t\t\t\t\te = e.originalEvent ? e.originalEvent : e;\r\n\t\t\t\t\tvar dir = (((e.deltaY < 0 || e.wheelDelta > 0) || e.deltaY < 0) ? 1 : -1);\r\n\t\t\t\t\tvar shouldStopPageScrolling = scrollable.wheelX(dir);\r\n\t\t\t\t\tif (shouldStopPageScrolling) {\r\n\t\t\t\t\t\tanimate.play();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// event stop propagation not working\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar onWheel = Utils.throttle(_onWheel, 25);\r\n\t\t\t\t// var onWheel = _onWheel;\r\n\r\n\t\t\t\tfunction off() {\r\n\t\t\t\t\tdragOff();\r\n\t\t\t\t\tanimate.pause();\r\n\t\t\t\t\tscrollable.off();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction isEnabled() {\r\n\t\t\t\t\tvar enabled = true;\r\n\t\t\t\t\tif (scrollableWhen) {\r\n\t\t\t\t\t\tenabled = enabled && scrollableWhen(scope);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tenabled = enabled && $window.innerWidth >= 1024;\r\n\t\t\t\t\tenabled = enabled && (containerNode.offsetWidth < contentNode.offsetWidth);\r\n\t\t\t\t\treturn enabled;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction onResize() {\r\n\t\t\t\t\tscrollable.setContainer(containerNode);\r\n\t\t\t\t\tscrollable.setContent(contentNode);\r\n\t\t\t\t\tvar enabled = isEnabled();\r\n\t\t\t\t\tif (!enabled) {\r\n\t\t\t\t\t\toff();\r\n\t\t\t\t\t}\r\n\t\t\t\t\trender();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscope.$watch(function () {\r\n\t\t\t\t\treturn contentNode.offsetWidth;\r\n\t\t\t\t}, function (newValue, oldValue) {\r\n\t\t\t\t\tonResize();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tfunction addListeners() {\r\n\t\t\t\t\tangular.element($window).on('resize', onResize);\r\n\t\t\t\t\telement.on('touchstart mousedown', onDown);\r\n\t\t\t\t\telement.on('wheel', onWheel);\r\n\t\t\t\t\t/*\r\n\t\t\t\t\telement[0].addEventListener('DOMMouseScroll', onWheel, {\r\n\t\t\t\t\t\tpassive: false\r\n\t\t\t\t\t}); // for Firefox\r\n\t\t\t\t\telement[0].addEventListener('mousewheel', onWheel, {\r\n\t\t\t\t\t\tpassive: false\r\n\t\t\t\t\t}); // for everyone else\r\n\t\t\t\t\t*/\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction removeListeners() {\r\n\t\t\t\t\tangular.element($window).off('resize', onResize);\r\n\t\t\t\t\telement.off('touchstart mousedown', onDown);\r\n\t\t\t\t\telement.off('wheel', onWheel);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction dragOn() {\r\n\t\t\t\t\tangular.element($window).on('touchmove mousemove', onMove);\r\n\t\t\t\t\tangular.element($window).on('touchend mouseup', onUp);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction dragOff() {\r\n\t\t\t\t\tangular.element($window).off('touchmove mousemove', onMove);\r\n\t\t\t\t\tangular.element($window).off('touchend mouseup', onUp);\r\n\t\t\t\t}\r\n\t\t\t\tscope.$on('$destroy', function () {\r\n\t\t\t\t\tremoveListeners();\r\n\t\t\t\t\tanimate.pause();\r\n\t\t\t\t});\r\n\r\n\t\t\t\taddListeners();\r\n\r\n\t\t\t\t/*\r\n\t\t\t\tvar events = new Events(element).add({\r\n\t\t\t\t\tdown: onDown,\r\n\t\t\t\t\twheel: onWheel,\r\n\t\t\t\t}, scope);\r\n\r\n\t\t\t\tvar windowEvents = new Events($window).add({\r\n\t\t\t\t\tresize: onResize,\r\n\t\t\t\t}, scope);\r\n\r\n\t\t\t\tfunction dragOn() {\r\n\t\t\t\t\twindowEvents.add({\r\n\t\t\t\t\t\tmove: onMove,\r\n\t\t\t\t\t\tup: onUp,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction dragOff() {\r\n\t\t\t\t\twindowEvents.remove({\r\n\t\t\t\t\t\tmove: onMove,\r\n\t\t\t\t\t\tup: onUp,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscope.$on('$destroy', function () {\r\n\t\t\t\t\tanimate.pause();\r\n\t\t\t\t});\r\n\t\t\t\t*/\r\n\r\n\t\t\t},\r\n\t\t};\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\r\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module('artisan');\r\n\r\n\tapp.factory('Scrollable', ['Point', 'Rect', function (Point, Rect) {\r\n\t\tfunction Scrollable() {\r\n\r\n\t\t\tvar padding = 150;\r\n\t\t\tvar enabled, busy, dragging, wheeling, down, move, prev;\r\n\r\n\t\t\tvar start = new Point(),\r\n\t\t\t\tend = new Point(),\r\n\t\t\t\tcurrent = new Point(),\r\n\t\t\t\tindicator = new Point(),\r\n\t\t\t\tspeed = new Point(),\r\n\t\t\t\trect = new Rect(),\r\n\t\t\t\tcontainer = new Rect(),\r\n\t\t\t\tcontent = new Rect();\r\n\r\n\t\t\trect.top = rect.right = rect.bottom = rect.left = 0;\r\n\r\n\t\t\tvar scrollable = {\r\n\t\t\t\t// properties\r\n\t\t\t\tstart: start,\r\n\t\t\t\tend: end,\r\n\t\t\t\tcurrent: current,\r\n\t\t\t\tindicator: indicator,\r\n\t\t\t\tspeed: speed,\r\n\t\t\t\trect: rect,\r\n\t\t\t\tcontainer: container,\r\n\t\t\t\tcontent: content,\r\n\t\t\t\t// methods\r\n\t\t\t\tsetContainer: setContainer,\r\n\t\t\t\tsetContent: setContent,\r\n\t\t\t\tsetEnabled: setEnabled,\r\n\t\t\t\tgetCurrent: getCurrent,\r\n\t\t\t\tgetIndicator: getIndicator,\r\n\t\t\t\tbounceX: bounceX,\r\n\t\t\t\trenderX: renderX,\r\n\t\t\t\tscrollToX: scrollToX,\r\n\t\t\t\tdoLeft: doLeft,\r\n\t\t\t\tdoRight: doRight,\r\n\t\t\t\tdragStart: dragStart,\r\n\t\t\t\tdragMove: dragMove,\r\n\t\t\t\tdragEnd: dragEnd,\r\n\t\t\t\twheelX: wheelX,\r\n\t\t\t\tdoReset: doReset,\r\n\t\t\t\toff: off,\r\n\t\t\t};\r\n\r\n\t\t\tangular.extend(this, scrollable);\r\n\r\n\t\t\tscrollable = this;\r\n\r\n\t\t\tfunction setContainer(node) {\r\n\t\t\t\tcontainer.width = node.offsetWidth;\r\n\t\t\t\tcontainer.height = node.offsetHeight;\r\n\t\t\t}\r\n\r\n\t\t\tfunction setContent(node) {\r\n\t\t\t\tcontent.width = node.offsetWidth;\r\n\t\t\t\tcontent.height = node.offsetHeight;\r\n\t\t\t}\r\n\r\n\t\t\tfunction setEnabled(flag) {\r\n\t\t\t\tenabled = flag;\r\n\t\t\t}\r\n\r\n\t\t\tfunction getCurrent() {\r\n\t\t\t\treturn current;\r\n\t\t\t}\r\n\r\n\t\t\tfunction getIndicator() {\r\n\t\t\t\treturn indicator;\r\n\t\t\t}\r\n\r\n\t\t\tfunction bounceX() {\r\n\t\t\t\tvar padding = 100;\r\n\t\t\t\trect.left += padding;\r\n\t\t\t\trect.right -= padding;\r\n\t\t\t\tif (end.x > rect.left) {\r\n\t\t\t\t\tdoLeft();\r\n\t\t\t\t} else if (end.x < rect.right) {\r\n\t\t\t\t\tdoRight();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction renderX() {\r\n\t\t\t\tif (enabled) {\r\n\t\t\t\t\trect.left = 0;\r\n\t\t\t\t\trect.right = container.width - content.width;\r\n\t\t\t\t\tif (dragging) {\r\n\t\t\t\t\t\tend.x = start.x + move.x - down.x;\r\n\t\t\t\t\t\tbounceX();\r\n\t\t\t\t\t} else if (speed.x) {\r\n\t\t\t\t\t\tend.x += speed.x;\r\n\t\t\t\t\t\tspeed.x *= 0.75;\r\n\t\t\t\t\t\tif (wheeling) {\r\n\t\t\t\t\t\t\tbounceX();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (Math.abs(speed.x) < 0.05) {\r\n\t\t\t\t\t\t\tspeed.x = 0;\r\n\t\t\t\t\t\t\tend.x = start.x = current.x;\r\n\t\t\t\t\t\t\tscrollable.wheeling = false;\r\n\t\t\t\t\t\t\t// animate.pause();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tend.x = Math.min(rect.left, end.x);\r\n\t\t\t\t\tend.x = Math.max(rect.right, end.x);\r\n\t\t\t\t\tcurrent.x += (end.x - current.x) / 4;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcurrent.x = end.x = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction scrollToX(x) {\r\n\t\t\t\tstart.x = end.x = 0;\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\toff();\r\n\t\t\t\t\tbusy = false;\r\n\t\t\t\t}, 500);\r\n\t\t\t}\r\n\r\n\t\t\tfunction doLeft(scope) {\r\n\t\t\t\tif (busy) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (!scrollable.onLeft) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tbusy = true;\r\n\t\t\t\tscrollable.onLeft(scope).then().finally(function () {\r\n\t\t\t\t\tscrollToX(0);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfunction doRight(scope) {\r\n\t\t\t\tif (busy) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (!scrollable.onRight) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tbusy = true;\r\n\t\t\t\tscrollable.onRight(scope).then().finally(function () {\r\n\t\t\t\t\tvar right = container.width - content.width;\r\n\t\t\t\t\tif (right > rect.right) {\r\n\t\t\t\t\t\tstart.x = end.x = rect.right;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tstart.x = end.x = rect.right + padding;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tscrollToX(0);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfunction off() {\r\n\t\t\t\tdragging = false;\r\n\t\t\t\twheeling = false;\r\n\t\t\t\tmove = null;\r\n\t\t\t\tdown = null;\r\n\t\t\t}\r\n\r\n\t\t\tfunction dragStart(point) {\r\n\t\t\t\tif (!busy) {\r\n\t\t\t\t\tstart.x = end.x = current.x;\r\n\t\t\t\t\tstart.y = end.y = current.y;\r\n\t\t\t\t\tspeed.x = 0;\r\n\t\t\t\t\tspeed.y = 0;\r\n\t\t\t\t\tdown = point;\r\n\t\t\t\t\twheeling = false;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction dragMove(point) {\r\n\t\t\t\tprev = move;\r\n\t\t\t\tmove = point;\r\n\t\t\t\tdragging = true;\r\n\t\t\t}\r\n\r\n\t\t\tfunction dragEnd() {\r\n\t\t\t\tif (move && prev) {\r\n\t\t\t\t\tspeed.x += (move.x - prev.x) * 4;\r\n\t\t\t\t\tspeed.y += (move.y - prev.y) * 4;\r\n\t\t\t\t}\r\n\t\t\t\tstart.x = end.x = current.x;\r\n\t\t\t\tstart.y = end.y = current.y;\r\n\t\t\t\tdragging = false;\r\n\t\t\t\tmove = null;\r\n\t\t\t\tdown = null;\r\n\t\t\t\tprev = null;\r\n\t\t\t}\r\n\r\n\t\t\tfunction incrementX() {\r\n\t\t\t\tvar increment = (content.width - container.width) / 20;\r\n\t\t\t\tincrement = Math.min(10, Math.max(100, increment));\r\n\t\t\t\treturn increment;\r\n\t\t\t}\r\n\r\n\t\t\tfunction wheelX(dir) {\r\n\t\t\t\tif (!busy && enabled) {\r\n\t\t\t\t\tend.x += dir * content.height;\r\n\t\t\t\t\tspeed.x += dir * 5;\r\n\t\t\t\t\t// speed.x += dir * incrementX();\r\n\t\t\t\t\twheeling = true;\r\n\t\t\t\t\treturn (end.x + speed.x < rect.left && end.x + speed.x > rect.right);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction doReset() {\r\n\t\t\t\tend.x = current.x = 0;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction link(methods) {\r\n\t\t\tangular.extend(this, methods);\r\n\t\t}\r\n\r\n\t\tScrollable.prototype = {\r\n\t\t\tlink: link,\r\n\t\t};\r\n\t\treturn Scrollable;\r\n    }]);\r\n\r\n}());\r\n\n/* global angular */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    var app = angular.module('artisan');\r\n\r\n    // micro interactions\r\n\r\n    function tap(Events) {\r\n        return {\r\n            restrict: 'A',\r\n            priority: 0,\r\n            link: link\r\n        };\r\n\r\n        function link(scope, element, attributes, model) {\r\n            if (attributes.ngBind) {\r\n                return;\r\n            }\r\n            if (attributes.href === '#' && !attributes.ngHref && !attributes.ngClick) {\r\n                return;\r\n            }\r\n\r\n            element.addClass('interaction-tap');\r\n            var node = document.createElement('interaction');\r\n            element[0].appendChild(node);\r\n\r\n            function onDown(e) {\r\n                element.removeClass('interaction-animate');\r\n                void element.offsetWidth;\r\n                // node.style.animationPlayState = \"paused\";\r\n                node.style.left = e.relative.x + 'px';\r\n                node.style.top = e.relative.y + 'px';\r\n                setTimeout(function() {\r\n                    element.addClass('interaction-animate');\r\n                    setTimeout(function() {\r\n                        element.removeClass('interaction-animate');\r\n                    }, 1000);\r\n                }, 10);\r\n\r\n                // console.log('tap.onDown', node, node.parentElement);\r\n            }\r\n            var listeners = { // down, move, up, click\r\n                down: onDown,\r\n            };\r\n            var events = new Events(element).add(listeners, scope); // passing scope to add remove listeners automatically on $destroy\r\n        }\r\n    }\r\n    app.directive('href', ['Events', tap]);\r\n    app.directive('ngClick', ['Events', tap]);\r\n\r\n}());"]}